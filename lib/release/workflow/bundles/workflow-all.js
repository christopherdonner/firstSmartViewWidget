csui.define("workflow/toolbars/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/toolbars/impl/nls/root/lang",{"NodesTableToolbarInitiateLabel":"Start workflow"}),csui.define("css!workflow/toolbars/impl/workflow.nodestable.toolbaritems",[],function(){}),csui.define("workflow/toolbars/workflow.nodestable.toolbaritems",["i18n!workflow/toolbars/impl/nls/lang","css!workflow/toolbars/impl/workflow.nodestable.toolbaritems"],function(e){return{"tableHeaderToolbar":[{"signature":"InitiateWorkflow","name":e.NodesTableToolbarInitiateLabel,"icon":"icon icon-toolbar-wfinitiate","group":"main"},{"signature":"InitiateDocumentWorkflow","name":e.NodesTableToolbarInitiateLabel,"group":"main"}],"inlineActionbar":[{"signature":"InitiateWorkflow","name":e.NodesTableToolbarInitiateLabel,"icon":"icon icon-toolbar-wfinitiate","group":"other"},{"signature":"InitiateDocumentWorkflow","name":e.NodesTableToolbarInitiateLabel,"icon":"icon icon-toolbar-wfinitiate","group":"other"}]}}),csui.define("workflow/utils/workitem.extension.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/log"],function(e,t,i){function s(e){this.context=e.context}return e.extend(s.prototype,{"initialize":function(){},"validate":function(){return!1},"execute":function(){var e=t.Deferred();return e.resolve(),e.promise()},"executeAction":function(){var e=t.Deferred();return e.resolve(),e.promise()}}),s.extend=i.Model.extend,s.ExtensionPoints={"AddSidebar":1,"AddForm":2,"FullView":3},s}),csui.define("workflow/models/activity/activity.model",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone"],function(e,t,i){var s=i.Model.extend({"constructor":function(e,t){t||(t={}),this.connector=t.connector||t.collection.connector,i.Model.prototype.constructor.apply(this,arguments)}});return s}),csui.define("workflow/models/activity/activity.collection.model",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","workflow/models/activity/activity.model"],function(e,t,i,s,n){var o=i.Collection.extend({"model":n,"url":function(){var e=this.connector.connection.url.replace("/v1","/v2");return s.combine(e,"processes",this._processId,"subprocesses",this._subprocessId,"activities")},"parse":function(e){return e.results.data},"constructor":function(e,t){i.Collection.prototype.constructor.apply(this,arguments),t&&t.connector&&t.connector.assignTo(this)},"isFetchable":function(){return void 0!==this._processId&&void 0!==this._subprocessId?!0:!1},"setData":function(e){this._processId=e.processId,this._subprocessId=e.subprocessId}});return o}),csui.define("workflow/models/activity/activity.collection.model.factory",["csui/lib/jquery","csui/lib/underscore","csui/utils/contexts/factories/factory","csui/utils/contexts/factories/connector","workflow/models/activity/activity.collection.model"],function(e,t,i,s,n){var o=i.extend({"propertyPrefix":"activities","constructor":function(e,t){i.prototype.constructor.apply(this,arguments);var o=e.getObject(s,t);this.context=e,this.property=new n(void 0,{"connector":o})},"isFetchable":function(){return this.property.isFetchable()},"fetch":function(e){return this.property.fetch(e)}});return o}),csui.define("workflow/widgets/workitem/workitem.activities/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/workitem/workitem.activities/impl/nls/root/lang",{"actionLabel":"Action taken","actionAriaLabel":"Action taken by","actionTextAttachmentAttach":"Attach","actionTextAttachmentUpdate":"Update","actionTextForward":"Forward","actionTextReassign":"Re-assign","actionTextReview":"Send for review","actionTextReply":"Reply","actionTextSendOn":"Send on","actionTextStart":"Start","actionTextForwardTo":"Forwarded to:","actionTextReassignTo":"Reassigned to:","actionTextReviewTo":"Sent to:","viewTitle":"Activities","anonymousUserName":"Anonymous User","dateAria":"{0}: Date of Activity","activityAria":"{0}:{1} at {2}:{3}","linkTitleAria":"{0} of type {1}"}),csui.define("hbs!workflow/widgets/workitem/workitem.activities/impl/activity.item",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e,t){var i;return'    <div class="attachment">\r\n      <div class="attachment-icon">'+this.escapeExpression((i=null!=(i=t.attachmentIcon||(null!=e?e.attachmentIcon:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"attachmentIcon","hash":{}}):i))+'</div>\r\n      <div class="attachment-name">\r\n        <a href="'+this.escapeExpression((i=null!=(i=t.attachmentUrl||(null!=e?e.attachmentUrl:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"attachmentUrl","hash":{}}):i))+'" aria-describedby="'+this.escapeExpression((i=null!=(i=t.attachmentDescID||(null!=e?e.attachmentDescID:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"attachmentDescID","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.attachmentName||(null!=e?e.attachmentName:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"attachmentName","hash":{}}):i))+'</a>\r\n      </div>\r\n    </div>\r\n    <p id="'+this.escapeExpression((i=null!=(i=t.attachmentDescID||(null!=e?e.attachmentDescID:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"attachmentDescID","hash":{}}):i))+'" class="attachment-desc">'+this.escapeExpression((i=null!=(i=t.attachmentDesc||(null!=e?e.attachmentDesc:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"attachmentDesc","hash":{}}):i))+"</p>\r\n"},"3":function(e,t,i,s){var n;return(null!=(n=t["if"].call(e,null!=e?e.comment:e,{"name":"if","hash":{},"fn":this.program(4,s,0),"inverse":this.noop}))?n:"")+(null!=(n=t["if"].call(e,null!=e?e.reassign:e,{"name":"if","hash":{},"fn":this.program(6,s,0),"inverse":this.noop}))?n:"")},"4":function(e,t){var i;return'      <p class="comment" title ="'+this.escapeExpression((i=null!=(i=t.commentText||(null!=e?e.commentText:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"commentText","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.commentText||(null!=e?e.commentText:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"commentText","hash":{}}):i))+"</p>\r\n"},"6":function(e,t){var i;return'      <div class="reassign">\r\n        <p class="reassign-label">'+this.escapeExpression((i=null!=(i=t.reassignLabel||(null!=e?e.reassignLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"reassignLabel","hash":{}}):i))+'</p>\r\n        <div class="reassign-user"></div>\r\n      </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n,o;return'<div class="activity-item">\r\n  <div class="header">\r\n    <div hidden id='+this.escapeExpression((o=null!=(o=t.ariaDescribedById||(null!=e?e.ariaDescribedById:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"ariaDescribedById","hash":{}}):o))+">"+this.escapeExpression((o=null!=(o=t.activityAriaDescription||(null!=e?e.activityAriaDescription:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"activityAriaDescription","hash":{}}):o))+'</div>\r\n    <div class="details">\r\n      <div class="user"></div>\r\n      <p class="date" aria-label="'+this.escapeExpression((o=null!=(o=t.dateAria||(null!=e?e.dateAria:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"dateAria","hash":{}}):o))+'" title="'+this.escapeExpression((o=null!=(o=t.exactDate||(null!=e?e.exactDate:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"exactDate","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.date||(null!=e?e.date:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"date","hash":{}}):o))+'</p>\r\n    </div>\r\n    <p class="action">\r\n      <span class="action-label">'+this.escapeExpression((o=null!=(o=t.actionLabel||(null!=e?e.actionLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"actionLabel","hash":{}}):o))+'</span>\r\n      <span class="action-text">'+this.escapeExpression((o=null!=(o=t.action||(null!=e?e.action:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"action","hash":{}}):o))+"</span>\r\n    </p>\r\n  </div>\r\n"+(null!=(n=t["if"].call(e,null!=e?e.attachment:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.program(3,s,0)}))?n:"")+"</div>\r\n"}});return i.registerPartial("workflow_widgets_workitem_workitem.activities_impl_activity.item",s),s}),csui.define("css!workflow/widgets/workitem/workitem.activities/impl/activity.item",[],function(){}),csui.define("workflow/widgets/workitem/workitem.activities/impl/activity.item.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/behaviors/default.action/default.action.behavior","csui/controls/form/fields/userfield.view","csui/controls/node-type.icon/node-type.icon.view","csui/models/member","csui/models/node/node.model","csui/utils/base","csui/utils/commands/open","csui/utils/nodesprites","i18n!workflow/widgets/workitem/workitem.activities/impl/nls/lang","hbs!workflow/widgets/workitem/workitem.activities/impl/activity.item","css!workflow/widgets/workitem/workitem.activities/impl/activity.item"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m){var p=s.LayoutView.extend({"className":"workflow-activity","template":m,"tagName":"li","templateHelpers":function(){this.activityAriaDescribedById=e.uniqueId("ActivityDescID_");var t,i=this._getAttachmentInfo(),s=this.model.get("comment"),n=this._getAuditDate(!0),o=this._getAuditAction();t=s&&0!==s.length?s:"";var a=e.str.sformat(h.activityAria,h.actionLabel,o,n,t);return{"date":n,"exactDate":this._getAuditDate(!1),"actionLabel":h.actionLabel,"action":o,"comment":s&&0!==s.length,"commentText":s,"reassign":this._isReassignAction(),"reassignLabel":this._getReassignLabel(),"attachment":i.isAttachmentAction,"attachmentUrl":i.url,"attachmentName":i.name,"attachmentDesc":i.description,"attachmentDisabled":this._hasAttachmentOpenAction(),"dateAria":h.dateAria.replace("{0}",n),"attachmentDescID":e.uniqueId("descID_"),"activityAriaDescription":a,"ariaDescribedById":this.activityAriaDescribedById}},"events":{"click .attachment-name > a":"onDownloadAttachment"},"_getAuditDate":function(e){return e===!0?c.formatFriendlyDateTime(this.model.get("date")):c.formatExactDateTime(this.model.get("date"))},"_getAuditAction":function(){var e,t=this.model.get("action");switch(t){case"start":t=h.actionTextStart;break;case"sendon":t=h.actionTextSendOn;break;case"forward":t=h.actionTextForward;break;case"review":t=h.actionTextReview;break;case"reassign":t=h.actionTextReassign;break;case"reply":t=h.actionTextReply;break;case"disposition":e=this.model.get("action_properties"),t=e.label||e.event;break;case"attachment":switch(e=this.model.get("action_properties"),e.event){case"create":t=h.actionTextAttachmentAttach;break;case"addversion":t=h.actionTextAttachmentUpdate}}return t},"_isReassignAction":function(){var e=this.model.get("action");return"forward"===e||"review"===e||"reassign"===e},"_isAttachmentAction":function(){var e=this.model.get("action");return"attachment"===e},"_hasAttachmentOpenAction":function(){return this.nodeModel&&this.nodeModel.actions.get("open")},"_getAttachmentInfo":function(){var t={"isAttachmentAction":this._isAttachmentAction()};if(t.isAttachmentAction===!0){var s=this.model.get("action_properties").node;e.isUndefined(s)||(t.id=s.id,t.name=s.name,t.description=s.description,t.type=s.type,t.mime_type=s.mime_type,t.url=n.getDefaultActionNodeUrl(new i.Model(s,{"connector":this.model.connector})))}return t},"_getReassignLabel":function(){var e=this.model.get("action");switch(e){case"forward":e=h.actionTextForwardTo;break;case"reassign":e=h.actionTextReassignTo;break;case"review":e=h.actionTextReviewTo}return e},"regions":{"userRegion":".activity-item .user","reassignUserRegion":".activity-item .reassign-user","attachmentIconRegion":".activity-item .attachment-icon"},"constructor":function(e){e||(e={}),s.LayoutView.prototype.constructor.apply(this,arguments)},"onDownloadAttachment":function(e){e.preventDefault(),this._hasAttachmentOpenAction()&&(new d).execute({"nodes":new i.Collection([this.nodeModel])},{"context":this.options.context})},"onRender":function(){var s=this,n=t.Deferred(),c=this.model.get("user_id");if(c&&0!==c){var d=new r({"id":c},{"connector":s.options.connector});n=d.fetch()}else n.resolve({"data":{"display_name":h.anonymousUserName}});if(t.when(n).then(function(e){var t=new o({"context":s.options.context,"mode":"readonly","model":new i.Model({"data":e.data,"schema":{"readonly":!0}}),"alpaca":{"options":{}}});s.listenTo(t,"render",function(){var e=t.$("a.esoc-user-container").attr("aria-label");t.$("a.esoc-user-container").attr("aria-label",h.actionAriaLabel+e),t.$("a.esoc-user-container").attr("aria-describedby",this.activityAriaDescribedById)}),s.userRegion&&s.userRegion.show(t)}),this._isReassignAction()===!0){var m=t.Deferred(),p=this.model.get("action_properties").user_id;if(p&&0!==p){var f=new r({"id":p},{"connector":s.options.connector});m=f.fetch()}else m.resolve({"data":{"display_name":h.anonymousUserName}});t.when(m).then(function(e){var t=new o({"context":s.options.context,"mode":"readonly","model":new i.Model({"data":e.data,"schema":{"readonly":!0}}),"alpaca":{"options":{}}});s.listenTo(t,"render",function(){var e=t.$("a.esoc-user-container").attr("aria-label"),i=this._getReassignLabel();t.$("a.esoc-user-container").attr("aria-label",i.substring(0,i.length-1)+e)}),s.reassignUserRegion.show(t)})}this._isAttachmentAction()===!0&&(s.nodeModel=new l(this._getAttachmentInfo(),{"connector":this.options.connector,"expand":{"properties":["original_id"]},"commands":["open"],"defaultActionCommands":["open"]}),s.nodeModel.fetch().then(function(){var t=new a({"node":s.nodeModel});s.attachmentIconRegion.show(t),s._hasAttachmentOpenAction()||s.$(".attachment > div").addClass("disabled");var i,n=u.findByNode(s.nodeModel)||{};n.attributes&&(i=n.get("mimeType"));var o=i||s.nodeModel.get("type_name")||s.nodeModel.get("type");if(s.nodeModel.get("name")&&o){var r=e.str.sformat(h.linkTitleAria,s.nodeModel.get("name"),o);s.$(".attachment-name a").attr("aria-label",r)}}))}});return p}),csui.define("workflow/widgets/workitem/workitem.activities/impl/activity.list.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/behaviors/keyboard.navigation/tabable.region.behavior","workflow/models/activity/activity.collection.model.factory","workflow/widgets/workitem/workitem.activities/impl/activity.item.view","i18n!workflow/widgets/workitem/workitem.activities/impl/nls/lang"],function(e,t,i,s,n,o){var a=i.CollectionView.extend({"className":"workflow-activity-list","childView":o,"tagName":"ul","focusableElements":[],"childViewOptions":function(){return{"context":this.options.context,"connector":this.collection.connector}},"behaviors":{"TabableRegion":{"behaviorClass":s}},"events":{"keydown":"onKeyDown"},"selectedIndex":0,"onKeyDown":function(e){var t;switch(e.keyCode){case 38:t=this.currentlyFocusedElement(),this._moveTo(e,this._selectPrevious(),t);break;case 40:t=this.currentlyFocusedElement(),this._moveTo(e,this._selectNext(),t)}},"_moveTo":function(t,i,s){t.preventDefault(),t.stopPropagation(),setTimeout(e.bind(function(){i.focus(),s.prop("tabindex","-1"),i.prop("tabindex","0")},this),50)},"_selectNext":function(){return this.selectedIndex<this.focusableElements.length-1&&this.selectedIndex++,this.currentlyFocusedElement()},"_selectPrevious":function(){return this.selectedIndex>0&&this.selectedIndex--,this.currentlyFocusedElement()},"currentlyFocusedElement":function(){this.focusableElements=[];var i=this.$("li"),s=this;e.each(i,function(i){var n=t(i).find(".esoc-user-container");e.each(n,function(e){s.focusableElements.push(e)});var o=t(i).find(".attachment-name > a");e.each(o,function(e){s.focusableElements.push(e)})});var n=this.focusableElements.length>this.selectedIndex?this.$(this.focusableElements[this.selectedIndex]):null;return n},"constructor":function(e){e||(e={}),e.collection=e.collection?e.collection:e.context.getModel(n),void 0!==e.processId&&void 0!==e.subprocessId&&e.collection.setData({"processId":e.processId,"subprocessId":e.subprocessId}),i.CollectionView.prototype.constructor.apply(this,arguments)}});return a}),csui.define("hbs!workflow/widgets/workitem/workitem.activities/impl/workitem.activities",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workflow-activities" tabindex="-1"></div>\r\n'}});return i.registerPartial("workflow_widgets_workitem_workitem.activities_impl_workitem.activities",s),s}),csui.define("css!workflow/widgets/workitem/workitem.activities/impl/workitem.activities",[],function(){}),csui.define("workflow/widgets/workitem/workitem.activities/workitem.activities.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","workflow/widgets/workitem/workitem.activities/impl/activity.list.view","hbs!workflow/widgets/workitem/workitem.activities/impl/workitem.activities","css!workflow/widgets/workitem/workitem.activities/impl/workitem.activities"],function(e,t,i,s,n,o,a){var r=i.LayoutView.extend({"className":"workflow-activities-container","template":a,"regions":{"activitiesListRegion":".workflow-activities"},"constructor":function(e){this.options=e||(e={}),i.LayoutView.prototype.constructor.apply(this,arguments),this.propagateEventsToRegions()},"behaviors":{"ScrollingBehavior":{"behaviorClass":s,"contentParent":".workflow-activities","suppressScrollX":!0}},"onRender":function(){var e=new o(this.options);this.activitiesListRegion.show(e)}});return e.extend(r.prototype,n),r}),csui.define("workflow/widgets/workitem/workitem.activities/workitem.activities.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/log","csui/utils/contexts/factories/node","workflow/utils/workitem.extension.controller","workflow/models/activity/activity.collection.model.factory","workflow/widgets/workitem/workitem.activities/workitem.activities.view","i18n!workflow/widgets/workitem/workitem.activities/impl/nls/lang"],function(e,t,i,s,n,o,a,r,l,c){var d=a.extend({"type":100,"sub_type":100,"position":2,"constructor":function(e,t){a.prototype.constructor.apply(this,arguments),t||(t={}),this.context=e.context},"validate":function(e,t){return e===this.type&&t===this.sub_type?!0:!1},"execute":function(e){var i=t.Deferred();if(e.extensionPoint!==a.ExtensionPoints.AddSidebar||e.model.get("isDraft")||void 0!==e.model.get("isDoc")||void 0!==e.model.get("isDocDraft"))return i.resolve({}),i.promise();var s=this.context.getModel(r);s.setData({"processId":e.model.get("process_id"),"subprocessId":e.model.get("subprocess_id")}),s.fetch();var n={"title":c.viewTitle,"position":this.position,"viewToRender":l,"viewToRenderOptions":{"context":this.context,"collection":s}};return i.resolve(n),i.promise()}});return d}),csui.define("workflow/behaviors/list.keyboard.behavior",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette"],function(e,t,i,s){var n=s.Behavior.extend({"defaults":{"currentlyFocusedElementSelector":"li:nth-child({0})"},"constructor":function(e,n){s.Behavior.prototype.constructor.apply(this,arguments),t.extend(n,{"selectedIndex":0,"$inlineItems":void 0,"inlineItemIndex":0,"inlineDropDownIsOpenSelector":"","$inlineItemsDropDown":void 0,"inlineItemDropDownIndex":-1,"onKeyDown":function(e){var t;switch(e.keyCode){case 27:this.inlineItemDropDownIndex=-1;break;case 38:void 0!==this.$inlineItemsDropDown&&0!==this.$inlineItemsDropDown.length&&this.$(this.inlineDropDownIsOpenSelector).length>0?this._moveInlineMenu(e,this._selectPreviousInlineElementMenu()):(t=this.currentlyFocusedElement(),this._moveTo(e,this._selectPrevious(),t));break;case 40:void 0!==this.$inlineItemsDropDown&&0!==this.$inlineItemsDropDown.length&&this.$(this.inlineDropDownIsOpenSelector).length>0?this._moveInlineMenu(e,this._selectNextInlineElementMenu()):(t=this.currentlyFocusedElement(),this._moveTo(e,this._selectNext(),t));break;case 39:i(e.target).hasClass("cs-input")||0!==this.$inlineItems.length&&0===this.$(this.inlineDropDownIsOpenSelector).length&&this._moveInline(e,this._selectNextInlineElement());break;case 37:i(e.target).hasClass("cs-input")||0!==this.$inlineItems.length&&0===this.$(this.inlineDropDownIsOpenSelector).length&&this._moveInline(e,this._selectPreviousInlineElement())}},"_moveInlineMenu":function(e,i){e.preventDefault(),e.stopPropagation(),setTimeout(t.bind(function(){this.$inlineItemsDropDown.prop("tabindex","-1"),i.focus(),i.prop("tabindex","0")},this),50)},"_selectNextInlineElementMenu":function(){return this.inlineItemDropDownIndex<this.$inlineItemsDropDown.length-1&&this.inlineItemDropDownIndex++,this.$(this.$inlineItemsDropDown[this.inlineItemDropDownIndex])},"_selectPreviousInlineElementMenu":function(){return this.inlineItemDropDownIndex>0&&this.inlineItemDropDownIndex--,this.$(this.$inlineItemsDropDown[this.inlineItemDropDownIndex])},"_moveInline":function(e,i){e.preventDefault(),e.stopPropagation(),setTimeout(t.bind(function(){this.$inlineItems.prop("tabindex","-1"),i.focus(),i.prop("tabindex","0")},this),50)},"_selectNextInlineElement":function(){return this.inlineItemIndex<this.$inlineItems.length-1&&this.inlineItemIndex++,this.$(this.$inlineItems[this.inlineItemIndex])},"_selectPreviousInlineElement":function(){return this.inlineItemIndex>0&&this.inlineItemIndex--,this.$(this.$inlineItems[this.inlineItemIndex])},"_moveTo":function(e,i,s){e.preventDefault(),e.stopPropagation(),setTimeout(t.bind(function(){i.focus(),s.prop("tabindex","-1"),i.prop("tabindex","0")},this),50)},"_selectNext":function(){var e=this.collection||this.model;return this.selectedIndex<e.length-1&&this.selectedIndex++,this.currentlyFocusedElement()},"_selectPrevious":function(){return this.selectedIndex>0&&this.selectedIndex--,this.currentlyFocusedElement()},"currentlyFocusedElementSelector":this.options.currentlyFocusedElementSelector,"currentlyFocusedElement":function(){var e=this.collection||this.model;0!==this.selectedIndex&&this.selectedIndex>=e.length&&(this.selectedIndex=e.length-1);var t=this.$(this.currentlyFocusedElementSelector),i=t.length>this.selectedIndex?this.$(t[this.selectedIndex]):null;return i}})}});return n}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/nls/root/lang",{"TabTitle":"Attachments","AddToolbarItemLabel":"Add attachment","AddFromContentServerLabel":"Add from Content Server","AddFromDesktopLabel":"Add from Desktop","AddShortcutLabel":"Add shortcut","AddDocumentLabel":"Add document(s)","ButtonLabelAdd":"Add","CommandNameAdd":"Add","CommandVerbAdd":"add","CommandDoneVerbAdd":"copied","AddPageLeavingWarning":"If you leave the page now, pending items will not be added.","AddingOneFile":"Adding file","AddFilesSucceeded":"{0} files succeeded.","AddOneFileSucceeded":"Add succeeded.","AddFiles":"Adding {0} files","AddFilesFailed":"{2} files failed to add.","AddFilesOneFailed":"1 file failed to add.","CopyOneFileFailed":"Copy failed","CopyingNodes":"Copying {0} nodes","CopyingNode":"Copying 1 node","DropMessage":"Drop your item(s) here","EmptyDragAndDropMessage":"Drag and drop files here","MessageItemCopied":"{0} item copied.","MessageItemsCopied":"{0} items copied.","AddingNodes":"Adding {0} nodes","AddingNode":"Adding 1 node","MessageItemAdded":"{0} item Added.","MessageItemsAdded":"{0} items Added.","ErrorMessageLoadAttachments":"Workflow attachments could not be loaded.","DescriptionPlaceholder":"Add description","NamePlaceholder":"Enter file name","FileAlreadyExists":"An item with the name '{0}' already exists","MaxLengthReached":"This field must contain at most 248 numbers or characters.","Cancel":"Cancel","NoFiles":"No files were dropped.","AddTypeDenied":"Cannot add documents to {1}.","AttachmentsFailMessageTitle":"Unable to start the workflow","AttachmentsFailMessage":"An error prevented {0} from being attached to the workflow.","linkTitleAria":"{0} of type {1}"}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.draganddrop.view",["csui/lib/underscore","csui/lib/marionette","csui/controls/draganddrop/draganddrop.view","csui/controls/fileupload/fileupload","csui/controls/globalmessage/globalmessage","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang"],function(e,t,i,s,n,o){var a=i.extend({"constructor":function(e){i.prototype.constructor.call(this,e)},"templateHelpers":function(){var e=i.prototype.templateHelpers.apply(this,arguments),t=o.DropMessage;return void 0!==e.message&&""!==e.message?(e.message=t,{"message":e.message}):{"message":t}},"onDropView":function(t){t.preventDefault(),t.stopPropagation();var i=this,a=t.originalEvent&&t.originalEvent.dataTransfer||{"files":t.originalEvent&&t.originalEvent.target&&t.originalEvent.target.files||[]};this._selectFiles(a).always(function(t){if(t=e.reject(t,function(e){return e instanceof Error}),t.length)if(1===t.length&&(i.collection.singleFileUpload=!0),i.canAdd()){var a=s.newUpload(e.extend({"originatingView":i.parentView},e.clone(i.options)));a.addFilesToUpload(t,{"collection":i.collection})}else{var r=i.container.get("name");n.showMessage("error",o.AddTypeDenied.replace("{1}",r))}else n.showMessage("error",o.NoFiles)}),this.disable()}});return a}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachment.tableactionbar",["csui/lib/backbone","csui/controls/tableactionbar/tableactionbar.view","csui/models/nodes","csui/utils/commandhelper","csui/utils/commands/properties"],function(e,t,i,s,n){var o=t.extend({"onChildviewToolitemAction":function(t,o){var a,r=o.toolItem.get("signature"),l=this.commands.findWhere({"signature":r}),c={"nodes":new i([this.model]),"container":this.container,"collection":this.containerCollection,"originatingView":this.originatingView,"context":this.options.context};e.trigger("closeToggleAction"),"Properties"===r?(this.originatingView.collection.propertiesAction=!0,this.propertiesCommand=new n,a=this.propertiesCommand.execute(c)):a=l.execute(c),s.handleExecutionResults(a,{"command":l,"suppressSuccessMessage":c.suppressSuccessMessage})}});return o}),csui.define("workflow/widgets/workitem/workitem.attachments/workitem.attachments.toolbaritems",["csui/lib/underscore","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","i18n!csui/controls/tabletoolbar/impl/nls/localized.strings"],function(e,t,i,s){var n={"inlineActionbar":new t({"other":[{"signature":"Properties","name":s.ToolbarItemInfo,"icon":"icon icon-toolbar-metadata"},{"signature":"Edit","name":s.ToolbarItemEdit,"icon":"icon icon-toolbar-edit"},{"signature":"Download","name":s.ToolbarItemDownload,"icon":"icon icon-toolbar-download"},{"signature":"OpenShortlink","name":s.ToolbarItemOpen,"icon":"icon icon-toolbar-shortcut"},{"signature":"InlineEdit","name":s.ToolbarItemRename,"icon":"icon icon-toolbar-rename"},{"signature":"Delete","name":s.ToolbarItemDelete,"icon":"icon icon-toolbar-delete"}]},{"maxItemsShown":4,"dropDownText":s.ToolbarItemMore,"dropDownIcon":"icon icon-toolbar-more"})};return n}),csui.define("workflow/commands/open.shortlink/open.shortlink",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/commandhelper","csui/models/command"],function(e,t,i,s,n){var o=n.extend({"defaults":{"signature":"OpenShortlink","command_key":["openshortlink","OpenShortlink"],"name":"OpenShortlink","verb":"OpenShortlink","doneVerb":"OpenShortlink","scope":"single"},"execute":function(e){var t=s.getJustOneNode(e),n=i.Deferred();return t.set("ActionBarShortcutOpenCommand",!0,{"silent":!0}),t.unset("ActionBarShortcutOpenCommand"),n.resolve(),n.promise()}});return o}),csui.define("hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentitem",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t){var i;return'<div class="workitem-attachments-item">\r\n  <div class="workitem-attachments-icon"></div>\r\n  <div class="workitem-attachments-info">\r\n    <a class="workitem-attachments-name" href="'+this.escapeExpression((i=null!=(i=t.defaultActionUrl||(null!=e?e.defaultActionUrl:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"defaultActionUrl","hash":{}}):i))+'">\r\n      <div class="workitem-attachment-name" title="'+this.escapeExpression((i=null!=(i=t.name||(null!=e?e.name:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"name","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.name||(null!=e?e.name:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"name","hash":{}}):i))+'</div>\r\n    </a>\r\n\r\n    <input id="workitem-attachments-name-input-'+this.escapeExpression((i=null!=(i=t.nodeId||(null!=e?e.nodeId:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"nodeId","hash":{}}):i))+'" class="workitem-attachments-name-input\r\n    binf-form-control cs-input rename-field binf-hidden" placeholder="'+this.escapeExpression((i=null!=(i=t.namePlaceholder||(null!=e?e.namePlaceholder:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"namePlaceholder","hash":{}}):i))+'"\r\n           tabindex="-1" aria-label="'+this.escapeExpression((i=null!=(i=t.namePlaceholder||(null!=e?e.namePlaceholder:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"namePlaceholder","hash":{}}):i))+'" title="'+this.escapeExpression((i=null!=(i=t.name||(null!=e?e.name:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"name","hash":{}}):i))+'">\r\n    <span class="workitem-attachments-name-cancel csui-undo edit-cancel inline-edit-icon\r\n      rename-field binf-hidden" tabindex="-1" title="'+this.escapeExpression((i=null!=(i=t.cancel||(null!=e?e.cancel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"cancel","hash":{}}):i))+'"></span>\r\n\r\n    <div id="workitem-attachments-error-message-'+this.escapeExpression((i=null!=(i=t.nodeId||(null!=e?e.nodeId:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"nodeId","hash":{}}):i))+'"\r\n         class="workitem-attachments-error-message binf-hidden"></div>\r\n\r\n    <div class="workitem-attachments-description">\r\n        <textarea id="workitem-attachments-description-input-'+this.escapeExpression((i=null!=(i=t.nodeId||(null!=e?e.nodeId:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"nodeId","hash":{}}):i))+'" class="workitem-attachments-description-input binf-form-control cs-input rename-field\r\n      binf-hidden" placeholder="'+this.escapeExpression((i=null!=(i=t.descriptionPlaceholder||(null!=e?e.descriptionPlaceholder:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"descriptionPlaceholder","hash":{}}):i))+'" tabindex="-1" aria-label="'+this.escapeExpression((i=null!=(i=t.descriptionPlaceholder||(null!=e?e.descriptionPlaceholder:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"descriptionPlaceholder","hash":{}}):i))+'" rows="2"></textarea>\r\n      <span class="workitem-attachments-description-cancel csui-undo edit-cancel inline-edit-icon\r\n      rename-field binf-hidden" tabindex="-1" title="'+this.escapeExpression((i=null!=(i=t.cancel||(null!=e?e.cancel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"cancel","hash":{}}):i))+'"></span>\r\n\r\n      <div class="wrap">\r\n        <div>\r\n\r\n        <span\r\n            class="workitem-attachment-description workitem-attachments-description-ro binf-hidden"\r\n            title="'+this.escapeExpression((i=null!=(i=t.description||(null!=e?e.description:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"description","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.description||(null!=e?e.description:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"description","hash":{}}):i))+'</span>\r\n\r\n          <span\r\n              class="workitem-attachment-description workitem-attachments-empty-description-ro binf-hidden"\r\n              title="'+this.escapeExpression((i=null!=(i=t.descriptionPlaceholder||(null!=e?e.descriptionPlaceholder:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"descriptionPlaceholder","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.descriptionPlaceholder||(null!=e?e.descriptionPlaceholder:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"descriptionPlaceholder","hash":{}}):i))+'</span>\r\n\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n  <div class="workitem-attachments-actions"></div>\r\n</div>\r\n'
}});return i.registerPartial("workflow_widgets_workitem_workitem.attachments_impl_workitem.attachmentitem",s),s}),csui.define("css!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments",[],function(){}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentitem.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/behaviors/default.action/default.action.behavior","csui/utils/log","csui/controls/globalmessage/globalmessage","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachment.tableactionbar","csui/controls/node-type.icon/node-type.icon.view","workflow/widgets/workitem/workitem.attachments/workitem.attachments.toolbaritems","workflow/commands/open.shortlink/open.shortlink","hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentitem","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang","css!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments"],function(e,t,i,s,n,o,a,r,l,c,d,u){var h=i.ItemView.extend({"className":"workitem-attachment-properties","template":d,"tagName":"li","behaviors":{"DefaultAction":{"behaviorClass":s}},"templateHelpers":function(){var e;return this.model.attributes.id?e=this.model.attributes.id:this.model.attributes.original_id&&(e=this.model.attributes.original_id),{"name":this.model.get("name"),"description":this.model.get("description"),"defaultActionUrl":s.getDefaultActionNodeUrl(this.model),"descriptionPlaceholder":u.DescriptionPlaceholder,"namePlaceholder":u.NamePlaceholder,"nodeId":e,"cancel":u.Cancel}},"ui":{"attachmentItem":".workitem-attachments-item","attachmentIcon":".workitem-attachments-icon","attachmentAction":"a.workitem-attachments-name","attachmentDescription":"div.workitem-attachments-description","attachmentDescriptionRO":"span.workitem-attachments-description-ro","attachmentDescriptionInput":".workitem-attachments-description-input","attachmentDescriptionCancel":".workitem-attachments-description-cancel","attachmentNameInput":".workitem-attachments-name-input","attachmentName":".workitem-attachment-name","attachmentErrorMsg":".workitem-attachments-error-message","attachmentNameCancel":".workitem-attachments-name-cancel","attachmentEmptyDescriptionRO":".workitem-attachments-empty-description-ro"},"events":{"keydown":"onKeyDown","mouse:enter":"onMouseEnter","mouse:leave":"onMouseLeave","focusin @ui.attachmentAction":"onFocusIn","focusout @ui.attachmentItem":"onFocusOutItem","click @ui.attachmentAction":"onClickItem"},"triggers":{"mouseenter":"mouse:enter","mouseleave":"mouse:leave","click @ui.attachmentDescriptionRO, @ui.attachmentEmptyDescriptionRO":"click:description","click @ui.attachmentDescriptionCancel,@ui.attachmentNameCancel":"click:cancel"},"constructor":function(e){this.options=e,i.ItemView.prototype.constructor.call(this,e),this.iconView=new r({"node":this.model}),this.listenTo(this.model,"change:csuiInlineFormErrorMessage",this.onRenameMode),this.listenTo(this.model,"change:ActionBarShortcutOpenCommand",this.openShortlink)},"onKeyDown":function(e){var i=e.keyCode,s=t(e.target),n=!0;switch(i){case 9:s.hasClass("workitem-attachments-description-input")&&this.ui.attachmentDescriptionCancel.hasClass("binf-hidden")&&(this.ui.attachmentNameInput.focus(),n=!1),s.hasClass("workitem-attachments-name-input")&&(this.ui.attachmentDescriptionInput.focus(),n=!1),s.hasClass("workitem-attachments-description-input")&&this.ui.attachmentNameCancel.hasClass("binf-hidden")&&(this.ui.attachmentDescriptionInput.focus(),n=!1);break;case 27:(s.hasClass("cs-input")||s.hasClass("edit-cancel"))&&(this._cancelEdit(),n=!1);break;case 32:case 13:s.hasClass("cs-input")?13===i&&(e.preventDefault(),e.stopPropagation(),n=!1,this.validateFileName()&&!this._parent.errorCase&&(this._submitDescription(),this._cancelEdit())):s.hasClass("edit-cancel")&&(e.preventDefault(),e.stopPropagation(),n=!1,this._cancelEdit());break;case 113:this.ui.attachmentDescriptionRO.hasClass("binf-hidden")&&this.ui.attachmentEmptyDescriptionRO.hasClass("binf-hidden")||this.onRenameMode(),s.hasClass("cs-input")&&(e.preventDefault(),e.stopPropagation(),n=!1,this.validateFileName()&&!this._parent.errorCase&&(this._submitDescription(),this._cancelEdit()))}return n},"onFocusIn":function(e){this._showActionBar({"view":e,"model":e.model})},"onMouseEnter":function(e){this._showActionBar({"view":e,"model":e.model})},"onMouseLeave":function(){this._destroyActionBar()},"onClickItem":function(e){e.preventDefault(),this.cancelPrevEdit(),this.triggerMethod("execute:defaultAction",this.model)},"onClickDescription":function(){this._editDescription()},"onClickCancel":function(){this._cancelEdit()},"onFocusOutItem":function(e){var i=t(e.relatedTarget);if(!(i.hasClass("cs-input")||i.hasClass("edit-cancel")||t(e.target).hasClass("edit-cancel")||t(e.target).hasClass("needsclick")))if(this.isEditMode()&&this.validateFileName()&&!this._parent.errorCase){this._submitDescription();var s=!1,n=t(t(":active").length?":active":":hover"),o=t(n[n.length-1]);(o.hasClass("workitem-attachment-description")||o.hasClass("workitem-attachment-name")||o.hasClass("icon icon-toolbar-rename"))&&(s=!0),s||this._cancelEdit()}else i.hasClass("csui-toolitem")===!1&&i.hasClass("workitem-expand-icon")===!1&&(this._destroyActionBar(),this.$(".workitem-attachments-name").prop("tabindex","0"))},"_editDescription":function(){var t=this.model.actions.findWhere({"signature":"Rename"}),i=this.model.actions.findWhere({"signature":"rename"});if(!(e.isUndefined(t)&&(e.isUndefined(i)||this._parent.errorCase)||(this.cancelPrevEdit(),this._destroyActionBar(),this.ui.attachmentDescriptionRO.hasClass("binf-hidden")&&this.ui.attachmentEmptyDescriptionRO.hasClass("binf-hidden")))){var s=this.model.get("description");this.ui.attachmentDescriptionInput.val(s),this.model.get("description")?this.ui.attachmentDescriptionRO.addClass("binf-hidden"):this.ui.attachmentEmptyDescriptionRO.addClass("binf-hidden"),this.ui.attachmentDescriptionInput.removeClass("binf-hidden"),this.ui.attachmentDescriptionCancel.removeClass("binf-hidden"),this.ui.attachmentItem.addClass("workitem-attachments-description-edit"),this.ui.attachmentDescriptionInput.focus(),this._parent.editMode=this.model.get("id"),this.triggerMethod("editmode:item",this)}},"_submitDescription":function(){if(this.ui.attachmentDescriptionRO.hasClass("binf-hidden")){var t=this.ui.attachmentDescriptionInput.val().trim(),i=this.model.get("description"),s=this._checkName(),n=this.model.get("name");0===s.length?this._cancelEdit():(this.model.set({"name":s,"description":t}),this.model.save({"name":s,"description":t},{"wait":!0,"patch":!0,"includeActions":!0}).done(e.bind(function(){var t=this.model.clone();t.collection=this.model.collection,t.fetch().then(e.bind(function(){this.model.set(t.attributes),t.original&&(this.model.original=t.original),this.$(".workitem-attachments-actions>div>ul>li>a.csui-toolitem").length>0&&this._updateActionBarAndPrepareKeyboardAccess()},this))},this)).fail(e.bind(function(e){o.showMessage("error",e.responseJSON.error),this.model.set({"name":n,"description":i}),this.model.fetch(),this.render()},this)),this._parent.errorCase=!1)}},"_checkName":function(){return this.ui.attachmentName.hasClass("binf-hidden")&&this.ui.attachmentDescriptionRO.hasClass("binf-hidden")?this.ui.attachmentNameInput.val().trim():this.model.get("name")},"_cancelEdit":function(){if(this.ui.attachmentDescriptionRO.hasClass("binf-hidden")){this.ui.attachmentErrorMsg.text(""),this.ui.attachmentErrorMsg.attr("title",""),this.ui.attachmentErrorMsg.addClass("binf-hidden"),this.$el.find("#workitem-attachments-name-input-"+this.model.attributes.id).removeClass("workitem-attachments-error-display"),this.ui.attachmentItem.removeClass("workitem-attachments-edit-error"),this.ui.attachmentDescriptionInput.addClass("binf-hidden"),this.ui.attachmentDescriptionCancel.addClass("binf-hidden"),this.model.get("description")?this.ui.attachmentDescriptionRO.removeClass("binf-hidden"):this.ui.attachmentEmptyDescriptionRO.removeClass("binf-hidden"),this.ui.attachmentName.removeClass("binf-hidden"),this.ui.attachmentNameInput.addClass("binf-hidden"),this.ui.attachmentNameCancel.addClass("binf-hidden"),this.ui.attachmentItem.removeClass("workitem-attachments-actions-display"),this.ui.attachmentItem.removeClass("workitem-attachments-description-edit");var e=this.model.get("name"),t=this.model.get("description");this.ui.attachmentName.text(e),this.ui.attachmentName.attr("title",e),this.ui.attachmentDescriptionRO.text(t),this.ui.attachmentDescriptionRO.attr("title",t),delete this._parent.editMode,this.triggerMethod("editmode:item",this),this._parent.errorCase=!1}},"isEditMode":function(){return this._parent.editMode&&this.model.get("id")===this._parent.editMode?!0:!1},"onRender":function(){if(this.iconView.render(),this.ui.attachmentIcon.prepend(this.iconView.$el),this.model.get("description"))this.ui.attachmentDescriptionRO.removeClass("binf-hidden");else{var t=this.options.view.model.get("mapsList");(!t||1!==t.length)&&this.options.view.model.get("isDoc")||this.options.view.model.get("isWFStatusItemAttachment")||this.ui.attachmentEmptyDescriptionRO.removeClass("binf-hidden")}if(this.options.defaultActionController&&!this.options.defaultActionController.hasAction(this.model)){var i="workitem-attachment-inactive";this.$el.find(".workitem-attachments-icon").addClass(i),this.$el.find(".workitem-attachments-name").addClass(i)}if(this.model.isLocallyCreated&&this.model.collection.singleFileUpload&&e.delay(e.bind(function(){this._editDescription(),this.model.isLocallyCreated=void 0,this.model.collection.singleFileUpload=void 0},this),500),this.model.attributes)var s=this.model.get("mime_type");var n=s||this.model.get("type_name")||this.model.get("type");if(this.model.get("name")&&n){var o=e.str.sformat(u.linkTitleAria,this.model.get("name"),n);this.$el.find(".workitem-attachments-name").attr("aria-label",o)}},"_updateActionBarAndPrepareKeyboardAccess":function(){this.tableActionBarView.$el.find(".binf-dropdown-menu").addClass("binf-dropdown-menu-right"),this.tableActionBarView.$el.find(".binf-dropdown-toggle").addClass("workitem-expand-icon");var t=this;this._parent.inlineItemIndex=0,this._parent.inlineItemDropDownIndex=-1,this._parent.$inlineItems=this.$(".workitem-attachments-name");var i=this.$(".workitem-attachments-actions>div>ul>li>a.csui-toolitem");i.prop("tabindex","-1");var s=this.$(".workitem-attachments-actions .binf-dropdown-toggle");s.prop("tabindex","-1"),e.each(i,function(e){t._parent.$inlineItems.push(e)}),e.each(s,function(e){t._parent.$inlineItems.push(e)}),this._parent.inlineDropDownIsOpenSelector="li.binf-dropdown.binf-open";var n=this.$(".workitem-attachments-actions .binf-dropdown-menu a");n.prop("tabindex","-1"),this._parent.$inlineItemsDropDown=[],e.each(n,function(e){t._parent.$inlineItemsDropDown.push(e)}),t._parent.$inlineItemsDropDown=this.$(t._parent.$inlineItemsDropDown)},"_showActionBar":function(){if(!this.isEditMode()){this._destroyActionBar(),this.defaultActionController&&this.defaultActionController.hasAction(this.model)?this.defaultActionController.commands.add(new c):this.defaultActionController.commands.remove([{"id":"OpenShortlink"}]),this.tableActionBarView=new a(e.extend({"context":this.options.context,"commands":this.defaultActionController.commands,"collection":l.inlineActionbar,"model":this.model,"container":this.options.container,"originatingView":this.options.view,"containerCollection":this.model.collection},l.inlineActionbar.options,{"inlineActionBarStyle":"csui-table-actionbar-bubble"})),this.tableActionBarView.actionState.set("state","full"),this.tableActionBarView.render(),this.tableActionBarView.triggerMethod("before:show"),this.tableActionBarView.triggerMethod("show");var t=this.$el.find(".workitem-attachments-actions");t.append(this.tableActionBarView.$el),t.addClass("workitem-attachments-actions-full"),this.tableActionBarView.triggerMethod("after:show"),this._updateActionBarAndPrepareKeyboardAccess()}},"openShortlink":function(){this._destroyActionBar(),this.triggerMethod("execute:defaultAction",this.model)},"_destroyActionBar":function(){if(this.tableActionBarView){var e=this.$el;e.removeClass("workitem-attachments-actions-full"),this.tableActionBarView.destroy(),this.tableActionBarView=null}},"onRenameMode":function(){var t=this.model.actions.findWhere({"signature":"Rename"}),i=this.model.actions.findWhere({"signature":"rename"});if(!(e.isUndefined(t)&&(e.isUndefined(i)||this._parent.errorCase)||this.ui.attachmentName.hasClass("binf-hidden"))){this.cancelPrevEdit(),this._destroyActionBar();var s=this.model.get("name");this.ui.attachmentNameInput.val(s),this.ui.attachmentName.addClass("binf-hidden"),this.ui.attachmentErrorMsg.addClass("binf-hidden"),this.ui.attachmentNameInput.removeClass("binf-hidden"),this.ui.attachmentItem.addClass("workitem-attachments-actions-display");var n=this.model.get("description");this.ui.attachmentDescriptionInput.val(n),this.model.get("description")?this.ui.attachmentDescriptionRO.addClass("binf-hidden"):this.ui.attachmentEmptyDescriptionRO.addClass("binf-hidden"),this.ui.attachmentDescriptionInput.removeClass("binf-hidden"),this.ui.attachmentNameCancel.removeClass("binf-hidden"),this.ui.attachmentNameInput.focus();var o=void 0!==s&&""!==s?s.length:0;s.lastIndexOf(".")>0&&s.lastIndexOf(".")<s.length-1&&(o=s.lastIndexOf(".")),document.getElementById("workitem-attachments-name-input-"+this.model.attributes.id).setSelectionRange(0,o),this._parent.editMode=this.model.get("id"),this.triggerMethod("editmode:item",this)}},"validateFileName":function(){var t,i=this,s=!0,n=248,o=u.MaxLengthReached,a=u.FileAlreadyExists;return i._parent.errorCase=!1,i.ui.attachmentName.hasClass("binf-hidden")&&i.ui.attachmentDescriptionRO.hasClass("binf-hidden")&&(t=i.ui.attachmentNameInput.val(),t.length>n?s=i.setErrorMessage(o):i.model.collection.forEach(function(n){t&&t!==i.model.get("name")&&t.toLowerCase()===n.attributes.name.toLowerCase()&&(a=e.str.sformat(a,t),s=i.setErrorMessage(a))})),s},"setErrorMessage":function(e){return this.$el.find("#workitem-attachments-name-input-"+this.model.attributes.id).addClass("workitem-attachments-error-display"),this.ui.attachmentItem.addClass("workitem-attachments-edit-error"),this.ui.attachmentErrorMsg.text(e),this.ui.attachmentErrorMsg.attr("title",e),this.ui.attachmentErrorMsg.hasClass("binf-hidden")&&this.ui.attachmentErrorMsg.removeClass("binf-hidden"),this._parent.errorCase=!0,!1},"cancelPrevEdit":function(){var t,i;if(this._parent.$el.find(".workitem-attachments-item.workitem-attachments-actions-display").length?t="workitem-attachments-actions-display":this._parent.$el.find(".workitem-attachments-item.workitem-attachments-description-edit").length&&(t="workitem-attachments-description-edit"),i=this._parent.$el.find("."+t),i.length){i.removeClass(t),i.find(".workitem-attachments-description-input").addClass("binf-hidden"),i.find(".edit-cancel").addClass("binf-hidden"),i.find(".workitem-attachment-name").removeClass("binf-hidden"),i.find(".workitem-attachments-name-input").addClass("binf-hidden"),i.find(".workitem-attachments-error-message").addClass("binf-hidden");var s,n,o=this,a=i.find(".workitem-attachment-name"),r=i.find("span.workitem-attachments-description-ro"),l=i.find("span.workitem-attachments-empty-description-ro");e.each(this._parent.collection.models,function(e){e.get("id")===o._parent.editMode&&(s=e.get("name"),n=e.get("description"),n?(i.find("span.workitem-attachments-description-ro").removeClass("binf-hidden"),r.text(n),r.attr("title",n)):(i.find("span.workitem-attachments-empty-description-ro").removeClass("binf-hidden"),l.text(u.DescriptionPlaceholder),l.attr("title",u.DescriptionPlaceholder)),a.text(s),a.attr("title",s),o._parent.errorCase===!0&&(o._parent.errorCase=!1,delete o._parent.editMode,i.find("#workitem-attachments-name-input-"+e.attributes.id).removeClass("workitem-attachments-error-display")))})}}});return h}),csui.define("hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.emptyDragAndDrop",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e){var t;return"<div class='work-item-attachments-draganddrop'>"+this.escapeExpression(this.lambda(null!=(t=null!=e?e.messages:e)?t.dragAndDropEmptyMsg:t,e))+"</div>"}});return i.registerPartial("workflow_widgets_workitem_workitem.attachments_impl_workitem.attachments.emptyDragAndDrop",s),s}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.emptyDragAndDrop.view",["csui/lib/underscore","csui/lib/marionette","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang","hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.emptyDragAndDrop","css!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments"],function(e,t,i,s){var n=t.ItemView.extend({"template":s,"className":"workitem-attachments-emptylist","templateHelpers":function(){return{"messages":{"dragAndDropEmptyMsg":i.EmptyDragAndDropMessage}}},"constructor":function(){t.ItemView.prototype.constructor.apply(this,arguments)}});return n}),csui.define("hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentlist",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workitem-attachments-scrolling" tabindex="-1">\r\n  <ul class="workitem-attachments-itemlist">\r\n  </ul>\r\n</div>'}});return i.registerPartial("workflow_widgets_workitem_workitem.attachments_impl_workitem.attachmentlist",s),s}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentlist.view",["csui/lib/underscore","csui/lib/marionette","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/models/node/node.addable.type.collection","csui/utils/log","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/behaviors/default.action/default.action.behavior","workflow/behaviors/list.keyboard.behavior","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.draganddrop.view","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentitem.view","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.emptyDragAndDrop.view","hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentlist","css!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments"],function(e,t,i,s,n,o,a,r,l,c,d,u){var h=t.CompositeView.extend({"childViewContainer":".workitem-attachments-itemlist","childView":c,"emptyView":d,"childViewOptions":function(){var e=this.options,t=e.view;return t.collection=this.collection,{"defaultActionController":this.defaultActionController,"context":e.context,"view":t,"container":e.container}},"childEvents":{"editmode:item":"onEditModeItem"},"events":{"keydown":"onKeyDown"},"behaviors":{"DefaultAction":{"behaviorClass":a},"TabableRegion":{"behaviorClass":i},"ListKeyboard":{"behaviorClass":r,"currentlyFocusedElementSelector":".workitem-attachments-name"},"ScrollingInstructions":{"behaviorClass":o,"contentParent":".workitem-attachments-scrolling","suppressScrollX":!0,"scrollYMarginOffset":16}},"className":"workflow-attachmentlist-form","template":u,"ui":{"dragAndDropArea":"div.workitem-attachments-scrolling"},"constructor":function(e){this.options=e,t.CompositeView.prototype.constructor.apply(this,arguments)},"onShow":function(){var e=this.options.view.model.get("mapsList");(!this.options.view.model.get("isDoc")||e&&1===e.length)&&this.setDragNDrop()},"onAddChild":function(){this.selectedIndex=0,this.trigger("refresh:tabindexes")},"onRemoveChild":function(){this.selectedIndex=0,this.trigger("refresh:tabindexes")},"onEditModeItem":function(t){e.isFunction(t.isEditMode)&&!t.isEditMode()&&this.trigger("refresh:tabindexes")},"setDragNDrop":function(){this.addableTypes=new s(void 0,{"node":this.collection.node}),this.addableTypes.fetch().done(e.bind(function(){this.dragNDrop=new l({"container":this.collection.node,"collection":this.collection,"context":this.options.context,"addableTypes":this.addableTypes}),this.listenTo(this.dragNDrop,"drag:over",this._addDragDropBorder,this),this.listenTo(this.dragNDrop,"drag:leave",this._removeDragDropBorder,this),this.dragNDrop.setDragParentView(this,".workitem-attachments-scrolling")},this))},"_addDragDropBorder":function(){this.ui.dragAndDropArea.addClass("drag-over")},"_removeDragDropBorder":function(){this.ui.dragAndDropArea.hasClass&&this.ui.dragAndDropArea.hasClass("drag-over")&&this.ui.dragAndDropArea.removeClass("drag-over")},"onDomRefresh":function(){this.collection.propertiesAction&&(t.CollectionView.prototype._renderChildren.call(this),this.collection.propertiesAction=!1)}});return h}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.addfromDesktop",["module","require","csui/lib/underscore","csui/lib/jquery","csui/utils/commands/add","csui/dialogs/file.open/file.open.dialog"],function(e,t,i,s,n,o){var a=n.extend({"_selectFilesForUpload":function(e,t){var i=s.Deferred(),n=new o({"multiple":!0});return n.on("add:files",function(s){csui.require(["csui/controls/fileupload/fileupload"],function(n){i.resolve();var o=n.newUpload(e,t);o.addFilesToUpload(s,{"collection":e.collection}),1===s.length&&(e.collection.singleFileUpload=!0)})}).on("cancel",function(){i.reject()}).show(),i.promise()}});return a}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.addfromCS",["module","require","csui/lib/underscore","csui/lib/jquery","csui/utils/log","csui/utils/url","csui/models/command","csui/utils/commandhelper","csui/utils/command.error","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang"],function(e,t,i,s,n,o,a,r,l,c){var d=e.config();i.defaults(d,{"parallelism":3});var u,h,m,p,f,w,g=a.extend({"defaults":{"signature":"Add","name":c.CommandNameAdd,"verb":c.CommandVerbAdd,"doneVerb":c.CommandDoneVerbAdd,"pageLeavingWarning":c.AddPageLeavingWarning},"execute":function(e,t){var n=this,o=s.Deferred(),a=e.context||t&&t.context,r=e.collection;return e.suppressSuccessMessage=!0,csui.require(["csui/controls/globalmessage/globalmessage","csui/controls/conflict.resolver/conflict.resolver","csui/utils/taskqueue","csui/dialogs/node.picker/impl/header/apply.properties.selector/apply.properties.selector.view","csui/models/fileuploads","csui/utils/page.leaving.blocker"],function(){u=arguments[0],h=arguments[1],m=arguments[2],p=arguments[3],f=arguments[4],w=arguments[5],n._selectCopyOptions(e).done(function(t){var s=t.nodes,l=r.node,d=t.applyProperties,h=!0;n._announceOperationStart(e.originatingView);var m=i.map(s,function(e){var t={"id":e.get("id"),"name":e.get("name"),"container":e.get("container"),"mime_type":e.get("mime_type"),"original_id":e.get("original_id"),"original":e.original,"type":e.get("type"),"size":e.get("size"),"type_name":e.get("type_name"),"state":"pending","count":0,"total":1,"enableCancel":!1};return 144===e.get("type")&&(t.size_formatted=e.get("size_formatted")),t}),p=i.map(m,function(e){return i.clone(e)});n._resolveNamingConflicts(l,p).done(function(s){i.each(s,function(e){void 0===e.id&&(e.id=i.findWhere(m,{"name":e.name}).id)}),n._metadataHandling(s,i.extend(t,{"context":a,"targetFolder":l})).done(function(){var t=new f(s),a=r.connector;n._copySelectedNodes(t,a,l,d,h,e.collection).done(function(){u.hideFileUploadProgress();var e=1===s.length?c.MessageItemCopied:c.MessageItemsCopied;e=i.str.sformat(e,s.length),u.showMessage("success",e),o.resolve()}).always(function(){n._announceOperationEnd(e.originatingView,h)}).fail(function(){o.reject()})}).fail(function(t){n._announceOperationEnd(e.originatingView,h),o.reject(t)})}).fail(function(t){n._announceOperationEnd(e.originatingView,h),o.reject(t)})})},function(e){o.reject(e)}),o.promise()},"_announceOperationStart":function(e){var t=e.resultsView||e.tableView;t&&t.blockActions(),w.enable(this.get("pageLeavingWarning"))},"_announceOperationEnd":function(e,t){w.disable();var i=e.resultsView||e.tableView;i&&(t&&i.collection.fetch(),i.unblockActions())},"_selectCopyOptions":function(e){var t=this,n=s.Deferred();return csui.require(["csui/dialogs/node.picker/node.picker"],function(s){var o=i.extend({"selectableTypes":e.validTypes,"showAllTypes":!0,"dialogTitle":c.AddDocumentLabel,"selectButtonLabel":c.ButtonLabelAdd,"initialContainer":e.container,"startLocation":"enterprise.volume","propertiesSeletor":!0,"globalSearch":!0,"startLocations":["enterprise.volume","current.location","personal.volume","favorites","recent.containers"]},e);t.nodePicker=new s(o),t.nodePicker.show().done(function(){n.resolve.apply(n,arguments)}).fail(function(){n.reject.apply(n,arguments)})},function(e){n.reject(e)}),n.promise()},"_resolveNamingConflicts":function(e,t){var s=1===t.length?c.CopyingNode:c.CopyingNodes,n=new h({"h1Label":i.str.sformat(s,t.length),"actionBtnLabel":"Add","excludeAddVersion":!0,"container":e,"files":t});return n.run()},"_metadataHandling":function(e,t){var i=s.Deferred();return csui.require(["csui/widgets/metadata/metadata.copy.move.items.controller"],function(s){var n,o=t.openSelectedProperties,a=t.applyProperties,r=new s;if(o)n=r.CopyMoveItemsWithMetadata;else{if(a!==p.APPLY_DESTINATION_PROPERTIES&&a!==p.COMBINE_ALL_PROPERTIES)return i.resolve();n=r.CopyMoveItemsRequiredMetadata}a===p.KEEP_ORIGINAL_PROPERTIES?t.inheritance="original":a===p.APPLY_DESTINATION_PROPERTIES?t.inheritance="destination":a===p.COMBINE_ALL_PROPERTIES&&(t.inheritance="merged"),t.action="copy",n.call(r,e,t).done(function(){i.resolve()}).fail(function(e){i.reject(e)})},function(e){n.warn("Failed to load MetadataCopyMoveItemsController. {0}",e),i.reject(e)}),i.promise()},"_copySelectedNodes":function(e,t,n,o,a,r){var h=this,p=new m({"parallelism":d.parallelism}),f=i.map(e.models,function(i){var c=s.Deferred();return p.pending.add({"worker":function(){var s=i.attributes,d=n.get("id");return h._getCategories(s,t,d,o).done(function(n){h._copyNode(n,s,t,d,i.node).done(function(){i.set("count",1),i.deferred.resolve(i),a&&h._addToCurrentTable(i.node,r,e),c.resolve(s)}).fail(function(e){i.deferred.reject(i,new l(e)),c.reject()})}).fail(function(e){i.deferred.reject(i,new l(e)),c.reject()}),c.promise()}}),c.promise()});return u.showFileUploadProgress(e,{"oneFileTitle":c.AddingOneFile,"oneFileSuccess":c.AddOneFileSucceeded,"multiFileSuccess":c.AddFilesSucceeded,"oneFilePending":c.AddingOneFile,"multiFilePending":c.AddFiles,"oneFileFailure":c.AddFilesOneFailed,"multiFileFailure":c.AddFilesFailed,"oneFailure":c.AddFilesOneFailed,"enableCancel":!1}),s.whenAll.apply(s,f)},"_addToCurrentTable":function(e,t,i){e.isLocallyCreated=!0,1===i.length&&(t.singleFileUpload=!0),r.refreshModelAttributesFromServer(e,t).done(function(){e.original&&(e.attributes.original_id=0,e.original=void 0),t.unshift(e)})},"_copyNode":function(e,t,i,s,n){var o={"original_id":t.id,"parent_id":s,"name":t.newName?t.newName:t.name,"roles":e};return n.connector||i.assignTo(n),n.save(o,{"data":o,"url":i.connection.url+"/nodes"})},"_getCategories":function(e,t,i,n){var o=s.Deferred();if(e.extended_data&&e.extended_data.roles)o.resolve(e.extended_data.roles);else{var a=t.extendAjaxOptions({"url":t.connection.url+"/forms/nodes/copy","method":"get","data":{"id":e.id,"parent_id":i}});s.ajax(a).then(function(e){var t,i=e.forms[1].data;t={},t[p.KEEP_ORIGINAL_PROPERTIES]="original",t[p.APPLY_DESTINATION_PROPERTIES]="destination",t[p.COMBINE_ALL_PROPERTIES]="merged";var s=i[t[n]];o.resolve({"categories":s})}).fail(function(e){o.reject(e)})}return o.promise()}});return g}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.addShortcut",["module","require","csui/lib/underscore","csui/lib/jquery","csui/models/command","csui/utils/commandhelper","csui/utils/command.error","csui/models/node/node.model","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang"],function(e,t,i,s,n,o,a,r,l){var c=e.config();i.defaults(c,{"parallelism":3});var d,u,h,m,p,f,w=n.extend({"defaults":{"signature":"Add","name":l.CommandNameAdd,"verb":l.CommandVerbAdd,"doneVerb":l.CommandDoneVerbAdd,"pageLeavingWarning":l.AddPageLeavingWarning},"execute":function(e,t){this.options=t;var n=this,o=s.Deferred(),a=e.collection;return e.suppressSuccessMessage=!0,csui.require(["csui/controls/globalmessage/globalmessage","csui/controls/conflict.resolver/conflict.resolver","csui/utils/taskqueue","csui/dialogs/node.picker/impl/header/apply.properties.selector/apply.properties.selector.view","csui/models/fileuploads","csui/utils/page.leaving.blocker"],function(){d=arguments[0],u=arguments[1],h=arguments[2],m=arguments[3],p=arguments[4],f=arguments[5],n._selectShortCutCreateOptions(e).done(function(t){var s=t.nodes,r=a.node,c=t.applyProperties,u=!0;n._announceOperationStart(e.originatingView);var h=i.map(s,function(e){var t={"id":e.get("id"),"name":e.get("name"),"container":e.get("container"),"mime_type":e.get("mime_type"),"original_id":e.get("original_id"),"original_id_expand":e.get("original_id_expand"),"type":e.get("type"),"size":e.get("size"),"type_name":e.get("type_name"),"state":"pending","count":0,"total":1,"enableCancel":!1};return t}),m=i.map(h,function(e){return i.clone(e)});n._resolveNamingConflicts(r,m).done(function(t){i.each(t,function(e){e.type=i.findWhere(h,{"name":e.name}).type});var s=new p(t),m=a.connector;n._createSelectedNodes(s,m,r,c,u,e.collection).done(function(){d.hideFileUploadProgress();var e=1===t.length?l.MessageItemAdded:l.MessageItemsAdded;e=i.str.sformat(e,t.length),d.showMessage("success",e),o.resolve()}).always(function(){n._announceOperationEnd(e.originatingView,u)}).fail(function(){o.reject()})}).fail(function(t){n._announceOperationEnd(e.originatingView,u),o.reject(t)})})},function(e){o.reject(e)}),o.promise()},"_announceOperationStart":function(e){var t=e.resultsView||e.tableView;t&&t.blockActions(),f.enable(this.get("pageLeavingWarning"))},"_announceOperationEnd":function(e,t){f.disable();var i=e.resultsView||e.tableView;i&&(t&&i.collection.fetch(),i.unblockActions())},"_selectShortCutCreateOptions":function(e){var t=this,n=s.Deferred();return csui.require(["csui/dialogs/node.picker/node.picker"],function(s){var o=i.extend({"showAllTypes":!0,"dialogTitle":l.AddDocumentLabel,"selectButtonLabel":l.ButtonLabelAdd,"initialContainer":e.container,"startLocation":"enterprise.volume","propertiesSeletor":!0,"globalSearch":!0,"startLocations":["enterprise.volume","current.location","personal.volume","favorites","recent.containers"]},e);t.nodePicker=new s(o),t.nodePicker.show().then(function(s){var n=[];return i.each(s.nodes,function(i){var s=new r({"type":t.options.type,"icon":i.get("icon"),"type_name":t.options.type_name,"container":!1,"name":i.get("name"),"original_id":i.get("id"),"original_id_expand":i.attributes},{"connector":e.container.connector});n.push(s)}),s.nodes=n,s}).done(function(){n.resolve.apply(n,arguments)}).fail(function(){n.reject.apply(n,arguments)})},function(e){n.reject(e)}),n.promise()},"_resolveNamingConflicts":function(e,t){var s=1===t.length?l.AddingNode:l.AddingNodes,n=new u({"h1Label":i.str.sformat(s,t.length),"actionBtnLabel":"Add","excludeAddVersion":!0,"container":e,"files":t});return n.run()},"_createSelectedNodes":function(e,t,n,o,r,u){var m=this,p=new h({"parallelism":c.parallelism}),f=i.map(e.models,function(i){var l=s.Deferred();return p.pending.add({"worker":function(){var s=i.attributes,c=n.get("id");return m._getCategories(s,t,c,o).done(function(n){m._createNode(n,s,t,c,i.node).done(function(){i.set("count",1),i.deferred.resolve(i),r&&m._addToCurrentTable(i.node,u,e),l.resolve(s)}).fail(function(e){i.deferred.reject(i,new a(e)),l.reject()})}).fail(function(e){i.deferred.reject(i,new a(e)),l.reject()}),l.promise()}}),l.promise()});return d.showFileUploadProgress(e,{"oneFileTitle":l.AddingOneFile,"oneFileSuccess":l.AddOneFileSucceeded,"multiFileSuccess":l.AddFilesSucceeded,"oneFilePending":l.AddingOneFile,"multiFilePending":l.AddFiles,"oneFileFailure":l.AddFilesOneFailed,"multiFileFailure":l.AddFilesFailed,"oneFailure":l.AddFilesOneFailed,"enableCancel":!1}),s.whenAll.apply(s,f)
},"_addToCurrentTable":function(e,t,i){e.isLocallyCreated=!0,1===i.length&&(t.singleFileUpload=!0),o.refreshModelAttributesFromServer(e,t).done(function(){t.unshift(e)})},"_createNode":function(e,t,i,s,n){var o={"original_id":t.original_id,"parent_id":s,"name":t.newName?t.newName:t.name,"roles":e,"action":"create","type":t.type,"original_id_expand":t.original_id_expand};return n.connector||i.assignTo(n),n.save(o,{"data":o,"url":i.connection.url+"/nodes"})},"_getCategories":function(e,t,i,n){var o=s.Deferred();if(e.extended_data&&e.extended_data.roles)o.resolve(e.extended_data.roles);else{var a=t.extendAjaxOptions({"url":t.connection.url+"/forms/nodes/create","method":"get","data":{"type":e.type,"parent_id":i}});s.ajax(a).then(function(e){var t,i=e.forms[0].data;t={},t[m.KEEP_ORIGINAL_PROPERTIES]="original",t[m.APPLY_DESTINATION_PROPERTIES]="destination",t[m.COMBINE_ALL_PROPERTIES]="merged";var s=i[t[n]];o.resolve({"categories":s})}).fail(function(e){o.reject(e)})}return o.promise()}});return w}),csui.define("hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmenttoolbar",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workitem-attachment-toolbar-view tile-nav">\r\n  <div class="workitem-attachment-toolbar-add"></div>\r\n</div>\r\n'}});return i.registerPartial("workflow_widgets_workitem_workitem.attachments_impl_workitem.attachmenttoolbar",s),s}),csui.define("workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmenttoolbar.view",["csui/lib/jquery","csui/lib/underscore","csui/lib/marionette","csui/utils/log","csui/controls/globalmessage/globalmessage","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/toolbar/toolbar.view","workflow/widgets/workitem/workitem.attachments/workitem.attachments.toolbaritems","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.addfromDesktop","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.addfromCS","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments.addShortcut","hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmenttoolbar","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang","css!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m){var p=i.LayoutView.extend({"template":h,"regions":{"addToolbarRegion":".workitem-attachment-toolbar-add"},"behaviors":{"TabableRegion":{"behaviorClass":o}},"toolbarItemSelector":"a."+o.accessibilityFocusableClass,"events":{"keydown":"onKeyInView"},"currentlyFocusedElement":function(){var t=this.$(this.toolbarItemSelector),i=t.length?e(t[this.accNthToolbarItemFocused]):null;return i},"constructor":function(e){e||(e={}),this.context=e.context,this.toolbarCollection=e.toolbarCollection,this.originatingView=e.originatingView,this.addableTypes=e.addableTypes,this.container=e.container,this.attachmentCollection=e.attachmentCollection,this.accNthToolbarItemFocused=0,i.LayoutView.prototype.constructor.apply(this,arguments)},"initialize":function(){this.toolbarView=new r({"collection":this.toolbarCollection,"maxItemsShown":0,"dropDownText":m.AddToolbarItemLabel,"dropDownIcon":"icon icon-toolbarAdd"}),this.addFromCSCommand=new d,this.addFromFileSysCommand=new c,this.addShortCutCommand=new u,this.listenTo(this.toolbarView,"childview:toolitem:action",this._toolbarItemClicked),this.propagateEventsToRegions()},"onRender":function(){this.addToolbarRegion.show(this.toolbarView)},"_closeMenu":function(e,t){var i=this.$el.find("li.binf-dropdown.binf-open");if(i.length>0){var s=this.$el.find("li.binf-dropdown.binf-open > a");i.removeClass("binf-open"),s.attr("aria-expanded","false"),t&&(e.preventDefault(),e.stopPropagation())}},"onKeyInView":function(e){switch(e.keyCode){case 27:this._closeMenu(e,!0);break;case 9:this._closeMenu(e,!1)}},"_toolbarItemClicked":function(e){switch(e.model.get("id")){case"copy":var t=this.addableTypes.map(function(e){return e.get("type")});this.addFromCSCommand.execute({"originatingView":this.originatingView,"context":this.context,"container":this.container,"collection":this.attachmentCollection,"validTypes":t});break;case"filesystem":var i={"originatingView":this.originatingView,"context":this.context,"container":this.container,"collection":this.attachmentCollection,"data":this.addableTypes},s={"context":this.context,"addableType":e.model.get("type"),"addableTypeName":e.model.get("name")};this.addFromFileSysCommand.execute(i,s);break;case"shortcut":this.addShortCutCommand.execute({"originatingView":this.originatingView,"context":this.context,"container":this.container,"collection":this.attachmentCollection},{"type":1,"type_name":"shortcut"});break;default:n.showMessage("warning","not implemented")}}});return t.extend(p.prototype,a),p}),csui.define("hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workitem-attachment-toolbar"></div>\r\n<div class="workitem-attachment-list"></div>'}});return i.registerPartial("workflow_widgets_workitem_workitem.attachments_impl_workitem.attachments",s),s}),csui.define("workflow/widgets/workitem/workitem.attachments/workitem.attachments.view",["csui/lib/underscore","csui/lib/marionette","csui/lib/backbone","csui/lib/jquery","csui/dialogs/modal.alert/modal.alert","csui/utils/log","csui/models/nodechildren","csui/models/node/node.addable.type.collection","csui/controls/progressblocker/blocker","csui/controls/globalmessage/globalmessage","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/controls/toolbar/toolitem.model","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentlist.view","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmenttoolbar.view","hbs!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang","css!workflow/widgets/workitem/workitem.attachments/impl/workitem.attachments"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m,p,f,w){var g=t.LayoutView.extend({"className":"workitem-attachments","template":f,"regions":{"toolbar":".workitem-attachment-toolbar","list":".workitem-attachment-list"},"constructor":function(e){e||(e={}),this.context=e.context,t.LayoutView.prototype.constructor.apply(this,arguments)},"_prepareAttachmentActions":function(){var t=s.Deferred();return this.toolbarCollection=new i.Collection,this.addableTypes=new r(void 0,{"node":this.model}),this.addableTypes.fetch().done(e.bind(function(){var e,t,i;this.addableTypes.forEach(function(s){switch(s.get("type")){case 1:e=new h({"name":w.AddShortcutLabel,"id":"shortcut"});break;case 144:i=new h({"name":w.AddFromDesktopLabel,"id":"filesystem","type":s.get("type")});break;default:t||(t=new h({"name":w.AddFromContentServerLabel,"id":"copy"}))}}),i&&this.toolbarCollection.add(i),t&&this.toolbarCollection.add(t),e&&this.toolbarCollection.add(e)},this)).always(function(){t.resolve()}),t.promise()},"initialize":function(){this.options.blockingParentView?l.delegate(this,this.options.blockingParentView):l.imbue(this),this.blockActions();var t=this.options.view.model.get("mapsList"),i=this.options.view.model.get("isDoc");if(i!==!0||t&&1===t.length){var o=this._prepareAttachmentActions();o.done(e.bind(function(){this.attachmentCollection=new a(void 0,{"node":this.model,"includeActions":!1,"delayRestCommands":!0,"expand":["node"],"commands":["openshortlink","download","properties","rename","delete","default","addcategory","open","edit"]}),this.toolbarView=new p({"context":this.context,"originatingView":this,"toolbarCollection":this.toolbarCollection,"addableTypes":this.addableTypes,"container":this.model,"attachmentCollection":this.attachmentCollection}),this.toolbar.show(this.toolbarView),this.toolbarCollection.length<=0&&this.toolbar.$el.addClass("binf-hidden");var t=this.options.view.model.get("docModels");if(t){var i=[],o=0,r=this,l=[];e.each(t,function(e){var t=e.attributes,s={"original_id":t.original_id,"parent_id":r.model.get("id"),"name":t.newName?t.newName:t.name,"action":"create","type":t.type,"original_id_expand":t.original_id_expand},n={"name":s.name,"promise":e.save(s,{"data":s,"url":r.model.connector.connection.url+"/nodes"})};i.push(n)}),e.each(i,function(i){i.promise.fail(e.bind(function(){l.push(" "+i.name)},r)).always(e.bind(function(){if(o===t.length-1)if(0===l.length)r.showAttachments();else{this.unblockActions();var i=w.AttachmentsFailMessageTitle,s=e.str.sformat(w.AttachmentsFailMessage,l),a=n.showError(s,i);a.always(function(){r.options.view.parentView._navigateToDocParentNode()})}o++},r))})}else this.showAttachments();this.options.view.model.get("isDraft")||s("<input>").attr({"type":"hidden","id":"attachmentFolderId","name":"attachmentFolderId","value":this.model.get("id")}).appendTo(".workitem-view"),this.attachments=new m({"context":this.context,"container":this.model,"collection":this.attachmentCollection,"view":this.options.view}),this.propagateEventsToRegions()},this))}else{var r=this.options.view.model.get("docModels");r&&(this.attachmentCollection=new a(r,{}),this.attachments=new m({"context":this.context,"collection":this.attachmentCollection,"view":this.options.view}),this.attachments.render())}},"showAttachments":function(){this.attachmentCollection.fetch().done(e.bind(function(){this.attachmentCollection.length>0?this.attachmentCollection.delayedActions.fetch().done(e.bind(function(){this.list.show(this.attachments)},this)):this.toolbarCollection.length>0&&this.list.show(this.attachments)},this)).fail(e.bind(function(){c.showMessage("error",w.ErrorMessageLoadAttachments)},this)).always(e.bind(function(){this.unblockActions()},this))}});return e.extend(g.prototype,d),g}),csui.define("workflow/widgets/workitem/workitem.attachments/workitem.attachments.controller",["csui/lib/underscore","csui/lib/jquery","csui/utils/log","csui/utils/contexts/factories/node","workflow/utils/workitem.extension.controller","workflow/widgets/workitem/workitem.attachments/workitem.attachments.view","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang"],function(e,t,i,s,n,o,a){var r=n.extend({"type":1,"sub_type":1,"position":1,"constructor":function(e,t){n.prototype.constructor.apply(this,arguments),t||(t={}),this.context=e.context},"validate":function(e,t){return e===this.type&&t===this.sub_type?!0:!1},"execute":function(i){var r=i.extensionPoint,l=i.data,c=i.parentView,d=t.Deferred();if(r===n.ExtensionPoints.AddSidebar){var u=this.context.getModel(s,{"attributes":{"id":l.attachment_folder_id}});return u.fetch().done(e.bind(function(e){e.title=a.TabTitle,e.position=this.position,e.viewToRender=o,e.viewToRenderOptions={"context":this.context,"model":u,"view":c},d.resolve(e)},this)).fail(e.bind(function(e){e.errorMsg=a.ErrorMessageLoadAttachments,d.reject(e)},this)),d.promise()}return d.resolve({}),d.promise()}});return r}),csui.define("workflow/controls/userpicker/userpicker.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/controls/userpicker/userpicker.view"],function(e,t,i,s,n){var o=n.extend({"events":{"keydown @ui.searchbox":"onKeyDown","change @ui.searchbox":"onChange"},"behaviors":{"TabableRegion":{"behaviorClass":s}},"constructor":function(e){n.prototype.constructor.call(this,e),this.listenTo(this,"item:change",this.onItemChanged)},"currentlyFocusedElement":function(){return t(this.ui.searchbox)},"onKeyDown":function(e){if(9===e.keyCode){var t=this.$el.find("li.binf-active");t.is(":visible")&&t.click()}},"onChange":function(){var e=this.model?this.model.get("name_formatted"):"";e!==this.ui.searchbox.val()&&(this.ui.searchbox.val(""),this.model=void 0,this.triggerMethod("item:remove"))},"onItemChanged":function(e){this.model=e.item}});return o}),csui.define("hbs!workflow/widgets/action/action.body/impl/action.body",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(){return'  <!-- Authenticate Area -->\r\n  <div class="workitem-action-authenticate">\r\n    <!--Here renders the authentication control-->\r\n  </div>\r\n'},"3":function(e,t,i,s){var n,o;return'  <div class="workitem-action-assignee-selector">\r\n    <div class="workitem-action-assignee">\r\n      <div class="assignee-label">\r\n        <span class="binf-glyphicon binf-glyphicon-star"></span>\r\n        '+this.escapeExpression((o=null!=(o=t.assigneePickerLabel||(null!=e?e.assigneePickerLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"assigneePickerLabel","hash":{}}):o))+'\r\n      </div>\r\n      <div class="assignee-picker">\r\n        <!-- Here renders the assignee user picker -->\r\n      </div>\r\n    </div>\r\n'+(null!=(n=t["if"].call(e,null!=e?e.showAssigneeOptionsSelector:e,{"name":"if","hash":{},"fn":this.program(4,s,0),"inverse":this.noop}))?n:"")+"  </div>\r\n"},"4":function(e){var t;return'      <div class="workitem-action-assignee-options">\r\n        <div class="assignee-label">\r\n          '+this.escapeExpression(this.lambda(null!=(t=null!=e?e.lang:e)?t.assigneeOptionLabel:t,e))+'\r\n        </div>\r\n        <div class="assignee-options">\r\n          <!-- Here render the assignee type selector -->\r\n        </div>\r\n      </div>\r\n'},"6":function(e,t,i,s){var n;return null!=(n=t["if"].call(e,null!=e?e.showAssigneeReadOnly:e,{"name":"if","hash":{},"fn":this.program(7,s,0),"inverse":this.noop}))?n:""},"7":function(e){var t;return'    <div class="workitem-action-assignee-label">\r\n      <div class="assignee-label">\r\n        '+this.escapeExpression(this.lambda(null!=(t=null!=e?e.lang:e)?t.assigneeLabelLabel:t,e))+'\r\n      </div>\r\n      <div class="assignee-name"></div>\r\n    </div>\r\n'},"9":function(){return'  <!-- Comment Area -->\r\n  <div class="workitem-action-comment">\r\n    <!-- Here renders the commenting control -->\r\n  </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n;return(null!=(n=t["if"].call(e,null!=e?e.showAuthenticate:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:"")+"<!-- Assignee area -->\r\n"+(null!=(n=t["if"].call(e,null!=e?e.showAssigneeSelector:e,{"name":"if","hash":{},"fn":this.program(3,s,0),"inverse":this.program(6,s,0)}))?n:"")+(null!=(n=t["if"].call(e,null!=e?e.showComment:e,{"name":"if","hash":{},"fn":this.program(9,s,0),"inverse":this.noop}))?n:"")}});return i.registerPartial("workflow_widgets_action_action.body_impl_action.body",s),s}),csui.define("hbs!workflow/widgets/action/action.body/impl/action.body.comment",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t){var i;return'<div class="comment-label">'+this.escapeExpression((i=null!=(i=t.label||(null!=e?e.label:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"label","hash":{}}):i))+'</div>\r\n<textarea class="comment-input" rows="6" placeholder="'+this.escapeExpression((i=null!=(i=t.placeholder||(null!=e?e.placeholder:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"placeholder","hash":{}}):i))+'" aria-label="'+this.escapeExpression((i=null!=(i=t.ariaLabel||(null!=e?e.ariaLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ariaLabel","hash":{}}):i))+'"></textarea>\r\n\r\n'}});return i.registerPartial("workflow_widgets_action_action.body_impl_action.body.comment",s),s}),csui.define("hbs!workflow/widgets/action/action.body/impl/action.body.authenticate",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t){var i;return'<div class="authenticate-description">\r\n  '+this.escapeExpression((i=null!=(i=t.authenticateDescLabelAndUser||(null!=e?e.authenticateDescLabelAndUser:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"authenticateDescLabelAndUser","hash":{}}):i))+'\r\n</div>\r\n<div class="authenticate-description">\r\n  '+this.escapeExpression((i=null!=(i=t.authenticateEnterPassword||(null!=e?e.authenticateEnterPassword:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"authenticateEnterPassword","hash":{}}):i))+'\r\n</div>\r\n<div class="authenticate-label">\r\n<span class="binf-glyphicon binf-glyphicon-star"></span>\r\n  '+this.escapeExpression((i=null!=(i=t.label||(null!=e?e.label:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"label","hash":{}}):i))+'\r\n</div>\r\n<input type="password" class="authenticate-input" placeholder="'+this.escapeExpression((i=null!=(i=t.placeholder||(null!=e?e.placeholder:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"placeholder","hash":{}}):i))+'"\r\n          aria-label="'+this.escapeExpression((i=null!=(i=t.ariaLabel||(null!=e?e.ariaLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ariaLabel","hash":{}}):i))+'" aria-required="true"></input>'}});return i.registerPartial("workflow_widgets_action_action.body_impl_action.body.authenticate",s),s}),csui.define("hbs!workflow/widgets/action/action.body/impl/assigneetypeselector",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="assignee-type-selector-region"></div>'}});return i.registerPartial("workflow_widgets_action_action.body_impl_assigneetypeselector",s),s}),csui.define("workflow/widgets/action/action.body/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/action/action.body/impl/nls/root/lang",{"assigneePickerLabel":"Forward to","assigneeOptionLabel":"Options to accept","assigneePickerPlaceholder":"Enter user name","assigneeCurrentUserMessage":"You are the current user","commentTextFieldLabel":"Add comments","commentTextFieldPlaceholder":"Add message","commentAriaLabelReply":"{0}: {1}","assigneeOptionOneMember":"One group member","assigneeOptionAllMembers":"All group members","assigneeLabelLabel":"To","authenticateTextFieldLabel":"Password","authenticateTextFieldPlaceholder":"Enter password","authenticateDescriptionLabel":"Additional user authentication is required.","authenticateEnterPassword":"Enter password for user {0}."}),csui.define("css!workflow/widgets/action/action.body/impl/action.body",[],function(){}),csui.define("workflow/widgets/action/action.body/action.body.view",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/form/fields/selectfield.view","csui/controls/form/fields/userfield.view","workflow/controls/userpicker/userpicker.view","hbs!workflow/widgets/action/action.body/impl/action.body","hbs!workflow/widgets/action/action.body/impl/action.body.comment","hbs!workflow/widgets/action/action.body/impl/action.body.authenticate","hbs!workflow/widgets/action/action.body/impl/assigneetypeselector","i18n!workflow/widgets/action/action.body/impl/nls/lang","css!workflow/widgets/action/action.body/impl/action.body"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m){var p=s.LayoutView.extend({"className":"action-comment","template":d,"templateHelpers":function(){return{"label":this.labelText,"placeholder":this.placeholderText,"ariaLabel":this.ariaLabel}},"ui":{"textbox":".comment-input"},"events":{"keyup @ui.textbox":"onKeyUpTextBox"},"behaviors":{"TabableRegion":{"behaviorClass":n,"initialActivationWeight":100}},"constructor":function(e){this.options=e||{},this.labelText=this.options.commentLabel||m.commentTextFieldLabel,this.ariaLabel=this.options.commentAriaLabel||m.commentTextFieldLabel,this.placeholderText=this.options.commentPlaceholder||m.commentTextFieldPlaceholder,s.LayoutView.prototype.constructor.call(this,e)},"onKeyUpTextBox":function(){this.triggerMethod("comment:changed",{"text":this.ui.textbox.val()})},"currentlyFocusedElement":function(){return e(this.ui.textbox)}}),f=s.LayoutView.extend({"className":"action-authenticate","template":u,"templateHelpers":function(){return{"lang":m,"label":this.labelText,"placeholder":this.placeholderText,"ariaLabel":this.ariaLabel,"authenticateDescLabelAndUser":this.authenticateDescLabel,"authenticateEnterPassword":this.authenticateEnterPassword}},"constructor":function(e){this.options=e||{},this.labelText=m.authenticateTextFieldLabel,this.ariaLabel=m.authenticateTextFieldLabel,this.placeholderText=m.authenticateTextFieldPlaceholder,this.authenticateDescLabel=m.authenticateDescriptionLabel;var i=e||"";this.authenticateEnterPassword=t.str.sformat(m.authenticateEnterPassword,i),s.LayoutView.prototype.constructor.call(this,e)},"ui":{"textbox":".authenticate-input"},"events":{"keyup @ui.textbox":"onKeyUpTextBox"},"onKeyUpTextBox":function(){this.triggerMethod("authenticate:changed",{"text":this.ui.textbox.val()})},"currentlyFocusedElement":function(){return e(this.ui.textbox)},"behaviors":{"TabableRegion":{"behaviorClass":n,"initialActivationWeight":100}}}),w=s.LayoutView.extend({"className":"assignee-options-select","template":h,"templateHelpers":function(){return{"lang":m}},"regions":{"selectField":".assignee-type-selector-region"},"behaviors":{"TabableRegion":{"behaviorClass":n,"initialActivationWeight":100}},"constructor":function(e){s.LayoutView.prototype.constructor.call(this,e)},"onRender":function(){var e=new i.Collection([{"id":m.assigneeOptionOneMember,"name":m.assigneeOptionOneMember},{"id":m.assigneeOptionAllMembers,"name":m.assigneeOptionAllMembers}]);this.assingeeOptions=new a({"id":"assigneeOptionSelector","model":new i.Model({"options":{"isMultiFieldItem":!1,"label":m.assigneeOptionLabel}}),"selected":e.get(m.assigneeOptionOneMember),"collection":e,"alpaca":{"options":{"setRequiredFieldsEditable":!0},"schema":{"readonly":!1}}}),this.assingeeOptions.alpacaField={"options":{"mode":"create"},"schema":{"readonly":!1},"setValueAndValidate":function(){return!0},"setValue":function(){},"parent":{}},this.selectField.show(this.assingeeOptions),this.listenTo(this.assingeeOptions,"field:changed",t.bind(function(e){this.triggerMethod("assigneeOption:changed",{"option":e.fieldvalue})},this))},"currentlyFocusedElement":function(){return this.$el.is(":visible")?this.$(".binf-dropdown-toggle"):void 0}}),g=s.LayoutView.extend({"className":"workitem-action-body","template":c,"templateHelpers":function(){return{"lang":m,"showAssigneeSelector":this.showAssigneeSelector,"showAssigneeOptionsSelector":this.showAssigneeOptionsSelector,"showAssigneeReadOnly":this.showAssigneeReadOnly,"showComment":this.showComment,"showAuthenticate":this.showAuthenticate,"assigneePickerLabel":this.texts.assigneeLabel||m.assigneePickerLabel}},"regions":{"assigneeRegion":".workitem-action-assignee .assignee-picker","assigneeTypeRegion":".workitem-action-assignee-options .assignee-options","assigneeLabelRegion":".workitem-action-assignee-label .assignee-name","commentRegion":".workitem-action-comment","authenticateInputRegion":".workitem-action-authenticate"},"ui":{"assigneeOptionsLabel":".workitem-action-assignee-options .assignee-label","assigneeOptionsSelector":".workitem-action-assignee-options .assignee-options"},"constructor":function(e){this.showAssigneeSelector=e.model.get("requireAssignee"),this.showAssigneeReadOnly=!this.showAssigneeSelector&&e.model.get("readonlyAssignee"),this.showAssigneeOptionsSelector=e.model.get("assigneeOptions"),this.showComment=e.model.get("requireComment"),e.model.get("assignee")&&(this.userId=e.model.get("assignee").get("id"),this.assigneeAttributes=e.model.get("assignee").attributes),this.showAuthenticate=e.model.get("authentication"),e.model.get("currentUser")&&(this.currentUser=e.model.get("currentUser")),this.texts=e.model.get("texts")||{},this.texts.commentAriaLabel=this.showAssigneeReadOnly?t.str.sformat(m.commentAriaLabelReply,this.texts.commentLabel,this.assigneeAttributes.display_name):this.texts.commentLabel,s.LayoutView.prototype.constructor.call(this,e),this.propagateEventsToRegions()},"onRender":function(){if(this.showAssigneeSelector){var e=new l({"context":this.options.context,"limit":20,"clearOnSelect":!1,"placeholder":this.texts.assigneePlaceholder||m.assigneePickerPlaceholder,"ariaLabel":this.texts.assigneeLabel||m.assigneePickerLabel,"disabledMessage":m.assigneeCurrentUserMessage,"onRetrieveMembers":t.bind(this.onRetrieveMembers,this),"prettyScrolling":!0,"initialActivationWeight":100,"isRequired":!0});this.listenTo(e,"dom:refresh",function(){this.showAuthenticate||e.$("input").focus()}),this.assigneeRegion.show(e),this.listenTo(e,"item:change",this.onUserChanged),this.listenTo(e,"item:remove",this.onUserRemoved)}if(this.showAssigneeReadOnly){var s=new r({"context":this.options.context,"mode":"readonly","model":new i.Model({"data":this.assigneeAttributes,"schema":{"readonly":!0}}),"alpaca":{"options":{}}});this.assigneeLabelRegion.show(s)}if(this.showAssigneeOptionsSelector){var n=new w({"context":this.options.context});this.listenTo(n,"assigneeOption:changed",this.onAssigneeOptionChanged),this.assigneeTypeRegion.show(n),this._hideAssigneeOptions(!0)}if(this.showAuthenticate){var o=new f(this.currentUser);this.listenTo(o,"dom:refresh",function(){o.$("input").focus()}),this.listenTo(o,"authenticate:changed",this.onAuthenticateChanged),this.authenticateInputRegion.show(o)}if(this.showComment){var a=new p(this.texts);this.listenTo(a,"comment:changed",this.onCommentChanged),this.commentRegion.show(a)}},"onAuthenticateChanged":function(e){this.model.set("authentication_info",{"password":e.text})},"onCommentChanged":function(e){this.model.set("comment",e.text)},"onAssigneeOptionChanged":function(e){e.option===m.assigneeOptionAllMembers?this.model.set("assigneeOption",2):this.model.set("assigneeOption",0)},"onUserChanged":function(e){var i=e.item;if(i.get("disabled")){var s=this.assigneeRegion.currentView;s&&s.ui.searchbox.val(""),i=void 0}this.model.set("assignee",i),this._hideAssigneeOptions(i&&0===i.get("type")||t.isUndefined(i)?!0:!1)},"onUserRemoved":function(){this.model.set("assignee",void 0),this._hideAssigneeOptions(!0)},"onRetrieveMembers":function(e){var t=this;this.userId&&e.collection.each(function(e){e.get("id")===t.userId&&e.set("disabled",!0)})},"_hideAssigneeOptions":function(e){e?(this.ui.assigneeOptionsLabel.addClass("binf-hidden"),this.ui.assigneeOptionsSelector.addClass("binf-hidden")):(this.ui.assigneeOptionsLabel.removeClass("binf-hidden"),this.ui.assigneeOptionsSelector.removeClass("binf-hidden"))}});return t.extend(g.prototype,o),g}),csui.define("workflow/dialogs/action.dialog/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/dialogs/action.dialog/impl/nls/root/lang",{"submitButtonLabel":"Submit","cancelButtonLabel":"Cancel","ActionFailMessageTitle":'Action "{0}" failed',"ActionFailMessage":'Action "{0}" failed. \n\n{1}',"DialogDefaultTitle":"{0}: Workflow step"}),csui.define("css!workflow/dialogs/action.dialog/impl/action.dialog",[],function(){}),csui.define("workflow/dialogs/action.dialog/action.dialog",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/controls/dialog/dialog.view","csui/dialogs/modal.alert/modal.alert","workflow/widgets/action/action.body/action.body.view","i18n!workflow/dialogs/action.dialog/impl/nls/lang","css!workflow/dialogs/action.dialog/impl/action.dialog"],function(e,t,i,s,n,o,a){var r=s.extend({"className":"workflow-action-dialog","constructor":function(t){var i=this;this.options=t||{},this.model=this.options.model,this.action=this.model.get("action"),this.model.get("assignee")&&(this.userId=this.model.get("assignee").get("id")),this.texts=t.model.get("texts")||{};var n=[];n.push({"id":i.action.get("id"),"label":this.texts.submitLabel||a.submitButtonLabel,"toolTip":this.texts.submitLabel||a.submitButtonLabel,"disabled":!this._isValidAuthInfoAndValidAssignee(),"default":!0,"click":function(){i.onClickAction()}}),n.push({"label":this.texts.cancelLabel||a.cancelButtonLabel,"toolTip":this.texts.cancelLabel||a.cancelButtonLabel,"close":!0,"click":function(){i.model.set("comment","")}});var r=this.model.get("title");e.isUndefined(r)&&(r=e.str.sformat(a.DialogDefaultTitle,this.action.get("label"))),e.defaults(t,{"title":r,"buttons":n});var l=new o(t);e.extend(t,{"view":l}),s.prototype.constructor.call(this,t),this.listenTo(this.model,"change:assignee",this.onChangedAssignee),this.listenTo(this.model,"change:authentication_info",this.onChangedAuthenticationInfo)},"onChangedAuthenticationInfo":function(){this.updateButton(this.action.get("id"),{"disabled":!this._isValidAuthInfoAndValidAssignee()})},"onClickAction":function(){e.isFunction(this.options.callback)&&this.options.callback(this.model),this.destroy()},"onChangedAssignee":function(){this.updateButton(this.action.get("id"),{"disabled":!this._isValidAuthInfoAndValidAssignee()})},"_isValidAuthInfo":function(){var e=!1;return this.model.get("authentication")?this.model.get("authentication_info")&&""!==this.model.get("authentication_info").password&&(e=!0):e=!0,e},"_isValidAssignee":function(){var e=!1;return this.model.get("requireAssignee")?this.model.get("assignee")&&this.model.get("assignee").get("id")!==this.userId&&(e=!0):e=!0,e},"_isValidAuthInfoAndValidAssignee":function(){var e=!1;return this._isValidAssignee()&&this._isValidAuthInfo()&&(e=!0),e}});return r}),csui.define("workflow/dialogs/action.dialog/action.dialog.model",["csui/lib/underscore","csui/lib/backbone"],function(e,t){var i=t.Model.extend({"defaults":{"title":void 0,"action":void 0,"requireComment":!1,"comment":void 0,"requireAssignee":!1,"readonlyAssignee":!1,"assigneeOptions":!1,"assignee":void 0,"texts":{},"authentication":!1,"currentUser":void 0,"authentication_info":void 0},"constructor":function(){t.Model.prototype.constructor.apply(this,arguments)}});return i}),csui.define("workflow/models/wfstatus/wfstatus.model",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url"],function(e,t,i,s){var n=i.Model.extend({"constructor":function(e,t){i.Model.prototype.constructor.apply(this,arguments),t&&t.connector&&t.connector.assignTo(this)},"url":function(){var e=this.connector.connection.url.replace("/v1","/v2"),t=s.combine(e,"workflows/status/widget"),i=this.get("filterWorkflowtype"),n=this.get("retention"),o=this.get("selectionType"),a=this.get("wfstatusfilter");if(!i){var r=this.get("filterWorkflows")?this.get("filterWorkflows").filterInitiated:!0,l=this.get("filterWorkflows")?this.get("filterWorkflows").filterManaged:!0;i="Both",r&&l?i="Both":r?i="Initiated":l&&(i="Managed")}return t+="?selectionType="+o,a&&""!==a?t+="&wfstatusfilter="+a:(t+="&wfretention="+n,t+="&kind="+i),t},"parse":function(e){return e.results},"isFetchable":function(){return!0},"sendReAssignAction":function(i){var n=this.connector.connection.url.replace("/v1","/v2"),o=s.combine(n,"workflows","status"),a=new FormData,r={"workid":i.wfData.process_id||i.wfData.processId,"subworkid":i.wfData.subprocess_id||i.wfData.subProcessId,"taskid":i.wfData.task_id||i.wfData.taskId,"newuserid":i.model.get("assignee"),"comment":i.model.get("comment")},l=t.Deferred();a.append("body",JSON.stringify(r));var c={"type":"POST","url":o,"data":a,"contentType":!1,"processData":!1};return this.connector&&this.connector.extendAjaxOptions(c),t.ajax(c).done(e.bind(function(e){l.resolve(e)},this)).fail(e.bind(function(e){var t="";e.responseText&&(t=JSON.parse(e.responseText)),l.reject(t)},this)),l}});return n}),csui.define("workflow/models/wfstatus/wfstatus.model.factory",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/utils/contexts/factories/factory","csui/utils/contexts/factories/connector","workflow/models/wfstatus/wfstatus.model"],function(e,t,i,s,n,o){var a=s.extend({"propertyPrefix":"wfstatus","constructor":function(e,t){s.prototype.constructor.apply(this,arguments);
var i=e.getObject(n,t);this.context=e,this.property=new o(t,{"connector":i})},"isFetchable":function(){return this.property.isFetchable()},"fetch":function(e){return this.property.fetch(e)}});return a}),csui.define("hbs!workflow/controls/usercards/impl/usercard",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e,t,i,s){var n,o;return'  <div\r\n      class="wfstatus-mini-profile-user binf-col-lg-12 binf-col-md-12 binf-col-sm-12 binf-col-xs-12">\r\n    <div class="wfstatus-mini-profile-details">\r\n      <div class="wfstatus-group-profile-img">\r\n            <span class="wfstatus-mini-profile-avatar">\r\n                <a href="javascript:void(0);" class="wfstatus-group-profile-pic">\r\n                    <span\r\n                        class="wfstatus-miniprofile-default-avatar-show default-group-avatar image_group_placeholder"\r\n                        title="'+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"name","hash":{}}):o))+'"></span>\r\n                </a>\r\n            </span>\r\n      </div>\r\n\r\n      <div\r\n          class="wfstatus-mini-profile-userinfo binf-col-lg-12 binf-col-md-12 binf-col-sm-12 binf-col-xs-12">\r\n        <div class="wfstatus-mini-profile-user-displayname">\r\n          <a href="javascript:void(0);" class="wfstatus-mini-profile-group-name"\r\n             title="'+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"name","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"name","hash":{}}):o))+'</a>\r\n        </div>\r\n      </div>\r\n      <div class="wfstatus-usercard-wfstatus" title="'+this.escapeExpression((o=null!=(o=t.status||(null!=e?e.status:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"status","hash":{}}):o))+'">\r\n        '+this.escapeExpression((o=null!=(o=t.status||(null!=e?e.status:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"status","hash":{}}):o))+'\r\n      </div>\r\n    </div>\r\n    <div class="wfstatus-usercard-actions">\r\n      <div class="wfstatus-reassignButton">\r\n            <span><button class="csui-btn binf-btn binf-btn-primary wfstatus-reassign-btn" title="'+this.escapeExpression((o=null!=(o=t.ReassignLabel||(null!=e?e.ReassignLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"ReassignLabel","hash":{}}):o))+'"\r\n                          tabindex="0">'+this.escapeExpression((o=null!=(o=t.ReassignLabel||(null!=e?e.ReassignLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"ReassignLabel","hash":{}}):o))+"</button>\r\n            </span>\r\n      </div>\r\n    </div>\r\n"+(null!=(n=t["if"].call(e,null!=e?e.MultiUser:e,{"name":"if","hash":{},"fn":this.program(2,s,0),"inverse":this.noop}))?n:"")+"  </div>\r\n\r\n"},"2":function(e,t,i,s){var n;return null!=(n=t["if"].call(e,null!=e?e.notLastUser:e,{"name":"if","hash":{},"fn":this.program(3,s,0),"inverse":this.noop}))?n:""},"3":function(){return"        <hr>\r\n"},"5":function(e,t,i,s){var n,o;return'\r\n  <div\r\n      class="wfstatus-mini-profile-user binf-col-lg-12 binf-col-md-12 binf-col-sm-12 binf-col-xs-12">\r\n    <div class="wfstatus-mini-profile-details">\r\n      <div class="wfstatus-user-profile-img">\r\n            <span class="wfstatus-mini-profile-avatar">\r\n                <a href="javascript:void(0);" class="wfstatus-user-profile-pic">\r\n                    <span\r\n                        class="image_user_placeholder wfstatus-miniprofile-default-avatar-'+this.escapeExpression((o=null!=(o=t.displayDefaultPic||(null!=e?e.displayDefaultPic:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"displayDefaultPic","hash":{}}):o))+'"\r\n                        title="'+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"name","hash":{}}):o))+'"></span>\r\n                    <img id="wfstatus-mini-profile-pic-'+this.escapeExpression((o=null!=(o=t.id||(null!=e?e.id:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"id","hash":{}}):o))+'" class="wfstatus-userprofile-img\r\n                         binf-img-circle-'+this.escapeExpression((o=null!=(o=t.displayPic||(null!=e?e.displayPic:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"displayPic","hash":{}}):o))+'" src="'+this.escapeExpression((o=null!=(o=t.photoUrl||(null!=e?e.photoUrl:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"photoUrl","hash":{}}):o))+'" title="'+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"name","hash":{}}):o))+'">\r\n                </a>\r\n            </span>\r\n      </div>\r\n\r\n      <div\r\n          class="wfstatus-mini-profile-userinfo binf-col-lg-12 binf-col-md-12 binf-col-sm-12 binf-col-xs-12">\r\n        <div class="wfstatus-mini-profile-user-displayname">\r\n          <a href="javascript:void(0);" class="wfstatus-mini-profile-user-name"\r\n             title="'+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"name","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"name","hash":{}}):o))+"</a>\r\n        </div>\r\n"+(null!=(n=t["if"].call(e,null!=e?e.business_email:e,{"name":"if","hash":{},"fn":this.program(6,s,0),"inverse":this.noop}))?n:"")+"\r\n"+(null!=(n=t["if"].call(e,null!=e?e.business_phone:e,{"name":"if","hash":{},"fn":this.program(8,s,0),"inverse":this.noop}))?n:"")+'      </div>\r\n      <div class="wfstatus-usercard-wfstatus" title="'+this.escapeExpression((o=null!=(o=t.status||(null!=e?e.status:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"status","hash":{}}):o))+'">\r\n        '+this.escapeExpression((o=null!=(o=t.status||(null!=e?e.status:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"status","hash":{}}):o))+'\r\n      </div>\r\n    </div>\r\n    <div class="wfstatus-usercard-actions">\r\n'+(null!=(n=t["if"].call(e,null!=e?e.isChatEnabled:e,{"name":"if","hash":{},"fn":this.program(10,s,0),"inverse":this.noop}))?n:"")+"\r\n\r\n"+(null!=(n=t["if"].call(e,null!=e?e.displayReassign:e,{"name":"if","hash":{},"fn":this.program(12,s,0),"inverse":this.noop}))?n:"")+"    </div>\r\n"+(null!=(n=t["if"].call(e,null!=e?e.MultiUser:e,{"name":"if","hash":{},"fn":this.program(2,s,0),"inverse":this.noop}))?n:"")+"  </div>\r\n"},"6":function(e,t){var i;return'          <div class="wfstatus-mini-profile-user-displayemail">\r\n            <a class="wfstatus-mini-profile-user-email" href="mailto:'+this.escapeExpression((i=null!=(i=t.business_email||(null!=e?e.business_email:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"business_email","hash":{}}):i))+'"\r\n               title="'+this.escapeExpression((i=null!=(i=t.business_email||(null!=e?e.business_email:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"business_email","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.business_email||(null!=e?e.business_email:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"business_email","hash":{}}):i))+"</a>\r\n          </div>\r\n"},"8":function(e,t){var i;return'          <div class="wfstatus-mini-profile-user-phone"\r\n               title="'+this.escapeExpression((i=null!=(i=t.business_phone||(null!=e?e.business_phone:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"business_phone","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.PhoneLabel||(null!=e?e.PhoneLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"PhoneLabel","hash":{}}):i))+" "+this.escapeExpression((i=null!=(i=t.business_phone||(null!=e?e.business_phone:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"business_phone","hash":{}}):i))+"</div>\r\n"},"10":function(e,t){var i;return'        <div class="wfstatus-chatButton">\r\n            <a href=\''+this.escapeExpression((i=null!=(i=t.chatURI||(null!=e?e.chatURI:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"chatURI","hash":{}}):i))+"' class='wfstatus-chat-icon'>\r\n                <span><button class=\"csui-btn binf-btn binf-btn-secondary wfstatus-chat-btn\" title=\""+this.escapeExpression((i=null!=(i=t.ChatLabel||(null!=e?e.ChatLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ChatLabel","hash":{}}):i))+'"\r\n                              tabindex="0">'+this.escapeExpression((i=null!=(i=t.ChatLabel||(null!=e?e.ChatLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ChatLabel","hash":{}}):i))+"</button>\r\n                </span></a>\r\n        </div>\r\n"},"12":function(e,t){var i;return'        <div class="wfstatus-reassignButton">\r\n            <span><button class="csui-btn binf-btn binf-btn-primary wfstatus-reassign-btn" title="'+this.escapeExpression((i=null!=(i=t.ReassignLabel||(null!=e?e.ReassignLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ReassignLabel","hash":{}}):i))+'"\r\n                          tabindex="0">'+this.escapeExpression((i=null!=(i=t.ReassignLabel||(null!=e?e.ReassignLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ReassignLabel","hash":{}}):i))+"</button>\r\n            </span>\r\n        </div>\r\n"},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n;return"<!-- Here if the assigneeType '1' is for group and '0' for user and handlebars considering '1' as true and '0' as false-->\r\n"+(null!=(n=t["if"].call(e,null!=e?e.assigneeType:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.program(5,s,0)}))?n:"")}});return i.registerPartial("workflow_controls_usercards_impl_usercard",s),s}),csui.define("workflow/controls/usercards/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/controls/usercards/nls/root/lang",{"PhoneLabel":"Phone:","ChatButtonLabel":"Chat","ReassignButtonLabel":"Reassign","ReassignTo":"Reassign to","SuccessMessage":" Workflow step was successfully reassigned","ErrorMessage":"Could not reassign step","DialogHeaderMessage":"Reassign workflow step","commentPlaceholder":"Type a message"}),csui.define("css!workflow/controls/usercards/impl/usercard",[],function(){}),csui.define("workflow/controls/usercards/usercard.view",["require","csui/lib/jquery","csui/utils/url","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/contexts/factories/connector","csui/controls/toolbar/toolbar.view","csui/controls/globalmessage/globalmessage","workflow/dialogs/action.dialog/action.dialog","workflow/dialogs/action.dialog/action.dialog.model","workflow/models/wfstatus/wfstatus.model.factory","hbs!workflow/controls/usercards/impl/usercard","i18n!workflow/controls/usercards/nls/lang","css!workflow/controls/usercards/impl/usercard"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m){var p=o.ItemView.extend({"template":h,"className":"wfstatus-usercard","constructor":function(){o.ItemView.prototype.constructor.apply(this,arguments),this.model.connector=this.options.context.getObject(a,this.options)},"events":{"mouseenter .wfstatus-mini-profile-user":"showActions","mouseleave .wfstatus-mini-profile-user":"hideActions","click .wfstatus-mini-profile-user-name, .wfstatus-user-profile-img":"showUserProfileDialog","click .wfstatus-reassignButton":"showReassignDialogView"},"templateHelpers":function(){var t=e("workflow/models/wfstatus/wfstatus.collection.factory"),i=e("workflow/utils/workitem.util"),n=null===this.model.get("first_name")?"":this.model.get("first_name"),o=null===this.model.get("last_name")?"":this.model.get("last_name"),a=n+" "+o,r=this.model.get("name"),l=this.model.get("business_phone"),c=this.model.get("business_email"),d=this.model.get("photo_url"),u=this.model.get("id"),h=this.model.collection.at(this.model.collection.length-1),p=h.get("id")===this.model.get("id")?!0:!1,f=this.options.status,w=this.model.get("name"),g=this.options.context.getCollection(t),b=g.options.chatSettings,v=b?b.chatEnabled:!1,k=this.model.get("type"),y={},x={},_="";return x.domain=b.chatDomain,x.tguser=w,_=i.getChatURI(x),1===k?y={"name":w,"id":u,"MultiUser":!this.model.get("singleUser"),"notLastUser":!p}:0===k&&(y={"name":" "===a?r:a,"business_phone":l?l:"","business_email":c?c:"","photoUrl":null===d?null:d,"id":u,"displayPic":null===d?"hide":"show","displayDefaultPic":null===d?"show":"hide","ChatLabel":m.ChatButtonLabel,"PhoneLabel":m.PhoneLabel,"MultiUser":!this.model.get("singleUser"),"notLastUser":!p,"displayReassign":"completed"!==f?!0:!1}),s.extend(y,{"ReassignLabel":m.ReassignButtonLabel,"status":f,"assigneeType":k,"isChatEnabled":v,"chatURI":_}),y},"showActions":function(){this.model.get("singleUser")||(this.$el.find(".wfstatus-usercard-actions").addClass("wfstatus-usercard-footer"),this.$el.find(".wfstatus-chatButton").show(),this.$el.find(".wfstatus-reassignButton").show())},"hideActions":function(){this.model.get("singleUser")||(this.$el.find(".wfstatus-chatButton").hide(),this.$el.find(".wfstatus-reassignButton").hide(),this.$el.find(".wfstatus-usercard-actions").removeClass("wfstatus-usercard-footer"))},"onRender":function(){var i=e("workflow/utils/workitem.util"),s=this;i.showProfilePic(this.model).always(function(e){var i=URL.createObjectURL(e),n=t("#wfstatus-mini-profile-pic-"+s.model.get("id"));s.model.attributes.photoUrl=i,n.attr("src",i)}),this.firstUser=this.model.collection.at(0).get("id")===this.model.get("id")?!0:!1;var n=this.model.get("singleUser")?!1:this.firstUser;this.$el.find(".wfstatus-usercard-actions").addClass("wfstatus-usercard-footer"),n||this.hideActions()},"showReassignDialogView":function(){var e=this.model.set({"id":"Reassign"}),t={"requireAssignee":!0,"assigneeOptions":!1,"texts":{"assigneeLabel":m.ReassignTo,"commentPlaceholder":m.commentPlaceholder}},i=new d(s.extend({"title":m.DialogHeaderMessage,"requireComment":this.getOption("wfData").comments_on?this.getOption("wfData").comments_on:this.getOption("originatingView").model.get("comments_on"),"action":e},t)),n=new c({"context":this.options.context,"model":i,"callback":s.bind(this.reAssignUser,this)});n.show()},"reAssignUser":function(t,i){var n=t.get("comment");s.isUndefined(n)||0===n.length||this.model.set("comment",n,{"silent":!0});var o=t.get("assignee");s.isUndefined(o)||this.model.set("assignee",o.get("id"),{"silent":!0}),this.wfstatusmodel=this.options.context.getModel(u);var a=this;a.wfstatusmodel.sendReAssignAction(a.options).done(s.bind(function(t){var i,n=e("workflow/utils/workitem.util"),o=a.options.originatingView,r=o.model,c=t.results,d=o.options.tableView,u=a.options.nodeModel,h="next"===a.options.stepType?!0:!1,p={};if(p.assignedto=c.assignedto,p.assignees=c.assignee,i=n.getAssignee(p),a.options.stepCardsListView){var f=a.options.nodeModel.get("task_id"),w=a.options.stepCardsListView.options.step_list;s.each(w,function(e){e.task_id===f&&(e.task_assignees=c)})}if(h||!f||1===w.length)a.updatingView(a,r,c,d,i,h);else{var g=r.collection.where({"process_id":r.get("process_id"),"subprocess_id":r.get("subprocess_id"),"task_id":f});g&&g.length>0&&a.updatingView(a,g[0],c,d,i,h)}u&&u.set("task_assignees",c),l.showMessage("success",m.SuccessMessage)},this)).fail(s.bind(function(e){l.showMessage("error",""===e.error?m.ErrorMessage:e.error)})).always(s.bind(function(){var t=e("workflow/utils/workitem.util");t.unbindPopover(i)},a))},"updatingView":function(e,t,i,n,o,a){a||(s.has(i,"assignedto")?(i.assignedto.assignees=i.assignee,t.set("assignedto",i.assignedto),t.set("userId",i.assignedto.groupId),i.assignee.length>0?t.set("assignee",o):t.set("assignee","")):1===i.assignee.length&&(t.unset("assignedto"),t.set("assignee",o),t.set("userId",i.assignee[0].userId)),n.updateRow(t),1===t.collection.length&&(t.collection.wfstatus?(t.collection.wfstatus.get("data").assignee=i.assignee,t.collection.wfstatus.trigger("change",t.collection.wfstatus)):(e.wfstatusmodel.get("data").assignee=i.assignee,e.wfstatusmodel.trigger("change"))))},"showUserProfileDialog":function(){var e=this.model.connector,i=this.options.context,n=t(".wfstatus.csui-expanded"),o=this;this.model.attributes.display_name=this.model.get("name_formatted"),csui.require(["esoc/controls/userwidget/userwidget.view"],function(a){function r(e,i,o){var l;l=o?new a(i):e,l.showUserProfileDialog(),l.off("userwidgetview.show.user.dialog").on("userwidgetview.show.user.dialog",function(e){var t=s.extend({},i);e.options.userid=e.options.model.id;var n=s.extend(t,e.options);delete n.model,n.display_name=e.options.model.attributes.display_name,r(a,n,!0)});var c=t(".wfstatus-user-profile-dialog .esoc-user-widget-dialog-back");c.off("click").on("click",function(){var e=l.util.userStack.pop();e.model.id===l.model.id&&(e=l.util.userStack.pop()),r(e,void 0,!1)});var d=t(".wfstatus-user-widget-dialog-back");d.off("click").on("click",function(){(t(".esoc-user-widget-dialog").is(":visible")||t(".wfstatus-user-profile-dialog").is(":visible"))&&t(".wfstatus-user-profile-dialog .cs-close").trigger("click"),n.show()});var u=t(".esoc-user-widget-dialog .cs-close");u.off("click").on("click",function(){l.util.userStack=[],n.show()}),l.util.userDialog&&l.util.userDialog.listenTo(l.util.userDialog,"destroy",function(){n.show()})}var l={};l.model=o.model,l.connector=e,l.userid=o.model.get("id"),l.context=i,l.baseElement=void 0,l.showUserProfileLink=!0,l.loggedUserId=o.model.get("id"),l.dialogClassName="wfstatus-user-profile-dialog",l.dialogiconLeft="arrow_back wfstatus-user-widget-dialog-back",l.dialogiconRight="wfstatus-no-righticon",r(a,l,!0)})}});return p}),csui.define("workflow/models/wfstatus/usercard.model",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/utils/url","workflow/controls/usercards/usercard.view"],function(e,t,i,s){var n=i.Model.extend({"constructor":function(e){i.Model.prototype.constructor.apply(this,arguments),e&&e.connector&&e.connector.assignTo(this)},"url":function(){var e=this.connector.connection.url.replace("/v1","/v2"),t=s.combine(e,"/members/"),i=s.combine(t,this.get("userId"));return i}});return n}),csui.define("workflow/controls/usercards/usercards.view",["csui/lib/underscore","csui/lib/marionette","csui/controls/tile/behaviors/perfect.scrolling.behavior","workflow/controls/usercards/usercard.view","css!workflow/controls/usercards/impl/usercard"],function(e,t,i,s){var n=t.CollectionView.extend({"childView":s,"className":"wfstatus-usercard-list","constructor":function(){t.CollectionView.prototype.constructor.apply(this,arguments)},"childViewOptions":function(){return{"options":this,"status":this.options.status,"context":this.options.context,"originatingView":this.options.originatingView,"nodeModel":this.options.nodeModel,"stepCardsListView":this.options.stepCardsListView,"wfData":this.options.wfData,"stepType":this.options.stepType}}});return n}),csui.define("hbs!workflow/controls/usercards/impl/usercards.list",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="wfstatus-usercard-list"> </div>'}});return i.registerPartial("workflow_controls_usercards_impl_usercards.list",s),s}),csui.define("workflow/controls/usercards/usercards.list.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/url","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/models/member/member.model","csui/models/member/membercollection","workflow/controls/usercards/usercard.view","workflow/models/wfstatus/usercard.model","workflow/controls/usercards/usercards.view","workflow/utils/workitem.util","hbs!workflow/controls/usercards/impl/usercards.list","css!workflow/controls/usercards/impl/usercard"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m){var p=n.LayoutView.extend({"childView":c,"className":"wfstatus-usercard-layout","template":m,"tagName":"div","regions":{"usercardLayout":".wfstatus-usercard-list"},"constructor":function(e){e=e||{},n.LayoutView.prototype.constructor.call(this,e)},"onRender":function(){var e=this;if(this.model.get("assignedto")){var t=new r({"groupId":this.model.get("assignedto").groupId},{"connector":this.model.connector});new l(void 0,{"member":t,"autofetch":!0,"connector":this.model.connector}).fetch().done(function(t){var s=i.sortBy(t.results,"type");e.renderUserCards(s)})}else new d({"userId":this.model.get("userId"),"connector":this.model.connector}).fetch().done(function(t){var i=t.results.data.properties;i.singleUser=!0,e.renderUserCards(i)})},"renderUserCards":function(t){var i={"dueDate":this.model.get(this.model.get("task_due_date")?"task_due_date":"due_date"),"status":this.model.get(this.model.get("task_status")?"task_status":"status_key")},s=e("workflow/utils/workitem.util"),n=s.formatStatus(i);this.Usercollection=new l(t,{}),this.usercardCollectionView=new u({"collection":this.Usercollection,"status":n.status,"context":this.options.context,"options":this,"originatingView":this.options.originatingView,"nodeModel":this.options.nodeModel,"stepCardsListView":this.options.stepCardsListView,"wfData":this.options.wfData,"stepType":this.options.stepType}),this.completeCollection=new l(t,{}),this.usercardLayout.show(this.usercardCollectionView)}});return p}),csui.define("hbs!workflow/controls/usercards/impl/usercards.popover",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e,t){var i;return'<div class = "wfstatus-usercard-list-header">\r\n    <div class="wfstatus-usercard-popover-header-labels">\r\n        <div class = "wfstatus-usercard-popover-header-group-label"\r\n             title="'+this.escapeExpression((i=null!=(i=t.groupName||(null!=e?e.groupName:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"groupName","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.groupName||(null!=e?e.groupName:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"groupName","hash":{}}):i))+'</div>\r\n        <div class = "wfstatus-usercard-popover-header-group-status"\r\n             title="'+this.escapeExpression((i=null!=(i=t.status||(null!=e?e.status:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"status","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.status||(null!=e?e.status:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"status","hash":{}}):i))+'</div>\r\n    </div>\r\n        <input class="search wfstatus-user-input" type="search" title="Search by Group User" style="display: none" >\r\n        <div class="cs-search-icon icon icon-search csui-acc-focusable-active wfstatus-user-search-icon" title="Search by Group User" ></div>\r\n</div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n;return(null!=(n=t["if"].call(e,null!=e?e.isGroup:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:"")+'<div class = "popover wfstatus-usercard-popover-scrolling\r\n     wfstatus-usercard-popover-content large"></div>\r\n'}});return i.registerPartial("workflow_controls_usercards_impl_usercards.popover",s),s}),csui.define("workflow/controls/usercards/usercards.popover.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/tile/behaviors/perfect.scrolling.behavior","workflow/controls/usercards/usercards.list.view","hbs!workflow/controls/usercards/impl/usercards.popover","css!workflow/controls/usercards/impl/usercard"],function(e,t,i,s,n,o,a,r){function l(t){var i=e("workflow/utils/workitem.util");i.unbindPopover(t);var s=c(t);d(t),h(s)}function c(e){var s,o,a,r,l={},c=i.uniqueId(3),d=t.fn.binf_modal.getDefaultContainer();s=document.createElement("div"),s.id="wfstatus-usercard-popover_"+c,r="#wfstatus-usercard-popover_"+c,s.setAttribute("class","wfstatus-usercard-popover"),o=document.createElement("div"),o.id="wfstatus-usercard-popover-pointer_"+c,a=document.createElement("div"),a.id="wfstatus-usercard-popover-mask_"+c,t(e.delegateTarget).css("overflow","hidden"),l.widgetDialog=s,l.widgetDialogPointer=o,l.widgetDialogMask=a,l.placeholder=e.delegateTarget,l.widgetBaseElement=e.delegateTarget,t(d).append(a).append(s).append(o);var u=new n.Region({"el":r}),h=new m(e.UserCardviewOptions);return u.show(h),t(r).css({"display":"block"}).animate({"opacity":1}),l}function d(i){var s=e("workflow/utils/workitem.util");t(".binf-modal-header").bind("keydown click",{"callbackFun":s.unbindPopover,"popoverOptions":i},u),t(".binf-modal-backdrop").bind("keydown click",{"callbackFun":s.unbindPopover,"popoverOptions":i},u),t(window).bind("resize.onUserCardPopOver",function(){s.unbindPopover(i)}),t(window).bind("popstate.onUserCardPopOver",function(){s.unbindPopover(i)}),t(window).bind("hashchange.onUserCardPopOver",function(){s.unbindPopover(i)}),t(".wfstatus-table tbody").scroll(function(){s.unbindPopover(i)}),t(document).off("focusin.binf.modal")}function u(e){function i(){if(o){var e=o.popoverOptions;"keydown"===n.type&&t(e).on("keyup",function(i){t(e).is(":focus")&&(t(e).off("keyup"),i.stopPropagation())}),e&&(e.focus(),setTimeout(function(){e.focus()},1))}}var s=!1,n=e||window.event,o=n.data.popoverOptions;"popstate"===n.type||"hashchange"===n.type?s=!0:"keyup"===n.type||"keydown"===n.type?(27===n.keyCode||27===n.which)&&(t(".wfstatus-usercard-popover").is(":visible")&&t(".cs-dialog").is(":visible")&&(s=!0),i()):"resize"===n.type?(t(".wfstatus-usercard-popover").is(":visible")&&t(".cs-dialog").is(":visible")&&(s=!0),i()):t(n.target).closest(".wfstatus-usercard-popover").length||"click"!==n.type||t(n.target).closest("[id*=wfstatus-usercard-popover]").length&&!t(n.target).closest("[id*=wfstatus-usercard-popover-mask_]").length||t(n.target).closest("[class*=ui-autocomplete]").length||(s=!0),s?n.data.callbackFun(o):""}function h(e){var i=t(e.widgetDialog),s=t(e.widgetDialogPointer),n=t(e.widgetBaseElement),o=!1;e.widgetBaseElement=0===t(e.widgetBaseElement).width()?t("[data-value="+t(e.widgetBaseElement).attr("data-value")+"]"):e.widgetBaseElement,i.css({"position":"absolute","left":"0","top":"0"}),s.css({"position":"absolute","left":"0","top":"0"}).addClass("wfstatus-usercard-popover-arrow-left");var a=parseInt(n.outerWidth()+10,10);i.position({"my":"left top","at":"left+"+a+" top -"+n.parent().height()/2,"of":e.widgetBaseElement,"collision":"flipfit flipfit"});var r=i.offset().left,l=i.offset().left+i.width(),c=n.offset().left,d=n.offset().top+10,u=n.parent().height()===n.height();u&&(d=n.offset().top+Math.ceil(n.height()/4)+2),c>r?(s.css({"position":"absolute","left":l,"top":d}),s.removeClass("wfstatus-usercard-popover-arrow-left").addClass("wfstatus-usercard-popover-arrow-right"),o=parseInt(t(s).css("left").replace("px",""),10)+1>n.offset().left):(s.css({"position":"absolute","left":r-10,"top":d}),s.removeClass("wfstatus-usercard-popover-arrow-right").addClass("wfstatus-usercard-popover-arrow-left"),o=parseInt(t(s).css("left").replace("px",""),10)+1<n.offset().left+n.width());var h=i.offset().top+i.height(),m=s.offset().top+25;m>h?i.css("top",parseInt(i.offset().top+(u?0:20),10)):h-m>20&&i.css("top",parseInt(i.offset().top-(u?0:20),10)),o?(i.css({"left":t(window).width()/2-i.width()/2}),s.css({"opacity":"0"})):s.css({"opacity":"1"})}var m=n.LayoutView.extend({"className":"wfstatus-usercard-popover-class","template":r,"tagName":"div","constructor":function(e){e=e||{},n.LayoutView.prototype.constructor.call(this,e),this.userCardListView=new a(this.options)},"regions":{"usercardPopover":".wfstatus-usercard-popover-content"},"events":{"click .wfstatus-user-search-icon":"toggleSearchInput","keyup .wfstatus-user-input":"searchUser"},"ui":{"wfstatusUserInput":".wfstatus-user-input"},"behaviors":{"ScrollingInstructions":{"behaviorClass":o,"contentParent":".wfstatus-usercard-popover-scrolling","suppressScrollX":!0,"scrollYMarginOffset":16}},"templateHelpers":function(){var t=e("workflow/utils/workitem.util"),i=this.model.get("assignedto")?this.model.get("assignedto"):this.model.get("task_assignees")?this.model.get("task_assignees").assignedto:void 0,s=void 0!==i?!0:!1,n=null===this.model.get("task_due_date")?"":this.model.get("task_due_date"),o=null===this.model.get("task_status")?"":this.model.get("task_status"),a={"dueDate":n,"status":o},r=t.formatStatus(a);return{"groupName":s===!0?i.groupName:"","isGroup":s,"status":r.status}},"onRender":function(){this.setPopoverSize(),this.usercardPopover.show(this.userCardListView)},"searchUser":function(e){var t,s=e.currentTarget.value,n=this.userCardListView.completeCollection;if(s&&s.length>0){var o=s.toLowerCase().split(" ");t=n.filter(function(e){var t=e.get("name"),s=e.get("first_name"),n=e.get("last_name");t=t?t.trim().toLowerCase():"",s=s?s.trim().toLowerCase():"",n=n?n.trim().toLowerCase():"";var a=i.reduce(o,function(e,i){return e&&(t.indexOf(i)>=0||s.indexOf(i)>=0||n.indexOf(i)>=0)},!0);return a})}else t=this.userCardListView.completeCollection.models;this.userCardListView.Usercollection.reset(t)},"toggleSearchInput":function(){this.ui.wfstatusUserInput.hasClass("binf-active")?(t(".wfstatus-user-input").hide(),t(".wfstatus-usercard-popover-header-labels").show(),this.ui.wfstatusUserInput.removeClass("binf-active")):(t(".wfstatus-user-input").show(),t(".wfstatus-usercard-popover-header-labels").hide(),this.ui.wfstatusUserInput.addClass("binf-active"))},"setPopoverSize":function(){var e=this.$el.find(".wfstatus-usercard-popover-content.popover");if(this.model.get("assignedto")){var t=this.model.get("assignedto").assignees?this.model.get("assignedto").assignees:this.model.get("task_assignees").assignees;if(t)switch(t.length){case 1:e.addClass("small");break;case 2:e.addClass("medium")}}else e.addClass("small")}});return{"ShowPopOver":l}}),csui.define("hbs!workflow/controls/stepcards/impl/stepcard",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e,t){var i;return'    <div class="wfstatus-step-assignee" title="'+this.escapeExpression((i=null!=(i=t.assignee||(null!=e?e.assignee:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"assignee","hash":{}}):i))+'">\r\n      '+this.escapeExpression((i=null!=(i=t.assignee||(null!=e?e.assignee:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"assignee","hash":{}}):i))+"\r\n    </div>\r\n"},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n,o;return'<div class="wfstatus-step-info" taskId="'+this.escapeExpression((o=null!=(o=t.task_id||(null!=e?e.task_id:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"task_id","hash":{}}):o))+'">\r\n  <div class="wfstatus-type-icon">\r\n    <span class="wfstatus-title-icon wfstatus-'+this.escapeExpression((o=null!=(o=t.stepIcon||(null!=e?e.stepIcon:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"stepIcon","hash":{}}):o))+'-step-icon" aria-hidden="true"></span>\r\n  </div>\r\n  <div class="wfstatus-step-header">\r\n    <div class="wfstatus-step-name" title="'+this.escapeExpression((o=null!=(o=t.stepName||(null!=e?e.stepName:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"stepName","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.stepName||(null!=e?e.stepName:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"stepName","hash":{}}):o))+'</div>\r\n    <div class="wfstatus-step-duedate" title="'+this.escapeExpression((o=null!=(o=t.dueDate||(null!=e?e.dueDate:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"dueDate","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.dueDate||(null!=e?e.dueDate:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"dueDate","hash":{}}):o))+"</div>\r\n  </div>\r\n\r\n"+(null!=(n=t["if"].call(e,null!=e?e.assignee:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:"")+'\r\n  <div class="wfstatus-stepcard-action">\r\n    <div class="wfstatus-open-workflow-button">\r\n            <span><button class="binf-btn binf-btn-default" title="'+this.escapeExpression((o=null!=(o=t.OpenWorkflowLabel||(null!=e?e.OpenWorkflowLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"OpenWorkflowLabel","hash":{}}):o))+'"\r\n                          tabindex="0">'+this.escapeExpression((o=null!=(o=t.OpenWorkflowLabel||(null!=e?e.OpenWorkflowLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"OpenWorkflowLabel","hash":{}}):o))+"</button>\r\n            </span>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n"
}});return i.registerPartial("workflow_controls_stepcards_impl_stepcard",s),s}),csui.define("workflow/controls/stepcards/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/controls/stepcards/nls/root/lang",{"OpenWorkflow":"Open Workflow","NoStepAvailable":"The next step is dependent on the user action in the Current Step or there are multiple steps possible"}),csui.define("css!workflow/controls/stepcards/impl/stepcard",[],function(){}),csui.define("workflow/controls/stepcards/stepcard.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/contexts/factories/connector","workflow/controls/usercards/usercards.popover.view","hbs!workflow/controls/stepcards/impl/stepcard","i18n!workflow/controls/stepcards/nls/lang","css!workflow/controls/stepcards/impl/stepcard"],function(e,t,i,s,n,o,a,r,l){var c=n.ItemView.extend({"template":r,"className":"wfstatus-stepcard","constructor":function(){n.ItemView.prototype.constructor.apply(this,arguments),this.stepCardsListView=this.options.stepCardsListView,this.model.connector=this.options.context.getObject(o,this.options),this.listenTo(this.model,"change",this.render)},"templateHelpers":function(){var t={},s=this.model.get("task_assignees"),n=e("workflow/utils/workitem.util"),o=null===this.model.get("task_name")?"":this.model.get("task_name"),a=null===this.model.get("task_due_date")?"":this.model.get("task_due_date"),r=null===this.model.get("task_status")?"":this.model.get("task_status"),c="",d=this.model.get("task_id"),u={"dueDate":a,"status":r},h=n.formatStatus(u);return null!==s&&(s.assignees=s.assignee,c=n.getAssignee(s)),t={"taskId":d,"dueDate":h.status,"stepName":o,"assignee":c,"stepIcon":r},i.extend(t,{"OpenWorkflowLabel":l.OpenWorkflow}),t},"events":{"click .wfstatus-step-assignee":"showUserPopOver"},"showUserPopOver":function(){var e=this.model.get("task_assignees"),s=e.assignee,n=this.options.context,o=t(".wfstatusitem-step-cards").position().top;o&&t(".wfstatusitem-user-cards").css({"top":o}),this.model.unset("userId"),this.model.unset("assignedto"),1===s.length?this.model.set("userId",s[0].userId):this.model.set("assignedto",e.assignedto);var r={"model":this.model,"nodeModel":this.model,"context":n,"originatingView":this.options.cellView,"currentView":this,"stepCardsListView":this.stepCardsListView,"stepType":this.options.stepType,"wfData":i.pick(this.model.attributes,"process_id","subprocess_id","task_id","userId")},l={"delegateTarget":this.$el,"UserCardviewOptions":r};0!==s.length&&a.ShowPopOver(l)}});return c}),csui.define("hbs!workflow/controls/stepcards/impl/stepcard.empty",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e){var t;return'<div class="wfstatus-step-info">\r\n\r\n  <div class="wfstatus-step-header">\r\n    <div class="wfstatus-empty-message" title="'+this.escapeExpression(this.lambda(null!=(t=null!=e?e.messages:e)?t.NoStepAvailable:t,e))+'">'+this.escapeExpression(this.lambda(null!=(t=null!=e?e.messages:e)?t.NoStepAvailable:t,e))+"</div>\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n"}});return i.registerPartial("workflow_controls_stepcards_impl_stepcard.empty",s),s}),csui.define("workflow/controls/stepcards/stepcard.empty.view",["csui/lib/underscore","csui/lib/marionette","i18n!workflow/controls/stepcards/nls/lang","hbs!workflow/controls/stepcards/impl/stepcard.empty","css!workflow/controls/stepcards/impl/stepcard"],function(e,t,i,s){var n=t.ItemView.extend({"template":s,"className":"wfstatus-stepcard","templateHelpers":function(){return{"messages":{"NoStepAvailable":i.NoStepAvailable}}},"constructor":function(){t.ItemView.prototype.constructor.apply(this,arguments)}});return n}),csui.define("hbs!workflow/controls/stepcards/impl/stepcards",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="wfstatus-stepcards"></div>\r\n'}});return i.registerPartial("workflow_controls_stepcards_impl_stepcards",s),s}),csui.define("workflow/controls/stepcards/stepcards.view",["csui/lib/underscore","csui/lib/marionette","workflow/controls/stepcards/stepcard.view","workflow/controls/stepcards/stepcard.empty.view","hbs!workflow/controls/stepcards/impl/stepcards","css!workflow/controls/stepcards/impl/stepcard"],function(e,t,i,s,n){var o=t.CompositeView.extend({"childView":i,"childViewOptions":function(){return{"context":this.options.context,"cellView":this.options.cellView,"wfStatusInfoModel":this.options.wfStatusInfoModel,"stepCardsListView":this.options.stepCardsListView,"stepType":this.options.stepType}},"emptyView":s,"className":"wfstatus-stepcards-view binf-col-md-12 binf-col-sm-9 binf-col-xs-12","template":n,"constructor":function(){t.CompositeView.prototype.constructor.apply(this,arguments)}});return o}),csui.define("hbs!workflow/controls/stepcards/impl/stepcards.list",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="wfstatus-stepcard-list"></div>'}});return i.registerPartial("workflow_controls_stepcards_impl_stepcards.list",s),s}),csui.define("workflow/controls/stepcards/stepcards.list.view",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/models/nodes","csui/controls/tile/behaviors/perfect.scrolling.behavior","workflow/controls/stepcards/stepcard.view","workflow/controls/stepcards/stepcards.view","hbs!workflow/controls/stepcards/impl/stepcards.list","css!workflow/controls/stepcards/impl/stepcard"],function(e,t,i,s,n,o,a,r,l){var c=s.LayoutView.extend({"childView":a,"className":"wfstatus-stepcard-layout","template":l,"tagName":"div","behaviors":{"ScrollingInstructions":{"behaviorClass":o,"contentParent":".wfstatus-stepcard-list","suppressScrollX":!0}},"regions":{"stepcardLayout":".wfstatus-stepcard-list"},"constructor":function(e){e=e||{},s.LayoutView.prototype.constructor.call(this,e)},"onRender":function(){this.stepcollection=new n(this.options.step_list,{}),this.stepcardCollectionView=new r({"collection":this.stepcollection,"context":this.options.context,"cellView":this.options.cellView,"stepCardsListView":this,"wfStatusInfoModel":this.options.wfStatusInfoModel,"stepType":this.options.stepType}),this.stepcardLayout.show(this.stepcardCollectionView)}});return c}),csui.define("hbs!workflow/widgets/wfstatus/impl/wfstatusitem.body",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e,t){var i;return'      <span class="wfstatusitem-enddate">'+this.escapeExpression((i=null!=(i=t.startDate||(null!=e?e.startDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"startDate","hash":{}}):i))+'</span> - <span\r\n        class="wfstatusitem-enddate">'+this.escapeExpression((i=null!=(i=t.endDate||(null!=e?e.endDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"endDate","hash":{}}):i))+"</span>\r\n"},"3":function(e,t){var i;return'    <div class="wfstatusitem-step">\r\n      <div class="wfstatusitem-step-row">\r\n        <span class="wfstatusitem-step-left-label">  </span>\r\n        <div type="next" class="wfstatusitem-step-circle wfstatusitem-link\r\n      wfstatusitem-next-step-icon"></div>\r\n        <span type="next" class="wfstatusitem-step-right-label wfstatusitem-next-step-label">\r\n          '+this.escapeExpression((i=null!=(i=t.nextStepLabel||(null!=e?e.nextStepLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"nextStepLabel","hash":{}}):i))+'</span>\r\n      </div>\r\n      <div class="wfstatusitem-bar"></div>\r\n    </div>\r\n    <div class="wfstatusitem-step">\r\n      <div class="wfstatusitem-step-row">\r\n        <span class="wfstatusitem-step-left-label">'+this.escapeExpression((i=null!=(i=t.currentStepDate||(null!=e?e.currentStepDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"currentStepDate","hash":{}}):i))+' </span>\r\n        <div type="current" class="wfstatusitem-step-circle wfstatusitem-link\r\n      wfstatusitem-current-step-icon"></div>\r\n        <span type="current" class="wfstatusitem-step-right-label wfstatusitem-current-step-label">\r\n          '+this.escapeExpression((i=null!=(i=t.currentStepLabel||(null!=e?e.currentStepLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"currentStepLabel","hash":{}}):i))+' </span>\r\n      </div>\r\n      <div class="wfstatusitem-bar"></div>\r\n    </div>\r\n'},"5":function(e,t){var i;return'    <div class="wfstatusitem-step">\r\n      <div class="wfstatusitem-step-row">\r\n        <span class="wfstatusitem-step-left-label"> </span>\r\n        <div type="completed" class="wfstatusitem-step-circle wfstatusitem-link\r\n      wfstatusitem-completed-step-icon"></div>\r\n        <span type="completed"\r\n              class="wfstatusitem-step-right-label wfstatusitem-completed-step-label">\r\n          '+this.escapeExpression((i=null!=(i=t.completedStepLabel||(null!=e?e.completedStepLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"completedStepLabel","hash":{}}):i))+'</span>\r\n      </div>\r\n      <div class="wfstatusitem-bar"></div>\r\n    </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n,o;return'<div class="wfstatusitem-progressbar">\r\n\r\n  <div class="wfstatusitem-date">\r\n'+(null!=(n=t["if"].call(e,null!=e?e.showDateHeader:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:"")+'  </div>\r\n  <div class="wfstatusitem-step">\r\n    <div class="wfstatusitem-step-row">\r\n      <span class="wfstatusitem-step-left-label"> '+this.escapeExpression((o=null!=(o=t.panelEndDate||(null!=e?e.panelEndDate:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"panelEndDate","hash":{}}):o))+' </span>\r\n      <div class="wfstatusitem-step-circle"></div>\r\n      <span class="wfstatusitem-step-right-label"> '+this.escapeExpression((o=null!=(o=t.endLabel||(null!=e?e.endLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"endLabel","hash":{}}):o))+' </span>\r\n    </div>\r\n    <div class="wfstatusitem-bar"></div>\r\n  </div>\r\n\r\n'+(null!=(n=t["if"].call(e,null!=e?e.showCurrent:e,{"name":"if","hash":{},"fn":this.program(3,s,0),"inverse":this.noop}))?n:"")+"\r\n"+(null!=(n=t["if"].call(e,null!=e?e.showCompleted:e,{"name":"if","hash":{},"fn":this.program(5,s,0),"inverse":this.noop}))?n:"")+'\r\n  <div class="wfstatusitem-step">\r\n    <div class="wfstatusitem-step-row">\r\n      <span class="wfstatusitem-step-left-label"> '+this.escapeExpression((o=null!=(o=t.startDate||(null!=e?e.startDate:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"startDate","hash":{}}):o))+' </span>\r\n      <div class="wfstatusitem-step-circle"></div>\r\n      <span class="wfstatusitem-step-right-label"> '+this.escapeExpression((o=null!=(o=t.startLabel||(null!=e?e.startLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"startLabel","hash":{}}):o))+' </span>\r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n<div class="wfstatusitem-step-cards"></div>\r\n<div class="wfstatusitem-user-cards"></div>\r\n'}});return i.registerPartial("workflow_widgets_wfstatus_impl_wfstatusitem.body",s),s}),csui.define("workflow/widgets/wfstatus/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/wfstatus/impl/nls/root/lang",{"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"dialogTitle":"Workflow Tracking","emptyListText":"There are no items to display","totalMsg":"Total","onTime":"On time","completed":"Completed","late":"Late","expandLabel":"Expand","dueDateLabel":"Due date","currentStepNameLabel":"Current step","assignedToLabel":"Assigned to","startDateLabel":"Start date","startedLabel":"Started","statusLabel":"Status","initiatorLabel":"Initiator","wfNameLabel":"Workflow name","NameLabel":"Name","allFilterLabel":"All","completedFilterLabel":"Completed","lateFilterLabel":"Late","ontimeFilterLabel":"On Time","headerFilterTitle":"Refine by","headerFilterLabel":"Show items with status","days":"days","day":"day","dueInLabel":"due in","dueLabel":"due","todayLabel":"today","details":"Details","attachments":"Attachments","startLabel":"Start","endLabel":"End","currentStepLabel":"Current Step","nextStepLabel":"Next Step","completedStepLabel":"Completed Step","currentStepsLabel":"Current Steps","completedStepsLabel":"Completed Steps"}),csui.define("css!workflow/widgets/wfstatus/impl/wfstatus.progress",[],function(){}),csui.define("workflow/widgets/wfstatus/impl/wfstatusitem.body.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/marionette","workflow/controls/stepcards/stepcards.list.view","hbs!workflow/widgets/wfstatus/impl/wfstatusitem.body","i18n!workflow/widgets/wfstatus/impl/nls/lang","css!workflow/widgets/wfstatus/impl/wfstatus.progress"],function(e,t,i,s,n,o,a){var r=s.LayoutView.extend({"template":o,"className":"wfstatusitem-content","constructor":function(e){this.options=e,this.model=e.model,this.defaults={"currentStepPosition":191},t(window).bind("resize.app",this.adjustStepCardPosition),s.LayoutView.prototype.constructor.call(this,e)},"ui":{"nodeIcon":".wfstatusitem-step-circle","nodeLabel":".wfstatusitem-step-right-label","currentStepIcon":".wfstatusitem-current-step-icon","completedStepIcon":".wfstatusitem-completed-step-icon","nextStepIcon":".wfstatusitem-next-step-icon","currentStepLabel":".wfstatusitem-current-step-label","completedStepLabel":".wfstatusitem-completed-step-label","nextStepLabel":".wfstatusitem-next-step-label","stepCard":".wfstatus-step-info"},"events":{"click @ui.currentStepIcon, @ui.currentStepLabel,@ui.completedStepIcon,@ui.completedStepLabel, @ui.nextStepIcon, @ui.nextStepLabel":"onClickStep","click .wfstatus-stepcard":"makeStepCardActive"},"regions":{"progressbar":".wfstatusitem-progressbar","stepcards":".wfstatusitem-step-cards"},"templateHelpers":function(){var t=e("workflow/utils/workitem.util"),i=this.model.get("details"),s=i.date_initiated&&i.end_date,n=this.model.get("step_list"),o=n&&n.current,r=n&&n.completed,l=o&&o.length>=1?t.dateConversion(o[0].task_start_date,"Month DD"):"",c=s?this.getDateHeader(i.start_date,i.end_date):"";return{"startLabel":a.startLabel,"endLabel":a.endLabel,"currentStepLabel":o&&o.length>1?a.currentStepsLabel:a.currentStepLabel,"nextStepLabel":a.nextStepLabel,"completedStepLabel":r&&r.length>1?a.completedStepsLabel:a.completedStepLabel,"wfName":i.wf_name,"startDate":c?c.startDate:"","panelStartDate":i.date_initiated,"currentStepDate":l,"endDate":c?c.endDate:"","panelEndDate":""===i.end_date?"":t.dateConversion(i.end_date,"Month DD"),"dueDate":i.due_date,"status":i.status_key,"assignee":i.assignee,"userId":i.userId,"showDateHeader":s,"showCompleted":r&&0!==r.length?!0:!1,"showCurrent":o&&0!==o.length?!0:!1}},"getDateHeader":function(t,i){var s=new Date(t),n=new Date(i),o=e("workflow/utils/workitem.util"),a={};return a.endDate=o.dateConversion(i),a.startDate=s.getFullYear()===n.getFullYear()?o.dateConversion(t,"Month DD"):o.dateConversion(t),a},"makeStepCardActive":function(e){if(t(".wfstatus-stepcard.active").length>0){t(t(".wfstatus-stepcard-layout .wfstatus-title-icon")[0]).removeClass("active");var i=t(".wfstatus-stepcard.active")[0];t(i).removeClass("active")}t(e.currentTarget).addClass("active")},"onClickStep":function(i){var s=e("workflow/utils/workitem.util");s.unbindPopover(),this.removeFocusIcons();var o,a,r,l,c,d=i&&i.currentTarget?i.currentTarget.getAttribute("type"):i;if(this.currentAction=d,d){switch(d){case"current":this.showArrow(this.ui.currentStepIcon,this.ui.currentStepLabel),o=this.ui.currentStepLabel.position();break;case"completed":this.showArrow(this.ui.completedStepIcon,this.ui.completedStepLabel),o=this.ui.completedStepLabel.position();break;case"next":this.showArrow(this.ui.nextStepIcon,this.ui.nextStepLabel),o=this.ui.nextStepLabel.position()}r=this.model.get("step_list")[d],l={"step_list":r,"context":this.options.context,"cellView":this.options.cellView,"wfStatusInfoModel":this.model,"stepType":d},this.stepcardsListView=new n(l),this.stepcards.show(this.stepcardsListView),a=o.top,c=t(".wfstatus-stepcard").height(),a=0!==a?a-c/2+14:this.defaults.currentStepPosition,t(".wfstatusitem-step-cards").css({"top":a});var u=a/16+13;t(".wfstatus-stepcard-list").css({"height":"calc(100vh - "+u+"rem)"}),this.makeDefaultStepCardActive()}},"makeDefaultStepCardActive":function(){t(".wfstatusitem-focus-arrow").length>0&&(t(t(".wfstatus-stepcard")[0]).addClass("active"),t(t(".wfstatus-stepcard-layout .wfstatus-title-icon")[0]).addClass("active"))},"adjustStepCardPosition":function(e){var i=t(t(".wfstatusitem-body"))[0].offsetHeight;"object"==typeof e&&(e=t(".wfstatusitem-bar").length),t(".wfstatusitem-progressbar .wfstatusitem-bar").css({"height":(i-250)/e}),t(".wfstatusitem-step-cards").css({"top":t(".wfstatusitem-focus-arrow")[0].offsetTop-30}),t(".wfstatus-progress-view").css({"opacity":"1"});var s=t(".wfstatusitem-focus-arrow")[0].offsetTop-30,n=s/16+13;t(".wfstatus-stepcard-list").css({"height":"calc(100vh - "+n+"rem)"})},"removeFocusIcons":function(){this.stepcardsListView&&this.stepcardsListView.destroy(),this.ui.nodeIcon.removeClass("wfstatusitem-focus-icon"),this.ui.nodeLabel.removeClass("wfstatusitem-focus-arrow")},"showArrow":function(e,t){e&&t&&(e.addClass("wfstatusitem-focus-icon"),t.addClass("wfstatusitem-focus-arrow"))}});return r}),csui.define("workflow/models/wfstatus/tabpanel.model",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone"],function(e,t,i){var s=i.Model.extend({"constructor":function(){i.Model.prototype.constructor.apply(this,arguments)}}),n=i.Collection.extend({"model":s,"constructor":function(){i.Collection.prototype.constructor.apply(this,arguments)}});return n}),csui.define("workflow/widgets/wfstatus/impl/wfstatusitem.tabpanel.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/log","csui/utils/contexts/factories/node","csui/controls/tab.panel/tab.panel.view","csui/controls/tab.panel/tab.links.ext.view"],function(e,t,i,s,n,o,a,r){var l=a.extend({"contentView":function(e){return e.get("viewToRender")},"contentViewOptions":function(e){return e.get("viewToRenderOptions")},"constructor":function(t){e.defaults(t,{"tabType":"binf-nav-pills","delayTabContent":!1,"TabLinkCollectionViewClass":r}),a.prototype.constructor.apply(this,arguments)}});return l}),csui.define("hbs!workflow/widgets/wfstatus/impl/wfstatusitem.details",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t){var i;return'<div class=\'wfstatusitem-details\'>\r\n\r\n  <div class="wfstatusitem-details-rec">\r\n    <div class="wfstatusitem-details-label">'+this.escapeExpression((i=null!=(i=t.NameLabel||(null!=e?e.NameLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"NameLabel","hash":{}}):i))+'</div>\r\n    <div class="wfstatusitem-details-value" title="'+this.escapeExpression((i=null!=(i=t.wfName||(null!=e?e.wfName:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"wfName","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.wfName||(null!=e?e.wfName:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"wfName","hash":{}}):i))+'</div>\r\n  </div>\r\n\r\n  <div class="wfstatusitem-details-rec">\r\n    <div class="wfstatusitem-details-label">'+this.escapeExpression((i=null!=(i=t.dueDateLabel||(null!=e?e.dueDateLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"dueDateLabel","hash":{}}):i))+'</div>\r\n    <div class="wfstatusitem-details-value" title="'+this.escapeExpression((i=null!=(i=t.dueDate||(null!=e?e.dueDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"dueDate","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.dueDate||(null!=e?e.dueDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"dueDate","hash":{}}):i))+'</div>\r\n  </div>\r\n\r\n  <div class="wfstatusitem-details-rec">\r\n    <div class="wfstatusitem-details-label">'+this.escapeExpression((i=null!=(i=t.statusLabel||(null!=e?e.statusLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"statusLabel","hash":{}}):i))+'</div>\r\n    <div class="wfstatusitem-details-value" title="'+this.escapeExpression((i=null!=(i=t.status||(null!=e?e.status:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"status","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.status||(null!=e?e.status:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"status","hash":{}}):i))+'</div>\r\n  </div>\r\n\r\n  <div class="wfstatusitem-details-rec">\r\n    <div class="wfstatusitem-details-label">'+this.escapeExpression((i=null!=(i=t.initiatorLabel||(null!=e?e.initiatorLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"initiatorLabel","hash":{}}):i))+'</div>\r\n    <div class="wfstatusitem-details-value" title="'+this.escapeExpression((i=null!=(i=t.initiator||(null!=e?e.initiator:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"initiator","hash":{}}):i))+'">\r\n      <span class="wfstatusitem-mini-profile-avatar">\r\n         <span class="wfstatus-mini-profile-pic">\r\n             <div class="image_user_placeholder wfstatusitem-userprofile-default-avatar binf-hidden"\r\n                  title="'+this.escapeExpression((i=null!=(i=t.initiator||(null!=e?e.initiator:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"initiator","hash":{}}):i))+'"></div>\r\n             <img id="wfstatusitem-mini-profile-pic-'+this.escapeExpression((i=null!=(i=t.userId||(null!=e?e.userId:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"userId","hash":{}}):i))+'"\r\n                  class="wfstatusitem-userprofile-img\r\n             binf-img-circle-show binf-hidden" >\r\n         </span>\r\n      </span>\r\n      '+this.escapeExpression((i=null!=(i=t.initiator||(null!=e?e.initiator:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"initiator","hash":{}}):i))+'</div>\r\n  </div>\r\n\r\n  <div class="wfstatusitem-details-rec">\r\n    <div class="wfstatusitem-details-label">'+this.escapeExpression((i=null!=(i=t.startedLabel||(null!=e?e.startedLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"startedLabel","hash":{}}):i))+'</div>\r\n    <div class="wfstatusitem-details-value" title="'+this.escapeExpression((i=null!=(i=t.startDate||(null!=e?e.startDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"startDate","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.startDate||(null!=e?e.startDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"startDate","hash":{}}):i))+"</div>\r\n  </div>\r\n\r\n</div>\r\n"}});return i.registerPartial("workflow_widgets_wfstatus_impl_wfstatusitem.details",s),s}),csui.define("workflow/widgets/wfstatus/impl/wfstatusitem.details.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/marionette","csui/utils/url","workflow/models/wfstatus/usercard.model","hbs!workflow/widgets/wfstatus/impl/wfstatusitem.details","i18n!workflow/widgets/wfstatus/impl/nls/lang"],function(e,t,i,s,n,o,a,r){var l=s.LayoutView.extend({"template":a,"ui":{"userIcon":".wfstatusitem-userprofile-img","defaultUserIcon":".wfstatusitem-userprofile-default-avatar"},"constructor":function(i){s.LayoutView.prototype.constructor.call(this,arguments),this.model=i.model,this.details=i.model.get("details"),this.photoUrl=null;var n=this;this.details.userId&&new o({"userId":this.details.userId,"connector":this.model.connector}).fetch().done(function(i){var s=e("workflow/utils/workitem.util"),o=i.results.data.properties,a=t("#wfstatusitem-mini-profile-pic-"+o.id);null===o.photo_url?n.ui.defaultUserIcon.removeClass("binf-hidden"):(n.model.set("photo_url",o.photo_url),s.showProfilePic(n.model).done(function(e){var t=URL.createObjectURL(e);n.ui.userIcon.removeClass("binf-hidden"),a.attr("src",t)}).fail(function(){n.ui.userIcon.addClass("binf-hidden")}))})},"templateHelpers":function(){var e=this.details;return{"NameLabel":r.NameLabel,"dueDateLabel":r.dueDateLabel,"statusLabel":r.statusLabel,"initiatorLabel":r.initiatorLabel,"startedLabel":r.startedLabel,"wfName":e.wf_name,"startDate":e.date_initiated,"dueDate":e.due_date,"status":e.status_key,"initiator":e.initiator,"userId":e.userId}}});return l}),csui.define("hbs!workflow/widgets/wfstatus/impl/wfstatusitem.attachments",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return"<div class='wfstatusitem-attachments'></div>"}});return i.registerPartial("workflow_widgets_wfstatus_impl_wfstatusitem.attachments",s),s}),csui.define("workflow/widgets/wfstatus/impl/wfstatusitem.attachments.view",["csui/lib/jquery","csui/lib/underscore","csui/lib/marionette","csui/models/nodechildren","csui/controls/globalmessage/globalmessage","csui/utils/contexts/factories/node","csui/controls/progressblocker/blocker","csui/controls/tile/behaviors/perfect.scrolling.behavior","workflow/widgets/workitem/workitem.attachments/impl/workitem.attachmentlist.view","i18n!workflow/widgets/wfstatus/impl/nls/lang","i18n!workflow/widgets/workitem/workitem.attachments/impl/nls/lang","hbs!workflow/widgets/wfstatus/impl/wfstatusitem.attachments","css!workflow/widgets/wfstatus/impl/wfstatus.progress"],function(e,t,i,s,n,o,a,r,l,c,d,u){var h=i.LayoutView.extend({"template":u,"ui":{"wfAttachments":".wfstatusitem-attachments"},"regions":{"attachmentsRegion":".wfstatusitem-attachments"},"constructor":function(e){this.options=e||{},i.LayoutView.prototype.constructor.call(this,e),this.model=e.model?e.model:{}},"behaviors":{"ScrollingInstructions":{"behaviorClass":r,"contentParent":".wfstatusitem-attachments","suppressScrollX":!0}},"onRender":function(){a.imbue(this),this.blockActions(),this.model.set("isWFStatusItemAttachment",!0),this.renderAttachments()},"renderAttachments":function(){var i=this.model.get("attachments"),a=this.options.context.getModel(o,{"attributes":{"id":i.attachment_folder_id}});this.attachmentCollection=new s(void 0,{"node":a,"includeActions":!1,"delayRestCommands":!0,"expand":["node"],"commands":["default","open"]}),this.attachmentCollection.fetch().done(t.bind(function(){if(this.attachmentCollection.length>0){var i=this.attachmentCollection.length;e("li").has('a[title="Attachments"]').append("<span class='cs-tablink-text'>"+i+"</span>"),this.attachments=new l({"context":this.options.context,"collection":this.attachmentCollection,"view":this}),this.attachments.render(),this.attachmentCollection.delayedActions.fetch().done(t.bind(function(){this.attachmentsRegion.show(this.attachments)},this))}},this)).fail(t.bind(function(){n.showMessage("error",d.ErrorMessageLoadAttachments)},this)).always(t.bind(function(){this.unblockActions()},this))}});return h}),csui.define("workflow/models/wfstatus/wfstatusinfo.model",["csui/lib/backbone","csui/lib/underscore","csui/utils/url","csui/models/node/node.model"],function(e,t,i){var s=e.Model.extend({"constructor":function(t,i){e.Model.prototype.constructor.apply(this,arguments),i&&i.connector&&i.connector.assignTo(this)},"url":function(){var e=this.connector.connection.url.replace("/v1","/v2"),t=i.combine(e,"workflows/status"),s=this.get("process_id");return t+="/processes/"+s},"parse":function(e){return e.results},"reset":function(e){this.clear(e),t.isUndefined(this.wfStatusInfo)||this.wfStatusInfo.reset()},"isFetchable":function(){return!0}});return s}),csui.define("workflow/models/wfstatus/wfstatusinfo.model.factory",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/utils/contexts/factories/factory","csui/utils/contexts/factories/connector","workflow/models/wfstatus/wfstatusinfo.model"],function(e,t,i,s,n,o){var a=s.extend({"propertyPrefix":"wfstatusinfo","constructor":function(e,t){s.prototype.constructor.apply(this,arguments);var i=e.getObject(n,t);this.context=e,this.property=new o(t,{"connector":i})},"isFetchable":function(){return this.property.isFetchable()},"fetch":function(e){return this.property.fetch(e)}});return a}),csui.define("hbs!workflow/widgets/wfstatus/impl/wfstatus.progress",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="wfstatusitem-progress-panel">\r\n  <div class="wfstatusitem-body binf-col-md-9 binf-col-sm-9 binf-col-xs-12" ></div>\r\n  <div class="wfstatusitem-tabpanel binf-col-md-3 binf-col-sm-3 binf-hidden-xs"></div>\r\n</div>'}});return i.registerPartial("workflow_widgets_wfstatus_impl_wfstatus.progress",s),s}),csui.define("workflow/widgets/wfstatus/impl/wfstatus.progress.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","workflow/widgets/wfstatus/impl/wfstatusitem.body.view","workflow/models/wfstatus/tabpanel.model","workflow/widgets/wfstatus/impl/wfstatusitem.tabpanel.view","workflow/widgets/wfstatus/impl/wfstatusitem.details.view","workflow/widgets/wfstatus/impl/wfstatusitem.attachments.view","workflow/models/wfstatus/wfstatusinfo.model.factory","hbs!workflow/widgets/wfstatus/impl/wfstatus.progress","i18n!workflow/widgets/wfstatus/impl/nls/lang","css!workflow/widgets/wfstatus/impl/wfstatus.progress"],function(e,t,i,s,n,o,a,r,l,c,d,u,h){var m=n.LayoutView.extend({"className":"wfstatus-progress-view","template":u,"regions":{"body":".wfstatusitem-body","tabPanel":".wfstatusitem-tabpanel"},"events":{"click .wfstatusitem-body, .wfstatusitem-tabpanel":"destroyUserCardPopovers"},"constructor":function(t){var s=e("workflow/utils/workitem.util"),o=t.model,r=o.get("process_id")?o.get("process_id"):0,u=o.get("subprocess_id")?o.get("subprocess_id"):0,m=o.get("task_id")?o.get("task_id"):0,p=t.context.getModel(d);p.set({"process_id":r,"subprocess_id":u,"task_id":m}),this.dataFetched=!1,p.fetch().done(i.bind(function(){this.dataFetched=!0;var e=p.get("wf_details"),t=e.initiator.firstName+" "+e.initiator.lastName,n=e.initiator.loginName,o=e.due_date,r=e.date_initiated,d=s.formatStatus({"dueDate":o,"status":e.status}),u={"wf_name":e.wf_name,"due_date":o?s.dateConversion(o):"","status_key":d.status,"initiator":" "===t?n:t,"date_initiated":r?s.dateConversion(r):"","userId":e.initiator.userId,"end_date":o,"start_date":r};p.set("details",u),this.model=p,this.viewOptions={"model":this.model,"context":this.options.context,"cellView":this.options.cellView},this.tabpanelCollection=new a([{"title":h.details,"viewToRender":l,"viewToRenderOptions":this.viewOptions,"id":i.uniqueId("wfstatusitem-tab")}]),i.isEmpty(this.model.get("attachments"))||this.tabpanelCollection.add({"title":h.attachments,"viewToRender":c,"viewToRenderOptions":this.viewOptions,"id":i.uniqueId("wfstatusitem-tab")}),this.render()},this)),n.LayoutView.prototype.constructor.apply(this,arguments)},"onRender":function(){this.dataFetched&&(this._renderBody(),this._renderTabPanel())},"destroyUserCardPopovers":function(){if(t(".wfstatus-usercard-popover").length>0){var i=e("workflow/utils/workitem.util");i.unbindPopover()}},"onDomRefresh":function(){if(t(".wfstatusitem-bar").length>0&&t(".wfstatus-progress-view")[0].offsetHeight>0){var e,i=this.model.get("step_list"),s=i&&i.current?i.current.length:0,n=i&&i.completed?i.completed.length:0,o="current";0===s?(e=2,o="completed"):e=0===n?3:4,this.body.currentView.onClickStep(o),this.body.currentView.adjustStepCardPosition(e)}},"_renderBody":function(){this.body.show(new o(this.viewOptions))},"_renderTabPanel":function(){if(this.tabpanelCollection.models.length>0){var e=new r({"collection":this.tabpanelCollection});this.tabPanel.show(e)}},"onBeforeDestroy":function(){t(window).unbind("resize.app"),this.model.reset();var i=e("workflow/utils/workitem.util");i.unbindPopover()}});return m}),csui.define("workflow/utils/workitem.util",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","csui/utils/log","csui/utils/commands/open.node.perspective","csui/models/nodes","csui/utils/commandhelper","csui/utils/contexts/factories/node","csui/controls/dialog/dialog.view","workflow/widgets/wfstatus/impl/wfstatus.progress.view","i18n!workflow/widgets/wfstatus/impl/nls/lang"],function(e,t,i,s,n,o,a,r,l,c,d,u){var h={"constants":{"WFSTATUS_ONTIME":"ontime","WFSTATUS_COMPLETED":"completed","WFSTATUS_LATE":"workflowlate","URI_DELIMITER":":","AT_SIGN_SYMBOL":"@","URI_PREFIX":"sip"},"dateConversion":function(e,t){var i,s=new Date(e);
switch(t){case"Month DD":i=u.months[s.getMonth()]+" "+s.getDate();break;default:i=u.months[s.getMonth()]+" "+s.getDate()+", "+s.getFullYear()}return i},"getAssignee":function(e){var t=e.assignees,i="",s="";return t&&t.length>1?(s=(t[0].firstName+" "+t[0].lastName).trim(),""!==s?i=s+" +"+(t.length-1):e.assignedto&&(i=e.assignedto.groupName+" + "+t.length)):1===t.length&&(e.assignedto&&""!==e.assignedto.groupName?(s=(t[0].firstName+" "+t[0].lastName).trim(),i=""!==s?s:e.assignedto.groupName):(i=(t[0].firstName+" "+t[0].lastName).trim(),i=""===i?t[0].loginName:i)),i},"displayWfstatusItemProgresspanel":function(e){this.unbindPopover(),this.progressDialog=new c;var i=t(".wfstatus.csui-expanded");i.hide(),this.progressDialog.options.title=e.model.get("wf_name"),this.progressDialog.options.iconRight="wfstatusitem-no-icon-right",this.progressDialog.options.iconLeft="title-icon mime_workflow_status",this.progressDialog.options.className="wfstatus-progress-view-dialog",this.progressDialog.options.actionIconLeft="arrow_back wfstatus-progress-view-dialog-back",this.progressDialog.options.largeSize=!0,this.progressDialog.options.view=new d(e),this.progressDialog.show();var s=this;this.progressDialog.listenTo(this.progressDialog,"destroy",function(){i.show()});var n=t(".wfstatus-progress-view-dialog-back").attr("tabindex","0");n.on("click",function(){s.progressDialog.options.view.destroy(),s.progressDialog.remove(),i.show()}),t(window).unbind("resize.app");var o=t(".wfstatusitem-no-icon-right");o.hide()},"unbindPopover":function(e){e&&t(e.delegateTarget).css("overflow",""),t(".wfstatus-usercard-popover").length>0&&(t(window).unbind("resize.onUserCardPopOver"),t(window).unbind("popstate.onUserCardPopOver"),t(window).unbind("hashchange.onUserCardPopOver"),t(".wfstatus-table tbody").off("scroll"),t(".binf-modal-backdrop").unbind("keydown click"),t(".binf-modal-header").unbind("keydown click"),t("[id*=wfstatus-usercard-popover]").remove(),t("[id*=wfstatus-usercard-popover-pointer]").remove(),t("[id*=wfstatus-usercard-popover-mask]").remove())},"formatStatus":function(e){var t,i,s,n=e.status,o=e.dueDate,a="wfstatus-"+n+"-icon",r=new Date(Date.now());return n===this.constants.WFSTATUS_ONTIME?(s=o?new Date(o):"",t=""!==s?Math.round(s.getDifference(r)/1e3/60/60/24):void 0,i=0===t?u.dueLabel+" "+u.todayLabel:1===t?u.dueInLabel+" "+t+" "+u.day:5>=t?u.dueInLabel+" "+t+" "+u.days:u.onTime.toLowerCase()):n===this.constants.WFSTATUS_COMPLETED?i=u.completed.toLowerCase():n===this.constants.WFSTATUS_LATE&&(s=o?new Date(o):"",t=""!==s?Math.round(r.getDifference(s)/1e3/60/60/24):void 0,i=1===t?t+" "+u.day+" "+u.lateFilterLabel.toLowerCase():t>1&&5>=t?t+" "+u.days+" "+u.lateFilterLabel.toLowerCase():u.late.toLowerCase()),{"status":i,"styleclass":a}},"showProfilePic":function(e){var i=t.Deferred();if(e.get("photo_url")){var n=e.get("photo_url"),o=n.substring(6),a=s.combine(e.connector.connection.url,o),r=e.connector.extendAjaxOptions({"url":a,"method":"GET","dataType":"binary"});t.ajax(r).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)})}return i.promise()},"getChatURI":function(e){var t=e.uriPrefix?e.uriPrefix:this.constants.URI_PREFIX,i=t+this.constants.URI_DELIMITER+e.tguser+this.constants.AT_SIGN_SYMBOL+e.domain;return i},"getWorkflowtype":function(e){var t=!0,i=!0,s="Both";return e&&(t=e.filterInitiated,i=e.filterManaged),t&&i?s="Both":t?s="Initiated":i&&(s="Managed"),s},"validateURL":function(e){var t=this.parseURL(e),i=t.hostname.trim();return""===i?e:i.toUpperCase()===location.hostname.trim().toUpperCase()?e:""},"parseURL":function(e){var t=document.createElement("a");return t.href=e,{"source":e,"protocol":t.protocol.replace(":",""),"hostname":t.hostname,"host":t.host,"port":t.port,"query":t.search,"params":function(){for(var e,i={},s=t.search.replace(/^\?/,"").split("&"),n=s.length,o=0;n>o;o++)s[o]&&(e=s[o].split("="),i[e[0]]=e[1]);return i}(),"hash":t.hash.replace("#",""),"segments":t.pathname.replace(/^\//,"").split("/")}}};return h}),csui.define("hbs!workflow/widgets/workitem/workitem/impl/header",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e,t,i,s){var n;return(null!=(n=t["if"].call(e,null!=e?e.showIcon:e,{"name":"if","hash":{},"fn":this.program(2,s,0),"inverse":this.noop}))?n:"")+(null!=(n=t["if"].call(e,null!=e?e.multiMaps:e,{"name":"if","hash":{},"fn":this.program(10,s,0),"inverse":this.program(13,s,0)}))?n:"")+"\r\n  </div>\r\n\r\n\r\n"},"2":function(e,t,i,s){var n;return null!=(n=t["if"].call(e,null!=e?e.iconLeft:e,{"name":"if","hash":{},"fn":this.program(3,s,0),"inverse":this.program(5,s,0)}))?n:""},"3":function(e,t){var i;return'      <span class="tile-type-icon cs-icon-left '+this.escapeExpression((i=null!=(i=t.iconLeft||(null!=e?e.iconLeft:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"iconLeft","hash":{}}):i))+'"></span>\r\n      <div class="tile-title">\r\n'},"5":function(e,t,i,s){var n;return null!=(n=t["if"].call(e,null!=e?e.imageLeftUrl:e,{"name":"if","hash":{},"fn":this.program(6,s,0),"inverse":this.program(8,s,0)}))?n:""},"6":function(e,t){var i;return'          <div class="tile-type-image '+this.escapeExpression((i=null!=(i=t.imageLeftClass||(null!=e?e.imageLeftClass:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"imageLeftClass","hash":{}}):i))+'">\r\n            <img src="'+this.escapeExpression((i=null!=(i=t.imageLeftUrl||(null!=e?e.imageLeftUrl:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"imageLeftUrl","hash":{}}):i))+'" aria-hidden="true">\r\n          </div>\r\n        <div class="tile-title">\r\n'},"8":function(){return'        <div class="tile-title cs-text-only">\r\n'},"10":function(e,t,i,s){var n,o;return'      <div class="cs-formfield cs-selectfield binf-dropdown">\r\n        <div class="cs-field-write">\r\n          <div class="cs-field-write-inner cs-drop-down">\r\n            <button id="select-workflow-type" title="'+this.escapeExpression((o=null!=(o=t.MultipleMapsSelectPlaceholder||(null!=e?e.MultipleMapsSelectPlaceholder:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"MultipleMapsSelectPlaceholder","hash":{}}):o))+'"\r\n                    type="button" class="binf-btn binf-btn-default binf-dropdown-toggle\r\n                    '+this.escapeExpression((o=null!=(o=t.shadowClass||(null!=e?e.shadowClass:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"shadowClass","hash":{}}):o))+'" data-binf-toggle="dropdown" aria-haspopup="true"\r\n                    aria-expanded="false">\r\n              <span class="cs-label select-workflow-label">'+this.escapeExpression((o=null!=(o=t.MultipleMapsSelectPlaceholder||(null!=e?e.MultipleMapsSelectPlaceholder:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"MultipleMapsSelectPlaceholder","hash":{}}):o))+'</span>\r\n              <span class="cs-icon icon-caret-down"></span>\r\n            </button>\r\n            <ul class="binf-dropdown-menu ps-container" role="menu"\r\n                aria-label="'+this.escapeExpression((o=null!=(o=t.MultipleMapsSelectPlaceholder||(null!=e?e.MultipleMapsSelectPlaceholder:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"MultipleMapsSelectPlaceholder","hash":{}}):o))+'">\r\n'+(null!=(n=t.each.call(e,null!=e?e.maps:e,{"name":"each","hash":{},"fn":this.program(11,s,0),"inverse":this.noop}))?n:"")+"            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n"},"11":function(e){return'                <li><a role="menuitem" class="cs-menu-option" href="#" data-wfid="'+this.escapeExpression(this.lambda(null!=e?e.DataID:e,e))+'" tabindex="-1" data-cstabindex="-1" >\r\n              <span class="cs-label" data-wfid="'+this.escapeExpression(this.lambda(null!=e?e.DataID:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.Name:e,e))+"</span>\r\n                </a>\r\n                </li>\r\n"},"13":function(e,t){var i;return'      <h2 title="'+this.escapeExpression((i=null!=(i=t.title||(null!=e?e.title:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"title","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.title||(null!=e?e.title:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"title","hash":{}}):i))+"</h2>\r\n"},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n;return null!=(n=t["if"].call(e,null!=e?e.expandedHeader:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:""}});return i.registerPartial("workflow_widgets_workitem_workitem_impl_header",s),s}),csui.define("workflow/widgets/workitem/workitem/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/workitem/workitem/impl/nls/root/lang",{"CloseButtonLabel":"Close","CancelButtonLabel":"Cancel","StartButtonLabel":"Start","ActionFailMessageTitle":'Action "{0}" failed',"ActionFailMessage":'Action "{0}" failed. \n\n{1}',"AssigneePickerLabelTo":"To","AssigneePickerLabelSendTo":"Send to","CommentTextFieldLabelInstructions":"Instructions","CommentTextFieldPlaceholderInstructions":"Add instructions","CommentTextFieldLabelReply":"Reply","CommentTextFieldPlaceholderReply":"Add reply","SubmitLabelSend":"Send","SuccessSendOnMessage":"One workflow submitted by you.","SuccessInitiateMessage":"Start workflow action was successful.","ErrorMessageLoadExtension":"Workflow could not load extension.","MultipleMapsSelectPlaceholder":"Select workflow type","ChangeWorkflowTypeTitle":"Changing Workflow Type","ChangeWorkflowTypeMessage":"Any changes you have made to this step will be lost.","ReserveDocumentMessageTitle":"Document reserved","ReserveDocumentMessageText":"The document {0} is reserved. \nDo you want to continue anyway?","MemberAcceptDialogTitle":"Workflow sent to a group","MemberAcceptDialogMessage":"Click Accept to work on this Workflow. It will be removed from the My Assignments tile of the other group members. It will be available on your My Assignments tile.","MemberAcceptAcceptButtonLabel":"Accept","MemberAcceptCloseButtonLabel":"Close","MemberAcceptedMessage":"This workflow has been accepted by you","MemberAcceptErrorDescription":"This Workflow was accepted by another group member.","MemberAcceptErrorTitle":"Workflow no longer available","DialogModelTitle":"{0}: {1}","WorkflowStepTitle":"Workflow Step : {0}"}),csui.define("css!workflow/widgets/workitem/workitem/impl/workitem",[],function(){}),csui.define("workflow/widgets/workitem/workitem/impl/header.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/utils/contexts/factories/node","csui/models/nodes","csui/utils/commandhelper","csui/dialogs/modal.alert/modal.alert","csui/controls/globalmessage/globalmessage","workflow/models/workflow/workflow.model","workflow/commands/initiate.workflow/initiate.workflow","hbs!workflow/widgets/workitem/workitem/impl/header","i18n!workflow/widgets/workitem/workitem/impl/nls/lang","i18n!csui/pages/start/impl/nls/lang","css!workflow/widgets/workitem/workitem/impl/workitem"],function(e,t,i,s,n,o,a,r,l,c,d,u,h){var m=i.ItemView.extend({"template":u,"behaviors":{"TabableRegion":{"behaviorClass":s,"initialActivationWeight":100}},"ui":{"titleWorkflow":".tile-title>h2"},"events":{"keydown":"onKeyInView","click .cs-menu-option":"onMapSelectionChanged"},"templateHelpers":function(){var t=this.options.maps,i="";for(var s in t){var n=t[s].Name.split(":");this.options.maps[s].Name=n[n.length-1]}var o=h.MultipleMapsSelectPlaceholder,a="",r=!0;return this.model&&this.model.attributes.isDocDraft&&(o=this.model.attributes.title),i=this.options.multiMaps===!0?o:this.options.title,document.title=e.str.sformat(h.WorkflowStepTitle,i),{"iconLeft":this.options.iconLeft,"imageLeftUrl":this.options.imageLeftUrl,"imageLeftClass":this.options.imageLeftClass,"title":this.options.title,"expandedHeader":!0,"multiMaps":this.options.multiMaps,"maps":this.options.maps,"MultipleMapsSelectPlaceholder":o,"shadowClass":a,"showIcon":r}},"constructor":function(){i.View.prototype.constructor.apply(this,arguments)},"isTabable":function(){return!0},"currentlyFocusedElement":function(){var e=this.$("#select-workflow-type");return e.length>0?t(e[0]):this.ui.titleWorkflow},"onSetFocus":function(){this.ui.titleWorkflow.focus()},"onDomRefresh":function(){var e=this.$("#select-workflow-type");e.length>0?e[0].focus():this.triggerMethod("setFocus")},"onKeyInView":function(e){var i=e.keyCode;32===i&&t(e.target).click()},"onMapSelectionChanged":function(e){var t=this;if(this.model&&this.model.attributes.isDocDraft){var i={};i.buttons=r.buttons.OkCancel;var s=r.confirmWarning(h.ChangeWorkflowTypeMessage,h.ChangeWorkflowTypeTitle,i);s.then(function(){t.mapSelected(e)})}else this.mapSelected(e)},"mapSelected":function(t){var i=parseInt(t.target.getAttribute("data-wfid"));i&&(this.propertiesCommand=new d,this.mapModel=this.options.context.getModel(n,{"attributes":{"id":i}}),this.mapModel.fetch().done(e.bind(function(){var e=this.options.model,t={};t.context=this.options.context,t.nodes=new o([this.mapModel]),t.isDoc=!0,t.doc_id=e.get("doc_id"),t.parent_id=e.get("parent_id"),t.docNames=e.get("doc_names");var i=e.defaults;e.reset({"silent":!0}),e.set(i,{"silent":!0});var s=this.propertiesCommand.execute(t);a.handleExecutionResults(s,{"command":this.propertiesCommand,"suppressSuccessMessage":t.suppressSuccessMessage})},this)).fail(e.bind(function(e){l.showMessage("error",e.responseJSON.error)},this)))}});return m}),csui.define("workflow/widgets/workitem/workitem/impl/footer.view",["csui/lib/marionette"],function(e){var t=e.ItemView.extend({"tagName":"button","className":"binf-btn","template":!1,"triggers":{"click":"click"},"constructor":function(){e.View.prototype.constructor.apply(this,arguments)},"onRender":function(){var e=this.$el,t=this.model.attributes;e.text(t.label),"standard-Review"===t.id&&e.addClass(t["default"]?"binf-btn-primary":"binf-btn-default-review"),e.addClass(t["default"]?"binf-btn-primary":"binf-btn-default"),t.toolTip&&e.attr("title",t.toolTip),t.separate&&e.addClass("cs-separate"),this.updateButton(t)},"updateButton":function(e){var t=this.$el;e||(e={}),void 0!==e.hidden&&(e.hidden?t.addClass("binf-hidden"):t.removeClass("binf-hidden")),void 0!==e.disabled&&t.prop("disabled",e.disabled)}}),i=e.CollectionView.extend({"childView":t,"constructor":function(){e.CollectionView.prototype.constructor.apply(this,arguments)},"onDomRefresh":function(){this.children.each(function(e){e.trigger("dom:refresh")})},"getButtons":function(){return this.children.toArray()},"updateButton":function(e,i){var s=this.collection.get(e);s?this.children.findByModel(s).updateButton(i):t.updateButton(this.$('[data-cs-id="'+e+'"]'),i)}});return i}),csui.define("hbs!workflow/widgets/message/impl/message",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t){var i;return'<div class="message-head">\r\n  <div class="message-subject">\r\n    <div class="subject-pre">'+this.escapeExpression((i=null!=(i=t.subjectPre||(null!=e?e.subjectPre:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"subjectPre","hash":{}}):i))+'</div>\r\n    <div class="subject-sender">'+this.escapeExpression((i=null!=(i=t.sender||(null!=e?e.sender:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"sender","hash":{}}):i))+'</div>\r\n    <div class="subject-post">'+this.escapeExpression((i=null!=(i=t.subjectPost||(null!=e?e.subjectPost:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"subjectPost","hash":{}}):i))+'</div>\r\n  </div>\r\n  <div class="message-toggle">\r\n    <div hidden id='+this.escapeExpression((i=null!=(i=t.ariaDescribedById||(null!=e?e.ariaDescribedById:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ariaDescribedById","hash":{}}):i))+">"+this.escapeExpression((i=null!=(i=t.subjectAria||(null!=e?e.subjectAria:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"subjectAria","hash":{}}):i))+'</div>\r\n    <a class="toggle-button" role="button" title="'+this.escapeExpression((i=null!=(i=t.seeLess||(null!=e?e.seeLess:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"seeLess","hash":{}}):i))+'" data-binf-toggle="collapse"\r\n       href=".message-body" aria-describedby='+this.escapeExpression((i=null!=(i=t.ariaDescribedById||(null!=e?e.ariaDescribedById:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ariaDescribedById","hash":{}}):i))+'\r\n           aria-label="'+this.escapeExpression((i=null!=(i=t.seeLessMessages||(null!=e?e.seeLessMessages:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"seeLessMessages","hash":{}}):i))+'">\r\n      <span class="csui-button-icon icon-expandArrowUp"></span>\r\n    </a>\r\n  </div>\r\n</div>\r\n<div class="message-body binf-collapse binf-in">\r\n  <div class="message-text">'+this.escapeExpression((i=null!=(i=t.messageText||(null!=e?e.messageText:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"messageText","hash":{}}):i))+"</div>\r\n</div>"}});return i.registerPartial("workflow_widgets_message_impl_message",s),s}),csui.define("workflow/widgets/message/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/message/impl/nls/root/lang",{"delegateMessage":"Message from {0} who forwarded the workflow step to a new approver.","delegateMessageNoComment":"{0} forwarded the workflow step to a new approver without a message.","reassignMessage":"Message from {0} who reassigned the workflow step.","reassignMessageNoComment":"{0} reassigned the workflow step without a message.","reviewMessage":"Message from {0} who sent you a workflow step for review. Please add a comment and reply.","reviewMessageNoComment":"{0} sent you a workflow step for review. Please add a comment and reply.","reviewReturnMessage":"Message from {0} who reviewed your workflow step.","reviewReturnMessageNoComment":"{0} reviewed your workflow step without a message.","seeLess":"See less","seeMore":"See more","seeLessMessages":"See less messages","seeMoreMessages":"See more messages","anonymousUserName":"Anonymous User"}),csui.define("css!workflow/widgets/message/impl/message",[],function(){}),csui.define("workflow/widgets/message/message.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/models/member","hbs!workflow/widgets/message/impl/message","i18n!workflow/widgets/message/impl/nls/lang","css!workflow/widgets/message/impl/message"],function(e,t,i,s,n,o,a){var r={"message":function(e,t){var i=e;switch(e){case"delegate":i=t?a.delegateMessage:a.delegateMessageNoComment;break;case"reassign":i=t?a.reassignMessage:a.reassignMessageNoComment;break;case"review":i=t?a.reviewMessage:a.reviewMessageNoComment;break;case"review_return":i=t?a.reviewReturnMessage:a.reviewReturnMessageNoComment}return i}},l=i.ItemView.extend({"className":"workflow-message","template":o,"templateHelpers":function(){return{"subjectPre":this.subjectPre,"subjectPost":this.subjectPost,"sender":this.sender,"subjectAria":this.subjectPre+this.sender+this.subjectPost+this.messageText,"ariaDescribedById":e.uniqueId("id_"),"messageText":this.messageText,"seeMore":a.seeMore,"seeLess":a.seeLess,"seeMoreMessages":a.seeMoreMessages,"seeLessMessages":a.seeLessMessages}},"ui":{"toggleButton":".toggle-button","toggleIcon":".toggle-button > span","messageBody":".message-body"},"events":{"click @ui.toggleButton":"onClickToggle"},"behaviors":{"TabableRegion":{"behaviorClass":s}},"constructor":function(t){if(e.isUndefined(t)||e.isUndefined(t.model))throw new Error("Message model is missing!");var s=t.model,o=t.connector;this.messageText=s.get("text");var l=s.get("subject");if(!e.isUndefined(l)){l=r.message(l,this.messageText);var c=l.split("{0}");2===c.length?(this.subjectPre=l.split("{0}")[0],this.subjectPost=l.split("{0}")[1]):(this.subjectPre=null,this.subjectPost=l)}var d=s.get("sender");if(e.isNumber(d)){var u=this,h=new n({"id":d},{"connector":o});h.fetch().done(function(e,t){"success"===t&&(u.sender=e.data.display_name,u.render())})}else this.sender=e.isString(d)?d:a.anonymousUserName;i.ItemView.prototype.constructor.call(this,t)},"onClickToggle":function(){this.ui.messageBody.hasClass("binf-in")?(this.ui.toggleIcon.removeClass("icon-expandArrowUp"),this.ui.toggleIcon.addClass("icon-expandArrowDown"),this.ui.toggleButton&&this.ui.toggleButton.hasClass("toggle-button csui-acc-focusable-active")&&(this.ui.toggleButton[0].title=a.seeMore,this.ui.toggleButton.attr("aria-label",a.seeMoreMessages))):(this.ui.toggleIcon.removeClass("icon-expandArrowDown"),this.ui.toggleIcon.addClass("icon-expandArrowUp"),this.ui.toggleButton&&this.ui.toggleButton.hasClass("toggle-button csui-acc-focusable-active")&&(this.ui.toggleButton[0].title=a.seeLess,this.ui.toggleButton.attr("aria-label",a.seeLessMessages)))},"currentlyFocusedElement":function(){return t(this.ui.toggleButton)}});return l}),csui.define("hbs!workflow/widgets/workitem/workitem.properties/impl/workitem.instructions",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e,t){var i,s;return'  <div class=" workitem-instructions-scrolling">\r\n    <div class="workitem-extended-view-mode workitem-see-less-content\r\n      workitem-see-less-instruction">\r\n      <div id="'+this.escapeExpression((s=null!=(s=t.id_instructions||(null!=e?e.id_instructions:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"id_instructions","hash":{}}):s))+'"\r\n           class="workitem-instructions-text csui-acc-focusable-active ">'+(null!=(i=this.lambda(null!=(i=null!=e?e.model:e)?i.instructions:i,e))?i:"")+'</div>\r\n      <a href="javascript:void(0);" title="'+this.escapeExpression((s=null!=(s=t.seeLess||(null!=e?e.seeLess:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"seeLess","hash":{}}):s))+'" role="button" aria-label="'+this.escapeExpression((s=null!=(s=t.seeLessInstructions||(null!=e?e.seeLessInstructions:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"seeLessInstructions","hash":{}}):s))+'"\r\n         aria-describedby="'+this.escapeExpression((s=null!=(s=t.id_instructions||(null!=e?e.id_instructions:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"id_instructions","hash":{}}):s))+'" class="instruction-see-less\r\n         workitem-see-less-instruction">\r\n      <span class="csui-button-icon icon-expandArrowUp"></span></a>\r\n      <a href="javascript:void(0);" title="'+this.escapeExpression((s=null!=(s=t.seeMore||(null!=e?e.seeMore:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"seeMore","hash":{}}):s))+'" role="button"\r\n         aria-describedby="'+this.escapeExpression((s=null!=(s=t.id_instructions||(null!=e?e.id_instructions:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"id_instructions","hash":{}}):s))+'" aria-label="'+this.escapeExpression((s=null!=(s=t.seeMoreInstructions||(null!=e?e.seeMoreInstructions:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"seeMoreInstructions","hash":{}}):s))+'"\r\n         class="instruction-see-more workitem-see-more-instruction workitem-hide-element">\r\n      <span class="csui-button-icon icon-expandArrowDown"></span></a>\r\n    </div>\r\n  </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n;return null!=(n=t["if"].call(e,null!=(n=null!=e?e.model:e)?n.instructions:n,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:""}});return i.registerPartial("workflow_widgets_workitem_workitem.properties_impl_workitem.instructions",s),s}),csui.define("workflow/widgets/workitem/workitem.properties/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/workitem/workitem.properties/impl/nls/root/lang",{"FormValidationErrorMessage":"Required fields must be filled","HideValidationErrorMessageIconTooltip":"Hide validation error","SeeMore":"See more","SeeLess":"See less","SeeMoreInstructions":"See more instructions","SeeLessInstructions":"See less instructions","multiMapSelectMessage":"Select the workflow you want to initiate from the drop-down list"}),csui.define("css!workflow/widgets/workitem/workitem.properties/impl/workitem.instructions",[],function(){}),csui.define("workflow/widgets/workitem/workitem.properties/impl/workitem.instructions.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/log","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/behaviors/keyboard.navigation/tabable.region.behavior","hbs!workflow/widgets/workitem/workitem.properties/impl/workitem.instructions","i18n!workflow/widgets/workitem/workitem.properties/impl/nls/lang","css!workflow/widgets/workitem/workitem.properties/impl/workitem.instructions"],function(e,t,i,s,n,o,a,r){var l=i.LayoutView.extend({"className":"workflow-workitem-properties-instructions","ui":{"instructions":".workitem-instructions-text","InstructionElement":".workitem-extended-view-mode","seeLessIcon":"a.workitem-see-less-instruction","seeMoreIcon":"a.workitem-see-more-instruction"},"events":{"keydown":"onKeyDown","click @ui.seeMoreIcon":"showMoreContent","click @ui.seeLessIcon":"showLessContent","keydown @ui.seeMoreIcon":"onKeyDownShowMoreContent","keydown @ui.seeLessIcon":"onKeyDownShowLessContent"},"template":a,"constructor":function(e){i.LayoutView.prototype.constructor.call(this,e),this.propagateEventsToRegions()},"behaviors":{"TabableRegion":{"behaviorClass":o}},"currentlyFocusedElement":function(){var e=this.model.get("instructions");return e?t(".workitem-instructions a"):void t(".cs-form.cs-form-update:first").addClass("workitem-with-empty-instructions")},"contentTypeElement":".workitem-extended-view-mode","showMoreContent":function(){if(""===window.getSelection().toString()){var e=t(this.$el.find(".instruction-see-less")[0]),i=t(this.$el.find(".instruction-see-more")[0]),s=this.ui.InstructionElement[0];t(e).removeAttr("style"),t(e).show(),t(i).hide(),this.ui.seeLessIcon.focus(),t(s).removeClass("workitem-see-more-content"),t(s).removeClass("workitem-see-more-instruction"),t(s).addClass("workitem-see-less-instruction")}},"showLessContent":function(){if(""===window.getSelection().toString()){var e=t(this.$el.find(".instruction-see-less")[0]),i=t(this.$el.find(".instruction-see-more")[0]),s=this.ui.InstructionElement[0];t(e).hide(),t(i).removeAttr("style"),t(i).show(),this.ui.seeMoreIcon.focus(),t(s).addClass("workitem-see-more-content"),t(s).addClass("workitem-see-more-instruction"),t(s).removeClass("workitem-see-less-instruction")}},"onKeyDownShowMoreContent":function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.showMoreContent(e))},"onKeyDownShowLessContent":function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.showLessContent(e))},"onKeyDown":function(e){var t=!1,i=0;switch(e.keyCode){case 38:i=-30,t=!0;break;case 40:i=30,t=!0}if(t){e.preventDefault(),e.stopPropagation();var s=this.$el.find(".workitem-instructions-scrolling");s.scrollTop(s.scrollTop()+i)}},"templateHelpers":function(){return{"seeMore":r.SeeMore,"seeLess":r.SeeLess,"seeMoreInstructions":r.SeeMoreInstructions,"seeLessInstructions":r.SeeLessInstructions,"model":this.model.toJSON(),"id_instructions":e.uniqueId("id_")}}});return e.extend(l.prototype,n),l}),csui.define("hbs!workflow/widgets/workitem/workitem.properties/impl/workitem.properties",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workitem-multimap-select-message"></div>\r\n<div class="workitem-message"></div>\r\n<div class="workitem-instructions"></div>\r\n<div class="workitem-forms"></div>\r\n<div class="workitem-extension"></div>\r\n\r\n'}});return i.registerPartial("workflow_widgets_workitem_workitem.properties_impl_workitem.properties",s),s}),csui.define("css!workflow/widgets/workitem/workitem.properties/impl/workitem.properties",[],function(){}),csui.define("workflow/controls/form/fields/alpaca/alpcsuirealfield",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/lib/alpaca/js/alpaca","csui/models/form","csui/controls/form/fields/textfield.view","csui/utils/base"],function(e,t,i,s,n,o,a,r){return o.Fields.CsuiRealField=o.Fields.NumberField.extend({"constructor":function(e,t,i,s,n,o,a){this.base(e,t,i,s,n,o,a)},"getFieldType":function(){return"text"},"postRender":function(e){this.base(e),this.showField()},"showField":function(){var e=this.id;this.options.id="lbl"+t.uniqueId(e);var o,a=i(this.field[0]).find("label");a&&1===a.length&&(o=a.attr("for")+"Label",a.attr("id",o)),this.fieldView=new r({"model":new s.Model({"data":this.data,"options":this.options,"schema":this.schema,"id":e}),"id":t.uniqueId(e),"alpacaField":this,"labelId":o,"value":this.data,"readonly":!0,"dataId":this.name,"path":this.path,"alpaca":{"data":this.data,"options":this.options,"schema":this.schema}});var l=i("<div>").addClass("alpaca-control");this.getControlEl().replaceWith(l),this.region=new n.Region({"el":l}),this.region.show(this.fieldView)},"getValue":function(){var e=i(this.control).val();return null===e||""===e?null:Number(e)},"setValueAndValidate":function(e,t){this.setValue(e);var i=!0;return t&&(i=this.validate(),this.refreshValidationState(!1)),i},"focus":function(){this.fieldView.setFocus()},"handleValidate":function(){var e=this.base();if(!e){var t=this.validation;if(""!==this.fieldView.ui.writeField.val())return t.notOptional.status=!0,t.notOptional.message="",e;for(var i in t)t[i].status===!1&&"notOptional"!==i&&(t[i].status=!0,t[i].message="")}return e},"destroy":function(){this.base(),this.region&&this.region.destroy()}}),o.registerFieldClass("number",o.Fields.CsuiRealField,"bootstrap-csui"),o.registerFieldClass("number",o.Fields.CsuiRealField,"bootstrap-edit-horizontal"),i.alpaca.Fields.CsuiRealField}),csui.define("workflow/controls/breadcrumbs/impl/breadcrumb/breadcrumb.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/controls/breadcrumbs/impl/breadcrumb/breadcrumb.view","csui/behaviors/default.action/default.action.behavior","i18n!csui/controls/breadcrumbs/impl/breadcrumb/impl/nls/lang"],function(e,t,i,s,n,o){var a=s.extend({"templateHelpers":function(){var t=this,i=e.map(this.model.get("subcrumbs"),function(i){return e.extend(i.toJSON(),{"url":t.getAncestorUrl(i)})});return{"inactive":this.model.get("inactive"),"hasSubCrumbs":i.length>0,"subcrumbs":i,"url":this.getAncestorUrl(this.model),"subcrumbTooltip":o.subcrumbTooltip}},"getAncestorUrl":function(e){return e.get("id")>0&&e.connector&&n.getDefaultActionNodeUrl(e)}});return a}),csui.define("workflow/controls/breadcrumbs/breadcrumbs.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/commands","csui/utils/defaultactionitems","csui/controls/breadcrumbs/breadcrumbs.view","csui/models/node/node.model","csui/behaviors/default.action/default.action.behavior","workflow/controls/breadcrumbs/impl/breadcrumb/breadcrumb.view"],function(e,t,i,s,n,o,a,r,l){var c=o.extend({"childView":l,"behaviors":{"DefaultAction":{"behaviorClass":r}},"onClickAncestor":function(e,t){var i=this,o={"node":t},r=new a({"id":t.get("id")},{"connector":t.connector,"autoreset":!0,"commands":n.getAllCommandSignatures(s)});r.fetch().done(function(){i.defaultActionController.hasAction(r)?i.triggerMethod("execute:defaultAction",r):(i.trigger("before:defaultAction",o),o.cancel||i._nextNode.set("id",t.get("id")),i.$el.trigger("setCurrentTabFocus"))})}});return c}),csui.define("hbs!workflow/controls/form/impl/fields/itempicker/itempicker",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e){var t;return'placeholder="'+this.escapeExpression(this.lambda(null!=(t=null!=e?e.options:e)?t.placeholder:t,e))+'"'},"3":function(e,t){var i;return'aria-labelledby="'+this.escapeExpression((i=null!=(i=t.idBtnLabel||(null!=e?e.idBtnLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"idBtnLabel","hash":{}}):i))+'" '
},"5":function(e,t){var i;return' aria-label="'+this.escapeExpression((i=null!=(i=t.multiFieldLabel||(null!=e?e.multiFieldLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"multiFieldLabel","hash":{}}):i))+'"'},"7":function(e,t){var i;return'        <button class="btn-container inline-clear-itempicker-button" title="'+this.escapeExpression((i=null!=(i=t.remove||(null!=e?e.remove:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"remove","hash":{}}):i))+'" tabindex="0"\r\n                data-cstabindex="0" aria-label="'+this.escapeExpression((i=null!=(i=t.remove||(null!=e?e.remove:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"remove","hash":{}}):i))+'">\r\n          <span class="inline-clear-itempicker formfield_clear" ></span>\r\n        </button>\r\n'},"9":function(e,t){var i;return'      <div class="icon-container">\r\n        <div class="csui-icon-edit inline-edit-icon edit-cancel" title="'+this.escapeExpression((i=null!=(i=t.cancel||(null!=e?e.cancel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"cancel","hash":{}}):i))+'"></div>\r\n      </div>\r\n'},"11":function(e,t){var i;return'      <button class="btn-container inline-edit-more-button" title="'+this.escapeExpression((i=null!=(i=t.toggleTitle||(null!=e?e.toggleTitle:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"toggleTitle","hash":{}}):i))+'"\r\n        aria-label="'+this.escapeExpression((i=null!=(i=t.toggleTitle||(null!=e?e.toggleTitle:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"toggleTitle","hash":{}}):i))+'" aria-expanded="false">\r\n        <span class="inline-edit-more-icon icon-toolbar-more"></span>\r\n      </button>\r\n'},"13":function(e,t,i,s){var n;return"      <a "+(null!=(n=t["if"].call(e,null!=(n=null!=e?e.schema:e)?n.readonly:n,{"name":"if","hash":{},"fn":this.program(14,s,0),"inverse":this.noop}))?n:"")+' href="'+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.url:n,e))+'"\r\n         class="item-reference-link '+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.disabledClass:n,e))+'"\r\n         title="'+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.anchorTitle:n,e))+'"\r\n        '+(null!=(n=t["if"].call(e,null!=e?e.multiFieldLabel:e,{"name":"if","hash":{},"fn":this.program(16,s,0),"inverse":this.program(18,s,0)}))?n:"")+">"+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.itemName:n,e))+"\r\n      </a>\r\n"},"14":function(){return' aria-disabled="true" '},"16":function(e,t){var i,s;return' aria-label="'+this.escapeExpression((s=null!=(s=t.readModeMultiFieldAria||(null!=e?e.readModeMultiFieldAria:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"readModeMultiFieldAria","hash":{}}):s))+" "+this.escapeExpression(this.lambda(null!=(i=null!=e?e.options:e)?i.anchorTitleShort:i,e))+'"\r\n        '},"18":function(e,t){var i,s;return' aria-label="'+this.escapeExpression((s=null!=(s=t.readModeAria||(null!=e?e.readModeAria:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"readModeAria","hash":{}}):s))+" "+this.escapeExpression(this.lambda(null!=(i=null!=e?e.options:e)?i.anchorTitleShort:i,e))+'" '},"20":function(e,t,i,s){var n;return null!=(n=t["if"].call(e,null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.errorCase:n,{"name":"if","hash":{},"fn":this.program(21,s,0),"inverse":this.program(28,s,0)}))?n:""},"21":function(e,t,i,s){var n;return"        <button "+(null!=(n=t["if"].call(e,null!=(n=null!=e?e.schema:e)?n.readonly:n,{"name":"if","hash":{},"fn":this.program(14,s,0),"inverse":this.noop}))?n:"")+' class="itempicker item-reference-link"\r\n          '+(null!=(n=t["if"].call(e,null!=e?e.multiFieldLabel:e,{"name":"if","hash":{},"fn":this.program(22,s,0),"inverse":this.program(24,s,0)}))?n:"")+"\r\n          "+(null!=(n=t["if"].call(e,null!=(n=null!=e?e.options:e)?n.buttonDisabled:n,{"name":"if","hash":{},"fn":this.program(26,s,0),"inverse":this.noop}))?n:"")+'>\r\n          <span class="placeholder error-placeholder" title="'+this.escapeExpression(this.lambda(null!=(n=null!=e?e.options:e)?n.placeholder:n,e))+'">\r\n              '+this.escapeExpression(this.lambda(null!=(n=null!=e?e.options:e)?n.placeholder:n,e))+"\r\n          </span>\r\n        </button>\r\n"},"22":function(e,t){var i;return' aria-label="'+this.escapeExpression((i=null!=(i=t.readModeMultiFieldAria||(null!=e?e.readModeMultiFieldAria:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"readModeMultiFieldAria","hash":{}}):i))+'"\r\n          '},"24":function(e,t){var i;return' aria-label="'+this.escapeExpression((i=null!=(i=t.readModeAria||(null!=e?e.readModeAria:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"readModeAria","hash":{}}):i))+'" '},"26":function(){return"disabled"},"28":function(e,t,i,s){var n;return"        <button "+(null!=(n=t["if"].call(e,null!=(n=null!=e?e.schema:e)?n.readonly:n,{"name":"if","hash":{},"fn":this.program(14,s,0),"inverse":this.noop}))?n:"")+' class="itempicker item-reference-link"\r\n          '+(null!=(n=t["if"].call(e,null!=e?e.multiFieldLabel:e,{"name":"if","hash":{},"fn":this.program(22,s,0),"inverse":this.program(24,s,0)}))?n:"")+"\r\n          "+(null!=(n=t["if"].call(e,null!=(n=null!=e?e.options:e)?n.buttonDisabled:n,{"name":"if","hash":{},"fn":this.program(26,s,0),"inverse":this.noop}))?n:"")+'>\r\n          <span class="placeholder" title="'+this.escapeExpression(this.lambda(null!=(n=null!=e?e.options:e)?n.placeholder:n,e))+'">\r\n            '+this.escapeExpression(this.lambda(null!=(n=null!=e?e.options:e)?n.placeholder:n,e))+"\r\n          </span>\r\n        </button>\r\n"},"30":function(e){var t;return" "+this.escapeExpression(this.lambda(null!=(t=null!=(t=null!=e?e.options:e)?t.item:t)?t.errorMsg:t,e))+" "},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n,o;return'<div class="cs-field-write">\r\n  <div class="cs-field-write-inner">\r\n    <div hidden id="'+this.escapeExpression((o=null!=(o=t.ariaDescribedById||(null!=e?e.ariaDescribedById:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"ariaDescribedById","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.fieldWriteDescribedByAria||(null!=e?e.fieldWriteDescribedByAria:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"fieldWriteDescribedByAria","hash":{}}):o))+'</div>\r\n    <input type="'+this.escapeExpression((o=null!=(o=t.inputType||(null!=e?e.inputType:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"inputType","hash":{}}):o))+'" id="'+this.escapeExpression((o=null!=(o=t.id||(null!=e?e.id:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"id","hash":{}}):o))+'" role="button" aria-describedby="'+this.escapeExpression((o=null!=(o=t.ariaDescribedById||(null!=e?e.ariaDescribedById:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"ariaDescribedById","hash":{}}):o))+'"\r\n        '+(null!=(n=t["if"].call(e,null!=(n=null!=e?e.options:e)?n.placeholder:n,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:"")+"\r\n        "+(null!=(n=t["if"].call(e,null!=e?e.idBtnLabel:e,{"name":"if","hash":{},"fn":this.program(3,s,0),"inverse":this.noop}))?n:"")+"\r\n        "+(null!=(n=t["if"].call(e,null!=e?e.multiFieldLabel:e,{"name":"if","hash":{},"fn":this.program(5,s,0),"inverse":this.noop}))?n:"")+'\r\n        value="'+(null!=(n=this.lambda(null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.itemName:n,e))?n:"")+'" title="'+(null!=(n=this.lambda(null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.anchorTitle:n,e))?n:"")+'" />\r\n'+(null!=(n=t["if"].call(e,null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.itemName:n,{"name":"if","hash":{},"fn":this.program(7,s,0),"inverse":this.noop}))?n:"")+'      <button class="binf-btn binf-btn-primary invoke-picker" tabindex="0" data-cstabindex="0"\r\n              title="'+this.escapeExpression((o=null!=(o=t.browse||(null!=e?e.browse:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"browse","hash":{}}):o))+'">\r\n        '+this.escapeExpression((o=null!=(o=t.browse||(null!=e?e.browse:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"browse","hash":{}}):o))+"\r\n      </button>\r\n"+(null!=(n=(t.xif||e&&e.xif||t.helperMissing).call(e,"this.mode !== 'writeonly'",{"name":"xif","hash":{},"fn":this.program(9,s,0),"inverse":this.noop}))?n:"")+'\r\n  </div>\r\n</div>\r\n\r\n<div class="cs-field-read">\r\n  <div class="cs-field-read-inner">\r\n'+(null!=(n=t["if"].call(e,null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.anchorTitle:n,{"name":"if","hash":{},"fn":this.program(11,s,0),"inverse":this.noop}))?n:"")+'    <div class="btn-container">\r\n'+(null!=(n=t["if"].call(e,null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.anchorTitle:n,{"name":"if","hash":{},"fn":this.program(13,s,0),"inverse":this.noop}))?n:"")+(null!=(n=t.unless.call(e,null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.anchorTitle:n,{"name":"unless","hash":{},"fn":this.program(20,s,0),"inverse":this.noop}))?n:"")+'    </div>\r\n    <div class="icon-container">\r\n      <div class="csui-icon-edit inline-edit-icon icon-edit" title="'+this.escapeExpression((o=null!=(o=t.edit||(null!=e?e.edit:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"edit","hash":{}}):o))+'"></div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<div class="breadcrumb-inner id-'+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.nodeId:n,e))+' binf-hidden"></div>\r\n<div class="item-reference-error-msg"> '+(null!=(n=t["if"].call(e,null!=(n=null!=(n=null!=e?e.options:e)?n.item:n)?n.errorCase:n,{"name":"if","hash":{},"fn":this.program(30,s,0),"inverse":this.noop}))?n:"")+" </div>\r\n"}});return i.registerPartial("workflow_controls_form_impl_fields_itempicker_itempicker",s),s}),csui.define("workflow/controls/form/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/controls/form/impl/nls/root/lang",{"alpacaPlaceholderItemReferencePicker":"Add a Content Server item","browse":"Browse","nodePickerDialogTitle":"Select {0}","originalNodeUnavailable":"Referenced item can not be accessed anymore","originalNodeUnavailableTooltip":"The original node is unavailable or you do not have permission to access it.","remove":"Remove","cancel":"Cancel","edit":"Edit","toggleTitle":"{0}:Toggle breadcrumb","fieldEditAria":"{0}:{1}, Press Enter or F2 to Edit","fieldWriteDescribedByAria":"Press Space to Open Select Dialog"}),csui.define("css!workflow/controls/form/impl/fields/itempicker/itempicker",[],function(){}),csui.define("workflow/controls/form/fields/itempickerfield.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/models/node/node.model","csui/utils/contexts/factories/node","csui/controls/form/fields/nodepickerfield.view","csui/behaviors/default.action/default.action.behavior","csui/dialogs/node.picker/node.picker","i18n!csui/controls/form/impl/nls/lang","workflow/controls/breadcrumbs/breadcrumbs.view","hbs!workflow/controls/form/impl/fields/itempicker/itempicker","i18n!workflow/controls/form/impl/nls/lang","css!workflow/controls/form/impl/fields/itempicker/itempicker"],function(e,t,i,s,n,o,a,r,l,c,d,u,h){var m=a.extend({"template":u,"templateHelpers":function(){var t="",i=c.noValue,s="",n="",o=!1,a="readonly"===this.mode,r="",l="",d=!1;if(o=this.options.alpacaField&&this.options.alpacaField.isRequired(),r=o?c.requiredField:"",this.ancestors.pluck("name").length>0){var u=this.ancestors.pluck("name");i=u[u.length-1]}return this.node.get("nodeError")&&(i=h.originalNodeUnavailable),this.alpacaField&&this.alpacaField.options&&this.alpacaField.options.isMultiFieldItem&&(t=this.alpacaField.parent&&this.alpacaField.parent.options?this.alpacaField.parent.options.label:"",d=this.alpacaField.options.isMultiFieldItem),d?(n=a?c.fieldReadOnlyAria.replace("{0}",t).replace("{1}",i)+r:h.fieldEditAria.replace("{0}",t).replace("{1}",i)+r,l=h.toggleTitle.replace("{0}",t)):this.model.get("options")&&this.model.get("options").label&&(s=a?c.fieldReadOnlyAria.replace("{0}",this.model.get("options").label).replace("{1}",i)+r:h.fieldEditAria.replace("{0}",this.model.get("options").label).replace("{1}",i)+r,l=h.toggleTitle.replace("{0}",this.model.get("options").label)),{"inputType":"text","idBtnLabel":this.options.labelId,"ariaDescribedById":e.uniqueId("id_"),"fieldWriteDescribedByAria":h.fieldWriteDescribedByAria,"readModeAria":s,"readModeMultiFieldAria":n,"multiFieldLabel":t,"browse":h.browse,"remove":h.remove,"cancel":h.cancel,"toggleTitle":l,"edit":h.edit}},"ui":{"readArea":".cs-field-read","readField":".cs-field-read .item-reference-link","writeArea":".cs-field-write","writeField":".cs-field-write input","anchor":".cs-field-read a","more":".inline-edit-more-button","buttonMore":".inline-edit-more-button","breadCrumbs":".breadcrumb-inner","clear":".inline-clear-itempicker-button","errMsg":".item-reference-error-msg","writeBrowseButton":".cs-field-write .invoke-picker","cancelIcon":".edit-cancel","browseButton":".invoke-picker","placeHolder":"span.placeholder","placeHolderButton":"button.itempicker"},"events":{"focusin @ui.anchor":"onFocusInAnchor","focusin @ui.writeField":"onFocusInWriteField","mousedown @ui.writeField":"onClickWriteField","keydown @ui.writeField":"onKeydownWriteField","keydown @ui.writeArea":"onKeydownWriteArea","click @ui.browseButton":"onClickBrowse","keydown @ui.browseButton":"onKeydownBrowse","click @ui.anchor":"onClickButton","keydown @ui.anchor":"onKeydownButton","click @ui.more":"onClickMore","keydown @ui.buttonMore":"onKeydownMore","click @ui.clear":"clearFieldvalue","keydown @ui.clear":"clearFieldvalueKeydown","mousedown @ui.writeBrowseButton, @ui.clear ":"onMouseDownWriteElements","click @ui.cancelIcon":"onCancelClicked","click @ui.placeHolder":"onClickPlaceHolder","keypress @ui.placeHolderButton":"onKeypressPlaceHolder","keydown @ui.placeHolderButton":"onKeydownPlaceHolder"},"onFocusInWriteField":function(){this.changedKey=!1},"onClickPlaceHolder":function(e){e.preventDefault(),e.stopPropagation()},"onKeydownPlaceHolder":function(e){32!==e.keyCode||this.alpacaField.options.isMultiFieldItem||(e.preventDefault(),e.stopPropagation())},"onKeypressPlaceHolder":function(e){13!==e.keyCode&&32!==e.keyCode||this.alpacaField.options.isMultiFieldItem||(e.preventDefault(),e.stopPropagation(),13===e.keyCode&&this.getStatesBehavior().isStateRead()&&(e.preventDefault(),e.stopPropagation(),this.getEditableBehavior().setViewStateWriteAndEnterEditMode()))},"onKeyPress":function(){},"allowEditOnEnter":function(){return!0},"onMouseDownWriteElements":function(){this._isReadyToSave=!1},"onKeydownButton":function(e){var t=this.options.formView;32===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.onClickButton(e)),13!==e.keyCode||this.alpacaField.options.isMultiFieldItem||this.getStatesBehavior().isStateRead()&&(e.preventDefault(),e.stopPropagation(),this.getEditableBehavior().setViewStateWriteAndEnterEditMode()),13===e.keyCode&&this.alpacaField.options.isMultiFieldItem&&"create"===t.mode&&this.getStatesBehavior().isStateRead()&&(e.preventDefault(),e.stopPropagation())},"onKeydownWriteField":function(e){13===e.keyCode||113===e.keyCode?this.changedKey=!0:27===e.keyCode?this.onCancelClicked(e):32===e.keyCode?(e.preventDefault(),e.stopPropagation(),this.onClickWriteField(e)):9!==e.keyCode&&(e.preventDefault(),e.stopPropagation())},"onKeydownWriteArea":function(e){113===e.keyCode&&(this.changedKey=!0),27===e.keyCode&&this.onCancelClicked(e)},"onKeydownBrowse":function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.onClickBrowse(e))},"onClickBrowse":function(e){this._isReadyToSave=!0,e.preventDefault(),this.$el.find("#"+this.model.get("id")).focus(),this._showNodePicker()},"clearFieldvalueKeydown":function(e){13===e.keyCode&&this.clearFieldvalue(e)},"clearFieldvalue":function(e){this._isReadyToSave=!0,this.ui.writeField.val(""),this.clearField=!0,this.editVal="",e.preventDefault(),e.stopPropagation(),this.ui.writeField.focus()},"onClickButton":function(e){e.preventDefault();var t=this.options.formView;"create"!==t.mode&&this.node.get("id")&&this.triggerMethod("execute:defaultAction",this.node),"create"===t.mode&&this.node.get("id")&&this.getStatesBehavior().isStateRead()&&this.triggerMethod("execute:defaultAction",this.node)},"setStateRead":function(e){return this.fieldsave?(this.fieldsave=void 0,this.$el.parents(".binf-form-group.alpaca-field")&&this.$el.parents(".binf-form-group.alpaca-field").find(".alpaca-message")&&this.$el.parents(".binf-form-group.alpaca-field").find(".alpaca-message").val(""),this.$el.hasClass("cs-formfield-invalid")&&this.$el.removeClass("cs-formfield-invalid"),this.newNode&&(this.node.set(this.newNode.attributes),this.newNode=void 0,this.clearField=void 0),this.clearField&&(this.clearField=void 0,this.setValue(null,!0)&&(this.node.clear(),this.ancestors._reset(),this._renderNode()))):(this.ui.errMsg.hasClass("binf-hidden")&&this.ui.errMsg.removeClass("binf-hidden"),this.ui.writeArea.addClass("binf-hidden"),this.ui.readArea.removeClass("binf-hidden"),this.setValue(this.curVal,e)),!1},"setStateWrite":function(e){return this.ui.breadCrumbs.hasClass("binf-hidden")||(this.ui.breadCrumbs.addClass("binf-hidden"),this.ui.more.attr("aria-expanded","false")),this.ui.errMsg.hasClass("binf-hidden")||this.ui.errMsg.addClass("binf-hidden"),this.getStatesBehavior().isWriteOnly()||this.getStatesBehavior().isStateWrite()?(this.ui.readArea.addClass("binf-hidden"),this.ui.writeArea.removeClass("binf-hidden")):this._showNodePicker(),this.setValue(this.curVal,e),this.ui.browseButton.focus(),!0},"onKeydownMore":function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.showHideBreadcrumbs())},"showHideBreadcrumbs":function(){this.breadcrumbs=new d({"context":this.options.context,"collection":this.ancestors,"node":this.ancestors.node}),this.listenTo(this.breadcrumbs.completeCollection,"sync",this.breadcrumbsChanged),this.listenTo(this.breadcrumbs,"after:synchronized",this.onAfterBreadcrumbsSynchronized);var e=this.ancestors;e.unbind("sync"),this.breadcrumbs.updateCompleteCollection(e);var t=new s.Region({"el":".breadcrumb-inner.id-"+this.id});t.show(this.breadcrumbs),this.ui.breadCrumbs.hasClass("binf-hidden")?(this.ui.breadCrumbs.removeClass("binf-hidden"),this.ui.more.attr("aria-expanded","true")):(this.ui.breadCrumbs.addClass("binf-hidden"),this.ui.more.attr("aria-expanded","false"))},"onClickMore":function(e){e.preventDefault(),this.showHideBreadcrumbs()},"onAfterBreadcrumbsSynchronized":function(){this.breadcrumbs._shrinkToFit(.8*this.$el.find(".breadcrumb-inner").outerWidth())},"breadcrumbsChanged":function(){this.triggerMethod("change:breadcrumbs",{"isBreadcrumbsEmpty":0===this.breadcrumbs.completeCollection.size()})},"_onWindowResize":function(){this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(e.bind(function(){this._isReadyToSave=!1;var e={};e.url=r.getDefaultActionNodeUrl(this.node),e.enabled=this.defaultActionController.hasAction(this.node),e.anchorTitle=this.ancestors.pluck("name").join(" > "),e.anchorShortTitle=this._prepareFieldText();var t=this.ancestors.pluck("name");e.anchorName=t[t.length-1],this._renderField(e),this.getStatesBehavior().setStateRead(!1,!0),this._isReadyToSave=!0},this),200)},"_renderNode":function(){var e={};e.url=r.getDefaultActionNodeUrl(this.node),e.enabled=this.defaultActionController.hasAction(this.node),e.anchorTitle=this.ancestors.pluck("name").join(" > "),e.anchorShortTitle=this._prepareFieldText();var t=this.ancestors.pluck("name");e.anchorName=t[t.length-1],this.node.unset("nodeError"),this._renderField(e),this.$el.width()>0&&t.length>0&&"readonly"!==this.mode&&this.changedKey&&this.ui.readField.focus()},"_renderField":function(t){var i,s;this.node.get("nodeError")?(i=!0,s=h.originalNodeUnavailable,t.url="#",t.enabled=!1,t.anchorName="",t.anchorShortTitle="",t.anchorTitle=""):i=!1,this.model.attributes.options.item={},e.extend(this.model.attributes.options.item,{"url":t.url,"buttonDisabled":!t.enabled,"disabledClass":t.enabled?"":"binf-disabled","anchorTitle":t.anchorTitle,"itemName":t.anchorName,"anchorTitleShort":t.anchorShortTitle,"nodeId":t.id?t.id:this.id,"errorCase":i,"errorMsg":s}),this.render()},"_getNodePicker":function(){var i,s,n=this.model.get("options")||{},o=this.model.get("schema")||{},a=n.label||o.title,r=t("#attachmentFolderId").val();if(r)var c=parseInt(r);if(this.model.get("multiFiedsItem")){var d=this.model.get("typeControl");d?(i=d.parameters.select_types,s=c||d.parameters.parent||this.node.parent&&this.node.parent.attributes||void 0):(i=n.select_types,s=c||void 0)}else i=n.type_control.parameters.select_types,s=c||n.type_control.parameters.parent||this.node.parent&&this.node.parent.attributes||void 0;return this.nodePicker=new l({"connector":this.connector,"dialogTitle":e.str.sformat(h.nodePickerDialogTitle,a),"selectableTypes":i,"globalSearch":!0,"context":this.options.context,"initialContainer":{"id":s&&s.id||s},"initialSelection":[this.node]}),this.nodePicker},"_showNodePicker":function(){if(this._isReadyToSave){this._isReadyToSave=!1;var t=this._getNodePicker();t.show().done(e.bind(function(e){var t=e.nodes[0],i=t.get("id");this.getStatesBehavior().isWriteOnly()||this.getStatesBehavior().isStateWrite()?this.editVal=i:this.getStatesBehavior().setStateRead(!1,!0),this.model.get("multiFiedsItem")?this.$el.find("#"+this.model.get("id")).val(t.get("name")):this.ui.writeField.val(t.get("name")),this.newNode=t;var s=this.options.context.getModel(o,{"attributes":{"id":i},"temporary":!0});s.set(t.attributes)},this)).fail(e.bind(function(){},this)).always(e.bind(function(){this.ui.writeField.focus(),this._isReadyToSave=!0},this))}},"trySetValue":function(){var e=this.getEditValue(),t=this.getValue(),i=!0,s=this.isReadyToSave(),n=null===t&&""===e;return!s||e===t&&n||(i=this.setValue(e,!0),this.fieldsave=!0),i},"onCancelClicked":function(){this.clearField&&(this.editVal=this.oldVal),this.clearField=void 0,this.newNode=void 0,this.ui.writeField.val(this.node.get("name"))},"_renderError":function(){this.node.set("nodeError",!0);var e={};this._renderField(e)}});return m}),csui.define("workflow/controls/form/fields/alpaca/alpcsuiitemreferencefield",["module","require","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/lib/alpaca/js/alpaca","csui/models/node/node.model","workflow/controls/form/fields/itempickerfield.view","i18n!workflow/controls/form/impl/nls/lang"],function(e,t,i,s,n,o,a,r,l,c){return a.Fields.CsuiItemReferenceField=a.Fields.IntegerField.extend({"constructor":function(e,t,i,s,n,o,a){this.base(e,t,i,s,n,o,a),this.on("showNodePickerDialog",this.actionTriggerShowNodePickerDialog)},"getFieldType":function(){return"item_reference_picker"},"postRender":function(e){this.base(e),this.showField()},"showField":function(){var e,t=this.id;this.options.id="lbl"+i.uniqueId(t);var a,r=s(this.field[0]).find("label");if(r&&1===r.length&&(a=r.attr("for")+"Label",r.attr("id",a)),this.options.isMultiFieldItem){var d=this.name,u=parseInt(d.substr(d.length-1));e=this.options.type_control[Object.keys(this.options.type_control)[u]],delete this.options.item}this.options.placeholder=c.alpacaPlaceholderItemReferencePicker,this.options.customField=!0,this.fieldView=new l({"context":this.connector.config.context,"formView":this.connector.config.formView,"model":new n.Model({"data":this.data?this.data:null,"options":this.options,"schema":this.schema,"typeControl":e,"multiFiedsItem":this.options.isMultiFieldItem,"id":t}),"id":i.uniqueId(t),"alpacaField":this,"labelId":a,"value":this.data,"readonly":!0,"dataId":this.name,"path":this.path,"alpaca":{"data":this.data,"options":this.options,"schema":this.schema}});var h=s("<div>").addClass("alpaca-control");this.getControlEl().replaceWith(h),this.region=new o.Region({"el":h}),this.region.show(this.fieldView)},"setValueAndValidate":function(e,t){this.setValue(e);var i=!0;return t&&(i=this.validate(),this.refreshValidationState(!1)),i},"focus":function(){this.fieldView.$el.focus()},"destroy":function(){this.base(),this.region&&this.region.destroy()}}),a.registerFieldClass("item_reference_picker",a.Fields.CsuiItemReferenceField,"bootstrap-csui"),a.registerFieldClass("item_reference_picker",a.Fields.CsuiItemReferenceField,"bootstrap-edit-horizontal"),s.alpaca.Fields.ItemPickerField}),csui.define("workflow/widgets/workitem/workitem.properties/workitem.properties.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/lib/jquery","csui/utils/log","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/controls/form/form.view","csui/controls/globalmessage/globalmessage","workflow/widgets/message/message.view","workflow/widgets/workitem/workitem.properties/impl/workitem.instructions.view","workflow/utils/workitem.extension.controller","hbs!workflow/widgets/workitem/workitem.properties/impl/workitem.properties","i18n!workflow/widgets/workitem/workitem/impl/nls/lang","i18n!workflow/widgets/workitem/workitem.properties/impl/nls/lang","css!workflow/widgets/workitem/workitem.properties/impl/workitem.properties","workflow/controls/form/fields/alpaca/alpcsuirealfield","workflow/controls/form/fields/alpaca/alpcsuiitemreferencefield"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m,p){var f=i.CollectionView.extend({"childView":r,"tagName":"div","className":"workflow-workitem-form","childViewOptions":function(t){var i=t.get("Columns"),s=i>1?"doubelCol":"singleCol",n=e.extend({"layoutMode":s},this.options);return n},"onShow":function(){var t=this;this.options.mode&&e.each(this.children._views,function(e){"create"===t.options.mode?t.listenTo(e,"change:field",t.refreshSameDefFields):t.listenTo(e,"change:field",t._saveField)})},"_addValidationErrorElement":function(){var t=this.children._views;t[Object.keys(t)[0]].$el.before('<div class="metadata-validation-error"></div>'),this.validationErrorElem=s(this.$el.find(".metadata-validation-error")[0]),this.validationErrorElem.append('<button class="icon notification_error cs-close-error-icon" title="'+p.HideValidationErrorMessageIconTooltip+'" aria-label="'+p.HideValidationErrorMessageIconTooltip+'" ></button>'),this.validationErrorElem.append('<span class="validation-error-message">'+p.FormValidationErrorMessage+"</span>"),this.validationErrorElem.hide();var i=s(this.$el.find(".metadata-validation-error .cs-close-error-icon")[0]);i&&i.on("click",e.bind(function(e){e.preventDefault(),e.stopPropagation(),this._hideValidationError()},this))},"_validateForm":function(){var t,i=!0;return e.each(this.children._views,function(e){var s=!0;e.form&&(e.form.refreshValidationState(s),t=e.form.isValid(s),i=i&&t)}),i},"_saveForms":function(){e.each(this.children._views,function(t){var i=t.form.getValue();if(e.keys(i).length){var s={"action":"formUpdate","values":i};t._blockActions(),t.model._saveChanges(s,t).fail(e.bind(function(e){l.showMessage("error",e.message),t.trigger("forms:error")},this)).always(e.bind(function(){t._unblockActions()},this))}})},"_showValidationError":function(){void 0===this.validationErrorElem&&this._addValidationErrorElement(),this.$el.find(".alpaca-message-notOptional").length>0?this.validationErrorElem&&this.validationErrorElem.show():this.validationErrorElem&&this.validationErrorElem.hide()},"_hideValidationError":function(){this.validationErrorElem&&this.validationErrorElem.hide()},"_clearValidationError":function(){this.validationErrorElem&&(this.validationErrorElem.remove(),delete this.validationErrorElem)},"_saveField":function(t){this._showValidationError();var i=t.view.form.getValue();this.args=t,this.values=i,this.name=t.parentField?t.parentField.name:t.name;var n=t.view;if(e.keys(i).length&&n._validate(i)){var o={"action":"formUpdate","values":i};n._blockActions(),t.model._saveChanges(o,n).done(e.bind(function(){n.model.attributes.data[this.name]=this.values[this.name];var e=!1;this.checkSameDefField(this.args,e),n.trigger("forms:sync");var t=s.Event("tab:content:field:changed");n.$el.trigger(t)},this)).fail(e.bind(function(e){l.showMessage("error",e.message),n.trigger("forms:error")},this)).always(e.bind(function(){n._unblockActions()},this))}},"refreshSameDefFields":function(e){var t=e.draftProcess?e.draftProcess:!0;this.checkSameDefField(e,t)},"parseSection":function(t,i){var s=this.children._indexByModel[t.cid],n=this.children._views[s].form?this.children._views[s].form.childrenByPropertyId[i.name]:"",o=this.children._views[s];if(n)if("array"===n.type){var a=n.children.length,r=i.currentfieldValue.length,l=0;if(a!==r){if(this.stopListening(o,"change:field"),a>r)for(l=r;a>l;l++)n.removeItem(0,function(){});else if(r>a)for(l=a;r>l;l++){var c="",d=n.children[0].options,u=n.children[0].schema;n.addItem(1,u,d,c,function(){})}"create"===this.options.mode?this.listenTo(o,"change:field",this.refreshSameDefFields):this.listenTo(o,"change:field",this._saveField)}i.draftprocess||n._showItemsInReadMode(),e.each(n.children,function(e,t){e.data!==i.currentfieldValue[t]&&(e.setValueAndValidate(i.currentfieldValue[t],!0),e.refresh())})}else n.setValueAndValidate(i.currentfieldValue,!0),n.refresh()},"checkSameDefField":function(t,i){var s=t.view,n=this,o={};o.values=t.view.form.getValue(),o.name=t.parentField?t.parentField.name:t.name,o.draftprocess=i,o.currentfieldValue=o.values[o.name],e.each(s.collection.models,function(e){if(e!==s.model&&o.name in e.attributes.data&&e.attributes.data[o.name]!==o.currentfieldValue)e.attributes.data[o.name]=o.currentfieldValue,n.parseSection(e,o);else if(e===s.model&&t.changePerformer){var i=n.children._indexByModel[e.cid],a=n.children._views[i].form?n.children._views[i].form.childrenByPropertyId[o.name]:"";a&&(a.setValueAndValidate(o.currentfieldValue,!0),a.refresh())}})}}),w=i.LayoutView.extend({"className":"workflow-workitem-properties","template":h,"constructor":function(e){e||(e={}),this.context=e.context,this.parentView=e.parentView,this.extensions=e.extensions,i.LayoutView.prototype.constructor.call(this,e),this.propagateEventsToRegions()},"regions":{"message":".workitem-message","instructions":".workitem-instructions","forms":".workitem-forms","extension":".workitem-extension"},"ui":{"selectMultiMap":".workitem-multimap-select-message"},"behaviors":{"ScrollingProperties":{"behaviorClass":a,"suppressScrollX":!0,"scrollYMarginOffset":15}},"onRender":function(){if(this.model){var i=this.model.get("mapsList");this.model.get("isDoc")===!0&&i&&1!==i.length&&(this.ui.selectMultiMap.text(p.multiMapSelectMessage),this.ui.selectMultiMap.show());var s=this.model.get("message");this.model.attributes.id=this.model.get("process_id"),s&&this.message.show(new c({"connector":this.model.connector,"model":new t.Model({"subject":s.type,"sender":s.performer,"text":s.text})})),this.instructions.show(new d({"context":this.context,"model":this.model}));var o=new f({"context":this.options.context,"collection":this.model.forms,"node":this.model,"mode":this.model.get("isDraft")||this.model.get("isDocDraft")||i&&1===i.length?"create":"update"});this.forms.show(o),this.listenTo(this.model,"form:saveForms",function(){o._saveForms()}),this.listenTo(this.model,"form:isValid",function(e){o._validateForm()?(e.validate=!0,o._clearValidationError()):o._showValidationError()});var a=this.model.get("data_packages");e.each(a,function(t){var i=e.find(this.extensions,function(e){return e.validate(t.type,t.sub_type)});i&&i.execute({"extensionPoint":u.ExtensionPoints.AddForm,"model":this.model,"data":t.data,"parentView":this}).done(e.bind(function(e){e.type=t.type,e.sub_type=t.sub_type,e.viewToShow&&this.extension.show(e.viewToShow)},this)).fail(e.bind(function(e){var t=e.errorMsg||m.ErrorMessageLoadExtension;l.showMessage("error",t)},this))},this)}else n.warn("Form view cannot displayed without data")}});return e.extend(w.prototype,o),w
}),csui.define("hbs!workflow/widgets/workitem/workitem.body/impl/workitem.body",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workitem-body-row binf-row">\r\n  <div class="workitem-properties"></div>\r\n</div>\r\n\r\n'}});return i.registerPartial("workflow_widgets_workitem_workitem.body_impl_workitem.body",s),s}),csui.define("workflow/widgets/workitem/workitem.body/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/workitem/workitem.body/impl/nls/root/lang",{"NoModelWarning":"Form view cannot displayed without data"}),csui.define("css!workflow/widgets/workitem/workitem.body/impl/workitem.body",[],function(){}),csui.define("workflow/widgets/workitem/workitem.body/workitem.body.view",["csui/lib/underscore","csui/lib/marionette","csui/utils/log","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/progressblocker/blocker","csui/controls/globalmessage/globalmessage","workflow/widgets/workitem/workitem.properties/workitem.properties.view","workflow/widgets/workitem/workitem.attachments/workitem.attachments.view","hbs!workflow/widgets/workitem/workitem.body/impl/workitem.body","i18n!workflow/widgets/workitem/workitem.body/impl/nls/lang","css!workflow/widgets/workitem/workitem.body/impl/workitem.body"],function(e,t,i,s,n,o,a,r,l,c){var d=t.LayoutView.extend({"className":"workflow-workitem-body","template":l,"constructor":function(e){e||(e={}),this.context=e.context,this.parentView=e.parentView,this.extensions=e.extensions,t.LayoutView.prototype.constructor.call(this,e),this.propagateEventsToRegions(),this.options.blockingParentView?n.delegate(this,this.options.blockingParentView):n.imbue(this)},"regions":{"properties":".workitem-properties"},"onRender":function(){this.model?this.properties.show(new a({"context":this.context,"model":this.model,"extensions":this.extensions,"parentView":this})):i.warn(c.NoModelWarning)}});return e.extend(d.prototype,s),d}),csui.define("workflow/widgets/workitem/workitem.tabPanel/workitem.tabPanel.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/log","csui/utils/contexts/factories/node","csui/controls/tab.panel/tab.panel.view","csui/controls/tab.panel/tab.links.ext.view","csui/controls/tab.panel/tab.links.ext.scroll.mixin"],function(e,t,i,s,n,o,a,r,l){var c=a.extend({"contentView":function(e){return e.get("viewToRender")},"contentViewOptions":function(e){return e.get("viewToRenderOptions")},"constructor":function(t){e.defaults(t,{"tabType":"binf-nav-pills","delayTabContent":!1,"toolbar":!0,"TabLinkCollectionViewClass":r}),a.prototype.constructor.apply(this,arguments)},"render":function(){return a.prototype.render.apply(this),this._initializeToolbars(),this._listenToTabEvent(),setTimeout(e.bind(this._enableToolbarState,this),500),this}});return e.extend(c.prototype,l),c}),csui.define("hbs!workflow/widgets/workitem/workitem/impl/workitem",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workitem-row binf-row">\r\n  <div class="workitem-view-left binf-col-md-8 binf-col-sm-8 binf-col-xs-12">\r\n    <div class="workitem-header">"></div>\r\n    <div class="workitem-body"></div>\r\n  </div>\r\n  <aside role="complementary">\r\n  <div class="workitem-tabpanel binf-col-md-4 binf-col-sm-4">\r\n    <div class="workitem-tabpanel-header"></div>\r\n    <div class="workitem-tabpanel-content"></div>\r\n  </div>\r\n  </aside>\r\n</div>\r\n<footer role="contentinfo">\r\n<div class="workitem-footer cs-dialog binf-modal-footer"></div>\r\n</footer>\r\n\r\n'}});return i.registerPartial("workflow_widgets_workitem_workitem_impl_workitem",s),s}),csui.define("hbs!workflow/widgets/workitem/workitem/impl/workitem.nopackages",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workitem-header"></div>\r\n<div class="workitem-body"></div>\r\n<div class="workitem-footer cs-dialog binf-modal-footer"></div>\r\n\r\n'}});return i.registerPartial("workflow_widgets_workitem_workitem_impl_workitem.nopackages",s),s}),csui.define("hbs!workflow/widgets/workitem/workitem/impl/workitem.fullview",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="workitem-extension-fullview"></div>\r\n\r\n'}});return i.registerPartial("workflow_widgets_workitem_workitem_impl_workitem.fullview",s),s}),csui.define("workflow/widgets/workitem/workitem/workitem.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/dialogs/modal.alert/modal.alert","csui/controls/globalmessage/globalmessage","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/tab.panel/tab.panel.view","csui/controls/tab.panel/tab.links.ext.view","csui/models/member","csui/utils/contexts/factories/user","csui/utils/contexts/factories/application.scope.factory","csui/models/node/node.model","csui/utils/contexts/factories/node","csui/utils/commands/open.node.perspective","csui/models/nodes","csui/models/nodechildren","csui/utils/commandhelper","workflow/commands/open.workitem/open.workitem","workflow/widgets/workitem/workitem.activities/workitem.activities.controller","workflow/widgets/workitem/workitem.attachments/workitem.attachments.controller","workflow/utils/workitem.extension.controller","workflow/utils/workitem.util","workflow/models/workitem/workitem.model.factory","workflow/dialogs/action.dialog/action.dialog","workflow/dialogs/action.dialog/action.dialog.model","workflow/widgets/workitem/workitem/impl/header.view","workflow/widgets/workitem/workitem/impl/footer.view","workflow/widgets/workitem/workitem.body/workitem.body.view","workflow/widgets/workitem/workitem.tabPanel/workitem.tabPanel.view","workflow/widgets/workitem/workitem.attachments/workitem.attachments.view","i18n!workflow/widgets/workitem/workitem/impl/nls/lang","hbs!workflow/widgets/workitem/workitem/impl/workitem","hbs!workflow/widgets/workitem/workitem/impl/workitem.nopackages","hbs!workflow/widgets/workitem/workitem/impl/workitem.fullview","csui-ext!workflow/widgets/workitem/workitem.view","css!workflow/widgets/workitem/workitem/impl/workitem"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m,p,f,w,g,b,v,k,y,x,_,C,M,A,D,T,L,I,E,S,P,F,V){var R=i.Collection.extend({"comparator":function(e){return e.get("position")}}),O=s.LayoutView.extend({"className":"workitem-view","template":S,"regions":{"header":".workitem-header","body":".workitem-body","tabPanel":".workitem-tabpanel-content","footer":".workitem-footer","fullview":".workitem-extension-fullview"},"ui":{"tabPanelHeader":".workitem-tabpanel-header","tabPanelContent":".workitem-tabpanel-content"},"_isSending":!1,"constructor":function(t){this.tabPanelCollection=new R,t.model=t.model?t.model:t.context.getModel(_),this.user=t.context.getModel(d),s.LayoutView.prototype.constructor.call(this,t),this.propagateEventsToRegions(),this.listenTo(this.model,"change",this.onModelChange);var i=V;t.viewExtensions&&(i=t.viewExtensions),this.extensions=e.chain(i).flatten(!0).map(function(e){return new e(t)}).value()},"tabNextRegion":function(){this.trigger("changed:focus")},"onModelChange":function(){var i=[];i.push(this.getTabPanelCollection()),i.push(this.getFullViewExtension()),t.when.apply(t,i).done(e.bind(function(){if(!this.model.get("isDoc")&&!this.model.get("isDocDraft")||this.model.get("datafetched")===!0){this.replyPerformer=void 0;var t=this,i=this.model.get("reply_performer_id");if(i&&0!==i){var s=new c({"id":i},{"connector":this.model.connector});s.fetch().done(function(e,i){"success"===i&&(t.replyPerformer=s)})}if((this.model.get("isDoc")||this.model.get("isDocDraft"))&&!this.model.get("docModels")&&this.model.get("doc_id")){var n=this.model.get("doc_id").split(","),a=[],r=this,l={};e.each(n,function(t){var i=r.options.context.getModel(m,{"attributes":{"id":parseInt(t)}},{"silent":!0});i.fetch().done(e.bind(function(e){var i=e.results.data.properties,s=new h({"type":1,"type_name":"Shortcut","container":!1,"name":i.name,"original_id":i.id,"original_id_expand":i},{"connector":r.model.connector});a.push(s),r.model.set({"docModels":a},{"silent":!0}),l[t]=i.name},r)).always(e.bind(function(){n.length===r.model.get("docModels").length&&(this.model.set("doc_names",l),this.render())},r)).fail(e.bind(function(e){o.showMessage("error",e.responseJSON.error)},r))})}else this.render()}},this))},"extensionsExecuteAction":function(i,s,n){var o,a=[];e.each(this.extensions,function(r){var l=t.Deferred();a.push(l.promise()),r.executeAction({"action":i,"options":s,"model":n}).done(e.bind(function(t){e.isUndefined(t)||(o=t),l.resolve()},this)).fail(e.bind(function(){l.reject()},this))});var r=t.Deferred();return t.when.apply(t,a).done(e.bind(function(){r.resolve(o)},this)).fail(e.bind(function(){r.reject()},this)),r.promise()},"getTabPanelCollection":function(){this.tabPanelCollection.reset();var i=new R,s=this.model.get("data_packages");void 0===s&&(s=[]),s.push({"type":v.prototype.type,"sub_type":v.prototype.sub_type,"data":{}});var n=[];e.each(s,function(s){var a=t.Deferred();n.push(a.promise());var r=e.find(this.extensions,function(e){return e.validate(s.type,s.sub_type)});r?r.execute({"extensionPoint":y.ExtensionPoints.AddSidebar,"model":this.model,"data":s.data,"parentView":this}).done(e.bind(function(t){t.type=s.type,t.sub_type=s.sub_type,t.viewToRender&&i.add(e.extend(t,{"id":e.uniqueId("workflow-tab")})),a.resolve()},this)).fail(e.bind(function(e){o.showMessage("error",e.errorMsg||E.ErrorMessageLoadExtension),a.resolve()},this)):a.resolve()},this);var a=t.Deferred();return t.when.apply(t,n).done(e.bind(function(){this.tabPanelCollection=i,a.resolve()},this)),a.promise()},"getFullViewExtension":function(){var i=[];this.fullViewExtension=void 0;var s=this.model.get("data_packages");e.each(s,function(s){var n=e.find(this.extensions,function(e){return e.validate(s.type,s.sub_type)});if(n){var a=t.Deferred();i.push(a.promise()),n.execute({"extensionPoint":y.ExtensionPoints.FullView,"model":this.model,"data":s.data,"parentView":this}).done(e.bind(function(e){e.type=s.type,e.sub_type=s.sub_type,e.viewToShow&&(this.extensionsFullView=e.viewToShow),a.resolve()},this)).fail(e.bind(function(e){o.showMessage("error",e.errorMsg||E.ErrorMessageLoadExtension),a.resolve()},this))}},this);var n=t.Deferred();return t.when.apply(t,i).done(function(){n.resolve()}),n.promise()},"onBeforeRender":function(){this.template=void 0!==this.extensionsFullView?F:0===this.tabPanelCollection.models.length?P:S},"onRender":function(){(!this.model.get("isDoc")&&!this.model.get("isDocDraft")||this.model.get("datafetched")===!0)&&(this._isSending||(void 0!==this.extensionsFullView?this.fullview.show(this.extensionsFullView):(this._renderHeader(),this._renderBody(),this._renderTabPanel(),this._renderFooter(),this.model.attributes.member_accept&&this._confirmMemberAccept())))},"_renderHeader":function(){var e={"iconLeft":"title-icon assignment-workflow","title":this.model.title()};(this.model.get("isDoc")||this.model.get("isDocDraft"))&&this.model.get("mapsList")&&this.model.get("mapsList").length>1&&(e.multiMaps=!0,e.context=this.options.context,e.maps=this.model.get("mapsList"),e.model=this.model);var t=this.headerView=new A(e);this.header.show(t)},"_renderBody":function(){this.options.parentView=this,this.options.extensions=this.extensions;var e=this.bodyView=new T(this.options);this.body.show(e)},"_renderTabPanel":function(){var e=this.model.get("mapsList");if(this.model.get("isDoc")&&this.model.get("datafetched")&&e&&1!==e.length){if(this.viewToShow=new I({"context":this.options.context,"view":this}),this.viewToShow.render(),this.viewToShow&&(this.tabPanel.show(this.viewToShow),this.ui.tabPanelHeader.addClass("workitem-doc-initiate"),this.ui.tabPanelContent.addClass("workitem-doc-initiate"),this.viewToShow.attachments))var i=this,s=setInterval(function(){t(".workitem-attachments").length>0&&(clearInterval(s),i.viewToShow.unblockActions(),i.viewToShow.list.show(i.viewToShow.attachments))},500)}else if(this.tabPanelCollection.models.length>0){var n=new L({"collection":this.tabPanelCollection});this.tabPanel.show(n)}},"_renderFooter":function(){var t=[],s={};if(this.model.actions&&this.model.customActions||this.model.get("isDoc")===!0){if(this.model.actions&&this.model.customActions){var n=this.model.actions.models,o=this.model.customActions.models;e.each(n,function(e){s={"label":e.get("label"),"toolTip":e.get("label"),"id":e.get("id")},t.push(s)}),e.each(o,function(e){s={"label":e.get("label"),"toolTip":e.get("label"),"id":e.get("id"),"default":!0},t.push(s)})}var a=this.model.get("mapsList");this.model.get("isDoc")===!0&&a&&1!==a.length&&(s={"label":E.StartButtonLabel,"disabled":!0,"default":!0},t.push(s)),s=this.model.get("isDraft")||this.model.get("isDocDraft")||this.model.get("isDoc")?{"label":E.CancelButtonLabel,"toolTip":E.CancelButtonLabel,"close":!0}:{"label":E.CloseButtonLabel,"toolTip":E.CloseButtonLabel,"close":!0},t.push(s);var r=this.footerView=new D({"collection":new i.Collection(t)});this.listenTo(r,"childview:click",this.onClickButton),this.footer.show(r)}},"_confirmMemberAccept":function(){var e=this;n.confirmQuestion(E.MemberAcceptDialogMessage,E.MemberAcceptDialogTitle,{"centerVertically":!1,"buttons":{"showYes":!0,"labelYes":E.MemberAcceptAcceptButtonLabel,"showNo":!0,"labelNo":E.MemberAcceptCloseButtonLabel}}).always(function(t){t?(e._acceptWorkitem(),e.headerView.triggerMethod("setFocus")):e._rejectWorkitem()})},"_acceptWorkitem":function(){var e=this;this.model.sendMemberAcceptAction().done(function(){e._updateWorkitemPerformer(),o.showMessage("success",E.MemberAcceptedMessage)}).fail(function(t){var i;i=t.errorDetail&&"ErrCode_Accept_Task"===t.errorDetail?E.MemberAcceptErrorDescription:t.error,n.showWarning(i,E.MemberAcceptErrorTitle).always(function(){e._leaveWorkitemPerspective()})})},"_rejectWorkitem":function(){this._leaveWorkitemPerspective()},"_updateWorkitemPerformer":function(){var t=[],i=this.options.parentView.bodyView.properties.currentView,s=i.forms.currentView;if(s&&s.children){var n=s.children._views;if(e.each(n,function(i){var s=i.model,n=s.attributes.data,o=e.has(n,"WorkflowForm_Performer");o&&t.push(i)}),t.length>0){var o={},a=this.options.parentView.user.get("id"),r={"name":"WorkflowForm_Performer","path":"/WorkflowForm_Performer","value":a};o.view=t[0],o.model=t[0].model,o.changePerformer=!0,o.draftProcess=!1,e.extend(o,{"name":"WorkflowForm_Performer","path":"/WorkflowForm_Performer","value":a,"targetField":r}),o.view.form.setValue({"WorkflowForm_Performer":o.value}),s.refreshSameDefFields(o,o.draftProcess)}var l=i.getChildView("extension");l&&l.triggerMethod("change:performer")}},"getTemplate":function(){return this.model.get("isDoc")&&this.model.get("docModels")?S:this.template},"getUrl":function(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,s){e[i]=s});var t=e.origin_index,i=e.nexturl,s=this.model.connector.connection.url.replace("/api/v1",""),n=["func=Personal.Assignments","func=work.Workflows&tabname=Assignments"];return t>=0&&t<=n.length-1?s+"?"+n[t]:i?decodeURIComponent(i):document.referrer?document.referrer:s+"/app/nodes/2000"},"onClickButton":function(e){var t=e.model;if(t.get("close"))this._leaveWorkitemPerspective();else{var i={"validate":!1};this.model.trigger("form:isValid",i),i.validate&&((this.model.get("isDraft")||this.model.get("isDocDraft")||this.model.get("isDoc"))&&this.model.trigger("form:saveForms"),this._ExecuteAction(t.get("id"),e))}},"_ExecuteAction":function(t,s){var o=this.model.actions.get(t);e.isUndefined(o)&&(o=this.model.customActions.get(t));var a={};switch(o.get("key")){case"Delegate":a={"requireAssignee":!0,"assignee":this.user};break;case"Review":a={"requireAssignee":!0,"assignee":this.user,"assigneeOptions":!0,"texts":{"assigneeLabel":E.AssigneePickerLabelSendTo,"commentLabel":E.CommentTextFieldLabelInstructions,"commentPlaceholder":E.CommentTextFieldPlaceholderInstructions,"submitLabel":E.SubmitLabelSend}};break;case"Reply":a={"readonlyAssignee":!0,"assignee":this.replyPerformer,"texts":{"assigneeLabel":E.AssigneePickerLabelTo,"commentLabel":E.CommentTextFieldLabelReply,"commentPlaceholder":E.CommentTextFieldPlaceholderReply,"submitLabel":E.SubmitLabelSend}}}this.extensionsExecuteAction(o,a,this.model).done(e.bind(function(t){if(t&&"custom"===t.scope){var r=new i.Model(t.data);this._sendOnWorkitem(r)}else if(void 0!==this.tabPanelCollection&&this.tabPanelCollection.length>0){var l=e.filter(this.tabPanelCollection.models,function(e){return 1===e.get("type")&&1===e.get("sub_type")?!0:void 0});if(l.length>0){var c=new w(void 0,{"node":l[0].get("viewToRenderOptions").model,"fields":{"properties":["id","reserved","name"]}});c.fetch().done(e.bind(function(t){var i=e.filter(t.data,function(e){return e.reserved}),r=this;if(i.length>0){var l={};l.buttons=n.buttons.OkCancel;var c="";e.each(i,function(e){c=c+" "+e.name});var d=e.str.sformat(E.ReserveDocumentMessageText,c),u=n.confirmWarning(d,E.ReserveDocumentMessageTitle,l);u.then(function(){r._sendOnWorkitem_check(o,a,s)})}else r._sendOnWorkitem_check(o,a,s)},this))}else this._sendOnWorkitem_check(o,a,s)}else this._sendOnWorkitem_check(o,a,s)},this)).fail(e.bind(function(){},this))},"_sendOnWorkitem_check":function(t,i,s){var n=new M(e.extend({"title":e.str.sformat(E.DialogModelTitle,t.get("label"),this.model.get("title")),"requireComment":this.model.get("comments_on"),"authentication":this.model.get("authentication"),"currentUser":this.user.get("display_name"),"action":t},i));if(n.get("requireComment")||n.get("requireAssignee")||n.get("authentication")){var o=new C({"context":this.options.context,"model":n,"callback":e.bind(this._sendOnWorkitem,this)});this.listenTo(o,"destroy",e.bind(function(){this.$el.focus()},s)),o.show()}else this._sendOnWorkitem(n)},"_getRespError":function(e){var t="";return e&&e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:e&&e.responseText&&(t=e.responseText),t},"_navigateToDocParentNode":function(){var e=new p,t=this.options.context.getModel(m,{"attributes":{"id":this.model.get("parent_id")}}),i={};i.context=this.options.context,i.nodes=new f([t]);var s=e.execute(i);g.handleExecutionResults(s,{"command":this.nodesCommand,"suppressSuccessMessage":i.suppressSuccessMessage})},"_sendOnWorkitem":function(t){this._isSending=!0;var i=t.get("action"),s=t.get("comment");e.isUndefined(s)||0===s.length||this.model.set("comment",s,{"silent":!0});var a=t.get("assignee");e.isUndefined(a)||this.model.set("assignee",a.get("id"),{"silent":!0});var r=t.get("assigneeOption");e.isUndefined(r)||this.model.set("assigneeOption",r,{"silent":!0});var l=t.get("authentication_info");e.isUndefined(l)||this.model.set("authentication_info",l,{"silent":!0}),this.model.sendAction(i).done(e.bind(function(e){var t="";if(window.location.href.indexOf("reload_classic_ui=true")>0?(t=this.getUrl(),this.model.set({"url_org":t},{"silent":!0})):t=this.model.get("url_org"),e&&e.auto_display)if(e.auto_display.workflow_open_in_smart_ui===!0)this.model.reset({"silent":!0}),this._isSending=!1,this.model.set({"process_id":e.auto_display.process_id,"subprocess_id":e.auto_display.subprocess_id,"task_id":e.auto_display.task_id,"url_org":t});else{var i=b.extend({"openInNewTab":!1,"getUrlQueryParameters":function(e){return{"func":"work.EditTask","workid":e.get("process_id"),"subworkid":e.get("subprocess_id"),"taskid":e.get("task_id"),"nexturl":e.get("url_org")}}}),s=new i;this.model.set({"process_id":e.auto_display.process_id,"subprocess_id":e.auto_display.subprocess_id,"task_id":e.auto_display.task_id,"url_org":t},{"silent":!0});var n=this.model;s._navigateTo(n)}else this._leaveWorkitemPerspective(),e&&e.custom_message?o.showMessage("success",e.custom_message):this.model.get("isDraft")||this.model.get("isDocDraft")||this.model.get("isDoc")?o.showMessage("success",E.SuccessInitiateMessage):o.showMessage("success",E.SuccessSendOnMessage)},this)).fail(e.bind(function(t){var s=this._getRespError(t),o=e.str.sformat(E.ActionFailMessageTitle,i.get("label")),a=e.str.sformat(E.ActionFailMessage,i.get("label"),s);n.showError(a,o),this._isSending=!1},this))},"_leaveWorkitemPerspective":function(){if(window.location.href.indexOf("reload_classic_ui=true")>0){var e=x.validateURL(this.getUrl());e&&""!==e?window.open(e,"_self"):this._navigateBack()}else this.model&&this.model.get("isDocDraft")===!0?this._navigateToDocParentNode():this.model.get("url_org")?location.href=this.model.get("url_org"):this._navigateBack()},"_navigateBack":function(){history.length>1?history.back():this.options.context.getModel(u).set("id","")}});return e.extend(O.prototype,a),O}),csui.define("workflow/models/wfstatus/wfstatus.table.model",["csui/lib/underscore","csui/lib/backbone","csui/utils/url","csui/models/mixins/connectable/connectable.mixin","csui/models/mixins/fetchable/fetchable.mixin","csui/models/fetchable","csui/models/mixins/v2.additional.resources/v2.additional.resources.mixin","csui/models/mixins/v2.fields/v2.fields.mixin","csui/models/mixins/v2.expandable/v2.expandable.mixin","csui/models/mixins/v2.commandable/v2.commandable.mixin","csui/models/browsable/client-side.mixin","csui/models/browsable/v2.response.mixin","csui/models/nodechildrencolumn","csui/models/nodechildrencolumns","csui/models/node/node.model","workflow/utils/workitem.util","i18n!csui/models/widget/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m,p,f){var w=h.extend({"constructor":function(e,t){h.prototype.constructor.call(this,e,t)}}),g=m.extend({"model":w,"getColumnModels":function(t,i){var s=m.prototype.getColumnModels.call(this,t,i);return e.each(s,function(e){var t=e.column_key,i=["status_key","due_date","wf_name","step_name","assignee","date_initiated"];i.indexOf(t)>=0&&(e.sort=!0)}),s},"getV2Columns":function(t){var i=t.results&&t.results[0]&&t.results[0].definitions&&t.results[0].definitions.wfstatus||{},s=e.keys(i);return this.getColumnModels(s,i)}}),b=p.extend({"parse":function(e,t){if(e.data&&e.data.wfstatus){var i={},s=0;i.assignees=e.data.wfstatus.assignee,1===i.assignees.length&&(s=i.assignees[0].userId),e.data.wfstatus.assignedto&&(e.data.wfstatus.assignedto.assignees=i.assignees),i.assignedto=e.data.wfstatus.assignedto,e.data.wfstatus.userId=s,e.data.wfstatus.assignee=f.getAssignee(i),e.data.properties=e.data.wfstatus}var n=p.prototype.parse.call(this,e,t);return n}}),v=t.Collection.extend(e.extend({},o(t.Collection),{"model":b,"constructor":function(i,s){t.Collection.prototype.constructor.apply(this,arguments),s&&(this.options=e.pick(s,["connector","autoreset","includeResources","fields","expand","commands","status","retention","wfstatusfilter","filterWorkflowtype","filterWorkflows","selectionType","isFilterVisible","statusListCount","chatSettings"])),this.makeConnectable(s).makeFetchable(s).makeAdditionalResourcesV2Mixin(s).makeFieldsV2(s).makeExpandableV2(s).makeCommandableV2(s).makeClientSideBrowsable(s).makeBrowsableV2Response(s),this.columns=new g},"clone":function(){var e=new this.constructor(this.models,this.options);return this.columns&&e.columns.reset(this.columns.toJSON()),e.actualSkipCount=this.actualSkipCount,e.wfstatus=this.model,e.totalCount=this.totalCount,e.filteredCount=this.filteredCount,e},"url":function(){var e=this.connector.connection.url.replace("/v1","/v2"),t=i.combine(e,"/workflows/status"),s=this.options.filterWorkflowtype,n=this.options.retention,o=this.options.selectionType,a=this.options.wfstatusfilter;return s||(s=f.getWorkflowtype(this.options.filterWorkflows)),t+="?selectionType="+o,a&&""!==a?t+="&wfstatusfilter="+a:(t+="&wfretention="+n,t+="&kind="+s),t},"parse":function(e,t){return this.parseBrowsedState(e,t),this.columns&&this.columns.resetColumnsV2(e,this.options),this.parseBrowsedItems(e,t)},"getResourceScope":function(){return e.deepClone({"fields":this.fields,"expand":this.expand,"includeResources":this._additionalResources,"commands":this.commands})},"fetchdata":function(e){return e&&(this.options=e),this.Fetchable.fetch.apply(this,arguments)},"setResourceScope":function(e){this.excludeResources(),e.includeResources&&this.includeResources(e.includeResources),this.resetFields(),e.fields&&this.setFields(e.fields),this.resetExpand(),e.expand&&this.setExpand(e.expand),this.resetCommands(),e.commands&&this.setCommands(e.commands)}}));d.mixin(v.prototype);var k=v.prototype._compareValues;return v.prototype._compareValues=function(e,t,i){if(e.indexOf("date")>=0){if(null===t)return 1;if(null===i)return-1}return k.apply(this,arguments)},u.mixin(v.prototype),s.mixin(v.prototype),n.mixin(v.prototype),a.mixin(v.prototype),r.mixin(v.prototype),l.mixin(v.prototype),c.mixin(v.prototype),v}),csui.define("workflow/models/wfstatus/wfstatus.collection.factory",["module","csui/lib/underscore","csui/lib/backbone","csui/utils/contexts/factories/factory","csui/utils/contexts/factories/connector","workflow/models/wfstatus/wfstatus.table.model","csui/utils/deepClone/deepClone"],function(e,t,i,s,n,o){var a=s.extend({"propertyPrefix":"wfstatus-list","constructor":function r(a,l){s.prototype.constructor.apply(this,arguments);var c=this.options.wfstatus||{};if(!(c instanceof i.Collection)){var d=a.getObject(n,l),u=e.config();c=new o(c.models,t.extend({"connector":d},this.options,u.options,r.getDefaultResourceScope(),{"autoreset":!0}))}this.property=c},"fetch":function(e){return this.property.fetch(e)},"isFetchable":function(){return window.csui&&window.csui.mobile?!this.property.fetched:!0}},{"getDefaultResourceScope":function(){return t.deepClone({"fields":{"wfstatus":[]},"includeResources":["metadata"]})}});return a}),csui.define("hbs!workflow/controls/visualdata/impl/wfdonut",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="wf-status-visual-data-container"></div>'}});return i.registerPartial("workflow_controls_visualdata_impl_wfdonut",s),s}),csui.define("css!workflow/controls/visualdata/impl/wfdonut",[],function(){}),csui.define("workflow/controls/visualdata/visual.data.donut.view",["csui/lib/underscore","csui/lib/marionette","csui/lib/jquery","csui/lib/d3","hbs!workflow/controls/visualdata/impl/wfdonut","css!workflow/controls/visualdata/impl/wfdonut"],function(e,t,i,s,n){var o=t.ItemView.extend({"className":"wf-status-donut-piechart","template":n,"rootElementType":"svg","defaults":{"marginTop":10,"marginTopp":60,"marginRight":0,"marginBottom":0,"marginLeft":20,"groupAfter":0},"ui":{"dataVisContainer":".wf-status-visual-data-container"},"onDestroy":function(){i(window).unbind("resize.app",this.render),i(".wfstatus-donut-chart-tooltip.toolTip").remove()},"constructor":function(e){this.options=e,this.parentEle=this.options.parent.$el,t.ItemView.prototype.constructor.call(this,e),i(window).bind("resize.app",this.render)},"onRender":function(){function t(t){if(0===t)return 0;var i=0;return e.each(f,function(e){t>0&&0!==e.count&&i++,t--}),i}function n(){var e,t=f.length||1,i=14,s=24;return e=2*c/t/2,e=i>e?i:e,e=e>s?s:e}function o(t){var i=0;return e.each(t,function(e){0!==e.count&&i++}),i}function a(e){var t=0,s=document.createElement("span");return s.innerText=e.data.count,s.style.visibility="hidden",i("body")[0].appendChild(s),t=i(s).width(),i("body")[0].removeChild(s),t}var r=-30;this.uniqueID=e.uniqueId("vis_");var l=this.width()>0?this.width():i(this.$el).width()-this.marginLeft()-this.marginRight(),c=this.height()>0?this.height():i(this.$el).height()-this.marginTop()-this.marginBottom();this.visElement=s.select(this.ui.dataVisContainer[0]).append(this.rootElementType).attr("id",this.uniqueID).attr("focusable",!1).attr("width",l+this.marginLeft()+this.marginRight()).attr("height",c-this.marginTopp()),this.visElement.append("g").attr("transform","translate("+this.marginLeft()+",-40)").attr("class","vis-wrapper"),this.visElement.select(".vis-wrapper").append("g").attr("class","pie-chart").attr("transform","translate("+this.width()/4+","+this.height()/2+")"),this.visElement.select(".vis-wrapper").append("g").attr("class","pie-legend-container").attr("transform","translate("+(this.width()/3*2+r-30)+","+this.height()/2+")");var d=s.select("body").append("div").attr("class","wfstatus-donut-chart-tooltip toolTip"),u=this,h=u.visElement,m=["#09bcef","#8cc53e","#f3794e"],p=s.scaleOrdinal(m),f=this.options.dataset,w=1.35,g=Math.min(l/4,c/3)+10,b=.9,v=1,k="#ffffff",y="0.7";l=this.width()-this.marginLeft()-this.marginRight(),c=this.width()-this.marginTop()-this.marginBottom();var x=s.arc().innerRadius(g/w).outerRadius(g),_=s.pie().sort(null).value(function(e){return e.count}),C=h.select(".pie-chart").selectAll(".arc").data(_(f)).enter().append("g").attr("class","arc").style("cursor","pointer");C.append("path").attr("d",x).attr("tabindex",function(e){return e.data.count?0:-1}).attr("focusable",function(e){return e.data.count?!0:!1}).attr("fill-opacity",b).style("fill",function(e,t){return p(t)}).on("keyup",function(e){9===s.event.keyCode&&h.select(".pie-chart").selectAll(".arc").filter(function(t){return t.data.status===e.data.status}).attr("stroke",k).attr("stroke-opacity",y).transition().duration(0).attr("stroke-width",v)}).on("focusout",function(e){h.select(".pie-chart").selectAll(".arc").filter(function(t){return t.data.status===e.data.status}).attr("stroke","none")}).on("keydown",function(e){13===s.event.keyCode&&(s.event.data={"status":e.data.status},u.options.parent.triggerMethod("click:segment",s.event))}).on("mouseover",function(e){return d.text(e.data.count+" "+u.options.statusArray[e.data.status]),d.style("visibility","visible")}).on("mousemove",function(e){d.text(e.data.count+" "+u.options.statusArray[e.data.status]);var t=s.mouse(s.select("body").node());return d.style("top",t[1]-25+"px").style("left",t[0]-10+"px")}).on("mouseout",function(e){return d.text(e.data.count+" "+u.options.statusArray[e.data.status]),d.style("visibility","hidden")}).on("click",function(e){s.event.data={"status":e.data.status},u.options.parent.triggerMethod("click:segment",s.event)});var M=h.select(".pie-chart").append("g").attr("class","pie-total-container").style("cursor","pointer"),A=10,D=A,T=10;M.append("text").attr("tabindex","0").attr("class","total-count").attr("transform","translate(0,"+(-(D/T)-10)+")").attr("text-anchor","middle").attr("alignment-baseline","middle").attr("fill","#cccccc").text(this.totalCount(f)).on("focusout",function(){M.attr("stroke","none")}).on("keydown",function(){13===s.event.keyCode&&u.options.parent.triggerMethod("click:segment",s.event)}).on("keyup",function(){9===s.event.keyCode&&M.attr("stroke",k).attr("stroke-opacity",y).transition().duration(0).attr("stroke-width",v)}),M.append("text").attr("class","total-text").attr("transform","translate(0,"+(D/T+30)+")").attr("text-anchor","middle").attr("alignment-baseline","middle").attr("fill","#cccccc").text("Total");var L=n()+12,I=h.select(".pie-legend-container");I.style("font-size",L/2+"px");var E=I.selectAll(".pie-legend").data(_(f)).enter().append("g").attr("class","pie-legend").on("mouseover",function(e){h.select(".pie-chart").selectAll(".arc").filter(function(t){return t.data.status===e.data.status}).attr("stroke","red").transition().duration(1e3).attr("stroke-width",2)}).on("mouseout",function(e){h.select(".pie-chart").selectAll(".arc").filter(function(t){return t.data.status===e.data.status}).attr("stroke","none")}).on("click",function(e){s.event.data={"status":e.data.status},u.options.parent.triggerMethod("click:segment",s.event)});E.append("text").attr("class","pie-legend-text wf-legend-text").attr("tabindex",function(e){return e.data.count?0:-1}).attr("focusable",function(e){return e.data.count?!0:!1}).on("keydown",function(e){13===s.event.keyCode&&(s.event.data={"status":e.data.status},u.options.parent.triggerMethod("click:segment",s.event))
}).attr("dy","1.2em").attr("transform",function(e,i){var s=L*o(f)/2-10,n=a(e,i)+L+24,r=t(i)*L-s;return"translate("+n+","+r+")"}).attr("fill","#cccccc").text(function(e){return e.data.count?u.options.statusArray[e.data.status]:""}).on("keyup",function(e){9===s.event.keyCode&&E.filter(function(t){return t.data.status===e.data.status}).attr("stroke",k).attr("stroke-opacity",y).transition().duration(0).attr("stroke-width",v)}).on("focusout",function(e){E.filter(function(t){return t.data.status===e.data.status}).attr("stroke","none")}),E.append("text").attr("class","pie-legend-text wf-legend-count").attr("dy","1.2em").attr("transform",function(e,i){var s=L*o(f)/2,n=36,a=t(i)*L-s;return"translate("+n+","+a+")"}).text(function(e){return e.data.count?e.data.count:""}).attr("fill",function(e,t){return p(t)}),E.style("cursor","pointer")},"marginTop":function(){return this.defaults.marginTop},"marginBottom":function(){return this.defaults.marginBottom},"marginLeft":function(){return this.defaults.marginLeft},"marginRight":function(){return this.defaults.marginRight},"marginTopp":function(){return this.defaults.marginTopp},"width":function(){return this.parentEle.width()-this.marginLeft()-this.marginRight()},"height":function(){return this.parentEle.height()-this.marginTop()-this.marginBottom()},"totalCount":function(t){var i=0;return e.each(t,function(e){i+=e.count}),i}});return o}),csui.define("workflow/controls/behaviors/wfstatus.infinite.scrolling.behavior",["csui/lib/jquery","csui/controls/tile/behaviors/infinite.scrolling.behavior"],function(e,t){var i=t.extend({"_checkScrollPosition":function(){var t=e(this.options.contentParent),i=t.height(),s=t[0].scrollHeight,n=t.scrollTop();n+30>=s-i&&e("#footerview").trigger("click")}});return i}),csui.define("workflow/controls/infinite.table/infinite.table.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/moment","csui/lib/backbone","csui/lib/marionette","csui/controls/table/table.view","csui/utils/commands","csui/utils/defaultactionitems","workflow/controls/behaviors/wfstatus.infinite.scrolling.behavior","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/lib/perfect-scrollbar"],function(e,t,i,s,n,o,a,r,l,c,d){var u=a.extend({"constructor":function h(){h.__super__.constructor.apply(this,arguments)},"behaviors":{"PerfectScrolling":{"behaviorClass":d,"contentParent":"tbody","suppressScrollX":!0},"InfiniteScrolling":{"behaviorClass":c,"contentParent":"tbody","content":"tbody>tr:visible","fetchMoreItemsThreshold":10}}});return u}),csui.define("workflow/widgets/wfstatus/wfstatus.columns",["csui/lib/backbone"],function(e){var t=e.Model.extend({"idAttribute":"key","defaults":{"key":null,"sequence":0}}),i=e.Collection.extend({"model":t,"comparator":"sequence","getColumnKeys":function(){return this.pluck("key")},"deepClone":function(){return new i(this.map(function(e){return e.attributes}))}}),s=new i([{"key":"status_key","sequence":10},{"key":"due_date","sequence":20},{"key":"wf_name","sequence":30},{"key":"step_name","sequence":40},{"key":"assignee","sequence":50},{"key":"date_initiated","sequence":60}]);return s}),csui.define("workflow/models/wfstatus/wfstatus.column.factory",["module","csui/lib/underscore","csui/lib/backbone","csui/utils/contexts/factories/factory","workflow/models/wfstatus/wfstatus.collection.factory"],function(e,t,i,s,n){var o=s.extend({"propertyPrefix":"wfstatus_columns","constructor":function(e,t){s.prototype.constructor.apply(this,arguments);var o=this.options.columns||{};if(!(o instanceof i.Collection)){var a=e.getCollection(n,t);o=a.columns}this.property=o}});return o}),csui.define("hbs!workflow/widgets/wfstatus/impl/wfstatuslist",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(){return'<div class="wfstatus-table">\r\n  <div id="tableview"></div>\r\n  <div id="footerview"></div>\r\n</div>\r\n'}});return i.registerPartial("workflow_widgets_wfstatus_impl_wfstatuslist",s),s}),csui.define("css!workflow/widgets/wfstatus/impl/wfstatus",[],function(){}),csui.define("workflow/widgets/wfstatus/impl/wfstatus.list.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/log","csui/controls/table/rows/description/description.view","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/widgets/nodestable/nodestable.view","csui/controls/toolbar/delayed.toolbar.view","csui/controls/toolbar/toolbar.view","csui/controls/tableactionbar/tableactionbar.view","workflow/controls/infinite.table/infinite.table.view","workflow/widgets/wfstatus/wfstatus.columns","workflow/models/wfstatus/wfstatus.column.factory","workflow/models/wfstatus/wfstatus.collection.factory","workflow/models/wfstatus/wfstatus.model.factory","workflow/controls/usercards/usercards.popover.view","workflow/utils/workitem.util","hbs!workflow/widgets/wfstatus/impl/wfstatuslist","i18n!workflow/widgets/wfstatus/impl/nls/lang","css!workflow/widgets/wfstatus/impl/wfstatus"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m,p,f,w,g,b,v,k){var y=l.extend({"template":v,"className":"","regions":{"tableRegion":"#tableview","footerRegion":"#footerview"},"events":{"click #footerview":"fetchMoreItems","click #tableview":"performStatusItemAction"},"constructor":function(e){e.separateDescription=!1,l.prototype.constructor.apply(this,arguments),this.propagateEventsToRegions()},"initialize":function(){this.collection=this.options.collection||this.context.getCollection(f),this.columns=this.collection.columns||this.context.getCollection(p),i.defaults(this.options,{"orderBy":"status_key desc","tableColumns":m}),this.setTableView(),this.options.collection&&(this.collection.fetched=!1),this.collection.page=1},"fetchMoreItems":function(){this.collection.fetched=!1;var e=this.collection.wfstatus,t=this.collection.options.status,s=0;t.length>0&&i.each(t,function(t){t="workflowlate"===t?"late":t;for(var i=0;i<e.changed.data.length;i++)if(t===e.changed.data[i].status){s+=e.changed.data[i].count;break}}),(0===t.length&&e.changed.count>this.collection.allModels.length||s>this.collection.allModels.length)&&(this.collection.page=this.collection.page+1,this.onRender(this.collection.page))},"setTableView":function(){this.tableView=new h({"context":this.options.context,"connector":this.connector,"collection":this.collection,"columns":this.columns,"tableColumns":this.options.tableColumns,"pageSize":this.options.pageSize,"originatingView":this,"columnsWithSearch":["wf_name"],"orderBy":this.options.orderBy,"filterBy":this.options.filterBy,"nameEdit":!1,"selectRows":"None","selectColumn":!1,"favoritesTableOptions":this.favoritesTableOptions,"actionItems":this.defaultActionController.actionItems,"commands":this.defaultActionController.commands,"blockingParentView":this,"tableTexts":{"zeroRecords":k.emptyListText},"alternativeHeader":{"viewClass":this.collection.delayedActions?c:d,"options":{"toolbarItems":this.options.toolbarItems,"toolbarItemsMask":this.options.toolbarItemsMasks.toolbars.tableHeaderToolbar,"toolbarCommandController":this.commandController}},"inlineBar":{"viewClass":u,"options":i.extend({"collection":this.options.toolbarItems.inlineActionbar,"toolItemsMask":this.options.toolbarItemsMasks.toolbars.inlineActionbar,"delayedActions":this.collection.delayedActions,"container":this.collection.node,"containerCollection":this.collection,"commandExecutionOptions":{"nameAttribute":"wf_name"}},this.options.toolbarItems.inlineActionbar.options,{"inlineBarStyle":this.options.inlineActionBarStyle,"forceInlineBarOnClick":this.options.forceInlineActionBarOnClick,"showInlineBarOnHover":this.options.showInlineActionBarOnHover})}}),this.listenTo(this,"render",function(){this.tableRegion.show(this.tableView)}),this.listenTo(this.tableView,"clicked:cell",this.performStatusItemAction)},"onDestroy":function(){this.options.collection&&this.collection.setResourceScope(this._originalScope),l.prototype.onDestroy.call(this)},"onRender":function(e){if(this.options.collection&&!this.collection.fetched){this._originalScope=this.collection.getResourceScope(),this.collection.setResourceScope(f.getDefaultResourceScope());var t={},s="";if(this.collection.options&&this.collection.options.status){var n="",o=this.collection.options.status;i.each(o,function(e){""!==e&&(s+=n+"wstatus="+e,n="&")})}if(t.reload=!0,t.data=s,(this.collection.options.status.length>0||this.collection.options.isFilterVisible===!0)&&this.$el.find(".wfstatus-table").addClass("wfstatus-filter-width"),e>1){t.data=t.data?t.data+"&page="+e:"page="+e,t.remove=!1,t.reset=!1,t.reload=!1,t.retention=this.collection.options.retention,t.selectionType=this.collection.options.selectionType,t.wfstatusfilter=this.collection.options.wfstatusfilter,t.status=this.collection.options.status;var a=this.collection.options.filterWorkflowtype;a||(a=b.getWorkflowtype(this.collection.options.filterWorkflows)),t.filterWorkflowtype=a,this.collection.fetchdata(i.extend({"remove":!1},t))}else this.collection.fetch(t)}this.tableRegion.show(this.tableView),this.listenTo(this.collection,"reset",this.unbindPopover)},"unbindPopover":function(){b.unbindPopover()},"performStatusItemAction":function(e){if(e&&e.target&&e.target.className.indexOf("csui-perfect-scrolling")>=0)return void this.unbindPopover();if(4===e.colIndex){var s=e.cellView.$el,n=e.cellView.options.context,o={"model":e.model,"context":n,"originatingView":e.cellView,"wfData":i.pick(e.model.attributes,"process_id","subprocess_id","task_id","userId","comments_on")},a={"delegateTarget":s,"UserCardviewOptions":o};0!==e.model.get("assignee").length&&g.ShowPopOver(a),t(s).hasClass("csui-acc-focusable-active")||(t(s).addClass("csui-acc-focusable-active"),t(s).attr("tabindex",0),t(s).focus())}else if(e.model&&e.cellView){var r={"model":e.model,"cellView":e.cellView,"context":e.cellView.options.context};b.displayWfstatusItemProgresspanel(r)}}});return i.extend(y.prototype,r),y}),csui.define("hbs!workflow/widgets/wfstatus/impl/wfstatus.extended",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t){var i;return'<div class="wfstatus-filter-view">\r\n\r\n  <div class="wfstatus-panel-heading" title="'+this.escapeExpression((i=null!=(i=t.headerFilterTitle||(null!=e?e.headerFilterTitle:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"headerFilterTitle","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.headerFilterTitle||(null!=e?e.headerFilterTitle:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"headerFilterTitle","hash":{}}):i))+'\r\n  </div>\r\n  <div class="binf-wfstatus-heading" title="'+this.escapeExpression((i=null!=(i=t.headerFilterLabel||(null!=e?e.headerFilterLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"headerFilterLabel","hash":{}}):i))+'">\r\n    '+this.escapeExpression((i=null!=(i=t.headerFilterLabel||(null!=e?e.headerFilterLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"headerFilterLabel","hash":{}}):i))+'\r\n  </div>\r\n\r\n  <div class="wfstatus-header csui-selected-checkbox csui-checkbox-primary">\r\n    <input id="selectAll" type="checkbox" class="All" tabindex="-1"\r\n      '+this.escapeExpression((i=null!=(i=t.checkedAll||(null!=e?e.checkedAll:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"checkedAll","hash":{}}):i))+">"+this.escapeExpression((i=null!=(i=t.allFilterLabel||(null!=e?e.allFilterLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"allFilterLabel","hash":{}}):i))+'</br></input>\r\n    <span class="wfstatus-allcount">'+this.escapeExpression((i=null!=(i=t.allWFStatusCount||(null!=e?e.allWFStatusCount:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"allWFStatusCount","hash":{}}):i))+'</span>\r\n  </div>\r\n\r\n  <div class="wfstatus-body">\r\n    <div class="csui-selected-checkbox csui-checkbox-primary">\r\n      <input id="wfstatus-late" type="checkbox" class="wfstatus-late" tabindex="-1"\r\n        '+this.escapeExpression((i=null!=(i=t.checkedLate||(null!=e?e.checkedLate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"checkedLate","hash":{}}):i))+">"+this.escapeExpression((i=null!=(i=t.lateFilterLabel||(null!=e?e.lateFilterLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"lateFilterLabel","hash":{}}):i))+'</input>\r\n      <span class="wfstatus-latecount">'+this.escapeExpression((i=null!=(i=t.lateCount||(null!=e?e.lateCount:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"lateCount","hash":{}}):i))+'</span>\r\n    </div>\r\n    </br>\r\n\r\n    <div class="csui-selected-checkbox csui-checkbox-primary">\r\n      <input id="wfstatus-ontime" type="checkbox" class="wfstatus-ontime" tabindex="-1"\r\n        '+this.escapeExpression((i=null!=(i=t.checkedOnTime||(null!=e?e.checkedOnTime:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"checkedOnTime","hash":{}}):i))+">"+this.escapeExpression((i=null!=(i=t.ontimeFilterLabel||(null!=e?e.ontimeFilterLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ontimeFilterLabel","hash":{}}):i))+'</input>\r\n      <span class="wfstatus-ontimecount">'+this.escapeExpression((i=null!=(i=t.ontimeCount||(null!=e?e.ontimeCount:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"ontimeCount","hash":{}}):i))+'</span>\r\n    </div>\r\n    </br>\r\n    <div class="csui-selected-checkbox csui-checkbox-primary">\r\n      <input id="wfstatus-completed" type="checkbox" class="wfstatus-completed" tabindex="-1"\r\n        '+this.escapeExpression((i=null!=(i=t.checkedCompleted||(null!=e?e.checkedCompleted:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"checkedCompleted","hash":{}}):i))+">"+this.escapeExpression((i=null!=(i=t.completedFilterLabel||(null!=e?e.completedFilterLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"completedFilterLabel","hash":{}}):i))+'</input>\r\n      <span class="wfstatus-completedcount">'+this.escapeExpression((i=null!=(i=t.completedCount||(null!=e?e.completedCount:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"completedCount","hash":{}}):i))+'</span>\r\n      </br>\r\n    </div>\r\n  </div>\r\n</div></div>\r\n\r\n<div class="wfstatus-list-view"></div>\r\n\r\n'}});return i.registerPartial("workflow_widgets_wfstatus_impl_wfstatus.extended",s),s}),csui.define("workflow/widgets/wfstatus/impl/wfstatus.extended.view",["csui/lib/marionette","csui/lib/underscore","csui/lib/jquery","csui/controls/table/table.view","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","workflow/models/wfstatus/wfstatus.collection.factory","workflow/widgets/wfstatus/impl/wfstatus.list.view","workflow/utils/workitem.util","hbs!workflow/widgets/wfstatus/impl/wfstatus.extended","i18n!workflow/widgets/wfstatus/impl/nls/lang"],function(e,t,i,s,n,o,a,r,l,c){var d=e.LayoutView.extend({"className":"wfstatus-extended-view","template":l,"events":{"click #selectAll":"toggleCheckBoxAll","click #wfstatus-late ,#wfstatus-ontime ,#wfstatus-completed":"toggleCheckBoxSelection"},"regions":{"filterRegion":".wfstatus-filter-view","listRegion":".wfstatus-list-view"},"templateHelpers":function(){var e="",i="",s="",n="",a="checked",r=this.options.context.getCollection(o),l=r.options.status,d=r.model.get("data");return l&&l.length>0?t.each(l,function(e){"ontime"===e?s=a:"workflowlate"===e?i=a:"completed"===e&&(n=a)}):(e=a,s=a,i=a,n=a),{"completedFilterLabel":c.completedFilterLabel,"lateFilterLabel":c.lateFilterLabel,"ontimeFilterLabel":c.ontimeFilterLabel,"headerFilterTitle":c.headerFilterTitle,"headerFilterLabel":c.headerFilterLabel,"allFilterLabel":c.allFilterLabel,"allWFStatusCount":r.model.get("count"),"ontimeCount":d[0]?d[0].count:"ontime"===d.status?1:0,"completedCount":d[0]?d[1].count:"completed"===d.status?1:0,"lateCount":d[0]?d[2].count:"workflowlate"===d.status?1:0,"checkedAll":e,"checkedLate":i,"checkedOnTime":s,"checkedCompleted":n}},"constructor":function(t){this.options=t,e.LayoutView.prototype.constructor.apply(this,arguments),this.listenTo(this,"click:actionIcon",this.onClickFilter),this.listenTo(this,"destroy",this.destroyUserCardPopovers),this.propagateEventsToRegions()},"onRender":function(){this.collection.options.isFilterVisible!==!0&&this.collection.add({});var e=this;setTimeout(function(){e.listRegion.show(new a({"context":e.options.context,"collection":e.collection}))},1),this.collection.options.status.length>0&&this.$el.find(".wfstatus-filter-view").addClass("wfstatus-show-filter-view")},"onClickFilter":function(){r.unbindPopover(),0===this.$el.find(".wfstatus-show-filter-view").length?(this.$el.find(".wfstatus-table").addClass("wfstatus-filter-width"),this.$el.find(".wfstatus-filter-view").addClass("wfstatus-show-filter-view")):(this.$el.find(".wfstatus-table").removeClass("wfstatus-filter-width"),this.$el.find(".wfstatus-filter-view").removeClass("wfstatus-show-filter-view")),i(window).trigger("resize.tableview",s.onTableWinResize)},"toggleCheckBoxAll":function(e){r.unbindPopover(),1===this.$el.find("[id='selectAll']:checked").length?i(".csui-selected-checkbox input:not(:checked)").each(function(){i(this).prop("checked",!0).trigger("change")}):i(".csui-selected-checkbox input:checked").each(function(){i(this).prop("checked",!1).trigger("change")}),this.collection.options.isFilterVisible=!0,this.getStatusList(e)},"toggleCheckBoxSelection":function(e){r.unbindPopover();var t=[];i(".wfstatus-body .csui-selected-checkbox input:not(:checked)").length>0?(i(".wfstatus-body .csui-selected-checkbox input:checked").each(function(){var e=this.id;"wfstatus-late"===e?t.push("workflowlate"):"wfstatus-ontime"===e?t.push("ontime"):"wfstatus-completed"===e&&t.push("completed")}),e.data=t,i("#selectAll").prop("checked",!1).trigger("change")):3===i(".wfstatus-body .csui-selected-checkbox input:checked").length&&i("#selectAll").prop("checked",!0).trigger("change"),this.collection.options.isFilterVisible=!0,this.getStatusList(e)},"getStatusList":function(e){this.collection.options.status=e.data?e.data:[],e.stopPropagation(),this.onRender()},"destroyUserCardPopovers":function(){r.unbindPopover()}});return t.extend(d.prototype,n),d}),csui.define("hbs!workflow/widgets/wfstatus/impl/wfstatus",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"1":function(e,t){var i;return'    <div class="wfstatus-empty-list"> '+this.escapeExpression((i=null!=(i=t.emptyListText||(null!=e?e.emptyListText:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"emptyListText","hash":{}}):i))+"</div>\r\n"},"3":function(e,t,i,s){var n,o;return'    <div class="wfstatus-single">\r\n      <div class="wfstatus-single-details">\r\n\r\n        <!-- 1 total -->\r\n        <div class="wfstatus-status-info">\r\n            <span class="wfstatus-count-'+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.model:e)?n.data:n)?n.status:n,e))+'"\r\n                  title="'+this.escapeExpression(this.lambda(null!=(n=null!=e?e.model:e)?n.count:n,e))+'">'+this.escapeExpression(this.lambda(null!=(n=null!=e?e.model:e)?n.count:n,e))+'</span>\r\n          <span class=" wfstatus-msg">'+this.escapeExpression((o=null!=(o=t.totalMsg||(null!=e?e.totalMsg:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"totalMsg","hash":{}}):o))+'</span>\r\n          <span class="wfstatus-'+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.model:e)?n.data:n)?n.status:n,e))+'-icon"></span>\r\n          <span class="wfstatus-info" title="'+this.escapeExpression((o=null!=(o=t.statusInfo||(null!=e?e.statusInfo:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"statusInfo","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.statusInfo||(null!=e?e.statusInfo:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"statusInfo","hash":{}}):o))+"</span>\r\n\r\n        </div>\r\n\r\n        <!-- status and due date -->\r\n"+(null!=(n=t["if"].call(e,null!=e?e.dueDate:e,{"name":"if","hash":{},"fn":this.program(4,s,0),"inverse":this.noop}))?n:"")+'        <!-- Workflow name -->\r\n        <div class="wfstatus-wfname-details">\r\n          <div class="wfstatus-wfname-label">'+this.escapeExpression((o=null!=(o=t.wfNameLabel||(null!=e?e.wfNameLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"wfNameLabel","hash":{}}):o))+'</div>\r\n          <div class="wfstatus-workflow-name"\r\n               title="'+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.model:e)?n.data:n)?n.wfname:n,e))+'">'+this.escapeExpression(this.lambda(null!=(n=null!=(n=null!=e?e.model:e)?n.data:n)?n.wfname:n,e))+"</div>\r\n        </div>\r\n"+(null!=(n=t["if"].call(e,null!=(n=null!=(n=null!=e?e.model:e)?n.data:n)?n.stepname:n,{"name":"if","hash":{},"fn":this.program(6,s,0),"inverse":this.noop}))?n:"")+'        <div class="wfstatus-assignee-startdate">\r\n'+(null!=(n=t["if"].call(e,null!=e?e.assignee:e,{"name":"if","hash":{},"fn":this.program(8,s,0),"inverse":this.noop}))?n:"")+"\r\n"+(null!=(n=t["if"].call(e,null!=e?e.startDate:e,{"name":"if","hash":{},"fn":this.program(10,s,0),"inverse":this.noop}))?n:"")+"        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n"},"4":function(e,t){var i;return'          <div class="wfstatus-detail">\r\n            <span class="wfstatus-duedate-label">'+this.escapeExpression((i=null!=(i=t.dueDateLabel||(null!=e?e.dueDateLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"dueDateLabel","hash":{}}):i))+'</span>\r\n\r\n            <div class="wfstatus-duedate" title="'+this.escapeExpression((i=null!=(i=t.dueDate||(null!=e?e.dueDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"dueDate","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.dueDate||(null!=e?e.dueDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"dueDate","hash":{}}):i))+"</div>\r\n          </div>\r\n"},"6":function(e,t){var i,s;return'          <!-- Step name -->\r\n          <div class="wfstatus-currentstep-details">\r\n            <span class="wfstatus-currentstep-label">'+this.escapeExpression((s=null!=(s=t.currentStepNameLabel||(null!=e?e.currentStepNameLabel:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"currentStepNameLabel","hash":{}}):s))+'</span>\r\n\r\n            <div class="wfstatus-step-name"\r\n                 title="'+this.escapeExpression(this.lambda(null!=(i=null!=(i=null!=e?e.model:e)?i.data:i)?i.stepname:i,e))+'">'+this.escapeExpression(this.lambda(null!=(i=null!=(i=null!=e?e.model:e)?i.data:i)?i.stepname:i,e))+"</div>\r\n          </div>\r\n"},"8":function(e,t){var i;return'            <div class="wfstatus-assignee-details">\r\n              <div class="wfstatus-assignee-label">'+this.escapeExpression((i=null!=(i=t.assignedToLabel||(null!=e?e.assignedToLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"assignedToLabel","hash":{}}):i))+'</div>\r\n              <div class="wfstatus-assignee" title="'+this.escapeExpression((i=null!=(i=t.assignee||(null!=e?e.assignee:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"assignee","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.assignee||(null!=e?e.assignee:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"assignee","hash":{}}):i))+"</div>\r\n            </div>\r\n"},"10":function(e,t){var i;return'            <div class="wfstatus-startdate-details">\r\n              <div class="wfstatus-startdate-label">'+this.escapeExpression((i=null!=(i=t.startDateLabel||(null!=e?e.startDateLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"startDateLabel","hash":{}}):i))+'</div>\r\n              <div class="wfstatus-start-date" title="'+this.escapeExpression((i=null!=(i=t.startDate||(null!=e?e.startDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"startDate","hash":{}}):i))+'">'+this.escapeExpression((i=null!=(i=t.startDate||(null!=e?e.startDate:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"startDate","hash":{}}):i))+"</div>\r\n            </div>\r\n"},"12":function(){return'    <div class="wfstatus-donut-chart"></div>\r\n'},"14":function(e,t){var i;return'    <div class="tile-footer">\r\n      <div id="cs-more" class="tile-expand" title='+this.escapeExpression((i=null!=(i=t.expandLabel||(null!=e?e.expandLabel:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"expandLabel","hash":{}}):i))+' role="button" tabindex="0">\r\n        <div class="icon circular icon-tileExpand"></div>\r\n      </div>\r\n    </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,s){var n,o;return'<div class="tile-header" tabindex="0">\r\n  <div class="tile-type-icon">\r\n    <span class="icon title-icon mime_workflow_status" aria-hidden="true"></span>\r\n  </div>\r\n  <div class="tile-title">\r\n    <h2 class="csui-heading">'+this.escapeExpression((o=null!=(o=t.dialogTitle||(null!=e?e.dialogTitle:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"dialogTitle","hash":{}}):o))+'</h2>\r\n  </div>\r\n</div>\r\n\r\n<div class="tile-content">\r\n<div class="wfstatus-scrolling">\r\n  <div class="cs-emptylist-placeholder"></div>\r\n'+(null!=(n=t["if"].call(e,null!=e?e.emptyTextRequired:e,{"name":"if","hash":{},"fn":this.program(1,s,0),"inverse":this.noop}))?n:"")+"\r\n"+(null!=(n=t["if"].call(e,null!=e?e.isSingleStatus:e,{"name":"if","hash":{},"fn":this.program(3,s,0),"inverse":this.noop}))?n:"")+(null!=(n=t["if"].call(e,null!=e?e.donutChart:e,{"name":"if","hash":{},"fn":this.program(12,s,0),"inverse":this.noop}))?n:"")+"\r\n\r\n"+(null!=(n=t["if"].call(e,null!=e?e.showExpand:e,{"name":"if","hash":{},"fn":this.program(14,s,0),"inverse":this.noop}))?n:"")+"</div></div>"}});return i.registerPartial("workflow_widgets_wfstatus_impl_wfstatus",s),s}),csui.define("workflow/widgets/wfstatus/wfstatus.view",["csui/lib/marionette","csui/lib/backbone","csui/lib/underscore","csui/lib/jquery","csui/utils/contexts/factories/connector","csui/behaviors/expanding/expanding.behavior","csui/controls/tile/behaviors/perfect.scrolling.behavior","workflow/models/wfstatus/wfstatus.collection.factory","workflow/models/wfstatus/wfstatus.model.factory","workflow/controls/visualdata/visual.data.donut.view","workflow/widgets/wfstatus/impl/wfstatus.extended.view","workflow/utils/workitem.util","hbs!workflow/widgets/wfstatus/impl/wfstatus","i18n!workflow/widgets/wfstatus/impl/nls/lang","css!workflow/widgets/wfstatus/impl/wfstatus"],function(e,t,i,s,n,o,a,r,l,c,d,u,h,m){var p=e.LayoutView.extend({"className":"cs-list tile content-tile csui-acc-tab-region wf-wfstatus","widgetTitle":m.dialogTitle,"template":h,"regions":{"donut":".wfstatus-donut-chart"},"templateHelpers":function(){var e=this.model.get("count"),t=1===e?!0:!1;if(t){var i,s=this.model.get("data"),n=s.status,o=s.dateinitiated?u.dateConversion(s.dateinitiated):"",a=s.duedate?u.dateConversion(s.duedate):"",r=s.assignee,l="",c={};c.assignees=r,c.assignedto=s.assignedto,l=u.getAssignee(c),n===u.constants.WFSTATUS_ONTIME?i=m.onTime:n===u.constants.WFSTATUS_COMPLETED?i=m.completed:n===u.constants.WFSTATUS_LATE&&(i=m.late)}return{"dialogTitle":this.widgetTitle,"totalMsg":m.totalMsg,"emptyListText":m.emptyListText,"expandLabel":m.expandLabel,"dueDateLabel":m.dueDateLabel,"currentStepNameLabel":m.currentStepNameLabel,"assignedToLabel":m.assignedToLabel,"startDateLabel":m.startDateLabel,"emptyTextRequired":0===e?!0:!1,"isSingleStatus":t,"statusInfo":i,"donutChart":e>1?!0:!1,"showExpand":e>0?!0:!1,"model":this.model.toJSON(),"startDate":o,"dueDate":a,"wfNameLabel":m.wfNameLabel,"assignee":l}},"behaviors":{"ScrollingInstructions":{"behaviorClass":a,"contentParent":".wfstatus-scrolling","suppressScrollX":!0,"scrollYMarginOffset":16},"ExpandableList":{"behaviorClass":o,"expandedView":d,"orderBy":"status_key desc","actionTitleBarIcon":"icon-toolbarFilter","dialogTitle":function(){return this.widgetTitle},"dialogTitleIconRight":"icon-tileCollapse","dialogClassName":"wfstatus"}},"constructor":function(t){t.unique=i.uniqueId(),t.data.unique=i.uniqueId(),t.data.selectionType=100,t.model=t.context.getModel(l,t.data),t.model.get("widgetTitle")&&i.str.trim(t.model.get("widgetTitle")).length>0&&(this.widgetTitle=t.model.get("widgetTitle")),e.LayoutView.prototype.constructor.call(this,t),this.listenTo(this.model,"change",this.onModelChange),this.listenTo(this,"click:segment",this.getExpandStatusList),t=t.data?i.extend(t,t.data):t,delete t.data,t.detached=!0,t.unique=i.uniqueId();var s=this.options.context.getCollection(r,t);this.completeCollection=s,t.detached=!0,t.internal=!1},"events":{"click #cs-more,.tile-expand,.pie-total-container,.tile-header":"getExpandStatusList"},"getExpandStatusList":function(e){if(this.model.get("count")>0){var t=[];if(e.data){var i="late"===e.data.status?"workflowlate":e.data.status;t.push(i)}this.completeCollection.model=this.model,this.completeCollection.options.retention=this.model.get("retention"),this.completeCollection.options.selectionType=this.model.get("selectionType"),this.completeCollection.options.wfstatusfilter=this.model.get("wfstatusfilter"),this.completeCollection.options.status=t,this.completeCollection.options.chatSettings=this.model.get("chatSettings");var s=this.model.get("filterWorkflowtype");s||(s=u.getWorkflowtype(this.model.get("filterWorkflows"))),this.completeCollection.options.filterWorkflowtype=s,e.preventDefault(),e.stopPropagation(),this.triggerMethod("expand")}},"isSearchOpen":function(){return!1},"onModelChange":function(){this.render()},"onKeyDown":function(e){var t=e.keyCode,i=s(e.target),n=!0;return 13===t&&(i.hasClass("tile-header")||i.hasClass("tile-expand"))&&(e.preventDefault(),e.stopPropagation(),this.getExpandStatusList(e),n=!1),n},"onRender":function(){if(this.$el.on("keydown",i.bind(this.onKeyDown,this)),this._isRendered&&this._isShown&&this.model.get("count")>0&&(this.collection=new t.Collection(this.model.get("data")),this.model.get("count")>1))var e=this,n=setInterval(function(){if(s(".wf-wfstatus").length>0){var t={};t.dataset=e.model.get("data");var i={};i.ontime=m.onTime,i.late=m.late,i.completed=m.completed,t.statusArray=i,t.parent=e;var o=new c(t);e.donut.show(o),clearInterval(n)}},500)},"onDestroy":function(){s(".wfstatus-progress-view-dialog-back").click()}});return p}),csui.define("workflow/widgets/wfmonitor/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/wfmonitor/impl/nls/root/lang",{"dialogTitle":"Workflow Monitoring"}),csui.define("workflow/widgets/wfmonitor/wfmonitor.view",["workflow/widgets/wfstatus/wfstatus.view","i18n!workflow/widgets/wfmonitor/impl/nls/root/lang"],function(e,t){var i=e.extend({"widgetTitle":t.dialogTitle,"constructor":function(t){e.prototype.constructor.call(this,t)}});return i}),csui.define("workflow/controls/table/cells/status.cell",["csui/lib/jquery","csui/controls/table/cells/cell/cell.view","csui/controls/table/cells/cell.registry","workflow/utils/workitem.util","i18n!workflow/widgets/wfstatus/impl/nls/lang"],function(e,t,i,s){var n=t.extend({"renderValue":function(){var e=s.formatStatus({"dueDate":this.model.get("due_date"),"status":this.model.get("status_key")});this.$el.html('<div class="wfstatus-status"><span class="wfstatus-status-icon-col '+e.styleclass+'"></span><span class="wfstatus-status-col-value">'+e.status+"</span></div>")}});return i.registerByColumnKey("status_key",n),n}),csui.define("workflow/controls/table/cells/date.cell",["csui/controls/table/cells/cell/cell.view","csui/controls/table/cells/cell.registry","workflow/utils/workitem.util"],function(e,t,i){var s=e.extend({"renderValue":function(){var e=this.getValueText(),t=e?i.dateConversion(e):"";this.$el.text(t)}});return t.registerByColumnKey("due_date",s),t.registerByColumnKey("date_initiated",s),s}),csui.define("hbs!workflow/controls/table/cells/impl/assignee",["module","hbs","csui/lib/handlebars"],function(e,t,i){var s=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t){var i;return'<span class="wfstatus-assigneeName">'+this.escapeExpression((i=null!=(i=t.formattedValue||(null!=e?e.formattedValue:e))?i:t.helperMissing,"function"==typeof i?i.call(e,{"name":"formattedValue","hash":{}}):i))+"</span>\r\n"
}});return i.registerPartial("workflow_controls_table_cells_impl_assignee",s),s}),csui.define("workflow/controls/table/cells/assignee.cell",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/table/cells/cell.registry","csui/controls/table/cells/templated/templated.view","workflow/controls/usercards/usercards.list.view","workflow/models/wfstatus/usercard.model","workflow/utils/workitem.util","hbs!workflow/controls/table/cells/impl/assignee"],function(e,t,i,s,n,o,a,r,l,c){var d=o.extend({"template":c,"renderValue":function(){var e=this.getValueData(),t=e?this.template(e):"";this.$el.html(t)},"getValueData":function(){var e=this.model,t=this.options.column,i=t.name,s=e.get(i);return null==s&&(s=""),s=s.toString(),{"formattedValue":s}}});return n.registerByColumnKey("assignee",d),d}),csui.define("workflow/perspective/context/plugins/workflow.perspective.context.plugin",["csui/lib/underscore","csui/lib/backbone","csui/utils/contexts/factories/application.scope.factory","workflow/models/workitem/workitem.model.factory","csui/utils/contexts/perspective/perspective.context.plugin"],function(e,t,i,s,n){var o=n.extend({"constructor":function(){n.prototype.constructor.apply(this,arguments),this.applicationScope=this.context.getModel(i),this.workItem=this.context.getModel(s,{"permanent":!0}).on("change:process_id",this._fetchWorkflowPerspective,this).on("change:doc_id",this._fetchWorkflowPerspective,this)},"_fetchWorkflowPerspective":function(){var e=this.workItem.get("process_id"),t=this.workItem.get("doc_id");if(!(e&&t||!e&&!t&&"workflow"!==this.applicationScope.id||this.loadingPerspective)){this.applicationScope.set("id","workflow");var i="json!workflow/perspective/context/plugins/impl/perspectives/",s="workflow.json";this.context.loadPerspective(i+s)}}});return o}),csui.define("json!workflow/perspective/context/plugins/impl/perspectives/workflow.json",{"type":"grid","options":{"rows":[{"columns":[{"sizes":{"md":12},"heights":{"xs":"full"},"widget":{"type":"workflow/widgets/workitem/workitem","options":{}}}]}]}}),csui.define("json!workflow/widgets/wfstatus/wfstatus.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{title}}","description":"{{description}}","kind":"tile","schema":{"type":"object","required":!1,"properties":{"widgetTitle":{"title":"{{workflowtrackingwidgetTitle}}","description":"{{workflowtrackingwidgetTitleDescription}}","readonly":!1,"required":!0,"default":"{{title}}","type":"string"},"retention":{"title":"{{displayCompletedWorkflows}}","description":"{{displayCompletedWorkflowsDescription}}","readonly":!1,"required":!1,"default":30,"type":"integer"},"filterWorkflowtype":{"title":"{{workflowTypeTitle}}","description":"{{workflowTypeDescription}}","type":"string","enum":["Managed","Initiated","Both"],"default":"Both"}}},"options":{"fields":{"widgetTitle":{"type":"text"},"retention":{"type":"number"},"filterWorkflowtype":{"type":"select","optionLabels":["{{workflowTypeManaged}}","{{workflowTypeInitiated}}","{{workflowTypeBoth}}"]}}}}),csui.define("json!workflow/widgets/wfmonitor/wfmonitor.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{title}}","description":"{{description}}","kind":"tile","schema":{"type":"object","required":!1,"properties":{"widgetTitle":{"title":"{{workflowmonitorwidgetTitle}}","description":"{{workflowmonitorwidgetTitleDescription}}","readonly":!1,"required":!0,"default":"{{title}}","type":"string"},"wfstatusfilter":{"title":"{{workflowStatusTitle}}","description":"{{workflowStatusDescription}}","required":!0,"type":"integer"}}},"options":{"fields":{"widgetTitle":{"type":"text"},"wfstatusfilter":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[190]}}}}}}),csui.define("workflow/widgets/wfstatus/impl/nls/wfstatus.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/wfstatus/impl/nls/root/wfstatus.manifest",{"title":"Workflow Tracking","description":"Shows the status of workflows for the current user.","displayCompletedWorkflows":"Days Completed Workflows Display","displayCompletedWorkflowsDescription":"Number of days completed workflows display","workflowTypeTitle":"Workflow Type","workflowTypeDescription":"Select the Workflow Types to display","workflowTypeBoth":"Both","workflowTypeInitiated":"Initiated","workflowTypeManaged":"Managed","workflowStatusTitle":"Workflow Status","workflowStatusDescription":"Workflow Status Selection","workflowtrackingwidgetTitle":"Title","workflowtrackingwidgetTitleDescription":"Workflow Tracking Widget Title"}),csui.define("workflow/widgets/wfmonitor/impl/nls/wfmonitor.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("workflow/widgets/wfmonitor/impl/nls/root/wfmonitor.manifest",{"title":"Workflow Monitoring","description":"Shows the status of workflows selected via a filter (which is configured in Classic UI).","workflowStatusTitle":"Workflow Status Filter","workflowStatusDescription":"Expression created in Classic UI to showcase the status of specific Workflows","workflowmonitorwidgetTitle":"Title","workflowmonitorwidgetTitleDescription":"Workflow Monitoring Widget Title"}),csui.define("bundles/workflow-all",["workflow/toolbars/workflow.nodestable.toolbaritems","workflow/widgets/workitem/workitem/workitem.view","workflow/widgets/wfstatus/wfstatus.view","workflow/widgets/wfmonitor/wfmonitor.view","workflow/controls/table/cells/status.cell","workflow/controls/table/cells/date.cell","workflow/controls/table/cells/assignee.cell","workflow/perspective/context/plugins/workflow.perspective.context.plugin","json!workflow/perspective/context/plugins/impl/perspectives/workflow.json","workflow/utils/workitem.extension.controller","json!workflow/widgets/wfstatus/wfstatus.manifest.json","json!workflow/widgets/wfmonitor/wfmonitor.manifest.json","i18n!workflow/widgets/wfstatus/impl/nls/wfstatus.manifest","i18n!workflow/widgets/wfmonitor/impl/nls/wfmonitor.manifest"],{}),csui.require(["require","css"],function(e,t){t.styleLoad(e,"workflow/bundles/workflow-all",!0)});
//# sourceMappingURL=workflow-all.js.map