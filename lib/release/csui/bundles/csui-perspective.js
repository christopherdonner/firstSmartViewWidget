csui.define("csui/perspective.manage/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/impl/nls/root/lang",{"layoutTabTitle":"Change page layout","widgetTabTitle":"Add widget","expandTab":"Expand tab","collapseTab":"Collapse tab","noTitle":"Title not available","goBackTooltip":"Go back","templateMessage":"Drag and Drop tile in position","changePageLayoutConfirmatonText":"All your previewsly added and configured widgets will be lost!","proceedButton":"Proceed","changeLayoutCancelButton":"Cancel","FlowLayoutTitle":"Flow Layout","LcrLayoutTitle":"Left-Center-Right","perspectiveSaveSuccess":"Perspective has been updated successfully.","saveConfirmMsg":"Please be aware this action will update all perspective overrides using this layout configuration. If you do not want this to happen, you should create a new perspective.","saveConfirmTitle":"Save perspective","addWidget":"Add Widget","save":"Save","close":"Close","cancel":"Cancel"}),csui.define("hbs!csui/perspective.manage/impl/widget.item",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="csui-module-item" title="'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</div>"}});return t.registerPartial("csui_perspective.manage_impl_widget.item",s),s}),csui.define("csui/perspective.manage/impl/widget.list.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/tile/behaviors/perfect.scrolling.behavior","i18n!csui/perspective.manage/impl/nls/root/lang","csui/models/widget/widget.collection","hbs!csui/perspective.manage/impl/widget.item"],function(e,i,t,s,n,a,r,o,c,l){"use strict";var p=e.config();i.defaults(p,{});var d=n.ItemView.extend({"constructor":function(e){n.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","template":l,"events":{"click":"onClickItem"},"onClickItem":function(){var e=new s.Collection(this.model.attributes.widgets);this.options.parentView.trigger("item:clicked",{"data":{"items":e.models,"draggable":!0}})}});return n.ItemView.extend({"tagName":"div","template":l,"constructor":function(e){e||(e={}),e.data||(e.data={}),this.behaviors&&i.any(this.behaviors,function(e,i){return e.behaviorClass===r})||(this.behaviors=i.extend({"PerfectScrolling":{"behaviorClass":r,"contentParent":".cs-module-list","suppressScrollX":!0,"scrollYMarginOffset":15}},this.behaviors)),n.ItemView.call(this,e);var t=this;this.allWidgets=new c,this.allWidgets.fetch().done(function(){t.collection=t._groupWidgetsByModule(),t.render(),t.trigger("items:fetched")})},"initialize":function(){i.bindAll(this,"renderItem")},"className":"cs-module-list","render":function(){this.collection&&this.collection.each(this.renderItem)},"renderItem":function(e){var i=this,s=new d({"model":e,"parentView":i});s.render(),t(this.el).append(s.el)},"_groupWidgetsByModule":function(){var e=new s.Collection;return i.each(this.allWidgets.models,function(e){e.set("title",e.attributes.manifest?e.attributes.manifest.title:o.noTitle)}),i.each(i.groupBy(this.allWidgets.models,function(e){return e.serverModule.id}),function(t,s){var n=i.first(t).serverModule.attributes.title;n=n?n.replace(/OpenText /,""):o.noTitle,e.add({"id":s,"title":n,"widgets":t})}),e},"_sanitiseWidgetLibrary":function(){}})}),csui.define("hbs!csui/perspective.manage/impl/accordion",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="csui-accordion-header csui-accordion-expand" title="'+this.escapeExpression(this.lambda(null!=e?e.widgetTabTitle:e,e))+'">\r\n  '+this.escapeExpression(this.lambda(null!=e?e.widgetTabTitle:e,e))+'\r\n  <div class="csui-button-icon cs-icon icon-expandArrowDown" title="'+this.escapeExpression(this.lambda(null!=e?e.expandTab:e,e))+'"></div>\r\n  <div class="csui-button-icon cs-icon icon-expandArrowUp" title="'+this.escapeExpression(this.lambda(null!=e?e.collapseTab:e,e))+'"></div>\r\n</div>\r\n<div class="csui-accordion-content"></div>'}});return t.registerPartial("csui_perspective.manage_impl_accordion",s),s}),csui.define("csui/perspective.manage/impl/accordion.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/perspective.manage/impl/widget.list.view","i18n!csui/perspective.manage/impl/nls/root/lang","hbs!csui/perspective.manage/impl/accordion"],function(e,i,t,s,n,a,r,o){"use strict";return s.ItemView.extend({"tagName":"div","className":"csui-accordion","template":o,"ui":{"accordionHeader":".csui-accordion-header","accordionContent":".csui-accordion-content","accordionHeaderIcon":".csui-accordion-header .cs-icon"},"events":{"click @ui.accordionHeader":"toggle"},"templateHelpers":function(){return{"widgetTabTitle":r.widgetTabTitle,"expandTab":r.expandTab,"collapseTab":r.collapseTab}},"constructor":function(e){s.ItemView.prototype.constructor.call(this,e)},"onRender":function(){this.widgetListRegion=new s.Region({"el":this.ui.accordionContent}),this.widgetListView=new a,this.widgetListRegion.show(this.widgetListView),this.listenTo(this.widgetListView,"item:clicked",function(e){this.trigger("item:clicked",e)}).listenTo(this.widgetListView,"items:fetched",function(){this.trigger("items:fetched")})},"toggle":function(){this.showAccordion=!this.showAccordion,this.ui.accordionHeader.toggleClass("csui-accordion-expand"),this.ui.accordionContent.toggle()}})}),csui.define("csui/perspective.manage/impl/perspectivelayouts",["csui/lib/underscore","i18n!csui/perspective.manage/impl/nls/root/lang","csui-ext!perspective.manage/impl/perspectivelayouts"],function(e,i,t){var s=[{"title":i.LcrLayoutTitle,"type":"left-center-right","icon":"csui-layout-lcr"},{"title":i.FlowLayoutTitle,"type":"flow","icon":"csui-layout-flow"}];return t&&(s=e.union(s,t)),s}),csui.define("hbs!csui/perspective.manage/impl/pman.panel",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="csui-tab-pannel">\r\n  <div class="csui-layout-tab" title="'+this.escapeExpression(this.lambda(null!=e?e.layoutTabTitle:e,e))+'">\r\n    '+this.escapeExpression(this.lambda(null!=e?e.layoutTabTitle:e,e))+'\r\n  </div>\r\n  <div class="csui-widget-tab"></div>\r\n</div>\r\n<div class="csui-list-pannel"></div>\r\n<div class="csui-template-wrapper">\r\n  <div class="csui-widget-template">\r\n    <div class="csui-template-header"></div>\r\n    <div class="csui-template-body">'+this.escapeExpression(this.lambda(null!=e?e.templateMessage:e,e))+"</div>\r\n  </div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_impl_pman.panel",s),s}),csui.define("hbs!csui/perspective.manage/impl/list.item",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="'+this.escapeExpression(this.lambda(null!=e?e.className:e,e))+'" title="'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'"\r\n     draggable='+this.escapeExpression(this.lambda(null!=e?e.draggable:e,e))+">\r\n  <span>"+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'</span>\r\n  <div class="csui-layout-icon '+this.escapeExpression(this.lambda(null!=e?e.iconClass:e,e))+'"></div>\r\n</div>'}});return t.registerPartial("csui_perspective.manage_impl_list.item",s),s}),csui.define("hbs!csui/perspective.manage/impl/list",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="cs-header binf-panel-heading cs-header-with-go-back" tabindex="0" role="link"\r\n     aria-label="'+this.escapeExpression((n=null!=(n=i.goBackAria||(null!=e?e.goBackAria:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"goBackAria","hash":{}}):n))+'">\r\n  <span class="icon circular arrow_back cs-go-back" title="'+this.escapeExpression((n=null!=(n=i.goBackTooltip||(null!=e?e.goBackTooltip:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"goBackTooltip","hash":{}}):n))+'"></span>\r\n</div>\r\n<div class="cs-content">\r\n  <div class="cs-list-group"></div>\r\n</div>\r\n'}});return t.registerPartial("csui_perspective.manage_impl_list",s),s}),csui.define("hbs!csui/perspective.manage/impl/widget.drag.template",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="csui-widget-template">\r\n  <div class="csui-template-header">'+this.escapeExpression(this.lambda(null!=e?e.header:e,e))+'</div>\r\n  <div class="csui-template-body">'+this.escapeExpression(this.lambda(null!=e?e.body:e,e))+"</div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_impl_widget.drag.template",s),s}),csui.define("css!csui/perspective.manage/impl/pman.panel",[],function(){}),csui.define("csui/perspective.manage/impl/pman.panel.view",["require","module","csui/lib/jquery","csui/lib/backbone","csui/lib/underscore","csui/lib/marionette","csui/controls/progressblocker/blocker","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/perspective.manage/impl/accordion.view","csui/perspective.manage/impl/perspectivelayouts","i18n!csui/perspective.manage/impl/nls/root/lang","hbs!csui/perspective.manage/impl/pman.panel","hbs!csui/perspective.manage/impl/list.item","hbs!csui/perspective.manage/impl/list","hbs!csui/perspective.manage/impl/widget.drag.template","css!csui/perspective.manage/impl/pman.panel"],function(e,i,t,s,n,a,r,o,c,l,p,d,u,g,m){"use strict";var h=a.ItemView.extend({"tagName":"div","template":d,"events":{"click @ui.layoutTab":"onTabClicked"},"ui":{"tabPannel":".csui-tab-pannel","listPannel":".csui-list-pannel","layoutTab":".csui-layout-tab","widgetTab":".csui-widget-tab","template":".csui-widget-template"},"className":"csui-pman-panel","templateHelpers":function(){return{"layoutTabTitle":p.layoutTabTitle,"templateMessage":p.templateMessage}},"onRender":function(){this.ui.widgetTab.hide(),this.ui.layoutTab.hide(),this.accordionRegion=new a.Region({"el":this.ui.widgetTab}),this.accordionView=new c,this.accordionRegion.show(this.accordionView),this.blockActions(),this.listenTo(this.accordionView,"item:clicked",this.onTabClicked).listenTo(this.accordionView,"items:fetched",function(){this.unblockActions(),this.ui.layoutTab.show(),this.ui.widgetTab.show()})},"constructor":function(e){this.options=e||{},a.ItemView.prototype.constructor.apply(this,arguments),r.imbue(this),this.listenTo(this,"reset:items",function(){this.listView&&this.listView.destroy()})},"onTabClicked":function(e){var i=e.data?e:{"data":{"items":l}};i.draggable=!!i.data.draggable,i.itemClassName=i.data.draggable?"csui-widget-item icon-draggable-handle":"csui-layout-item",i.pmanView=this.options.pmanView,this.ui.tabPannel.addClass("binf-hidden"),this.listregion=new a.Region({"el":this.ui.listPannel}),this.listView=new f(i),this.listregion.show(this.listView),this.listenTo(this.listView,"before:destroy",function(){this.ui.tabPannel.removeClass("binf-hidden")}).listenTo(this.listView,"click:back",function(){this.listView.destroy()})}}),v=a.ItemView.extend({"constructor":function(e){a.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","template":u,"templateHelpers":function(){return{"draggable":!!this.options.draggable,"className":this.options.itemClassName,"iconClass":this.model.get("icon")}},"ui":{"widget":".csui-widget-item"},"events":{"dragstart @ui.widget":"onDragStart","dragend @ui.widget":"onDragEnd"},"triggers":{"click .csui-layout-item:not(.binf-active)":"change:layout"},"onRender":function(){this.model.get("type")===this.options.pmanView.perspective.get("perspective").type&&this.trigger("set:active"),t(".perspective-editing .csui-dnd-container").length&&this._makeWidgetSortable()},"_makeWidgetSortable":function(){var e=this;this.$el.data("pman.widget",this.model),this.$el.sortable({"connectWith":".perspective-editing .csui-dnd-container","containment":".perspective-editing .csui-dnd-container","helper":function(i,t){return e.widgetDragTemplate=new w({"title":e.model.attributes.title,"newWidget":e.model}),e.widgetDragTemplate.render(),e.widgetDragTemplate.$el.width("250px"),e.widgetDragTemplate.$el.height("250px"),e.widgetDragTemplate.$el.css({"opacity":.75}),e.widgetDragTemplate.$el.appendTo(e.options.pmanView.$el.find(".pman-header")),e.widgetDragTemplate.$el},"cursor":"grabbing","tolerance":"pointer","cursorAt":{"top":50,"left":50},"start":function(e,i){i.item.css("display","block"),i.placeholder.css("display","none")},"over":function(e,i){i.placeholder.css("display","none")},"out":function(i,t){t.placeholder.css("display","block"),e.dragStart()},"stop":function(){e.dragEnd()}})},"onDragStart":function(e){e.originalEvent.dataTransfer.setData("text",JSON.stringify(this.model.toJSON()));var i=t(".csui-template-wrapper");i.find(".csui-template-header").text(this.model.attributes.title),e.originalEvent.dataTransfer.setDragImage&&e.originalEvent.dataTransfer.setDragImage(i[0],50,50),this.dragStart()},"onDragEnd":function(e){this.dragEnd()},"dragStart":function(){this.options.pmanView.$el.find(".csui-pman-panel").addClass("csui-pman-drag-start")},"dragEnd":function(){this.options.pmanView.$el.find(".csui-pman-panel").removeClass("csui-pman-drag-start")}}),f=a.CompositeView.extend({"constructor":function(e){if(e||(e={}),e.data||(e.data={}),this.behaviors&&n.any(this.behaviors,function(e,i){return e.behaviorClass===o})||(this.behaviors=n.extend({"PerfectScrolling":{"behaviorClass":o,"contentParent":".csui-pman-list","suppressScrollX":!0,"scrollYMarginOffset":15}},this.behaviors)),a.CompositeView.call(this,e),this.options.data&&this.options.data.items){if(!this.collection){var i=s.Collection.extend({"model":s.Model.extend({"idAttribute":null})});this.collection=new i}this.collection.add(this.options.data.items)}},"ui":{"back":".cs-go-back"},"className":"csui-pman-list","events":{"click @ui.back":"onClickBack"},"childEvents":{"change:layout":"onChangeLayout","set:active":"setActive"},"template":g,"templateHelpers":function(){return{"goBackTooltip":p.goBackTooltip}},"childViewContainer":".cs-list-group","childView":v,"childViewOptions":function(){return this.options},"onClickBack":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("click:back")},"setActive":function(e){this.$el.find(".csui-layout-item").removeClass("binf-active"),e.$el.find(".csui-layout-item").addClass("binf-active")},"onChangeLayout":function(e){var i=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(t){t.confirmWarning(p.changePageLayoutConfirmatonText,p.layoutTabTitle,{"buttons":{"showYes":!0,"labelYes":p.proceedButton,"showNo":!0,"labelNo":p.changeLayoutCancelButton}}).done(function(t){t&&(i.setActive(e),i.options.pmanView.trigger("change:layout",e.model.get("type")))})})}}),w=a.ItemView.extend({"constructor":function(e){a.ItemView.prototype.constructor.apply(this,arguments)},"tagName":"div","className":"csui-template-wrapper","template":m,"templateHelpers":function(){return{"header":this.options&&this.options.title,"body":p.templateMessage}},"onRender":function(){this.$el.data("pman.widget",this.options.newWidget)}});return h}),csui.define("hbs!csui/perspective.manage/impl/pman",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="pman-backdrop"></div>\r\n<div class="pman-header">\r\n  <div class="pman-header-backdrop"></div>\r\n  <div class="pman-tools-container">\r\n    <div class="pman-left-tools">\r\n      <ul>\r\n        <li class="pman-toolitem">\r\n          <button class="icon icon-toolbarAdd" title="'+this.escapeExpression(this.lambda(null!=e?e.addWidget:e,e))+'"></button>\r\n        </li>\r\n      </ul>\r\n      <div class="pman-pannel-wrapper"></div>\r\n    </div>\r\n    <div class="pman-right-tools">\r\n      <ul>\r\n        <li class="pman-toolitem">\r\n          <button class="icon icon-save" title="'+this.escapeExpression(this.lambda(null!=e?e.save:e,e))+'" disabled></span>\r\n        </li>\r\n        <li class="pman-toolitem">\r\n          <button class="icon cancel-edit" title="'+this.escapeExpression(this.lambda(null!=e?e.cancel:e,e))+'"></button>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</div>'}});return t.registerPartial("csui_perspective.manage_impl_pman",s),s}),csui.define("css!csui/perspective.manage/impl/pman",[],function(){}),csui.define("hbs!csui/perspective.manage/impl/options.form.wrapper",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="csui-pman-form-header">\r\n    <div class="csui-pman-form-title">'+this.escapeExpression((n=null!=(n=i.title||(null!=e?e.title:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"title","hash":{}}):n))+'</div>\r\n    <div class="csui-pman-form-description">'+this.escapeExpression((n=null!=(n=i.description||(null!=e?e.description:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"description","hash":{}}):n))+'</div>\r\n</div>\r\n<div class="csui-pman-form-content"></div>'}});return t.registerPartial("csui_perspective.manage_impl_options.form.wrapper",s),s}),csui.define("css!csui/perspective.manage/impl/options.form",[],function(){}),csui.define("csui/perspective.manage/impl/options.form.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/controls/form/form.view","hbs!csui/perspective.manage/impl/options.form.wrapper","i18n!csui/perspective.manage/impl/nls/lang","css!csui/perspective.manage/impl/options.form"],function(e,i,t,s,n,a,r,o,c){var l=s.LayoutView.extend({"template":o,"className":"csui-pman-form-wrapper","regions":{"bodyRegion":".csui-pman-form-content"},"templateHelpers":function(){return{"title":this.options.manifest.title,"description":this.options.manifest.description}},"constructor":function(e){this.options=e||{},this.manifest=this.options.manifest,s.LayoutView.prototype.constructor.apply(this,arguments)},"_createForm":function(){this.widgetOptionsFormView=new p({"context":this.options.context,"model":this._prepareFormModel(),"mode":"create"}),this.listenToOnce(this.widgetOptionsFormView,"render:form",function(){this.trigger("render:form")}.bind(this)),this.listenTo(this.widgetOptionsFormView,"change:field",function(e){this.trigger("change:field",e)}.bind(this))},"_hasSchema":function(){return!(!(this.manifest&&this.manifest.schema&&this.manifest.schema.properties)||e.isEmpty(this.manifest.schema.properties))},"onRender":function(){this._hasSchema()?(this._createForm(),this.bodyRegion.show(this.widgetOptionsFormView)):this.trigger("render:form")},"getValues":function(){if(this._hasSchema())return this.widgetOptionsFormView.getValues()},"validate":function(){return!this._hasSchema()||this.widgetOptionsFormView.validate()},"_isPreviewWidget":function(){return"csui/perspective.manage/widgets/perspective.widget"===this.options.widgetConfig.type},"_prepareFormModel":function(){var e=this.options.widgetConfig.options||{};this._isPreviewWidget()&&(e=e.options||{});var i=JSON.parse(JSON.stringify(this.manifest.schema)),s=JSON.parse(JSON.stringify(this.manifest.options||{}));return this._addWidgetSizePropertyIfSupported(i,s,e),new t.Model({"schema":i,"options":s,"data":e})},"_addWidgetSizePropertyIfSupported":function(i,t,s){if(this.options.perspectiveView.getSupportedWidgetSizes){var n=this.options.perspectiveView.getSupportedWidgetSizes(this.manifest,this.options.widgetView);if(n&&0!==n.length){var a={"title":c.widgetSizeTitle,"description":c.widgetSizeDescription,"type":"string","enum":e.map(n,function(e){return e.kind})},r={"type":"select","optionLabels":e.map(n,function(e){return e.label}),"removeDefaultNone":!0},o=e.find(n,function(e){return e.selected});o&&(s[l.widgetSizeProperty]=o.kind);var p={};p[l.widgetSizeProperty]=a,i.properties=e.extend(p,i.properties);var d={};d[l.widgetSizeProperty]=r,t.fields=e.extend(d,t.fields),i.required=i.required||[],i.required.push(l.widgetSizeProperty)}}}},{"widgetSizeProperty":"__widgetSize"}),p=r.extend({"className":function(){return r.prototype.className.call(this)+" perspective-widget-form"},"constructor":function(e){r.apply(this,arguments)},"_modifyModel":function(){this._normalizeSchemaToFormView(),r.prototype._modifyModel.apply(this,arguments)},"_normalizeSchemaToFormView":function(){this.alpaca.options||(this.alpaca.options={}),this.alpaca.options.fields||(this.alpaca.options.fields={}),this._normalizeOptions(this.alpaca.schema.properties,this.alpaca.options.fields,this.alpaca.data)},"_normalizeOptions":function(i,t,s){var n=this;e.each(i,function(i,a){var r=t[a],o=s[a];switch(r||(t[a]=r={}),i.type){case"array":r.fields||e.defaults(r,{"fields":{"item":{}}}),r.items&&(r.fields.item=r.items),"object"===i.items.type&&(r.fields.item.fields||(r.fields.item.fields={}),o||(s[a]=o=[{}]),n._normalizeOptions(i.items.properties,r.fields.item.fields,o[0])),o||(s[a]=[null]);break;case"object":o||(s[a]=o={}),r.fields||(r.fields={},n._normalizeOptions(i.properties,r.fields,o));break;default:o||(s[a]=null)}})}});return e.extend(p.prototype,n),l}),csui.define("csui/perspective.manage/behaviours/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/behaviours/impl/nls/root/lang",{"deleteConfirmMsg":"Are you sure, you want to remove widget?","deleteConfirmTitle":"Remove Widget","replaceConfirmMsg":"Are you sure, you want to replace widget?","replaceConfirmTitle":"Replace Widget","widgetSizeTitle":"Widget size","widgetSizeDescription":"Determines how much space the widget occupies. Note that widgets are re-sized automatically to display optimally on smaller screens."}),csui.define("hbs!csui/perspective.manage/behaviours/impl/widget.masking",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){return'<div class="csui-pman-widget-masking">\r\n  <div class="csui-pman-widget-close">\r\n    <div class="formfield_clear"></div>\r\n  </div>\r\n</div>\r\n<div class="csui-pman-popover-right csui-pman-popover-holder"></div>\r\n<div class="csui-pman-popover-left csui-pman-popover-holder"></div>'}});return t.registerPartial("csui_perspective.manage_behaviours_impl_widget.masking",s),s}),csui.define("css!csui/perspective.manage/behaviours/impl/widget.masking",[],function(){}),csui.define("csui/perspective.manage/behaviours/pman.widget.config.behaviour",["require","i18n","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/lib/backbone","csui/utils/log","csui/models/widget/widget.model","csui/perspective.manage/impl/options.form.view","i18n!csui/perspective.manage/behaviours/impl/nls/lang","hbs!csui/perspective.manage/behaviours/impl/widget.masking","css!csui/perspective.manage/behaviours/impl/widget.masking"],function(e,i,t,s,n,a,r,o,c,l,p){"use strict";var d=n.ItemView.extend({"template":p,"className":function(){return d.className},"ui":{"delete":".csui-pman-widget-close","masking":".csui-pman-widget-masking"},"events":{"click @ui.masking":"_showCallout","drop":"onDrop","dragover":"onDragOver","dragenter":"onDragEnter","dragleave":"onDragLeave","click @ui.delete":"onDeleteClick"},"constructor":function(e){n.ItemView.apply(this,arguments),this.dropCounter=0,this.manifest=void 0,this.perspectiveView=e.perspectiveView,this.widgetView=e.widgetView,this.widgetConfig=e.widgetConfig},"onRender":function(){var e=this;this._loadManifest().done(function(i){e._createOptionsForm(function(){e._updateWidgetOptions()})})},"_showCallout":function(){this.widgetConfig&&!t.isEmpty(this.widgetConfig)&&"csui/perspective.manage/widgets/perspective.placeholder"!==this.widgetConfig.type&&this._loadManifest().done(function(e){this._showOptionsCallout(e)}.bind(this))},"_showOptionsCallout":function(e){if(this._calculatePopoverPlacement(),this.$popoverEl.data("binf.popover"))return void this.$popoverEl.binf_popover("destroy");this.perspectiveView.$el.find("."+d.className+" .csui-pman-popover-holder").binf_popover("destroy"),this.optionsFormView?this._showPopover():this._createOptionsForm()},"_createOptionsForm":function(e){this.optionsFormView=new c(t.defaults({"context":this.perspectiveView.options.context,"manifest":this.manifest},this.options)),e&&this.optionsFormView.listenToOnce(this.optionsFormView,"render:form",e),this.optionsFormView.render(),this.optionsFormView.listenTo(this.optionsFormView,"change:field",this._onChangeField.bind(this))},"_calculatePopoverPlacement":function(){var e=this._determineCalloutPlacement(),t=i&&i.settings.rtl?"right"==e.placement?e.mirror?"right":"left":"right":"left"==e.placement&&e.mirror?"right":e.placement;this.$popoverEl=this.$el.find(".csui-pman-popover-"+t),this.placement=e.placement},"_showPopover":function(){var e={"html":!0,"content":this.optionsFormView.el,"trigger":"manual","viewport":{"selector":this.options.perspectiveSelector,"padding":15},"placement":this.placement};this.$popoverEl.binf_popover(e),this.$popoverEl.off("hidden.binf.popover").on("hidden.binf.popover",this._handleCalloutHide.bind(this)),this.$popoverEl.binf_popover("show"),this._registerPopoverEvents()},"_registerPopoverEvents":function(){s(".perspective-editing .cs-perspective-panel").on("click."+this.cid,{"view":this},this._documentClickHandler),s(".pman-container").on("click."+this.cid,{"view":this},this._documentClickHandler)},"_unregisterPopoverEvents":function(){s(".perspective-editing .cs-perspective-panel").off("click."+this.cid,this._documentClickHandler),s(".pman-container").off("click."+this.cid,this._documentClickHandler)},"_handleCalloutHide":function(){this._unregisterPopoverEvents(),this._updateWidgetOptions()},"_updateWidgetOptions":function(){var e=this.optionsFormView.validate(),i=this.optionsFormView.getValues();this.perspectiveView.trigger("update:widget:options",this.widgetView,e,i),e?this.widgetView.$el.removeClass("binf-has-error"):this.widgetView.$el.addClass("binf-has-error")},"_documentClickHandler":function(e){var i=e.data.view;s(e.target).closest(".binf-popover").length||i.$el.is(e.target)||i.$el.has(e.target).length||s.contains(document,e.target)&&(i._unregisterPopoverEvents(),i.$popoverEl.binf_popover("destroy"))},"_onChangeField":function(e){e.name===c.widgetSizeProperty&&(this.perspectiveView.trigger("update:widget:size",this.options.widgetView,e.value),this.$popoverEl.binf_popover("destroy"))},"_determineCalloutPlacement":function(){var e=this.$el.offset(),t=e.left,n=(s(document).outerWidth(),s(document).width()-(t+this.$el.width())),a=i&&i.settings.rtl,r=a?n<550?"left":"right":t<550?"right":"left",o=!1;return(a?n+this.$el.width()+500:this.$el.offset().left+this.$el.width()+500)>s(document).width()&&(!a&&"right"==r||a&&"left"==r)&&(r="right"==r?"left":"right",o=!0),{"placement":r,"mirror":o}},"_isPreviewWidget":function(){return this.widgetConfig.type===d.perspectiveWidget},"_loadManifest":function(){if(void 0!==this.manifest)return s.Deferred().resolve(this.manifest);if(this._isPreviewWidget())return this.manifest=this.widgetConfig.options.widget.get("manifest"),this._loadManifest();var e=s.Deferred(),i=this,t=new o({"id":this.widgetConfig.type});return t.fetch().then(function(){i.manifest=t.get("manifest"),e.resolve(i.manifest)},function(i){e.reject(i)}),e.promise()},"onDeleteClick":function(e){e.preventDefault(),e.stopPropagation();var i=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(e){e.confirmQuestion(l.deleteConfirmMsg,l.deleteConfirmTitle).done(function(e){e&&i._doDeleteWidget()})})},"_doDeleteWidget":function(){this.perspectiveView.trigger("delete:widget",this.widgetView)},"_doReplaceWidget":function(e){var i=e.get("manifest")||{};this.perspectiveView.trigger("replace:widget",this.widgetView,{"type":d.perspectiveWidget,"kind":i.kind,"options":{"options":{},"widget":e}})},"onDragOver":function(e){e.preventDefault()},"onDragEnter":function(e){e.preventDefault(),this.dropCounter++,this.$el.addClass("csui-widget-drop")},"onDragLeave":function(){0===--this.dropCounter&&this.$el.removeClass("csui-widget-drop")},"_extractWidgetToDrop":function(e){var i=e.originalEvent.dataTransfer.getData("text");if(i)try{return new o(JSON.parse(i))}catch(e){return!1}},"onDrop":function(e){this.onDragLeave();var i=this._extractWidgetToDrop(e);if(i)if(this.widgetConfig.type===d.placeholderWidget)this._doReplaceWidget(i);else{var t=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(e){e.confirmQuestion(l.replaceConfirmMsg,l.replaceConfirmTitle).done(function(e){e&&t._doReplaceWidget(i)})})}}},{"className":"csui-configure-perspective-widget","perspectiveWidget":"csui/perspective.manage/widgets/perspective.widget","placeholderWidget":"csui/perspective.manage/widgets/perspective.placeholder","widgetSizeProperty":"__widgetSize"});return n.Behavior.extend({"defaults":{"perspectiveSelector":".perspective-editing .cs-perspective > div"},"constructor":function(e,i){if(!e.perspectiveView)throw new n.Error({"name":"perspectiveView","message":"Undefined perspectiveView options"});this.perspectiveView=e.perspectiveView,n.Behavior.prototype.constructor.apply(this,arguments),this.view=i,t.extend(this.perspectiveView,{"getPManPlaceholderWidget":function(){return{"type":d.placeholderWidget,"options":{}}}})},"_ensureWidgetElement":function(){if(t.isObject(this.$widgetEl)||(this.$widgetEl=this.options.el?s(this.options.el):this.view.$el),!this.$widgetEl||0===this.$widgetEl.length)throw new n.Error('An "el" '+this.$widgetEl.selector+" must exist in DOM");return!0},"_checkAndApplyMask":function(){if(!(this.$el.find("."+d.className).length>0)){this._ensureWidgetElement();var e=this._resolveWidgetConfiguration(),i=new d(t.extend(this.options,{"widgetView":this.view,"widgetConfig":e}));i.render(),this.$widgetEl.append(i.el),this.$widgetEl.addClass("csui-pman-editable-widget"),this.$widgetEl.data("pman.widget",{"attributes":{"manifest":e}})}},"_resolveWidgetConfiguration":function(){return this.view.model&&this.view.model.get("widget")?this.view.model.get("widget"):this.view.getPManWidgetConfig&&t.isFunction(this.view.getPManWidgetConfig)?this.view.getPManWidgetConfig():this.options.widgetConfig?this.options.widgetConfig:void 0},"onRender":function(){this._checkAndApplyMask()},"onDestroy":function(){}})}),csui.define("csui/perspective.manage/pman.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/utils/non-emptying.region/non-emptying.region","csui/perspective.manage/impl/pman.panel.view","i18n!csui/perspective.manage/impl/nls/root/lang","hbs!csui/perspective.manage/impl/pman","css!csui/perspective.manage/impl/pman","csui/perspective.manage/behaviours/pman.widget.config.behaviour"],function(e,i,t,s,n,a,r,o,c){var l;return s.ItemView.extend({"className":"pman pman-container","template":c,"templateHelpers":function(){return{"addWidget":o.addWidget,"save":o.save,"cancel":o.cancel}},"ui":{"pmanPanel":".pman-header .pman-pannel-wrapper","cancelEdit":".pman-header .cancel-edit","addIcon":".pman-header .icon-toolbarAdd","saveBtn":".pman-header .icon-save"},"events":{"click @ui.cancelEdit":"onClickClose","click @ui.addIcon":"togglePannel","click @ui.saveBtn":"onClickSave"},"constructor":function(t){t||(t={}),e.defaults(t,{"applyMasking":this.applyMasking.bind(this),"container":document.body}),t.container=i(t.container),this.context=t.context,this._prepareForEdit(t.perspective||t.context.perspective),s.ItemView.prototype.constructor.call(this,t),this._registerEventHandler()},
"_registerEventHandler":function(){this.listenTo(this,"change:layout",function(e){this.perspective.set("perspective",{"type":e,"options":{"perspectiveMode":"edit"}},{"silent":!0}),this._triggerEditMode(),this.togglePannel()}),this.listenTo(this.context,"save:perspective",this._savePerspective)},"_prepareForEdit":function(e){if(!e)throw new Error("Missing perspective");this.perspective=this._clonePrespective(e),this.perspective.isNew()&&this.perspective.set("perspective",this._getDefaultPerspectiveConfig()),(this.perspective.get("perspective").options||{}).perspectiveMode="edit"},"_clonePrespective":function(e){var i=e.get("perspective"),t=JSON.parse(JSON.stringify(i));return e.set("perspective",t),e},"show":function(){var e=this.getContainer();return new a({"el":e}).show(this),this},"getContainer":function(){return l&&i.contains(this.options.container,l)||(l=i("<div>",{"class":"binf-widgets"}).appendTo(this.options.container)[0]),l},"_getDefaultPerspectiveConfig":function(){return{"type":"left-center-right","options":{"center":{"type":"csui/widgets/nodestable"}}}},"_fetchPerspective":function(){var e=this;this.perspective.isNew()?e.ui.saveBtn.removeAttr("disabled"):this.perspective.fetch().then(function(){e.ui.saveBtn.removeAttr("disabled")})},"_savePerspective":function(e){this.perspective.set("perspective",e);var t=this;this.perspective.save().then(function(){csui.require(["csui/controls/globalmessage/globalmessage"],function(i){i.showMessage("success",o.perspectiveSaveSuccess),e.id=t.perspective.get("id"),t.context.perspective.set(e),t._doExitPerspective()})},function(e){var t;if(e&&e.responseJSON&&e.responseJSON.error)t=e.responseJSON.error;else{var s=n.MessageHelper.toHtml();n.MessageHelper.reset(),t=i(s).text()}csui.require(["csui/controls/globalmessage/globalmessage"],function(e){e.showMessage("error",t)})})},"onClickSave":function(){var e=this;csui.require(["csui/dialogs/modal.alert/modal.alert"],function(i){i.confirmWarning(o.saveConfirmMsg,o.saveConfirmTitle).done(function(i){i&&e.context.triggerMethod("serialize:perspective",e.perspective)})})},"onClickClose":function(){this._doExitPerspective()},"togglePannel":function(){this.ui.pmanPanel.hasClass("binf-active")?this._closeToolsPanel():this._openToolsPanel()},"_openToolsPanel":function(){this.pmanPanelView.trigger("reset:items"),this.ui.addIcon.addClass("binf-active"),this.ui.addIcon.attr("title",o.close),this.ui.pmanPanel.addClass("binf-active")},"_closeToolsPanel":function(){this.ui.pmanPanel.removeClass("binf-active"),this.ui.addIcon.attr("title",o.addWidget),this.ui.addIcon.removeClass("binf-active")},"applyMasking":function(){},"_initializeWidgets":function(){this.pmanPanelRegion=new s.Region({"el":this.ui.pmanPanel}),this.pmanPanelView=new r({"pmanView":this}),this.pmanPanelRegion.show(this.pmanPanelView)},"_triggerEditMode":function(){var e=new t.Model(this.perspective.get("perspective"));this.context.triggerMethod("enter:edit:perspective",e)},"onRender":function(){this.options.container.addClass("perspective-editing"),this.options.applyMasking(),this._initializeWidgets(),this._triggerEditMode(),i(document).on("click."+this.cid,{"view":this},this._documentClick),this._fetchPerspective()},"_documentClick":function(e){var i=e.data.view;i.ui.addIcon.is(e.target)||i.ui.addIcon.has(e.target).length||i.ui.pmanPanel.is(e.target)||i.ui.pmanPanel.has(e.target).length||i._closeToolsPanel()},"_doExitPerspective":function(){this.options.container.removeClass("perspective-editing"),this.context.triggerMethod("exit:edit:perspective",this.perspective),i(document).off("click."+this.cid,this._documentClick),this.trigger("destroy")}},{"placeHolderWidget":"csui/perspective.manage/widgets/perspective.placeholder"})}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/root/lang",{"dndWidgetsHere":"Drag and Drop widgets here"}),csui.define("hbs!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="csui-placeholder-title" title="'+this.escapeExpression((n=null!=(n=i.dndWidgetsHere||(null!=e?e.dndWidgetsHere:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"dndWidgetsHere","hash":{}}):n))+'">\r\n  '+this.escapeExpression((n=null!=(n=i.dndWidgetsHere||(null!=e?e.dndWidgetsHere:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"dndWidgetsHere","hash":{}}):n))+"\r\n</div>"}});return t.registerPartial("csui_perspective.manage_widgets_perspective.placeholder_impl_perspective.placeholder",s),s}),csui.define("css!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder",[],function(){}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","i18n!csui/perspective.manage/widgets/perspective.placeholder/impl/nls/lang","hbs!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder","css!csui/perspective.manage/widgets/perspective.placeholder/impl/perspective.placeholder"],function(e,i,t,s,n){return t.ItemView.extend({"className":"csui-perspective-placeholder","template":n,"templateHelpers":function(){return{"dndWidgetsHere":s.dndWidgetsHere}},"constructor":function(e){t.ItemView.apply(this,arguments)},"onShow":function(){this.$el.parent().addClass("csui-pman-placeholder-container")},"onDestroy":function(){this.$el.parent().removeClass("csui-pman-placeholder-container")}})}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/root/lang",{"noConfig":"No configuration needed","clickToConfig":"Click to configure"}),csui.define("hbs!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget",["module","hbs","csui/lib/handlebars"],function(e,i,t){var s=t.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,i,t,s){var n;return'<div class="tile-header">\r\n  <div class="tile-title">\r\n    <h2 class="csui-heading" title="'+this.escapeExpression((n=null!=(n=i.widgetTitle||(null!=e?e.widgetTitle:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetTitle","hash":{}}):n))+'">'+this.escapeExpression((n=null!=(n=i.widgetTitle||(null!=e?e.widgetTitle:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetTitle","hash":{}}):n))+'</h2>\r\n  </div>\r\n</div>\r\n<div>\r\n  <div title="'+this.escapeExpression((n=null!=(n=i.widgetMessage||(null!=e?e.widgetMessage:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetMessage","hash":{}}):n))+'" class="csui-pman-widget-msg">\r\n    '+this.escapeExpression((n=null!=(n=i.widgetMessage||(null!=e?e.widgetMessage:e))?n:i.helperMissing,"function"==typeof n?n.call(e,{"name":"widgetMessage","hash":{}}):n))+"\r\n  </div>\r\n</div>"}});return t.registerPartial("csui_perspective.manage_widgets_perspective.widget_impl_perspective.widget",s),s}),csui.define("css!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget",[],function(){}),csui.define("csui/perspective.manage/widgets/perspective.widget/perspective.widget.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","i18n!csui/perspective.manage/widgets/perspective.widget/impl/nls/lang","hbs!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget","css!csui/perspective.manage/widgets/perspective.widget/impl/perspective.widget"],function(e,i,t,s,n){return t.ItemView.extend({"className":"csui-pman-widget","template":n,"templateHelpers":function(){var i=this.widget.get("manifest"),t=!i||!i.schema||!i.schema.properties||e.isEmpty(i.schema.properties);return{"widgetTitle":this.widget.get("title"),"widgetMessage":t?s.noConfig:s.clickToConfig}},"constructor":function(e){t.ItemView.apply(this,arguments),this.widget=e.data.widget}})}),csui.define("json!csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{title}}","description":"{{description}}","kind":"tile","schema":{"type":"object","properties":{}}}),csui.define("json!csui/perspective.manage/widgets/perspective.widget/perspective.widget.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{title}}","description":"{{description}}","kind":"tile","schema":{"type":"object","properties":{}}}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/perspective.placeholder.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.placeholder/impl/nls/root/perspective.placeholder.manifest",{"dndWidgetsHere":"Drag and Drop widgets here"}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/perspective.widget.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/perspective.manage/widgets/perspective.widget/impl/nls/root/perspective.widget.manifest",{"noConfig":"No configuration needed","clickToConfig":"Click to configure"}),csui.define("bundles/csui-perspective",["csui/perspective.manage/pman.view","csui/perspective.manage/behaviours/pman.widget.config.behaviour","csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.view","csui/perspective.manage/widgets/perspective.widget/perspective.widget.view","json!csui/perspective.manage/widgets/perspective.placeholder/perspective.placeholder.manifest.json","json!csui/perspective.manage/widgets/perspective.widget/perspective.widget.manifest.json","i18n!csui/perspective.manage/widgets/perspective.placeholder/impl/nls/perspective.placeholder.manifest","i18n!csui/perspective.manage/widgets/perspective.widget/impl/nls/perspective.widget.manifest"],{}),csui.require(["require","css"],function(e,i){i.styleLoad(e,"csui/bundles/csui-perspective",!0)});
//# sourceMappingURL=csui-perspective.js.map