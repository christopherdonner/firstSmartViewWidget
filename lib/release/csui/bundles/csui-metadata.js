csui.define("csui/controls/tableheader/comment/comment.button.view",["require","csui/lib/underscore","csui/lib/marionette","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/behaviors/keyboard.navigation/tabable.region.behavior"],function(e,t,i,n,o){var s=i.View.extend({"className":"csui-comment-button","behaviors":{"TabableRegionBehavior":{"behaviorClass":o}},"constructor":function(e){i.View.call(this,e),this.listenTo(this.model,"change",this.render)},"render":function(){var e=this;return csui.require(["esoc/widgets/utils/commentdialog/commentdialog.view"],function(t){var n=new i.Region({"el":e.el});(void 0!==window.require?window.require.s.contexts._.config:window.csui.require.s.contexts._.config).roId=e.model.get("id");var o=new t({"connector":e.model.connector,"nodeid":e.model.get("id"),"CSID":e.model.get("id"),"model":e.model,"context":e.options.context});o.listenTo(o,"before:render",function(){e.triggerMethod("before:render",e)}),o.listenTo(o,"render",function(){e.triggerMethod("render",e)}),e.propagateEventsToViews(o),n.show(o)},function(){}),this}});return t.extend(s.prototype,n),s}),csui.define("csui/widgets/metadata/versions.toolbaritems",["csui/lib/underscore","i18n!csui/widgets/metadata/impl/nls/lang","csui/controls/toolbar/toolitems.factory","csui-ext!csui/widgets/metadata/versions.toolbaritems","csui/controls/toolbar/toolitem.model"],function(e,t,i,n,o){var s={"tableHeaderToolbar":new i({"main":[{"signature":"VersionProperties","name":t.ToolbarItemVersionInfo,"icon":"icon icon-toolbar-metadata"},{"signature":"VersionDownload","name":t.ToolbarItemVersionDownload},{"signature":"VersionDelete","name":t.ToolbarItemVersionDelete}]},{"maxItemsShown":5,"dropDownIcon":"icon icon-toolbar-more"}),"rightToolbar":new i({"main":[{"signature":"PurgeAllVersions","name":t.ToolbarItemVersionPurgeAll}]},{"hAlign":"right"})};return n&&function(t){e.each(t,function(t){e.each(t,function(t,i){var n=s[i];if(!n)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new o(e),n.addItem(e)})})})}(n),s}),csui.define("csui/widgets/metadata/impl/metadata.tabcontentcollection.view",["csui/lib/underscore","csui/controls/tab.panel/impl/tab.contents.view","csui/utils/base"],function(e,t,i){return t.extend({"constructor":function(n,o){t.prototype.constructor.apply(this,arguments),e.extend(this,{"currentlyFocusedElement":function(e){for(var t=e&&e.shiftKey,n=this.currentlyFocusedElementInternal(e),o=this.keyboardBehavior.tabableElements.length,s=t?o-1:0;!i.isElementVisibleInParent(n,this.$el,1,1)&&s>=0&&s<o;)e.elementCursor=s+=t?-1:1,n=this.currentlyFocusedElementInternal(e);return n}})}})}),csui.define("hbs!csui/widgets/metadata/impl/header/item.name/metadata.item.name",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <div class="title-edit-icon-div">\r\n'+(null!=(o=t.unless.call(e,null!=e?e.show_dropdown_menu:e,{"name":"unless","hash":{},"fn":this.program(2,n,0),"inverse":this.noop}))?o:"")+"  </div>\r\n"},"2":function(e,t,i,n){var o;return'      <span class="csui-icon-edit inline-edit-icon icon-edit" title="'+this.escapeExpression((o=null!=(o=t.edit_name_tooltip||(null!=e?e.edit_name_tooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"edit_name_tooltip","hash":{}}):o))+'"\r\n            aria-label="'+this.escapeExpression((o=null!=(o=t.edit_name_tooltip||(null!=e?e.edit_name_tooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"edit_name_tooltip","hash":{}}):o))+'"></span>\r\n'},"4":function(e,t,i,n){var o;return'    <span class="csui-undo edit-cancel inline-edit-icon" title="'+this.escapeExpression((o=null!=(o=t.cancel_edit_name_tooltip||(null!=e?e.cancel_edit_name_tooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"cancel_edit_name_tooltip","hash":{}}):o))+'"\r\n          aria-label="'+this.escapeExpression((o=null!=(o=t.cancel_edit_name_tooltip||(null!=e?e.cancel_edit_name_tooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"cancel_edit_name_tooltip","hash":{}}):o))+'"></span>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o,s;return'<div class="cs-metadata-item-name">\r\n<span class="csui-toggle-wrapper binf-hidden">\r\n  <span class="icon circular1 arrow_back cs-go-back binf-hidden1" style="display:none;"\r\n        aria-label="'+this.escapeExpression((s=null!=(s=t.goBack||(null!=e?e.goBack:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"goBack","hash":{}}):s))+'" title="'+this.escapeExpression((s=null!=(s=t.goBack||(null!=e?e.goBack:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"goBack","hash":{}}):s))+'" tabindex="0"></span>\r\n  <span class="csui-icon csui-metadata-listview csui-metadata-listview-expand-icon" role="button" title="'+this.escapeExpression((s=null!=(s=t.sidebarToggleTitle||(null!=e?e.sidebarToggleTitle:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"sidebarToggleTitle","hash":{}}):s))+'"\r\n        aria-label="'+this.escapeExpression((s=null!=(s=t.sidebarToggleTitle||(null!=e?e.sidebarToggleTitle:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"sidebarToggleTitle","hash":{}}):s))+'" tabindex="0"></span>\r\n</span><span class="csui-type-icon"></span>\r\n<div role="heading" aria-level="2" class="title-header">\r\n<span class="title" tabindex="0" title="'+this.escapeExpression((s=null!=(s=t.name||(null!=e?e.name:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"name","hash":{}}):s))+'" aria-label="'+this.escapeExpression((s=null!=(s=t.nameAria||(null!=e?e.nameAria:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"nameAria","hash":{}}):s))+'" role="button"\r\n      aria-expanded="false">\r\n    '+this.escapeExpression((s=null!=(s=t.name||(null!=e?e.name:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"name","hash":{}}):s))+'<span class="fadeout"></span>\r\n</span>\r\n</div>\r\n'+(null!=(o=t.unless.call(e,null!=e?e.read_only:e,{"name":"unless","hash":{},"fn":this.program(1,n,0),"inverse":this.noop}))?o:"")+'<div class="title-edit-div">\r\n  <label id="'+this.escapeExpression((s=null!=(s=t.edit_name_id||(null!=e?e.edit_name_id:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"edit_name_id","hash":{}}):s))+'" class="binf-hidden">'+this.escapeExpression((s=null!=(s=t.placeholder_text||(null!=e?e.placeholder_text:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"placeholder_text","hash":{}}):s))+'</label>\r\n  <span class="cs-icon-required category_required" title="'+this.escapeExpression((s=null!=(s=t.required_tooltip||(null!=e?e.required_tooltip:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"required_tooltip","hash":{}}):s))+'"></span>\r\n  <input type="text" class="title-input" placeholder="'+this.escapeExpression((s=null!=(s=t.placeholder_text||(null!=e?e.placeholder_text:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"placeholder_text","hash":{}}):s))+'"\r\n         value="'+this.escapeExpression((s=null!=(s=t.edit_name||(null!=e?e.edit_name:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"edit_name","hash":{}}):s))+'" aria-labelledby="'+this.escapeExpression((s=null!=(s=t.edit_name_id||(null!=e?e.edit_name_id:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"edit_name_id","hash":{}}):s))+'" aria-required="true">\r\n'+(null!=(o=t.unless.call(e,null!=e?e.hideCancelButton:e,{"name":"unless","hash":{},"fn":this.program(4,n,0),"inverse":this.noop}))?o:"")+'</div>\r\n</div>\r\n<div class="title-error-div">\r\n  <span class="title-error" title=""></span>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_header_item.name_metadata.item.name",n),n}),csui.define("hbs!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <div class="binf-dropdown">\r\n    <button id="'+this.escapeExpression((o=null!=(o=t.btnId||(null!=e?e.btnId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"btnId","hash":{}}):o))+'" type="button" class="binf-btn binf-dropdown-toggle"\r\n            data-binf-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\r\n            aria-label="'+this.escapeExpression((o=null!=(o=t.showMoreAria||(null!=e?e.showMoreAria:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"showMoreAria","hash":{}}):o))+'">\r\n      <span class="csui-button-icon icon-expandArrowDown" title="'+this.escapeExpression((o=null!=(o=t.showMoreTooltip||(null!=e?e.showMoreTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"showMoreTooltip","hash":{}}):o))+'"></span>\r\n    </button>\r\n    <ul class="binf-dropdown-menu" role="menu"></ul>\r\n  </div>\r\n'},"3":function(e,t,i,n){return'  <div class="csui-loading-parent-wrapper binf-disabled csui-disbaled binf-hidden">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n  </div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return(null!=(o=t.if.call(e,null!=e?e.hasCommands:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.program(3,n,0)}))?o:"")+"\r\n"}});return i.registerPartial("csui_widgets_metadata_impl_header_dropdown.menu_dropdown.menu",n),n}),csui.define("hbs!csui/widgets/metadata/impl/header/dropdown.menu/lazy.loading.template",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<li role="menuitem" class="csui-loading-parent-wrapper binf-disabled csui-disbaled">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n</li>'}});return i.registerPartial("csui_widgets_metadata_impl_header_dropdown.menu_lazy.loading.template",n),n}),csui.define("css!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu",[],function(){}),csui.define("csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/log","csui/controls/toolbar/toolitem.model","csui/controls/toolbar/toolitem.view","csui/models/nodes","csui/controls/toolbar/toolitems.filtered.model","csui/controls/toolbar/toolbar.view","csui/utils/commands","csui/utils/commandhelper","hbs!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/behaviors/dropdown.menu/dropdown.menu.behavior","csui/utils/contexts/factories/browsing.states","i18n!csui/widgets/metadata/impl/nls/lang","hbs!csui/widgets/metadata/impl/header/dropdown.menu/lazy.loading.template","css!csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu","csui/lib/binf/js/binf"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p,g,f,b,w){"use strict";return o.CompositeView.extend({"className":"cs-dropdown-menu","template":m,"childView":r,"childViewContainer":"ul.binf-dropdown-menu","childViewOptions":function(e){return{"role":"menuitem"}},"templateHelpers":function(){return{"hasCommands":!!this.collection.length,"btnId":i.uniqueId("dropdownMenuButton"),"showMoreTooltip":b.showMore,"showMoreAria":b.showMoreAria}},"ui":{"dropdownToggle":".binf-dropdown-toggle","dropdownMenu":".binf-dropdown-menu","loadingIconsDiv":".csui-loading-parent-wrapper"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":p},"DropdownMenuBehavior":{"behaviorClass":g}},"constructor":function(e){var s={"nodes":new l([e.model]),"container":e.container,"containerCollection":e.containerCollection,"context":e.context};e.status=s,e.collection=new d(e.toolItems,{"status":s,"commands":this.commands,"delayedActions":e.containerCollection&&e.containerCollection.delayedActions,"mask":e.toolItemMask}),e.reorderOnSort=!0,o.CompositeView.prototype.constructor.apply(this,arguments),i.defaults(this.options,e.toolItems.options),this.originatingView=e.originatingView,this.commands=e.commands||u,e.el&&t(e.el).addClass(i.result(this,"className")),this.listenTo(this,"childview:toolitem:action",this._triggerMenuItemAction).listenTo(this.model,"sync",this.render).listenTo(n,"closeToggleAction",this._closeToggle).listenTo(this.model,"change",this.render)},"_updateMenuItems":function(){this.collection.refilter(),this.render()},"onRender":function(){if(this.collection.length){this.fetchingNonPromotedActions=!1,this.ui.dropdownToggle.binf_dropdown(),this.ui.dropdownMenu.find("> li > a.binf-hidden").removeClass("binf-hidden");var e=i.bind(function(){this.ui.dropdownMenu.removeClass("adjust-dropdown-menu");var e=this.ui.dropdownMenu.offset().left,t=this.ui.dropdownMenu.outerWidth(),i=this.options.originatingView.$el.width(),n=(window.innerWidth-i)/2,o=i-(e+t-n);(e+t>i||o+t>i)&&this.ui.dropdownMenu.addClass("adjust-dropdown-menu")},this),n=i.bind(function(){var e=this,t=this.options.model?this.options.model:this.model,n=!!t&&!!t.get("csuiLazyActionsRetrieved"),o=!!t&&!!t.isLocallyCreated;t&&!n&&t.nonPromotedActionCommands.length&&!o&&(this.fetchingNonPromotedActions=!0,this.ui.dropdownMenu.append(w),t.setEnabledLazyActionCommands(!0).done(function(){e.fetchingNonPromotedActions=!1;var t=new d(e.options.toolItems,{"status":e.options.status,"commands":e.commands,"delayedActions":e.options.containerCollection&&e.options.containerCollection.lazyActions,"lazyActions":e.options.containerCollection&&e.options.containerCollection.lazyActions,"mask":e.options.toolItemsMask}),n=e.ui.dropdownMenu.find(".csui-loading-parent-wrapper");n.animate("width: 0",300,function(){n.remove(),e.collection.models.length!==t.models.length&&i.filter(t.models,function(t){if(!0===e.isDestroyed||e._isDestroyed)e.children=void 0;else{var i=t.get("signature");if(!e.collection.find({"signature":i})){e.collection.models.push(t);e.addChild(t,r).renderTextOnly()}}})})}))},this);this.ui.dropdownToggle.bind("binf.dropdown.after.show",e),this.ui.dropdownToggle.bind("binf.dropdown.before.show",n),t(window).bind("resize.metadata.header.dropdown.menu",i.debounce(e,100)),this.delegateEvents()}else{var o=this.options.model?this.options.model:this.model,s=!!o&&!!o.get("csuiLazyActionsRetrieved"),a=!!o&&!!o.isLocallyCreated;o&&!s&&o.nonPromotedActionCommands.length&&!a&&(this.$el.find(".binf-dropdown").addClass("binf-hidden"),this.ui.loadingIconsDiv.removeClass("binf-hidden"),this.fetchingNonPromotedActions=!0,o.setEnabledLazyActionCommands(!0).done(i.bind(function(){this.fetchingNonPromotedActions=!1;var e=this.$el.find(".csui-loading-parent-wrapper");e.animate("width: 0",300,i.bind(function(){e.addClass("binf-hidden"),this.$el.find(".binf-dropdown").removeClass("binf-hidden"),this.collection.silentFetch=!0,this._updateMenuItems()},this))},this)))}},"onRenderCollection":function(){if(this.collection.length&&this.fetchingNonPromotedActions){var e=this.ui.dropdownMenu.find(".csui-loading-parent-wrapper");e.length&&e.remove(),this.ui.dropdownMenu.append(w)}},"onDestroy":function(){t(window).unbind("resize.metadata.header.dropdown.menu")},"currentlyFocusedElement":function(){return t(this.ui.dropdownToggle)},"_closeToggle":function(){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&e.binf_dropdown("toggle")},"_triggerMenuItemAction":function(e,t){this.$el.find(".binf-dropdown-toggle").binf_dropdown("toggle");var n=t.toolItem.get("signature"),o=this.commands.findWhere({"signature":n});if("Rename"===n)setTimeout(i.bind(function(){this.trigger("rename",this)},this),200);else{var s={"context":this.options.context,"nodes":new l([this.model]),"container":this.options.container,"collection":this.options.containerCollection,"originatingView":this.originatingView};if(o&&o.enabled(s)){if("Delete"===n&&this.trigger("metadata:item:before:delete",this),"Move"===n&&this.trigger("metadata:item:before:move",this),"CopyLink"===n&&this.options.metadataScenario){var a=this.options.context.getCollection(f);1===a.length&&(a.models[0].attributes.path.node_id=s.nodes.models[0].get("id"),a.models[0].attributes.path.node_name=s.nodes.models[0].get("name")),s.url=a.getUrlPathWithQuery()}o.execute(s).done(i.bind(function(e){"Delete"===n&&this.trigger("metadata:item:deleted",this)},this))}}}})}),csui.define("csui/widgets/metadata/header.dropdown.menu.items",["csui/lib/underscore","i18n!csui/controls/tabletoolbar/impl/nls/localized.strings","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","csui-ext!csui/widgets/metadata/header.dropdown.menu.items","csui-ext!csui/widgets/metadata/header.item.name/menuitems"],function(e,t,i,n,o,s){"use strict";function a(t){e.each(t,function(t){e.each(t,function(t,i){var o=r[i];if(!o)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new n(e),o.addItem(e)})})})}var r={"dropdownMenuList":new i({"main":[{"signature":"Properties","name":t.ToolbarItemInformation},{"signature":"CopyLink","name":t.ToolbarItemCopyLink},{"signature":"Edit","name":t.ToolbarItemEdit},{"signature":"EmailLink","name":t.ToolbarItemShare},{"signature":"permissions","name":t.ToolbarItemPermissions},{"signature":"Rename","name":t.ToolbarItemRename},{"signature":"Download","name":t.ToolbarItemDownload},{"signature":"ReserveDoc","name":t.ToolbarItemReserve},{"signature":"UnreserveDoc","name":t.ToolbarItemUnreserve},{"signature":"Copy","name":t.ToolbarItemCopy},{"signature":"Move","name":t.ToolbarItemMove},{"signature":"AddVersion","name":t.ToolbarItemAddVersion},{"signature":"Delete","name":t.ToolbarItemDelete}],"shortcut":[{"signature":"OriginalCopyLink","name":t.ToolbarItemOriginalCopyLink},{"signature":"OriginalEdit","name":t.ToolbarItemOriginalEdit},{"signature":"OriginalEmailLink","name":t.ToolbarItemOriginalShare},{"signature":"OriginalReserveDoc","name":t.ToolbarItemOriginalReserve},{"signature":"OriginalUnreserveDoc","name":t.ToolbarItemOriginalUnreserve},{"signature":"OriginalCopy","name":t.ToolbarItemOriginalCopy},{"signature":"OriginalMove","name":t.ToolbarItemOriginalMove},{"signature":"OriginalAddVersion","name":t.ToolbarItemAddVersion},{"signature":"OriginalDownload","name":t.ToolbarItemOriginalDownload},{"signature":"OriginalDelete","name":t.ToolbarItemOriginalDelete}]},{"maxItemsShown":0,"dropDownIcon":"icon icon-expandArrowDown"})};return s&&a(s),o&&a(o),r}),csui.define("csui/widgets/metadata/header.dropdown.menu.items.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,n){"use strict";return i.extend({"constructor":function(){var o=e.config(),s=new n;i.prototype.constructor.call(this,s,{"normalize":!1}),t.each(o,function(e,t){this.extendMask(e)},this),this.storeMask()}})}),csui.define("css!csui/widgets/metadata/impl/metadata",[],function(){}),csui.define("css!csui/widgets/metadata/impl/header/item.name/metadata.item.name",[],function(){}),csui.define("csui/widgets/metadata/impl/header/item.name/metadata.item.name.view",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/node-type.icon/node-type.icon.view","hbs!csui/widgets/metadata/impl/header/item.name/metadata.item.name","i18n!csui/widgets/metadata/impl/nls/lang","csui/widgets/metadata/impl/header/dropdown.menu/dropdown.menu.view","csui/widgets/metadata/header.dropdown.menu.items","csui/widgets/metadata/header.dropdown.menu.items.mask","csui/models/version","csui/behaviors/item.name/item.name.behavior","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","i18n","css!csui/widgets/metadata/impl/metadata","css!csui/widgets/metadata/impl/header/item.name/metadata.item.name"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p){"use strict";var g=n.ItemView.extend({"className":"cs-metadata-item-name-container","template":s,"templateHelpers":function(){return{"name":this.modelHasEmptyName?this.readonly?this.placeHolderName:"":this.options.model.get("name"),"edit_name":this.modelHasEmptyName?"":this.options.model.get("name"),"edit_name_id":t.uniqueId("cs-metadata-edit-name"),"placeholder_text":this.placeHolderName,"nameAria":this.options.model.get("name")||a.emptyObjectNameAria,"edit_name_tooltip":a.editNameTooltip,"cancel_edit_name_tooltip":a.cancelEditNameTooltip,"switch_language_tooltip":a.switchLanguageTooltip,"show_dropdown_menu":!!this.options.showDropdownMenu,"read_only":this.options.model instanceof c||this.readonly,"goBack":a.goBackTooltip,"sidebarToggleTitle":a.expand,"hideCancelButton":this.options.mode&&"create"===this.options.mode}},"ui":{"name":".title","nameEditIconDiv":".title-edit-icon-div","nameEditIcon":".csui-icon-edit","nameEditDiv":".title-edit-div","nameInput":".title-input","nameEditCancelIcon":".edit-cancel","titleError":".title-error","toggleIcon":".csui-metadata-listview","toggleWrapper":".csui-toggle-wrapper","backEle":".arrow_back"},"modelEvents":{"change":"render"},"events":{"keydown":"onKeyInView","mouseenter":"onMouseEnterName","mouseleave":"onMouseLeaveName","click @ui.nameEditIcon":"onClickName","keydown @ui.nameInput":"onKeyDown","click @ui.toggleIcon":"toggleSideBar","click @ui.backEle":"goBack","keydown @ui.toggleIcon":"toggleSideBar","keydown @ui.backEle":"goBack","keydown @ui.toggleWrapper":"_onKeyInView"},"behaviors":function(){return{"ItemName":{"behaviorClass":u,"nameSchema":this._nameSchema,"mode":this.options.mode},"TabableRegionBehavior":{"behaviorClass":h}}},"toggleSideBar":function(e){!e||13!==e.keyCode&&32!==e.keyCode&&"click"!==e.type||(this.toggleSideBarEvent(),e.preventDefault(),e.stopPropagation())},"toggleSideBarEvent":function(){if(this.leftBar&&this.leftBar.length>0){var t=this.leftBar.closest(".metadata-navigation");if(t&&t.length>0){var i=this.leftBar;if(i.length>0){if(t.hasClass("csui-hide-side-bar"))t.toggleClass("csui-hide-side-bar"),e(i).show("blind",{"direction":this.direction},"200",function(){e(window).trigger("resize.tableview")}),e(this.ui.backEle).hide(),e(this.ui.toggleIcon).attr("title",a.collapse).attr("aria-label",a.collapse),e(this.ui.toggleIcon).addClass("csui-metadata-listview-collapse-icon").removeClass("csui-metadata-listview-expand-icon"),this.sideBarHidden=!1;else{var n=this;e(i).hide("blind",{"direction":this.direction},"200",function(){t.toggleClass("csui-hide-side-bar"),e(window).trigger("resize.tableview")}),e(n.ui.backEle).show().focus(),this.sideBarHidden=!0,e(this.ui.toggleIcon).attr("title",a.expand).attr("aria-label",a.expand),e(this.ui.toggleIcon).addClass("csui-metadata-listview-expand-icon").removeClass("csui-metadata-listview-collapse-icon")}e(i).promise().done(function(){var t=e.Event("toggled:navigationbar");this.closest(".metadata-navigation").find(".cs-metadata").trigger(t)})}}}},"ensureTitleLabelIcon":function(){if(this.leftBar&&this.leftBar.length>0){var t=this.leftBar.closest(".metadata-navigation");if(t&&t.length>0){this.leftBar.length>0&&(t.hasClass("csui-hide-side-bar")?(e(this.ui.toggleIcon).attr("title",a.expand).attr("aria-label",a.expand),e(this.ui.toggleIcon).addClass("csui-metadata-listview-expand-icon").removeClass("csui-metadata-listview-collapse-icon")):(e(this.ui.toggleIcon).attr("title",a.collapse).attr("aria-label",a.collapse),e(this.ui.toggleIcon).addClass("csui-metadata-listview-collapse-icon").removeClass("csui-metadata-listview-expand-icon")))}}},"constructor":function(i){i||(i={}),this._nameSchema=t.extend({"required":!0,"readonly":!1},i.nameSchema),this.listenTo(i.model,"change:name",this._updateName),this.direction=p.settings.rtl?"right":"left",n.ItemView.prototype.constructor.call(this,i),this.readonly=this._nameSchema.readonly,this.placeHolderName=a.addItemPlaceHolderName;var o=this.model.get("name");this.modelHasEmptyName=!o,this._createDropdownMenu(),e(window).bind("resize",{"view":this},this._onWindowResize)},"goBack":function(e){13!==e.keyCode&&32!==e.keyCode&&"click"!==e.type||(this.options.originatingView.triggerMethod("metadata:close"),e.preventDefault(),e.stopPropagation())},"_applyToggle":function(){this.sideBarHidden||(this.ui.toggleWrapper instanceof Object&&this.ui.toggleWrapper.removeClass("binf-hidden"),this.$el.addClass("csui-metadata-header-with-toggle"),this.options.originatingView&&this.options.originatingView.mdn&&this.options.originatingView.mdn.$el.is(":visible")&&this.ui.backEle instanceof Object&&this.ui.backEle.hide())},"_removeToggle":function(){this.ui.toggleWrapper instanceof Object&&(this.ui.toggleWrapper.addClass("binf-hidden"),this.$el.removeClass("csui-metadata-header-with-toggle")),this.sideBarHidden&&this.toggleSideBarEvent()},"onDestroy":function(){this._destroyDropdownMenu()},"_updateName":function(){var t=this.model.get("name");this.modelHasEmptyName=!t,this.render();var i=e(this.ui.nameInput).is(":focus");this._toggleEditMode(i||this.modelHasEmptyName||!1,!1),this.validate()},"_destroyDropdownMenu":function(){this.dropdownMenuView&&(this.cancelEventsToViewsPropagation(this.dropdownMenuView),this.dropdownMenuView.destroy())},"_createDropdownMenu":function(){if(this.options.showDropdownMenu){var e,i=this.options.originatingView,n=this.options.toolbarItemsMask;e=i&&i.options&&i.options.toolbarItems&&i.options.toolbarItems.dropdownMenuListInProperties?i.options.toolbarItems.dropdownMenuListInProperties:l.dropdownMenuList,n||(n=new d),e=this.options.showPermissionView?e.collection.filter(function(e){return"permissions"!=e.get("signature")}):e.collection.filter(function(e){return"Properties"!=e.get("signature")}),this._destroyDropdownMenu();var o=this.dropdownMenuView=new r({"model":this.options.model,"container":this.options.container,"containerCollection":this.options.collection||this.options.containerCollection,"toolItems":e,"toolItemsMask":n,"originatingView":this.options.originatingView,"context":this.options.context,"commands":this.options.commands,"metadataScenario":this.options.metadataScenario});this.listenTo(o,"rename",t.bind(this._toggleEditMode,this,!0)),this.listenTo(o,"metadata:item:before:delete",t.bind(function(e){this.trigger("metadata:item:before:delete",e)},this)),this.listenTo(o,"metadata:item:before:move",t.bind(function(e){this.trigger("metadata:item:before:move",e)},this)),this.listenTo(o,"metadata:item:deleted",t.bind(function(e){this.trigger("metadata:item:deleted",e)},this)),o.$el.bind("keydown",t.bind(function(e){9===e.keyCode&&e.shiftKey&&(this.ui.backEle.is(":visible")||this.ui.toggleIcon.is(":visible"))&&(this.ui.name.prop("tabindex",0),e.stopPropagation())},this)),this.propagateEventsToViews(this.dropdownMenuView)}},"_onWindowResize":function(e){if(e&&e.data&&e.data.view){var t=e.data.view;t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){t._setHideShowToggleButton()},200)}},"_setHideShowToggleButton":function(t){var i=window.matchMedia("(orientation: landscape)").matches,n=window.matchMedia("(orientation: portrait)").matches,o=t&&t.data&&t.data.view?t.data.view:this;if(o.leftBar=o.options.originatingView&&o.options.originatingView.$el.find(".metadata-sidebar"),o.leftBar&&o.leftBar.length>0){var s=o.leftBar.closest(".metadata-navigation");i?window.innerWidth<=1280?o.sideBarHidden?(o.ui.toggleWrapper instanceof Object&&o.ui.toggleWrapper.removeClass("binf-hidden"),o.ui.backEle instanceof Object&&(o.ui.backEle.css({"display":"inline-block","positin":"relative"}),o.ui.backEle.attr("tabindex",0)),this.ensureTitleLabelIcon()):(o._applyToggle(t),o.leftBar.removeClass("binf-hidden"),s.hasClass("csui-hide-side-bar")&&(o.leftBar.show(),s.toggleClass("csui-hide-side-bar"),o.ui.backEle instanceof Object&&o.ui.backEle.hide(),e(window).trigger("resize.tableview")),this.ensureTitleLabelIcon()):(this.sideBarHidden=!1,o._removeToggle(t),s.hasClass("csui-hide-side-bar")&&(o.leftBar.show(),s.toggleClass("csui-hide-side-bar"),o.ui.backEle instanceof Object&&o.ui.backEle.hide()),e(window).trigger("resize.tableview"),this.ensureTitleLabelIcon()):n&&(o._applyToggle(t),o.leftBar.length>0&&(s.hasClass("csui-hide-side-bar")||(o.leftBar.hide(),s.toggleClass("csui-hide-side-bar"),e(window).trigger("resize.tableview")),o.ui.backEle instanceof Object&&(o.ui.backEle.css({"display":"inline-block","positin":"relative"}),o.ui.backEle.attr("tabindex",0))),this.ensureTitleLabelIcon())}},"currentlyFocusedElement":function(){return this.ui.backEle&&e(this.ui.backEle).is(":visible")?this.ui.backEle:this.ui.toggleIcon&&e(this.ui.toggleIcon).is(":visible")?this.ui.toggleIcon:e(this.options.mode&&"create"===this.options.mode?this.ui.nameInput:this.ui.name)},"onRender":function(){this.editing=!1,this.ui.nameEditIcon.addClass("binf-hidden"),this.ui.nameEditDiv.addClass("binf-hidden"),this._nodeIconView&&this._nodeIconView.destroy(),this._nodeIconView=new o({"el":this.$(".csui-type-icon").get(0),"node":this.options.model}),1===this.model.get("type")&&this._nodeIconView.$el.addClass("csui-metadata-shortcut-overlay"),this._nodeIconView.render(),!this.readonly&&this.options.showDropdownMenu&&this.dropdownMenuView&&(this.dropdownMenuView.render(),n.triggerMethodOn(this.dropdownMenuView,"before:show",this.dropdownMenuView,this),this.ui.nameEditIconDiv.append(this.dropdownMenuView.el),n.triggerMethodOn(this.dropdownMenuView,"show",this.dropdownMenuView,this)),this.modelHasEmptyName&&(this.ui.nameInput.addClass("csui-empty-with-placeholder"),this.ui.nameInput.attr("placeholder",this.placeHolderName),this.readonly&&this.ui.name.addClass("csui-empty-with-placeholder")),this._setHideShowToggleButton()},"onMouseEnterName":function(e){this.readonly||(e.preventDefault(),e.stopPropagation(),!0!==this.editing&&this.ui.nameEditIcon.removeClass("binf-hidden"))},"onMouseLeaveName":function(e){this.readonly||(e.preventDefault(),e.stopPropagation(),!0!==this.editing&&this.ui.nameEditIcon.addClass("binf-hidden"))},"onKeyDown":function(e){if(this.$el.parents(".cs-item-action-metadata").find("div[class='load-container']").length>0)return!1;this.readonly||this.modelHasEmptyName&&!0!==this.inputBoxNameChange&&(this.setInputBoxValue(""),this.inputBoxNameChange=!0,this.ui.nameInput.removeClass("csui-empty-with-placeholder"))},"_validateAndSave":function(){var e=this.getValue().trim(),t=this.getInputBoxValue();if(t=t.trim(),0===t.length||e!==t){if(!0===this.validate(t)){var i=this;this.setInputBoxValue(t),this.setValue(t),this.modelHasEmptyName=!1,this.trigger("metadata:item:name:save",{"sender":this,"success":function(){i._toggleEditMode(!1,!1)},"error":function(t){i.setValue(e),i._toggleEditMode(!0),i.showInlineError(t)}})}}else this.clearInlineError(),this._toggleEditMode(!1,!1)},"_onKeyInView":function(t){9!==t.keyCode||t.shiftKey||(e(t.target).is(this.ui.backEle)?(this.ui.toggleIcon.focus(),t.stopPropagation(),t.preventDefault()):e(t.target).is(this.ui.toggleIcon)&&(this.ui.name.focus(),t.stopPropagation(),t.preventDefault()))},"onKeyInView":function(e){if(!this.readonly)return!(!this.options.mode||"create"!==this.options.mode)||(9===e.keyCode&&e.shiftKey&&e.stopPropagation(),this.ItemNameBehavior.onKeyInView(e))},"_toggleEditMode":function(e,t){if("create"!=this.options.mode)return this.ItemNameBehavior._toggleEditMode(e,t)},"onClickName":function(e){if(!this.readonly)return this.ItemNameBehavior.onClickName(e)},"getValue":function(){return this.ItemNameBehavior.getValue()},"setValue":function(e){return this.ItemNameBehavior.setValue(e)},"getInputBoxValue":function(){return this.ItemNameBehavior.getInputBoxValue()},"setInputBoxValue":function(e){return this.ItemNameBehavior.setInputBoxValue(e)},"validate":function(e){return this.ItemNameBehavior.validate(e)},"setEditModeFocus":function(){return this.ItemNameBehavior.setEditModeFocus()},"showInlineError":function(e){return this.ItemNameBehavior.showInlineError(e)},"clearInlineError":function(){
return this.ItemNameBehavior.clearInlineError()},"_getErrorMessageFromResponse":function(e){return this.ItemNameBehavior._getErrorMessageFromResponse(e)},"setReadOnly":function(t){t=!!t;var i;!!this.readonly!==t?(this.readonly=t,this.render(),i=e(this.ui.nameInput).is(":focus"),this._toggleEditMode(i||this.modelHasEmptyName||!1,!1),this.validate()):(i=e(this.ui.nameInput).is(":focus"))||this.validate()},"setPlaceHolder":function(e){e||(e=a.addItemPlaceHolderName),this.placeHolderName!==e&&(this.placeHolderName=e,this.render())},"updateNameSchema":function(i){this.modelHasEmptyName&&""===this.ui.nameInput.val()&&!i.readonly&&(i.required=!0),this._nameSchema=t.extend({"required":!0,"readonly":!1},i),this.readonly=this._nameSchema.readonly,this.render(),this.ui.nameInput[0].placeholder=this.placeHolderName;var n=e(this.ui.nameInput).is(":focus");return this._toggleEditMode(n||this.modelHasEmptyName||!1,!1),this.ItemNameBehavior.updateNameSchema(i)}});return t.extend(g.prototype,m),g}),csui.define("hbs!csui/widgets/metadata/impl/header/leftbar/header.leftbar",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <span class="icon arrow_back cs-go-back" aria-label="'+this.escapeExpression((o=null!=(o=t.goBackTooltip||(null!=e?e.goBackTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"goBackTooltip","hash":{}}):o))+'"\r\n        title="'+this.escapeExpression((o=null!=(o=t.goBackTooltip||(null!=e?e.goBackTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"goBackTooltip","hash":{}}):o))+'"\r\n        role="link"></span>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return null!=(o=t.if.call(e,null!=e?e.back_button:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.noop}))?o:""}});return i.registerPartial("csui_widgets_metadata_impl_header_leftbar_header.leftbar",n),n}),csui.define("css!csui/widgets/metadata/impl/header/leftbar/header.leftbar",[],function(){}),csui.define("csui/widgets/metadata/impl/header/leftbar/header.leftbar.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","hbs!csui/widgets/metadata/impl/header/leftbar/header.leftbar","i18n!csui/widgets/metadata/impl/nls/lang","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/utils/contexts/factories/browsing.states","css!csui/widgets/metadata/impl/header/leftbar/header.leftbar"],function(e,t,i,n,o,s,a){return i.ItemView.extend({"className":"metadata-header-left-bar","template":n,"templateHelpers":function(){return{"back_button":this.options.showBackIcon,"goBackTooltip":o.goBackTooltip}},"behaviors":function(){return this.options.showBackIcon?{"TabableRegionBehavior":{"behaviorClass":s}}:{}},"ui":{"back":".cs-go-back"},"events":{"keydown":"onKeyInView","click @ui.back":"onClickClose"},"onKeyInView":function(e){var i=e||window.event,n=i.target||i.srcElement;13!==i.keyCode&&32!==i.keyCode||(i.preventDefault(),i.stopPropagation(),t(n).click())},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,i.ItemView.prototype.constructor.call(this,e)},"currentlyFocusedElement":function(){if(this.options.showBackIcon)return t(this.ui.back)},"onClickClose":function(e){if(e.preventDefault(),e.stopPropagation(),this.options.context){var t=this.options.context.getCollection(a);t&&(t.triggerStateChangeOnStateRemoval=!0)}this.trigger("metadata:close")}})}),csui.define("hbs!csui/widgets/metadata/impl/header/rightbar/header.rightbar",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <div class="binf-row shortcut-div">\r\n    <a href="#" class="shortcut-switch" title="'+this.escapeExpression((o=null!=(o=t.right_label||(null!=e?e.right_label:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"right_label","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.right_label||(null!=e?e.right_label:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"right_label","hash":{}}):o))+"</a>\r\n  </div>\r\n\r\n"},"3":function(e,t,i,n){var o;return'\r\n  <div class="metadata-header-floating-rightbar">\r\n    <span class="icon close cs-metadata-close" title="'+this.escapeExpression((o=null!=(o=t.close_metadata_button_tooltip||(null!=e?e.close_metadata_button_tooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"close_metadata_button_tooltip","hash":{}}):o))+'"></span>\r\n  </div>\r\n\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return(null!=(o=t.if.call(e,null!=e?e.is_shortcut:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.noop}))?o:"")+(null!=(o=t.if.call(e,null!=e?e.show_close_icon:e,{"name":"if","hash":{},"fn":this.program(3,n,0),"inverse":this.noop}))?o:"")}});return i.registerPartial("csui_widgets_metadata_impl_header_rightbar_header.rightbar",n),n}),csui.define("css!csui/widgets/metadata/impl/header/rightbar/header.rightbar",[],function(){}),csui.define("csui/widgets/metadata/impl/header/rightbar/header.rightbar.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","hbs!csui/widgets/metadata/impl/header/rightbar/header.rightbar","i18n!csui/widgets/metadata/impl/nls/lang","csui/controls/form/fields/booleanfield.view","csui/behaviors/keyboard.navigation/tabable.region.behavior","css!csui/widgets/metadata/impl/header/rightbar/header.rightbar"],function(e,t,i,n,o,s,a,r,l){var d=n.ItemView.extend({"className":"metadata-header-right-bar","template":s,"templateHelpers":function(){var t={"show_close_icon":this.options.showCloseIcon,"close_metadata_button_tooltip":a.closeMetadataButtonTooltip};if(this.options.showShortcutSwitch&&this.options.shortcutNode){var i=a.viewOriginalMessage;return this.options.shortcutNode.original===this.node&&(i=a.viewShortcutMessage),e.extend(t,{"is_shortcut":!0,"right_label":i})}return t},"behaviors":function(){return this.options.showShortcutSwitch&&this.options.shortcutNode||this.options.showCloseIcon?{"TabableRegionBehavior":{"behaviorClass":l}}:{}},"ui":{"shortcutSwitchLabel":"a.shortcut-switch","closeIcon":".cs-metadata-close"},"events":{"keydown":"onKeyInView","click @ui.shortcutSwitchLabel":"onClickShortcutSwitch","click @ui.closeIcon":"onClickClose"},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,n.ItemView.prototype.constructor.call(this,e)},"onKeyInView":function(e){var i=e||window.event,n=i.target||i.srcElement;13!==i.keyCode&&32!==i.keyCode||(i.preventDefault(),i.stopPropagation(),setTimeout(function(){t(n).click()},200))},"currentlyFocusedElement":function(){return this.options.showShortcutSwitch&&this.options.shortcutNode?t(this.ui.shortcutSwitchLabel):this.options.showCloseIcon?t(this.ui.closeIcon):void 0},"onClickShortcutSwitch":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("shortcut:switch")},"onClickClose":function(e){e.preventDefault(),e.stopPropagation(),this.trigger("metadata:close")}});return e.extend(d.prototype,o),d}),csui.define("hbs!csui/widgets/metadata/impl/header/metadata.header",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){return'\r\n  <div class="metadata-header-left-bar-container"></div>\r\n  <div class="metadata-header with-right-bar"></div>\r\n  <div class="metadata-header-right-bar-container"></div>\r\n\r\n'},"3":function(e,t,i,n){var o;return"\r\n"+(null!=(o=t.if.call(e,null!=e?e.back_button:e,{"name":"if","hash":{},"fn":this.program(4,n,0),"inverse":this.program(9,n,0)}))?o:"")+"\r\n"+(null!=(o=t.if.call(e,null!=e?e.show_only_required_fields_switch:e,{"name":"if","hash":{},"fn":this.program(14,n,0),"inverse":this.noop}))?o:"")+"\r\n"},"4":function(e,t,i,n){var o;return'\r\n    <div class="metadata-header-left-bar-container"></div>\r\n\r\n'+(null!=(o=t.if.call(e,null!=e?e.show_only_required_fields_switch:e,{"name":"if","hash":{},"fn":this.program(5,n,0),"inverse":this.program(7,n,0)}))?o:"")+"\r\n"},"5":function(e,t,i,n){return'      <div class="metadata-header with-back-button with-right-bar"></div>\r\n'},"7":function(e,t,i,n){return'      <div class="metadata-header with-back-button"></div>\r\n'},"9":function(e,t,i,n){var o;return"\r\n"+(null!=(o=t.if.call(e,null!=e?e.show_only_required_fields_switch:e,{"name":"if","hash":{},"fn":this.program(10,n,0),"inverse":this.program(12,n,0)}))?o:"")+"\r\n"},"10":function(e,t,i,n){return'      <div class="metadata-header with-right-bar"></div>\r\n'},"12":function(e,t,i,n){return'      <div class="metadata-header"></div>\r\n'},"14":function(e,t,i,n){return'    <div class="metadata-header-right-bar-container"></div>\r\n'},"16":function(e,t,i,n){return'  <div class="metadata-header-right-bar-container"></div>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return(null!=(o=t.if.call(e,null!=e?e.is_shortcut:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.program(3,n,0)}))?o:"")+"\r\n"+(null!=(o=t.if.call(e,null!=e?e.show_close_icon:e,{"name":"if","hash":{},"fn":this.program(16,n,0),"inverse":this.noop}))?o:"")}});return i.registerPartial("csui_widgets_metadata_impl_header_metadata.header",n),n}),csui.define("css!csui/widgets/metadata/impl/header/metadata.header",[],function(){}),csui.define("csui/widgets/metadata/impl/header/metadata.header.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/impl/header/item.name/metadata.item.name.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/widgets/metadata/impl/header/leftbar/header.leftbar.view","csui/widgets/metadata/impl/header/rightbar/header.rightbar.view","hbs!csui/widgets/metadata/impl/header/metadata.header","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/log","csui/controls/form/fields/booleanfield.view","css!csui/widgets/metadata/impl/header/metadata.header"],function(e,t,i,n,o,s,a,r,l,d,c,u){var h=n.ItemView.extend({"className":"metadata-content-header","template":l,"templateHelpers":function(){var t={"back_button":this.options.showBackIcon,"show_close_icon":this.options.showCloseIcon,"close_metadata_button_tooltip":d.closeMetadataButtonTooltip,"show_only_required_fields_switch":this.options.showRequiredFieldsSwitch,"only_required_fields_label":d.onlyRequiredFieldsLabel};if(this.options.showShortcutSwitch&&this.options.shortcutNode){var i=d.viewOriginalMessage;return this.options.shortcutNode.original===this.node&&(i=d.viewShortcutMessage),e.extend(t,{"is_shortcut":!0,"right_label":i})}return t},"ui":{"leftbar":".metadata-header-left-bar-container","header":".metadata-header","rightbar":".metadata-header-right-bar-container"},"events":{"click .metadata-header":"onClickHeader"},"constructor":function(e){e||(e={}),this.options=e,this.node=this.options.model,this.originatingView=e.originatingView,n.ItemView.prototype.constructor.call(this,e),this._createMetadataHeaderLeftBarView(),this._createMetadataItemNameView(),this._createMetadataHeaderRightBarView()},"_createMetadataHeaderLeftBarView":function(){this.leftbarView&&(this.cancelEventsToViewsPropagation(this.leftbarView),this.leftbarView.destroy());var e=this.leftbarView=new a(this.options);this.listenTo(e,"metadata:close",function(e){this.trigger("metadata:close",e)}),this.propagateEventsToViews(this.leftbarView)},"_createMetadataItemNameView":function(t){this.metadataItemNameView&&(this.cancelEventsToViewsPropagation(this.metadataItemNameView),this.metadataItemNameView.destroy());var i=t||this.node,n=this.metadataItemNameView=new o({"model":i,"container":this.options.container,"containerCollection":this.options.containerCollection,"collection":this.options.collection,"context":this.options.context,"nameSchema":this._getNameSchema(),"commands":this.options.commands,"originatingView":this.options.originatingView,"showDropdownMenu":this.options.showDropdownMenu,"metadataScenario":this.options.metadataScenario,"showPermissionView":this.options.showPermissionView,"mode":this.options.action});this.listenTo(n,"metadata:item:name:save",function(e){this.trigger("metadata:item:name:save",e)}),this.listenTo(n,"metadata:item:before:delete",e.bind(function(e){this.trigger("metadata:item:before:delete",e)},this)),this.listenTo(n,"metadata:item:before:move",e.bind(function(e){this.trigger("metadata:item:before:move",e)},this)),this.listenTo(n,"metadata:item:deleted",e.bind(function(e){this.trigger("metadata:item:deleted",e)},this)),this.listenTo(n,"update:button",e.bind(function(e){this.trigger("update:button",e)},this)),this.propagateEventsToViews(this.metadataItemNameView)},"_createMetadataHeaderRightBarView":function(t){this.rightbarView&&(this.cancelEventsToViewsPropagation(this.rightbarView),this.rightbarView.destroy());var i=t||this.node,n=this.rightbarView=new r(e.extend({},this.options,{"model":i}));this.listenTo(n,"shortcut:switch",this.onClickShortcutSwitch),this.listenTo(n,"metadata:close",function(e){this.trigger("metadata:close",e)}),this.propagateEventsToViews(this.rightbarView)},"onRender":function(){var e=this.leftbarView.render();n.triggerMethodOn(e,"before:show",e,this),this.ui.leftbar.append(e.el);var t=this.metadataItemNameView.render();n.triggerMethodOn(t,"before:show",t,this),this.ui.header.append(t.el);var i=this.rightbarView.render();n.triggerMethodOn(i,"before:show",i,this),this.ui.rightbar.append(i.el),this.options.showCloseIcon&&this.$el.addClass("with-close-icon"),this.options.showShortcutSwitch&&this.options.shortcutNode&&this.$el.addClass("shortcut-object"),n.triggerMethodOn(e,"show",e,this),n.triggerMethodOn(t,"show",t,this),n.triggerMethodOn(i,"show",i,this)},"onBeforeDestroy":function(){this.leftbarView&&(this.cancelEventsToViewsPropagation(this.leftbarView),this.leftbarView.destroy()),this.metadataItemNameView&&(this.cancelEventsToViewsPropagation(this.metadataItemNameView),this.metadataItemNameView.destroy()),this.requiredFieldSwitchView&&this.requiredFieldSwitchView.destroy()},"onClickHeader":function(e){e.preventDefault(),e.stopPropagation()},"onClickShortcutSwitch":function(){var e=this.model;e=this.options.shortcutNode&&this.options.shortcutNode.original===this.node?this.node=this.options.shortcutNode:this.node=this.node.original,this._createMetadataItemNameView(e);var t=this.metadataItemNameView.render();n.triggerMethodOn(t,"before:show",t,this),this.ui.header.append(t.el),n.triggerMethodOn(t,"show",t,this),this._createMetadataHeaderRightBarView(e);var i=this.rightbarView.render();n.triggerMethodOn(i,"before:show",i,this),this.ui.rightbar.append(i.el),n.triggerMethodOn(i,"show",i,this);var o=i.currentlyFocusedElement();o&&o.focus(),this.trigger("shortcut:switch",{"node":e})},"getNameInputBoxValue":function(){return this.metadataItemNameView.getInputBoxValue()},"validateName":function(){var e=this.metadataItemNameView.getInputBoxValue();return this.metadataItemNameView.validate(e)},"getNameValue":function(){return this.metadataItemNameView.getValue()},"setNameEditModeFocus":function(){this.metadataItemNameView.setEditModeFocus()},"_getNameSchema":function(){var e=this.options.collection&&this.options.collection.first(),t=e&&e.get("schema"),i=t&&t.properties&&t.properties.name;return this.options.collection&&t&&!i&&c.warn("Form collection lacks name field in the first form."),i||{}}});return e.extend(h.prototype,s),h}),csui.define("csui/widgets/metadata/property.panels/categories/impl/category.form.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/base","csui/utils/url","csui/controls/form/form.view","csui/controls/form/pub.sub","csui/controls/globalmessage/globalmessage"],function(e,t,i,n,o,s,a,r){return s.extend({"constructor":function(e){s.prototype.constructor.call(this,e),this.node=this.options.node,this.listenTo(this,"change:field",this._saveField),this.listenTo(this,"disable:active:item",this._disableItem)},"_disableItem":function(e){this.options.metadataView&&this.options.metadataView.trigger("disable:active:item")},"_saveField":function(e){if("create"!==this.mode){var t=this.getValues();this._saveChanges(t)}},"_saveChanges":function(i){if(!this.node)throw new Error("Missing node to save the categories to.");return e.keys(i).length?this._validate(i)?(this._blockActions(),t.ajax(this.node.connector.extendAjaxOptions({"type":"PUT","url":o.combine(this.node.urlBase(),"categories",this.model.get("id")),"data":{"body":JSON.stringify(i)}})).done(e.bind(function(){this.trigger("forms:sync");var e=t.Event("tab:content:field:changed");this.options.metadataView&&this.options.metadataView.trigger("enable:active:item"),this.$el.trigger(e)},this)).fail(e.bind(function(e){var t=this.model.get("data");this.form.children.forEach(function(e){e.setValue(t[e.propertyId]),e.refresh()});var i=new n.Error(e);r.showMessage("error",i.message),this.trigger("forms:error")},this)).always(e.bind(function(){this._unblockActions()},this))):t.Deferred().reject().promise():t.Deferred().resolve().promise()}})}),csui.define("csui/widgets/metadata/metadata.general.form.fields",["csui/lib/underscore","csui/lib/backbone","csui-ext!csui/widgets/metadata/metadata.general.form.fields"],function(e,t,i){var n=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),o=t.Collection.extend({"model":n,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),s=new o;return i&&(i=e.flatten(i,!0),e.each(i,function(){var e=i.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),s.add(i)),s}),csui.define("css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view",[],function(){}),csui.define("csui/widgets/metadata/general.form.fields/impl/general.form.fields.view",["csui/lib/underscore","csui/lib/marionette","csui/controls/form/form.view","css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view"],function(e,t,i){"use strict";return t.CollectionView.extend({"className":"csui-general-form-fields","getChildView":function(t){var n=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return n&&n.formView||i},"childViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.mode,"generalFormView":this.view,"fetchedModels":this.options.fetchedModels,"displayedModels":this.options.displayedModels,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"layoutMode":"singleCol"},n=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return n&&e.extend(i,n.formViewOptions),i},"constructor":function(e){t.CollectionView.prototype.constructor.call(this,e),this.listenTo(this,"render",this._triggerRenderForms)},"_triggerRenderForms":function(){var t=this.children.map(function(i){var n=i.cid;return i.once("render:form",function(){t=e.without(t,n),t.length||this.triggerMethod("render:forms",this)},this),i.cid},this)}})}),csui.define("csui/widgets/metadata/general.form.fields/general.form.field.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/metadata.general.form.fields","csui/widgets/metadata/general.form.fields/impl/general.form.fields.view","csui/dialogs/modal.alert/modal.alert"],function(e,t,i,n,o,s,a){"use strict";return n.Behavior.extend({"constructor":function(t,i){n.Behavior.prototype.constructor.apply(this,arguments),this.view=i,this.listenTo(this.view,"render",this._insertFieldExtensions).listenTo(this.view,"destroy",this._emptyExtensionRegion);var o=this;i.getGeneralFormFieldValues=function(){var t={};return o.fieldRegion&&o.fieldRegion.currentView.children.each(function(i){var n,o,s=i.getValues(),a=i.model.get("role_name");s&&(a?(n=t.roles||(t.roles={}),o=n[a]||(n[a]={}),e.extend(o,s)):e.extend(t,s))}),t}},"_insertFieldExtensions":function(){var t=this.getOption("fieldParent");if(e.isFunction(t)&&(t=t.call(this.view)),t&&(t=this.view.$(t)[0]),t){var o=this.getOption("fieldDescriptors");if(e.isFunction(o)&&(o=o.call(this.view)),o&&o.length){this.fieldRegion=new n.Region({"el":t});var a=this.getOption("fieldViewOptions");e.isFunction(a)&&(a=a.call(this.view));var r=new i.Collection(e.pluck(o,"formModel")),l=new s(e.extend({"context":this.view.options.context,"fieldDescriptors":o,"collection":r,"node":this.view.options.node,"mode":this.view.options.mode,"generalFormView":this.view,"fetchedModels":this.view.options.fetchedModels,"displayedModels":this.view.options.displayedModels,"originatingView":this.view.options.originatingView,"metadataView":this.view.options.metadataView},a));this.listenTo(l,"render:forms",function(){this.view.triggerMethod("render:general:form:fields",l)}),this.fieldRegion.show(l)}}},"_emptyExtensionRegion":function(){this.fieldRegion&&this.fieldRegion.empty()}},{"getFieldDescriptors":function(i){var n,s;"create"===i.action?(n="getGeneralFormFieldsForCreate",s=[{"forms":i.forms}]):"copy"===i.action?(n="getGeneralFormFieldsForCopy",s=[{"forms":i.forms}]):"move"===i.action?(n="getGeneralFormFieldsForMove",s=[{"forms":i.forms}]):n="getGeneralFormFields";var a=o.chain().map(function(t){var o=t.get("controller"),a=t.get("controllerOptions"),r=new o(e.extend({"context":i.context,"model":i.node,"fetchedModels":i.forms},a)),l=r[n];return l&&l.apply(r,s)}).compact().value();return t.when.apply(t,a).then(function(){return e.flatten(arguments)})}})}),csui.define("csui/widgets/metadata/metadata.general.action.fields",["csui/lib/underscore","csui/lib/backbone","csui-ext!csui/widgets/metadata/metadata.general.action.fields"],function(e,t,i){var n=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),o=t.Collection.extend({"model":n,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),s=new o;return i&&(i=e.flatten(i,!0),e.each(i,function(){var e=i.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),s.add(i)),s}),csui.define("csui/widgets/metadata/general.action.fields/impl/general.action.fields.view",["csui/lib/underscore","csui/lib/marionette","csui/controls/form/form.view","css!csui/widgets/metadata/general.form.fields/impl/general.form.fields.view"],function(e,t,i){"use strict";return t.CollectionView.extend({"className":"csui-general-action-fields","getChildView":function(t){var n=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return n&&n.formView||i},"childViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.mode,"generalFormView":this.view,"fetchedModels":this.options.fetchedModels,"displayedModels":this.options.displayedModels,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"layoutMode":"singleCol"},n=e.findWhere(this.options.fieldDescriptors,{"formModel":t});return n&&e.extend(i,n.formViewOptions),i},"constructor":function(e){t.CollectionView.prototype.constructor.call(this,e),this.listenTo(this,"render",this._triggerRenderForms)},"_triggerRenderForms":function(){var t=this.children.map(function(i){var n=i.cid;return i.once("render:form",function(){t=e.without(t,n),t.length||this.triggerMethod("render:forms",this)},this),i.cid},this)}})}),csui.define("csui/widgets/metadata/general.action.fields/general.action.field.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/metadata.general.action.fields","csui/widgets/metadata/general.action.fields/impl/general.action.fields.view","csui/dialogs/modal.alert/modal.alert"],function(e,t,i,n,o,s,a){"use strict";return n.Behavior.extend({"constructor":function(t,i){n.Behavior.prototype.constructor.apply(this,arguments),this.view=i,this.listenTo(this.view,"render",this._insertFieldExtensions).listenTo(this.view,"destroy",this._emptyExtensionRegion);var o=this;i.getGeneralActionFieldValues=function(){var t={};return o.fieldRegion&&o.fieldRegion.currentView.children.each(function(i){var n,o,s=i.getValues(),a=i.model.get("role_name");s&&(a?(n=t.roles||(t.roles={}),o=n[a]||(n[a]={}),e.extend(o,s)):e.extend(t,s))}),t}},"_insertFieldExtensions":function(){var t=this.getOption("fieldParent");if(e.isFunction(t)&&(t=t.call(this.view)),t&&(t=this.view.$(t)[0]),t){var o=this.getOption("fieldDescriptors");if(e.isFunction(o)&&(o=o.call(this.view)),o&&o.length){this.fieldRegion=new n.Region({"el":t});var a=this.getOption("fieldViewOptions");e.isFunction(a)&&(a=a.call(this.view));var r=new i.Collection(e.pluck(o,"formModel")),l=new s(e.extend({"context":this.view.options.context,"fieldDescriptors":o,"collection":r,"node":this.view.options.node,"mode":this.view.options.mode,"generalFormView":this.view,"fetchedModels":this.view.options.fetchedModels,"displayedModels":this.view.options.displayedModels,"originatingView":this.view.options.originatingView,"metadataView":this.view.options.metadataView},a));this.listenTo(l,"render:actions",function(){this.view.triggerMethod("render:general:action:fields",l)}),this.fieldRegion.show(l)}}},"_emptyExtensionRegion":function(){this.fieldRegion&&this.fieldRegion.empty()}},{"getFieldDescriptors":function(i){var n,s;"create"===i.action?(n="getGeneralActionFieldsForCreate",s=[{"forms":i.forms}]):"copy"===i.action?(n="getGeneralActionFieldsForCopy",s=[{"forms":i.forms}]):"move"===i.action?(n="getGeneralActionFieldsForMove",s=[{"forms":i.forms}]):n="getGeneralActionFields";var a=o.chain().map(function(t){var o=t.get("controller"),a=t.get("controllerOptions"),r=new o(e.extend({"context":i.context,"model":i.node,"fetchedModels":i.forms},a)),l=r[n];return l&&l.apply(r,s)}).compact().value();return t.when.apply(t,a).then(function(){return e.flatten(arguments)})}})}),csui.define("csui/widgets/metadata/general.panels/node/server.adaptor.mixin",["csui/lib/underscore","csui/lib/backbone","csui/utils/nodesprites","csui/controls/table/cells/size/size.view","csui/utils/base","csui/utils/url","csui/models/form","csui/models/version","csui/models/mixins/node.resource/node.resource.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,s,a,r,l,d){"use strict";var c={"makeServerAdaptor":function(e){return this},"url":function(){var t,i=this.options.node,n=i.get("id");return t=void 0===n?e.str.sformat("forms/nodes/create?type={0}&parent_id={1}",i.get("type"),i.get("parent_id")):i instanceof r?e.str.sformat("forms/nodes/versions/properties/general?id={0}&version_number={1}",n,i.get("version_number")):e.str.sformat("forms/nodes/properties/general?id={0}",n),s.combine(this.connector.connection.url,t)},"parse":function(t,i){var n=e.extend({"data":{},"schema":{},"options":{}},t.form||t.forms&&t.forms[0]||t),o=n.title||this.get("title")||d.general;return n.options=e.omit(n.options,"form"),n.schema.title||(n.schema.title=o),n.title||(n.title=o),this._addCreatorInfo(n,i),this._addOwnerInfo(n,i),this._addCreateDateInfo(n,i),this._addModifyDateInfo(n,i),this._addMimeTypeInfo(n,i),this._addSizeInfo(n,i),this._addItemidInfo(n,i),this._ensurePlaceholder(n,i),this._addReserveInfo(n,i),this._addMimeTypeClassNameInfo(n,i),n},"_addSizeInfo":function(t,i){this.options.node.get("type");this.sizeView=new n({"model":this.options.node,"column":{"name":this.options.node.has("size")?"size":"file_size"}});e.extend(t.data,{"size":this.sizeView.getValueData().formattedValue});e.extend(t.options.fields,{"size":{"hidden":!1,"readonly":!0,"label":d.formFieldSizeLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"size":{"hidden":!1,"readonly":!0,"title":d.formFieldSizeLabel,"type":"string"}})},"_addItemidInfo":function(t,i){if(this.node){this.options.node.get("type"),e.extend(t.data,{"itemId":this.node.get("id")});e.extend(t.options.fields,{"itemId":{"hidden":!1,"readonly":!0,"label":d.formFieldItemIdLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"itemId":{"hidden":!1,"readonly":!0,"label":d.formFieldItemIdLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text","tooltip":this.node.get("id")}})}},"_addCreateDateInfo":function(e,t){e.options.fields.create_date&&(e.options.fields.create_date.type="datetime",e.options.fields.create_date.placeholder=d.alpacaPlaceholderNotAvailable,e.schema.properties.create_date.format="datetime")},"_addModifyDateInfo":function(e,t){e.options.fields.modify_date&&(e.options.fields.modify_date.type="datetime",e.options.fields.modify_date.placeholder=d.alpacaPlaceholderNotAvailable,e.schema.properties.modify_date.format="datetime")},"_addOwnerInfo":function(e,t){var i="owner_user_id";if(this.node instanceof r&&(i="owner_id"),e.options.fields[i]){var n=-3===this.node.get("owner_user_id"),s=n?{"id":-3}:this.node.get("owner_user_id_expand")||this.node.get("owner_user_id")||this.node.get("owner_id");s&&s instanceof Object&&(e.data[i]=s.id,e.options.fields[i].type="otcs_user",e.options.fields[i].type_control={"name":n?d.NoOwner:o.formatMemberName(s)},e.options.fields[i].placeholder=d.alpacaPlaceholderNotAvailable)}},"_addCreatorInfo":function(e,t){if(e.options.fields.create_user_id){var i=this.node.get("create_user_id_expand")||this.node.get("create_user_id");i&&i instanceof Object&&(e.data.create_user_id=i.id,e.options.fields.create_user_id.type="otcs_user",e.options.fields.create_user_id.type_control={"name":o.formatMemberName(i)},e.options.fields.create_user_id.placeholder=d.alpacaPlaceholderNotAvailable)}},"_addMimeTypeInfo":function(t,n){var o=(this.options.node.get("type"),this.options.node);e.extend(t.data,{"mime_type":i.findTypeByNode(o)}),e.extend(t.options.fields,{"mime_type":{"hidden":!1,"readonly":!0,"label":d.formFieldTypeLabel,"placeholder":d.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(t.schema.properties,{"mime_type":{"hidden":!1,"readonly":!0,"title":d.formFieldTypeLabel,"type":"string"}})},"_addMimeTypeClassNameInfo":function(t,n){var o=(this.options.node.get("type"),this.options.node);e.extend(t.data,{"mimeTypeClassName":i.findClassByNode(o)})},"_ensurePlaceholder":function(e,t){if(e.options.fields.description){var i=e.options.fields.description;void 0!==i.placeholder&&0!==i.placeholder.length||(i.placeholder=d.alpacaPlaceholderDescription)}},"_addReserveInfo":function(t,i){e.extend(t.data,{"reserve_info":this.options.node.get("reserved")?this:void 0});e.extend(t.options.fields,{"reserve_info":{"hidden":!1,"readonly":!0,"label":d.formFieldReservedByLabel,"type":"otcs_reserve_button"}}),e.extend(t.schema.properties,{"reserve_info":{"hidden":!1,"readonly":!0,"type":"otcs_reserve_button"}})}};return{"mixin":function(t){return e.extend(t,c)}}}),csui.define("csui/widgets/metadata/general.panels/node/node.general.form.model",["csui/lib/jquery","csui/lib/underscore","csui/models/form","csui/models/mixins/node.resource/node.resource.mixin","csui/widgets/metadata/general.panels/node/server.adaptor.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,s){"use strict";var a=i.extend({"defaults":{"id":"general"},"constructor":function(e,t){i.prototype.constructor.apply(this,arguments),this.makeNodeResource(t).makeServerAdaptor(t)}});return n.mixin(a.prototype),o.mixin(a.prototype),a}),csui.define("csui/widgets/metadata/general.panels/document/document.general.form.model",["csui/lib/underscore","csui/utils/base","csui/controls/table/cells/size/size.view","csui/widgets/metadata/general.panels/node/node.general.form.model","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o){"use strict";return n.extend({"constructor":function(e,t){n.prototype.constructor.apply(this,arguments)},"parse":function(e,t){var i=n.prototype.parse.apply(this,arguments);return this._addSizeInfo(i,t),
i},"_addSizeInfo":function(n,s){var a=(this.options.node.get("type"),this.options.node.has("size")),r=(a?"":"file_")+"size";this.sizeView=new i({"model":this.options.node,"column":{"name":r}});var l=this.sizeView.getValueData().formattedValue;e.extend(n.data,{"size":l||t.getReadableFileSizeString(this.options.node.get("size"))});e.extend(n.options.fields,{"size":{"hidden":!1,"readonly":!0,"label":o.formFieldSizeLabel,"placeholder":o.alpacaPlaceholderNotAvailable,"type":"text"}}),e.extend(n.schema.properties,{"size":{"hidden":!1,"readonly":!0,"title":o.formFieldSizeLabel,"type":"string","tooltip":this.sizeView.getValueData().value}})}})}),csui.define("hbs!csui/widgets/metadata/general.panels/node/impl/node.general.form",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn cs-form-leftcolumn">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="typename_section general-information"></div>\r\n      {{#if options.showSize}}\r\n      <div class="size_section general-information"></div>\r\n      {{/if}}\r\n      <div class="reserve_info general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n      <div class="csui-action-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.aria_label}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_node_impl_node.general.form",n),n}),csui.define("css!csui/widgets/metadata/general.panels/node/impl/node.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/node/node.general.form.view",["csui/lib/underscore","csui/lib/jquery","csui/utils/log","csui/controls/form/form.view","csui/utils/commandhelper","csui/behaviors/default.action/default.action.behavior","csui/widgets/metadata/general.form.fields/general.form.field.behavior","csui/widgets/metadata/general.action.fields/general.action.field.behavior","csui/models/version","csui/controls/globalmessage/globalmessage","hbs!csui/widgets/metadata/general.panels/node/impl/node.general.form","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/base","csui/utils/commands/versions","csui/models/nodeversions","css!csui/widgets/metadata/general.panels/node/impl/node.general.form"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p){"use strict";return n.extend({"behaviors":{"defaultAction":{"behaviorClass":s},"generalFormFields":{"behaviorClass":a,"fieldParent":".csui-extra-general-fields","fieldDescriptors":function(){return this.options.generalFormFieldDescriptors},"fieldViewOptions":function(){return{"context":this.options.context,"node":this.node,"mode":this.options.mode,"originatingView":this,"metadataView":this.options.metadataView}}},"generalActionFields":{"behaviorClass":r,"fieldParent":".csui-action-fields","fieldDescriptors":function(){return this.options.generalActionFieldDescriptors},"fieldViewOptions":function(){return{"context":this.options.context,"node":this.node,"mode":this.options.mode,"originatingView":this,"metadataView":this.options.metadataView}}}},"className":"cs-form csui-general-form","fieldToRefresh":["modify_date","reserve_info"],"constructor":function(i){n.prototype.constructor.call(this,i),this.node=this.options.node,this.fieldToRefresh=e.union(this.fieldToRefresh,i.fieldToRefresh||[]),this.listenTo(this,"change:field",this._saveField),this.listenTo(this.node,"change",e.bind(function(){"create"!==this.mode&&this.model.fetch();var e=t.Event("tab:content:field:changed");this.$el.trigger(e)},this)),this.defaultActionController.getAction(this.options.node)||(this.noDefaultActionExist=!0)},"formTemplate":c,"formTemplateHelpers":function(){var t=this.node.get("type_name"),i=this.node.get("name");return{"showThumbnail":"create"!=this.mode,"showSize":""!==this.model.get("data").size,"reserved":this.node.get("reserved"),"title":this.noDefaultActionExist?"":e.str.sformat(u.openDoc,t),"aria_label":this.noDefaultActionExist?"":e.str.sformat(u.openDocAria,t,i)}},"_getLayout":function(){return{"parent":"bootstrap-csui","layout":{"template":this.getOption("formTemplate").call(this,{"data":this.alpaca.data,"mode":this.mode}),"bindings":this._getBindings()}}},"_getBindings":function(){var t={"name":"name_section","create_date":".owner_section","create_user_id":".owner_section","modify_date":".owner_section","owner_user_id":".owner_section","mime_type":".typename_section","description":".description_section","itemId":".owner_section","size":".size_section"};return this.node.get("reserved")&&(t=e.extend(t,{"reserve_info":".reserve_info"})),this.node instanceof l&&(t=e.extend(t,{"version_number_name":".owner_section","owner_id":".owner_section"})),t},"_saveField":function(e){if("create"!==this.mode){var t=e.targetField,i={};i[t.name]=t.value,this._saveChanges(i)}},"_saveChanges":function(e){var t=this.model.options.node,i=this;t.save(e,{"wait":!0,"patch":!0}).then(function(){return t.fetch()}).fail(function(e){var t=i.model.get("data");i.form.children.forEach(function(e){e.setValue(t[e.propertyId]),e.refresh()});var n=new h.Error(e);d.showMessage("error",n.message),i.trigger("forms:error")})},"onBeforeDestroy":function(){this.triggerDefaultAction&&this.triggerMethod("execute:DefaultAction",this.options.node)},"updateRenderedForm":function(i){this.updateReserveFieldDisplay(),n.prototype.updateRenderedForm.apply(this,arguments),this._showDefaultImage();var o=this.$el.find(".thumbnail_section");if(this.options.node instanceof l){var s=this.options.node;o.click(e.bind(function(){var e=m.get("VersionOpen"),t={"nodes":new p([s])},i={"context":this.options.context,"originatingView":this};e.execute(t,i)},this))}else o.click(e.bind(function(e){this.noDefaultActionExist||(this.options.node.get("container")?(this.options.metadataView.trigger("metadata:close"),this.triggerDefaultAction=!0):this.triggerMethod("execute:DefaultAction",this.options.node))},this));o.on("focusin",function(e){h.checkAndScrollElemToViewport(e.currentTarget)});var a=(t("<span></span>").prop("class","icon csui-icon language-switcher").prop("alt","Switch language").prop("title","Switch language").css("margin-left","0.5em"),this.options.generalFormFieldDescriptors);a&&a.length&&this.listenToOnce(this,"render:general:form:fields",i.async())},"setFocus":function(){var e=this.$form.find(".alpaca-field:not(.alpaca-readonly) button");e.length>0&&e[0].focus()},"updateForm":function(){(this.node.isReservedClicked||this.node.isUnreservedClicked)&&(this.render(),this.node.isReservedClicked=!1,this.node.isUnreservedClicked=!1);var e=this.$el.alpaca("get"),t=!!this.node.collection&&!!this.node.collection.requireSwitched;if(e)for(var i=this.model.get("data"),n=0;n<this.fieldToRefresh.length;n++){var o=e.childrenByPropertyId[this.fieldToRefresh[n]],s=i[this.fieldToRefresh[n]];o&&o.getValue()!==s&&!t&&(o.setValue(s),o.refresh())}return this._showDefaultImage(),this.updateReserveFieldDisplay(),this},"updateReserveFieldDisplay":function(){var e=this.$el.find(".reserve_info");this.node.get("reserved")?e.hasClass("binf-hidden")&&e.removeClass("binf-hidden"):e.hasClass("binf-hidden")||e.addClass("binf-hidden")},"_showDefaultImage":function(){var e=this.$el.find(".default_thumbnail"),i="thumbnail_missing";this.options&&this.options.model.get("data")&&(i=this.options.model.get("data").mimeTypeClassName),e.addClass(i),e.removeClass("thumbnail_empty");var n=t.Event("tab:content:render");this.$el.trigger(n),this.noDefaultActionExist&&this.$el.find(".default_thumbnail").addClass("thumbnail_disabled")}})}),csui.define("hbs!csui/widgets/metadata/general.panels/document/impl/document.general.form",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn cs-form-leftcolumn">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="typename_section general-information"></div>\r\n      <div class="size_section general-information"></div>\r\n      <div class="reserve_info general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="thumbnail_not_loaded thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.aria_label}}"></span>\r\n          <img src="{{options.imgSrc}}" class="img-doc-preview binf-hidden"\r\n               alt="{{options.imgAlt}}">\r\n        </div>\r\n        {{/if}}\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_document_impl_document.general.form",n),n}),csui.define("css!csui/widgets/metadata/general.panels/document/impl/document.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/document/document.general.form.view",["csui/lib/underscore","csui/lib/jquery","csui/utils/commands/impl/thumbnail/thumbnail.object","csui/widgets/metadata/general.panels/node/node.general.form.view","hbs!csui/widgets/metadata/general.panels/document/impl/document.general.form","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/general.panels/document/impl/document.general.form"],function(e,t,i,n,o,s){"use strict";return n.extend({"constructor":function(e){n.prototype.constructor.call(this,e),this.thumbnail=this.options.thumbnail||new i({"node":this.options.node}),this.listenTo(this.thumbnail,"load",this._showImage).listenTo(this.thumbnail,"error",this._showDefaultImage).listenTo(this,"destroy",function(){this.thumbnail.destroy()})},"formTemplate":o,"fieldToRefresh":["modify_date","reserve_info","mime_type","size"],"formTemplateHelpers":function(){var t=this.node.get("type_name"),i=this.node.get("name");return{"showThumbnail":"create"!=this.mode,"title":e.str.sformat(s.openDoc,t),"aria_label":e.str.sformat(s.openDocAria,t,i),"reserved":this.node.get("reserved"),"imgSrc":"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=","imgAlt":s.docPreviewAlt}},"_getBindings":function(){var t=n.prototype._getBindings.apply(this,arguments);return e.extend(t,{"size":".size_section"})},"updateRenderedForm":function(e){if(n.prototype.updateRenderedForm.apply(this,arguments),"create"!==this.mode){this.thumbnail.url?this._showImage():this.thumbnail.load()}},"_showImage":function(){var e=this,i=this.$el.find(".img-doc-preview"),n=this.$el.find(".thumbnail_not_loaded");i.attr("src",this.thumbnail.url),i.prop("tabindex","0"),i.one("load",function(o){o.target.clientHeight>=o.target.clientWidth?i.addClass("cs-form-img-vertical"):i.addClass("cs-form-img-horizontal"),i.addClass("cs-form-img-border"),n.addClass("binf-hidden"),i.removeClass("binf-hidden");var s=t.Event("tab:content:render");e.$el.trigger(s)})},"_showDefaultImage":function(){var i=this.$el.find(".img-doc-preview"),n=this.$el.find(".thumbnail_not_loaded"),o="thumbnail_missing";this.options&&this.options.model.get("data")&&(o=this.options.model.get("data").mimeTypeClassName),!!n.prop("className")&&n.prop("className").split(" ").forEach(e.bind(function(e){0===e.indexOf("mime")&&n.removeClass(e)},n)),n.addClass(o),n.removeClass("thumbnail_empty"),n.removeClass("csui-icon-notification-error"),n.removeClass("binf-hidden"),i.addClass("binf-hidden");var s=t.Event("tab:content:render");this.$el.trigger(s)}})}),csui.define("csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.model",["csui/lib/jquery","csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/utils/node.links/node.links","csui/models/specificnodemodel","csui/models/mixins/syncable.from.multiple.sources/syncable.from.multiple.sources.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,s,a){"use strict";var r=i.extend({"constructor":function(e,t){i.prototype.constructor.apply(this,arguments),this.makeSyncableFromMultipleSources(t)},"_mergeSources":function(e,i){var n=e[0].forms[0],o=i[0].forms[0];t.extend(o.data,n.data),t.extend(o.options.fields,n.options.fields),t.extend(o.schema.properties,n.schema.properties),o.options=t.omit(o.options,"form"),this.set(o)},"sync":function(){var e=new o(this.node.attributes,{"connector":this.connector,"node":this.node,"context":this.options.context}),t=new i(this.node.attributes,{"connector":this.connector,"node":this.options.node,"context":this.options.context}),n=e.fetch(),s=t.fetch(),a={"parse":!1};return this.syncFromMultipleSources([n,s],this._mergeSources,a)}});return s.mixin(r.prototype),r}),csui.define("hbs!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn\r\n    cs-form-leftcolumn">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="typename_section general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.title}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        <div class="shortcut_section general-information"></div>\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_shortcut_impl_shortcut.general.form",n),n}),csui.define("css!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.view",["csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.view","csui/utils/contexts/factories/node","hbs!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form","css!csui/widgets/metadata/general.panels/shortcut/impl/shortcut.general.form"],function(e,t,i,n){"use strict";return t.extend({"constructor":function(e){t.prototype.constructor.call(this,e),e.context&&e.node&&e.node.original&&e.node.original.get("id")>0&&e.context.getModel(i,{"attributes":{"id":e.node.original.get("id")},"node":e.node.original,"temporary":!0})},"formTemplate":n,"_getBindings":function(){var i=t.prototype._getBindings.apply(this,arguments);return e.extend(i,{"original_id":".shortcut_section"})}})}),csui.define("csui/widgets/metadata/general.panels/url/url.general.form.model",["csui/lib/jquery","csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/models/specificnodemodel","csui/models/mixins/syncable.from.multiple.sources/syncable.from.multiple.sources.mixin","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,s){"use strict";var a=i.extend({"constructor":function(e,t){i.prototype.constructor.apply(this,arguments),this.makeSyncableFromMultipleSources(t)},"_mergeSources":function(e,i){var n=e[0].forms[0],o=i[0].forms[0];t.extend(o.data,n.data),t.extend(o.options.fields,n.options.fields),t.extend(o.schema.properties,n.schema.properties),o.options=t.omit(o.options,"form"),this.set(o)},"sync":function(){var e=new n(this.node.attributes,{"connector":this.connector,"node":this.node,"context":this.options.context}),t=new i(this.node.attributes,{"connector":this.connector,"node":this.options.node,"context":this.options.context}),o=e.fetch(),s=t.fetch(),a={"parse":!1};return this.syncFromMultipleSources([o,s],this._mergeSources,a)}});return o.mixin(a.prototype),a}),csui.define("hbs!csui/widgets/metadata/general.panels/url/impl/url.general.form",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="binf-row">\r\n  {{#if options.label}}\r\n  <div class="binf-col-md-12 alpaca-container-label">\r\n    <h4>{{options.label}}</h4>\r\n  </div>\r\n  {{/if}}\r\n  <div class="metadata-pane-container">\r\n    <div class="metadata-pane-left binf-col-md-6  cs-form-doublecolumn\r\n    cs-form-leftcolumn">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="typename_section general-information"></div>\r\n      <div class="csui-extra-general-fields"></div>\r\n    </div>\r\n    <div class="metadata-pane-right binf-col-md-6 cs-form-doublecolumn cs-form-rightcolumn">\r\n      <div class="metadata-tab">\r\n        {{#if options.showThumbnail}}\r\n        <div class="thumbnail_section metadata-preview preview-section" title="{{options.title}}">\r\n          <span class="default_thumbnail thumbnail_empty" data-cstabindex="0" role="button"\r\n                aria-label="{{options.title}}"></span>\r\n        </div>\r\n        {{/if}}\r\n        <div class="url_section general-information"></div>\r\n        <div class="description_section general-information"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_general.panels_url_impl_url.general.form",n),n}),csui.define("css!csui/widgets/metadata/general.panels/url/impl/url.general.form",[],function(){}),csui.define("csui/widgets/metadata/general.panels/url/url.general.form.view",["csui/lib/underscore","csui/widgets/metadata/general.panels/node/node.general.form.view","hbs!csui/widgets/metadata/general.panels/url/impl/url.general.form","css!csui/widgets/metadata/general.panels/url/impl/url.general.form"],function(e,t,i){"use strict";return t.extend({"constructor":function(e){t.prototype.constructor.call(this,e)},"formTemplate":i,"_getBindings":function(){var i=t.prototype._getBindings.apply(this,arguments);return e.extend(i,{"url":".url_section"})}})}),csui.define("csui/widgets/metadata/metadata.general.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/general.panels/document/document.general.form.model","csui/widgets/metadata/general.panels/document/document.general.form.view","csui/widgets/metadata/general.panels/node/node.general.form.model","csui/widgets/metadata/general.panels/node/node.general.form.view","csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.model","csui/widgets/metadata/general.panels/shortcut/shortcut.general.form.view","csui/widgets/metadata/general.panels/url/url.general.form.model","csui/widgets/metadata/general.panels/url/url.general.form.view","csui/models/mixins/rules.matching/rules.matching.mixin","csui-ext!csui/widgets/metadata/metadata.general.panels"],function(e,t,i,n,o,s,a,r,l,d,c,u){"use strict";var h=t.Model.extend({"defaults":{"sequence":100,"contentModel":null,"contentView":null,"contentViewOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments),this.makeRulesMatching(i)}});c.mixin(h.prototype);var m=t.Collection.extend({"model":h,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)},"findByNode":function(e){return this.find(function(t){return t.matchRules(e,t.attributes)})}}),p=new m([{"equals":{"type":[144,749]},"contentModel":i,"contentView":n,"sequence":100},{"equals":{"type":[1,2]},"contentModel":a,"contentView":r,"sequence":100},{"equals":{"type":140},"contentModel":l,"contentView":d,"sequence":100},{"contentModel":o,"contentView":s,"sequence":1e4}]);return u&&p.add(e.flatten(u,!0)),p}),csui.define("csui/widgets/metadata/property.panels/general/metadata.general.property.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/models/form","csui/controls/form/form.view","csui/widgets/metadata/metadata.general.panels"],function(e,t,i,n,o,s){"use strict";return i.Controller.extend({"constructor":function(e){i.Controller.prototype.constructor.apply(this,arguments)},"getPropertyPanels":function(e){var t=this._getGeneralPanel(),i=new t.model(void 0,{"connector":this.connector,"node":this.options.model,"context":this.options.context});return i.fetch().then(function(){return[{"model":i,"contentView":t.contentView,"contentViewOptions":t.contentViewOptions}]})},"getPropertyPanelsForCreate":function(e){var i=this._getGeneralPanel(),n=t.Deferred(),o=e.forms.findWhere({"id":"general"});if(!o)throw new Error("General form missing.");return o=new i.model(o.attributes,{"connector":this.connector,"node":this.options.model,"parse":!0}),n.resolve([{"model":o,"contentView":i.contentView,"contentViewOptions":i.contentViewOptions}]).promise()},"getPropertyPanelsForMove":function(e){return this._getPropertyPanelsForMoveAndCopy(e)},"getPropertyPanelsForCopy":function(e){return this._getPropertyPanelsForMoveAndCopy(e)},"_getPropertyPanelsForMoveAndCopy":function(e){var t=this._getGeneralPanel(),i=new t.model(void 0,{"connector":this.connector,"node":this.options.model});return i.fetch().then(function(){return i.get("schema").readonly=!0,[{"model":i,"contentView":t.contentView,"contentViewOptions":t.contentViewOptions}]})},"_getGeneralPanel":function(){var e=s.findByNode(this.options.model);return{"model":e.get("contentModel")||n,"contentView":e.get("contentView")||o,"contentViewOptions":e.get("contentViewOptions")}}})}),csui.define("csui/widgets/metadata/metadata.property.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/property.panels/general/metadata.general.property.controller","csui-ext!csui/widgets/metadata/metadata.property.panels"],function(e,t,i,n){var o=t.Model.extend({"defaults":{"sequence":100,"controller":null,"controllerOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),s=t.Collection.extend({"model":o,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),a=new s([{"sequence":10,"controller":i}]);return n&&(n=e.flatten(n,!0),e.each(n,function(){var e=n.sequence;if(e<10||e>100)throw new Error("Sequence must be greater or equal to 10 and less or equal to 100.")}),a.add(n)),a}),csui.define("hbs!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return'<div class="binf-dropdown">\r\n  <button id="'+this.escapeExpression((o=null!=(o=t.btnId||(null!=e?e.btnId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"btnId","hash":{}}):o))+'" type="button" class="binf-btn binf-dropdown-toggle"\r\n          data-binf-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\r\n          aria-label="'+this.escapeExpression((o=null!=(o=t.addTitleTooltip||(null!=e?e.addTitleTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"addTitleTooltip","hash":{}}):o))+'">\r\n    <span class="csui-button-icon icon-toolbarAdd" title="'+this.escapeExpression((o=null!=(o=t.addTitleTooltip||(null!=e?e.addTitleTooltip:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"addTitleTooltip","hash":{}}):o))+'"></span>\r\n  </button>\r\n  <ul class="binf-dropdown-menu" role="menu"></ul>\r\n</div>\r\n<div class="csui-loading-parent-wrapper binf-disabled csui-disbaled binf-hidden">\r\n  <span class="csui-loading-dots-wrapper">\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n    <span class="csui-loading-dot"></span>\r\n  </span>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_add.properties_add.properties.dropdown.menu",n),n}),csui.define("css!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu",[],function(){}),csui.define("csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu.view",["csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/log","csui/controls/toolbar/toolitem.view","csui/controls/progressblocker/blocker","csui/models/nodes","csui/controls/toolbar/toolitems.filtered.model","csui/utils/commands","csui/behaviors/dropdown.menu/dropdown.menu.behavior","hbs!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu","csui/lib/binf/js/binf"],function(e,t,i,n,o,s,a,r,l,d,c,u,h){return n.CompositeView.extend({"className":"metadata-add-properties","template":u,"templateHelpers":function(){return{"btnId":t.uniqueId("addPropertiesButton"),"addTitleTooltip":1===this.collection.length?this.collection.at(0).get("name"):h.addNewProperties}},"childView":s,"childViewContainer":"ul.binf-dropdown-menu","childViewOptions":function(e){return{"role":"menuitem"}},"ui":{"dropdownDiv":".binf-dropdown","dropdownToggle":".binf-dropdown-toggle","loadingIconsDiv":".csui-loading-parent-wrapper"},"behaviors":{"DropdownMenuBehavior":{"behaviorClass":c}},"constructor":function(o){o||(o={}),this.context=o.context,this.commands=o.commands||d,this.node=o.node,this.container=o.container,this.formCollection=o.collection,this.originalFormCollection=o.formCollection,this.listenTo(this.formCollection,"reset",this._updateMenuItems),this.originatingView=o.originatingView,o.blockingParentView?a.delegate(this,o.blockingParentView):a.imbue(this);var s={"nodes":new r([o.node]),"container":o.container,"formCollection":this.formCollection,"originalFormCollection":this.originalFormCollection,"context":o.context},c=o.toolbarItems.addPropertiesToolbar;o.collection=new l(c,{"status":s,"commands":this.commands,"delayedActions":o.containerCollection&&o.containerCollection.delayedActions,"mask":o.toolbarItemsMask}),n.CompositeView.prototype.constructor.apply(this,arguments),o.el&&e(o.el).addClass(t.result(this,"className")),this.listenTo(this,"childview:toolitem:action",this._triggerMenuItemAction).listenTo(this.node,"sync change",this._reRender).listenTo(i,"closeToggleAction",this._closeToggle),o.containerCollection&&o.containerCollection.delayedActions&&this.listenTo(o.containerCollection.delayedActions,"sync",this._reRender)},"_updateMenuItems":function(){this.collection.refilter()},"_reRender":function(){this._isRendered&&!this.isDestroyed&&(this._updateMenuItems(),this.render())},"onRender":function(){this._ensureLazyActionsRetrieved().done(t.bind(function(){this.collection.length<1||!0===this.options.suppressAddProperties?(this.$el.addClass("binf-hidden"),this.ui.dropdownToggle.attr("data-cstabindex","-1")):(this.$el.find(".binf-dropdown").removeClass("binf-hidden"),this.$el.removeClass("binf-hidden"),this.ui.dropdownToggle.attr("data-cstabindex","0"),1===this.collection.length&&this.ui.dropdownToggle.attr("aria-haspopup",!1)),this.collection.length>1&&this.ui.dropdownToggle.binf_dropdown(),this.ui.dropdownDiv.on("click",t.bind(this._onClickAddButton,this)),this.ui.dropdownToggle.on("click",t.bind(this._onClickAddButton,this));var i=this;setTimeout(function(){var t=e.Event("tab:content:render");i.$el.trigger(t)},200)},this)).fail(function(){this.$el.addClass("binf-hidden"),this.ui.dropdownToggle.attr("data-cstabindex","-1")})},"_closeToggle":function(){if(!0!==this.options.suppressAddProperties){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&e.binf_dropdown("toggle",!1)}},"_onClickAddButton":function(e){1===this.collection.length&&(i.trigger("closeToggleAction"),e.preventDefault(),e.stopPropagation(),this._executeAction(this.collection.at(0).get("signature")))},"_triggerMenuItemAction":function(e,t){this.$el.find(".binf-dropdown-toggle").binf_dropdown("toggle"),this._executeAction(t.toolItem.get("signature"))},"_executeAction":function(e){var i=this.commands.findWhere({"signature":e}),n={"action":this.options.action,"node":this.options.node,"collection":this.formCollection,"container":this.options.container,"inheritance":this.options.inheritance,"context":this.options.context,"parentView":this.options.parentView,"addPropertiesCallback":this.options.addPropertiesCallback},o={"context":this.options.context,"nodes":new r([this.node]),"container":this.options.container,"formCollection":this.formCollection,"originalFormCollection":this.originalFormCollection,"originatingView":this.originatingView};if(i&&i.enabled(o)){var s=this.ui.dropdownDiv;s.addClass("binf-disabled"),i.execute(o,n).done(t.bind(function(e){s.removeClass("binf-disabled"),s.closest(".tab-links").find(".tab-links-bar ul li.binf-active a").focus()},this)).fail(function(e){s.removeClass("binf-disabled"),e&&e.cancelled&&s.find(".binf-btn.binf-dropdown-toggle").focus()})}},"_ensureLazyActionsRetrieved":function(){var i=e.Deferred(),n=this.options.node,o=!!n.get("csuiLazyActionsRetrieved"),s=!!n.isLocallyCreated,a=n.nonPromotedActionCommands;return n&&!o&&!s&&a&&a.length?(this.$el.find(".binf-dropdown").addClass("binf-hidden"),this.ui.loadingIconsDiv.removeClass("binf-hidden"),n.setEnabledLazyActionCommands(!0).done(t.bind(function(){setTimeout(t.bind(function(){this.ui.loadingIconsDiv.addClass("binf-hidden"),this._updateMenuItems(),i.resolve()},this),300)},this)).fail(t.bind(function(){this.$el.find(".binf-dropdown").removeClass("binf-hidden"),i.reject()},this))):i.resolve(),i.promise()}})}),csui.define("csui/widgets/metadata/add.properties.menuitems",["csui/lib/underscore","csui/utils/base","i18n!csui/widgets/metadata/impl/nls/lang","csui/controls/toolbar/toolitems.factory","csui/controls/toolbar/toolitem.model","csui-ext!csui/widgets/metadata/add.properties.menuitems","csui-ext!csui/widgets/metadata/add.properties/toolbaritems"],function(e,t,i,n,o,s,a){"use strict";function r(t){e.each(t,function(t){e.each(t,function(t,i){var n=l[i];if(!n)throw new Error("Invalid target toolbar: "+i);e.each(t,function(e){e=new o(e),n.addItem(e)})})})}var l={"addPropertiesToolbar":new n({"add":[{"signature":"AddCategory","name":i.addNewCategory}]},{"maxItemsShown":0})};return a&&r(a),s&&r(s),l}),csui.define("csui/widgets/metadata/add.properties.menuitems.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask"],function(e,t,i,n){"use strict";return i.extend({"constructor":function(){var o=e.config(),s=new n
;i.prototype.constructor.call(this,s,{"normalize":!1}),t.each(o,function(e,t){this.extendMask(e)},this),this.storeMask()}})}),csui.define("hbs!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return'<div class="csui-tab-contents-header-content">\r\n  <div class="csui-tab-contents-header-right">\r\n    <div class="required-field-switch binf-hidden">\r\n        <span id="'+this.escapeExpression((o=null!=(o=t.requiredFieldsLabelId||(null!=e?e.requiredFieldsLabelId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"requiredFieldsLabelId","hash":{}}):o))+'" class="only-required-fields-label"\r\n              title="'+this.escapeExpression((o=null!=(o=t.onlyRequiredFieldsLabel||(null!=e?e.onlyRequiredFieldsLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"onlyRequiredFieldsLabel","hash":{}}):o))+'">'+this.escapeExpression((o=null!=(o=t.onlyRequiredFieldsLabel||(null!=e?e.onlyRequiredFieldsLabel:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"onlyRequiredFieldsLabel","hash":{}}):o))+'</span>\r\n      <div class="required-fields-switch"></div>\r\n    </div>\r\n  </div>\r\n  <h4>General</h4>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_tab.contents.header_tab.contents.header",n),n}),csui.define("css!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header",[],function(){}),csui.define("csui/widgets/metadata/impl/tab.contents.header/tab.contents.header.view",["require","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/form/pub.sub","csui/models/version","i18n!csui/widgets/metadata/impl/nls/lang","hbs!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header","css!csui/widgets/metadata/impl/tab.contents.header/tab.contents.header","csui/lib/binf/js/binf"],function(e,t,i,n,o,s,a,r,l){"use strict";return o.ItemView.extend({"tagName":"div","className":"csui-tab-contents-header","template":l,"ui":{"leftTabContentsHeader":".csui-tab-contents-header-content","rightTabContentsHeader":".csui-tab-contents-header-right","tabContentsHeaderTitle":".csui-tab-contents-header-content h4","requiredSwitchEle":".required-field-switch","requiredSwitchIcon":".required-field-switch > div.required-fields-switch"},"events":{"click @ui.requiredSwitchIcon":"onClickRequiredIconDiv","keydown":"onKeyInView"},"constructor":function(){o.ItemView.prototype.constructor.apply(this,arguments),this.pubsubPostFix=(this.options.node instanceof a?"v":"p")+this.options.node.get("id"),this.requiredFieldsLabelId=i.uniqueId("requiredFields");var e="pubsub:tab:contents:header:view:change:tab:title:"+this.pubsubPostFix;s.off(e),this.listenTo(s,e,this._changeTabTitle),this.listenTo(this.collection,"add",function(e){!!e.get("required")&&this._showRequiredSwitch()}),this.listenTo(this.collection,"remove",function(e){this.isRequiredCatPresent()||this._hideRequiredSwitch()}),this.listenTo(this,"metadata:schema:updated",function(e){this.isRequiredCatPresent()?this._showRequiredSwitch():this._hideRequiredSwitch()},this)},"templateHelpers":function(){return{"onlyRequiredFieldsLabel":r.onlyRequiredFieldsLabel,"requiredFieldsLabelId":this.requiredFieldsLabelId}},"_changeTabTitle":function(e){this.$(this.ui.tabContentsHeaderTitle).html(e)},"onRender":function(){this.requiredFieldSwitchModel=new n.Model({"data":!!this.options.node.collection.requireSwitched});var e=this;csui.require(["csui/controls/form/fields/booleanfield.view"],function(t){e.requiredFieldSwitchView=new t({"mode":"writeonly","model":e.requiredFieldSwitchModel,"labelId":e.requiredFieldsLabelId}),e.requiredFieldSwitchView.render(),e.listenTo(e.requiredFieldSwitchView,"field:changed",function(t){var i="pubsub:tab:contents:header:view:switch:"+e.pubsubPostFix;s.trigger(i,{"on":t.fieldvalue}),e.options.node.collection&&(e.options.node.collection.requireSwitched=t.fieldvalue)}),e.$(".required-fields-switch").append(e.requiredFieldSwitchView.$el),e.isRequiredCatPresent()&&e._showRequiredSwitch(),s.off("pubsub:header:rightbar:view:change:switch:status"),e.listenTo(s,"pubsub:header:rightbar:view:change:switch:status",function(t){t?e.requiredFieldSwitchView.curVal&&e.requiredFieldSwitchView.$el.click():e.requiredFieldSwitchModel&&void 0!==e.requiredFieldSwitchModel.get("data")&&!e.requiredFieldSwitchModel.get("data")&&e.options.node&&e.options.node.collection&&e.options.node.collection.requireSwitched&&e.requiredFieldSwitchView.$el.click()})})},"currentlyFocusedElement":function(e){return!this.ui.requiredSwitchEle.hasClass("binf-hidden")&&this.requiredFieldSwitchView?t(this.ui.requiredSwitchIcon.find(":input")):void 0},"onKeyInView":function(e){var n=e||window.event,o=n.target||n.srcElement;32!==n.keyCode&&13!==n.keyCode||!this.ui.requiredSwitchEle.hasClass("binf-hidden")&&this.requiredFieldSwitchView&&(n.preventDefault(),n.stopPropagation(),setTimeout(i.bind(function(){t(o).click()},this),200))},"onClickRequiredIconDiv":function(e){this.requiredFieldSwitchView.onClickWriteField(e)},"_hideRequiredSwitch":function(){this.ui.tabContentsHeaderTitle.addClass("csui-tab-contents-header-title-full-width"),this.ui.requiredSwitchEle.addClass("binf-hidden"),!!this.requiredFieldSwitchView&&!!this.requiredFieldSwitchView.getValue()&&this.requiredFieldSwitchView.ui.flagWriteField.trigger("click")},"_showRequiredSwitch":function(){this.ui.tabContentsHeaderTitle.removeClass("csui-tab-contents-header-title-full-width"),this.ui.requiredSwitchEle.removeClass("binf-hidden")},"isRequiredCatPresent":function(){for(var e=!1,t=0;!e&&t<this.collection.models.length;t++)e=!0===this.collection.models[t].get("required");return e}})}),csui.define("csui/widgets/metadata/impl/metadata.properties.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/url","csui/utils/base","csui/controls/tab.panel/tab.panel.view","csui/controls/tab.panel/tab.links.ext.view","csui/controls/tab.panel/tab.links.ext.scroll.mixin","csui/models/form","csui/controls/form/form.view","csui/widgets/metadata/property.panels/categories/impl/category.form.view","csui/models/appliedcategories","csui/widgets/metadata/impl/metadata.forms","csui/dialogs/modal.alert/modal.alert","csui/controls/progressblocker/blocker","csui/models/version","csui/widgets/metadata/impl/metadata.utils","i18n","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/widgets/metadata/general.form.fields/general.form.field.behavior","csui/widgets/metadata/general.action.fields/general.action.field.behavior","i18n!csui/widgets/metadata/impl/nls/lang","csui/widgets/metadata/metadata.property.panels","csui/widgets/metadata/impl/add.properties/add.properties.dropdown.menu.view","csui/widgets/metadata/add.properties.menuitems","csui/widgets/metadata/add.properties.menuitems.mask","csui/widgets/metadata/impl/tab.contents.header/tab.contents.header.view","csui/controls/form/pub.sub","csui/widgets/metadata/impl/metadata.tabcontentcollection.view","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p,g,f,b,w,v,_,y,T,V,x,C,I,k,M,F){var A=h.extend({"constructor":function(t,i){h.prototype.constructor.apply(this,arguments),this.options=i||{},e.defaults(this.options,{"urlResource":""})},"url":function(){return o.combine(this.node.urlBase(),this.options.urlResource)},"fetch":function(){return this.node instanceof f||void 0===this.node.get("id")||this.options.action?(this.fetching=!1,this.fetched=!0,t.Deferred().resolve()):h.prototype.fetch.apply(this,arguments)},"parse":function(){return this.node instanceof f?{}:void 0===this.node.get("id")||this.options.action?{"categories_add":"dummy value"}:h.prototype.parse.apply(this,arguments)}}),E=a.extend({"className":(s.isTouchBrowser()?"cs-touch-browser ":"")+"cs-metadata-properties binf-panel binf-panel-default","rtlEnabled":w.settings.rtl,"contentView":function(t){var i=e.findWhere(this._propertyPanels,{"model":t});return i?i.contentView||c:"categories"===t.get("role_name")?u:c},"contentViewOptions":function(t){var i={"context":this.options.context,"node":this.options.node,"mode":this.options.formMode,"fetchedModels":this.allForms,"displayedModels":this.collection,"originatingView":this,"layoutMode":"doubleCol","metadataView":this.options.metadataView,"generalFormFieldDescriptors":this._generalFormFieldDescriptors,"generalActionFieldDescriptors":this._generalActionFieldDescriptors},n=e.findWhere(this._propertyPanels,{"model":t});return n&&e.extend(i,n.contentViewOptions),i},"isTabable":function(){return!0!==this.options.notTabableRegion},"constructor":function(n){n||(n={});var o;o=s.isTouchBrowser()?"category_delete-touch-browser":"category_delete",e.defaults(n,{"tabType":"binf-nav-pills","mode":"spy","extraScrollTopOffset":3,"formMode":"update","toolbar":!0,"toolbarItems":C,"delete_icon":o,"delete_tooltip":T.removeCategoryTooltip,"contentView":this.getContentView,"TabLinkCollectionViewClass":r,"TabContentCollectionViewClass":F,"searchTabContentForTabableElements":!0,"tabContentAccSelectors":"a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[data-cstabindex], *[contenteditable]"}),n.toolbarItemsMask||(n.toolbarItemsMask=new I),this.behaviors=e.extend({"PerfectScrolling":{"behaviorClass":v,"contentParent":"> .binf-tab-content","scrollXMarginOffset":30,"scrollYMarginOffset":15}},this.behaviors),n.collection?this.allForms=n.collection:(this.allForms=new m(void 0,{"node":n.node,"connector":n.node.connector,"container":n.container,"action":n.action,"inheritance":n.inheritance,"autoreset":!0,"formCollection":n.formCollection}),n.collection=new i.Collection),void 0===n.node.newCategories&&(n.node.newCategories=new i.Collection),void 0===n.node.removedCategories&&(n.node.removedCategories=[]),a.prototype.constructor.apply(this,arguments),this.widths=[],this.options.blockingParentView?g.delegate(this,this.options.blockingParentView):g.imbue(this),M.off("pubsub:tab:contents:panel:textarea:scrollupdate"),this.listenTo(M,"pubsub:tab:contents:panel:textarea:scrollupdate",this._updateToTextAreaScrollbar),this.listenTo(this.allForms,"request",this.blockActions).listenTo(this.allForms,"request",this._checkFormFetching).listenTo(this.allForms,"sync",this._syncForms).listenTo(this.allForms,"sync",this.unblockActions).listenTo(this.allForms,"destroy",this.unblockActions).listenTo(this.allForms,"error",this.unblockActions).listenTo(this.collection,"reset",this.render).listenTo(n.node,"change:id",function(){"create"!==this.options.formMode&&this._fetchForms()}).listenTo(this,"reset:switch",this._resetRequiredSwitchView).listenTo(this,"update:button",e.bind(function(e){this.options.metadataView.trigger("update:button",{"overlay":e})},this)),this.allForms.fetching&&this.blockActions(),t(window).bind("resize",{"view":this},this._onWindowResize),t(window).bind("resize.tableview",{"view":this},this._onWindowResize),this.listenTo(this,"render",this.onRendered),this.listenTo(i,"metadata:schema:updated",function(e){this.resolveHasRequiredFields(e),this.has_required_fields=this.collection.filter(function(e){return!0===e.get("required")}),this.tabLinks.trigger("metadata:schema:updated",e),this.tabContentHeader.trigger("metadata:schema:updated",e)},this)},"onBeforeDestroy":function(){t(window).unbind("resize",this._onWindowResize),t(window).unbind("resize.tableview",this._onWindowResize),this.addPropertiesView&&(this.cancelEventsToViewsPropagation(this.addPropertiesView),this.addPropertiesView.destroy()),this.contentHeaderRegion&&this.contentHeaderRegion.empty()},"_updateScrollbar":function(){this.trigger("update:scrollbar"),this.$(this.behaviors.PerfectScrolling.contentParent).animate({"scrollTop":0},"fast")},"_updateToTextAreaScrollbar":function(e){this.trigger("update:scrollbar");var t=e.$el.offset().top-this.$(this.behaviors.PerfectScrolling.contentParent).offset().top;this.$(this.behaviors.PerfectScrolling.contentParent).scrollTop()>0&&this.$(this.behaviors.PerfectScrolling.contentParent).animate({"scrollTop":t},"fast")},"_activateSelectedPropertyTab":function(){var e=this.options.selectedProperty;if(e&&e instanceof i.Model&&this.collection&&this.collection.length>0){var t,n,o=e.get("id"),s=e.get("title"),a=-1;for(t=0;t<this.collection.length;t++)if(n=this.collection.at(t),o===n.get("id")||s===n.get("title")){a=t;break}-1!==a&&(this.options.activeTab.set("tabIndex",a),this.tabLinks.children.findByIndex(a).activate())}},"render":function(){var t=!0;if(this.allForms.fetched||this.allForms.error||(t=!1,this._fetchingForms||this._fetchForms()),!1===t||this._fetchingForms)return this;if(1===this.collection.length){var i=this.collection.first(),n=e.clone(i.get("schema"));n.title="",i.set("schema",n)}var o=this;return this.collection.each(function(e,t){o.resolveHasRequiredFields.call(o,e)&&(o.hasRequiredField=!0)}),e.extend(this,{"_":e}),a.prototype.render.apply(this),this._createAddPropertiesView(),this._initializeOthers(),this},"resolveHasRequiredFields":function(e){var t=new b,i=t.AlpacaFormOptionsSchemaHaveRequiredFields(e.get("options"),e.get("schema"),e.get("id"));return e.set("required",i),i},"onRendered":function(){this._setTablinksAttributes(),setTimeout(e.bind(this._setTablinksAttributes,this),300),this.tabLinks.stopListening(this.collection,"reset"),this.tabContent.stopListening(this.collection,"reset"),this.tabContentHeader&&(this.tabContentHeader.destroy(),this.$el.find(".csui-tab-contents-header-wrapper").remove()),this.listenTo(this.tabLinks,"childview:delete:tab",e.bind(this._onDeleteCategory,this)),this.tabLinks.$el.addClass("binf-hidden"),this.tabContent.$el.addClass("binf-hidden"),this.blockActions(),this.updateTitle=!0;var i=[],o=this;this.tabContent.children.each(e.bind(function(e){var n=t.Deferred();i.push(n.promise());var o=e.content;o instanceof c&&!o.isRenderFinished()?this.listenTo(o,"render:form",function(e){var t=e.$el.find(".cs-form-singlecolumn")?e.$el.find(".cs-form-singlecolumn"):e.$el.find(".cs-form-doublecolumn");t&&t.length>0?t.html()&&n.resolve():n.resolve()}):n.resolve()},this)),t.when.apply(t,i).done(function(){if(o.unblockActions(),o.tabLinks.$el.removeClass("binf-hidden"),!!o.collection.findWhere({"id":"general"})){var e=o.options.node instanceof f?"v":"p";e="pubsub:tab:contents:header:view:switch:"+e+o.options.node.get("id"),M.off(e),o.listenTo(M,e,o._onRequiredSwitch),o.tabContent.$el.before("<div class='csui-tab-contents-header-wrapper'></div>"),o.contentHeaderRegion=new n.Region({"el":o.$el.find(".csui-tab-contents-header-wrapper")}),o.tabContentHeader=new k(o.options),o.contentHeaderRegion.show(o.tabContentHeader)}if(o.tabContentHeader&&o.options.node.collection.requireSwitched&&o.hasRequiredField&&o._hideNotRequiredFormFields(!0),o.tabContent.$el.removeClass("binf-hidden"),o.addPropertiesView&&o.rightToolbar){var i=o.addPropertiesView.render();n.triggerMethodOn(i,"before:show",i,o),o.rightToolbar.append(i.el),n.triggerMethodOn(i,"show",i,o),o.allFormsRendered=!0}var s,a=o.tabLinks.collection.find(function(e){return!o.tabLinks.children.findByModel(e).$el.hasClass("binf-hidden")});a&&!(s=o.tabLinks.children.findByModel(a)).isActive()&&s.activate(),o._initializeOthers(),o.triggerMethod("render:forms",this),setTimeout(function(){o._computeTablinkWidth(),o._enableToolbarState()},300);var r=t.Event("tab:content:render");if(o.$el.trigger(r),"create"!==o.options.formMode&&o.setFocus(),o.trigger("update:scrollbar"),o.updateTitle){var l=(o.options.node instanceof f?"v":"p")+o.options.node.get("id");l="pubsub:tab:contents:header:view:change:tab:title:"+l,M.trigger(l,s.el.innerText)}o._activateSelectedPropertyTab()}),this.$el&&!this.$el.is(":visible")&&(this.updateTitle=!1),this.childWithBlockingView&&this.childWithBlockingView.metadataHeaderView.metadataItemNameView.ui.toggleIcon.attr("tabindex",0)},"onShow":function(){},"setFocus":function(){},"_computeTablinkWidth":function(){var e=this.$el.find(".tab-links-bar"),i=e&&e.find("ul > li");if(e&&e.removeClass("wide-tablink very-wide-tablink"),e&&e.length>0&&i&&i.length>1){var n,o=t(e[0]).width(),s=0,a=0;for(n=0;n<i.length;n++){var r=t(i[n]);r.hasClass("hidden-by-switch")||(s+=r.width(),a++)}var l=a>0?s/a:t(i[0]).width(),d=2*s,c=s+1.3*l;o>d?e.addClass("very-wide-tablink"):o>c?e.addClass("wide-tablink"):e.removeClass("wide-tablink very-wide-tablink")}},"onPanelActivated":function(){setTimeout(e.bind(function(){this._setTablinksAttributes(),this._enableToolbarState()},this),300)},"validateForms":function(){var e=!0;return!!this.allFormsRendered&&(this.tabContent.children.each(function(t){var i=t.content.validate();e=e&&i}),e?this._hideValidationError():this._showValidationError(),e)},"getFormsValues":function(){var t,i,n,o,s={};this.tabContent.children.each(function(t){var i,a,r=t.content.getValues(),l=t.content.model.get("role_name");r&&(l?(n=s.roles||(s.roles={}),o=n[l]||(n[l]={}),"categories"===l?(a=t.model.get("id").toString(),i=o[a]||(o[a]={}),e.isEmpty(r)?i=null:e.extend(i,r)):e.extend(o,r)):e.extend(s,r))}),this.options.node.removedCategories.length>0&&(n=s.roles||(s.roles={}),o=n.categories||(n.categories={}),e.each(this.options.node.removedCategories,function(e){o[e]||(o[e]={})}));var a=this.tabContent.children.find(function(e){return!!e.content.getGeneralFormFieldValues});return a&&(t=a.content.getGeneralFormFieldValues(),i=t.roles||{},delete t.roles,e.extend(s,t),e.each(e.keys(i),function(t){n=s.roles||(s.roles={}),o=n[t]||(n[t]={}),e.extend(o,i[t])})),s},"_addValidationErrorElement":function(){if(0===this.$el.find(".metadata-validation-error").length){this.tabLinks.$el.after('<div class="metadata-validation-error"></div>'),this.validationErrorElem=t(this.$el.find(".metadata-validation-error")[0]),this.validationErrorElem.append('<span class="icon notification_error cs-close-error-icon" alt="'+T.hideValidationErrorMessageIconTooltip+'" title="'+T.hideValidationErrorMessageIconTooltip+'"></span>'),this.validationErrorElem.append('<span class="validation-error-message">'+T.formValidationErrorMessage+"</span>"),this.validationErrorElem.hide();var i=t(this.$el.find(".metadata-validation-error .cs-close-error-icon")[0]);i&&i.on("click",e.bind(function(e){e.preventDefault(),e.stopPropagation(),this._hideValidationError()},this))}},"_showValidationError":function(){void 0===this.validationErrorElem&&this._addValidationErrorElement(),this.tabContent.$el.find(".alpaca-message-notOptional").length>0?(this.tabContent&&this.tabContent.$el.addClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.addClass("show-validation-error"),this.validationErrorElem&&this.validationErrorElem.show()):this._hideValidationError()},"_hideValidationError":function(){this.tabContent&&this.tabContent.$el.removeClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.removeClass("show-validation-error"),this.validationErrorElem&&this.validationErrorElem.hide()},"_clearValidationError":function(){this.tabContent&&this.tabContent.$el.removeClass("show-validation-error"),this.contentHeaderRegion&&this.contentHeaderRegion.$el.removeClass("show-validation-error"),this.validationErrorElem&&(this.validationErrorElem.remove(),delete this.validationErrorElem)},"_checkFormFetching":function(){this._fetchingForms=!0},"_fetchForms":function(){return this.allForms.fetch()},"_syncForms":function(){var t=this;return this.blockActions(),this._clearValidationError(),this._loadPanels().then(e.bind(this._loadGeneralFormFields,this)).then(e.bind(this._loadGeneralActionFields,this)).always(function(){t.unblockActions(),t._fetchingForms=!1}).then(function(){var i=e.pluck(t._propertyPanels,"model"),n=t.allForms.where({"role_name":"categories"});t.panelModelsLength=i.length,t.options.node.newCategories.models.length>0&&(n=e.union(n,t.options.node.newCategories.models));var o=e.sortBy(n,function(e){return e.attributes.title.toLowerCase()});n=i.concat(o),t._normalizeModels(n),t.collection.reset(n),t._checkCategoriesActions()}).fail(function(e){var t=new s.Error(e);p.showError(t.message,T.getPropertyPanelsFailTitle)})},"_loadPanels":function(){var i,n,o=this;"create"===this.options.action?(i="getPropertyPanelsForCreate",n=[{"forms":this.allForms}]):"copy"===this.options.action?(i="getPropertyPanelsForCopy",n=[{"forms":this.allForms}]):"move"===this.options.action?(i="getPropertyPanelsForMove",n=[{"forms":this.allForms}]):i="getPropertyPanels";var s=V.chain().map(function(t){var s=t.get("controller"),a=t.get("controllerOptions"),r=new s(e.extend({"context":o.options.context,"model":o.options.node},a)),l=r[i];return l&&l.apply(r,n)}).compact().value();return t.when.apply(t,s).then(function(){o._propertyPanels=e.flatten(arguments)})},"_loadGeneralFormFields":function(){var e=this;return _.getFieldDescriptors({"context":this.options.context,"action":this.options.action,"node":this.options.node,"forms":this.allForms}).then(function(t){e._generalFormFieldDescriptors=t})},"_loadGeneralActionFields":function(){var e=this;return y.getFieldDescriptors({"context":this.options.context,"action":this.options.action,"node":this.options.node,"forms":this.allForms}).then(function(t){e._generalActionFieldDescriptors=t})},"_normalizeModels":function(t){e.each(t,function(e){if(e instanceof d){var t=e.get("schema");t&&t.title&&e.set("title",t.title)}null==e.get("id")&&e.set("id",e.cid),e.collection&&e.collection.remove(e)})},"_checkCategoriesActions":function(){var i=this.options.collection.where({"role_name":"categories"});if(i.length>0){var n=i[0].get("categoryId"),o=new A(void 0,{"node":this.options.node,"action":this.options.action,"urlResource":"categories/"+n+"/actions","autofetch":!0,"autoreset":!0});this.blockActions(),o.fetch().done(e.bind(function(){o.length>0&&o.at(0).get("categories_remove")&&o.at(0).get("categories_remove").length>0&&e.each(i,function(e){e.attributes.removeable=!0,e.trigger("action:updated")}),this.unblockActions(),setTimeout(e.bind(function(){var e=t.Event("tab:content:render");this.$el.trigger(e)},this),300)},this)).fail(e.bind(function(t){var i=this._getRespError(t),o=T.getCategoryActionsFailTitle,s=e.str.sformat(T.getActionsForACategoryFailMessage,n,this.options.node.get("id"),i);p.showError(s,o),this.unblockActions()},this))}},"_initializeOthers":function(){var t={"gotoPreviousTooltip":T.gotoPreviousCategoryTooltip,"gotoNextTooltip":T.gotoNextCategoryTooltip};this._initializeToolbars(t),this._listenToTabEvent(),setTimeout(e.bind(this._enableToolbarState,this),300)},"_onWindowResize":function(e){if(e&&e.data&&e.data.view){var t=e.data.view;t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(function(){t._setTablinksAttributes(),t._computeTablinkWidth(),t._enableToolbarState(),t._updateScrollbar()},200)}},"_setTablinksAttributes":function(){var e,i,n=this.$el.parent();for(e=0;e<5;e++){if(i=n.siblings(".cs-tab-links.binf-dropdown"),i.length>0){var o=t(i[0]).width();if(o>15){var s=o-12,a=s+"px",r=this.rtlEnabled?"margin-right":"margin-left",l=this.$el.find(".tab-links");if(l.css({"width":function(){return"calc(100% - "+a+")"}}),l.length){l.css(r,a);var d=parseInt(l.css("width").replace("px",""),10);d>20&&d<250?l.addClass("csui-mini-tablinks"):l.removeClass("csui-mini-tablinks")}}break}n=n.parent()}},"_createAddPropertiesView":function(){this.addPropertiesView&&(this.cancelEventsToViewsPropagation(this.addPropertiesView),this.addPropertiesView.destroy());var t=e.extend({"toolbarItems":this.options.toolbarItems,"toolbarItemsMask":this.options.toolbarItemsMask,"parentView":this,"blockingParentView":this.options.blockingParentView,"addPropertiesCallback":this.addPropertiesCallback,"suppressAddProperties":this.options.suppressAddProperties},this.options);this.addPropertiesView=new x(t),this.propagateEventsToViews(this.addPropertiesView)},"addCatAt":function(e,t){for(var i=this.panelModelsLength,n=i;n<e.length;n++){if(e[n].get("title").toLowerCase()>t.get("title").toLowerCase()){i=n;break}i+=1}return i},"addPropertiesCallback":function(e){this.options.action&&this.options.node.newCategories.add(e);var t=1===this.options.collection.models.length?1:this.addCatAt(this.options.collection.models,e);return this.doAddModelProperties(e,t),!1},"doAddModelProperties":function(i,n,o){function s(){var e=t.Event("tab:content:render");a.$el.trigger(e),a._autoScrollTabTo(n,{"animationOff":!0}).done(function(){a.tabLinks.children.findByModel(a.options.collection.findWhere({"id":i.get("id")})).activate()})}var a=this;this.tabLinks.$el.find(".binf-active").removeClass("binf-active").removeAttr("aria-selected"),this.options.collection.add(i,e.extend(o||{},{"at":n})),i.collection=this.options.collection,this._listenToTabIdEvent(n);var r=this.tabContent.children.findByModel(this.options.collection.findWhere({"id":i.get("id")})),l=r&&r.content;if(void 0!==l){if(l instanceof c?l.isRenderFinished():l._isRendered)s();else{var d=l instanceof c?"render:form":"dom:refresh";this.listenToOnce(l,d,e.bind(function(){this.trigger("update:button",!1),s()},this))}this._autoScrollTabTo(n,{"animationOff":!0})}else s();this._computeTablinkWidth(),this._enableToolbarState(),this.trigger("reset:switch")},"_resetRequiredSwitchView":function(){M.trigger("pubsub:header:rightbar:view:change:switch:status","reset")},"_onDeleteCategory":function(t){this.tabToDelete=t;var i=t.model.get("title"),n=T.removeCategoryWarningTitle,o=i?e.str.sformat(T.removeCategoryWarningMessage,i):T.removeCategoryWarningMessage;p.confirmWarning(o,n).done(e.bind(this._removeCategory,this)).fail(e.bind(function(e){e||this.tabToDelete.$el.find("a").focus()},this))},"_removeCategory":function(){if(this.tabToDelete){var i=this.tabToDelete.model.get("id");if(i=e.isNumber(i)?i.toString():i,void 0===this.options.node.get("id")||this.options.action)return this._removeTab(),void(void 0===this.options.node.newCategories.remove(i)&&this.options.node.removedCategories.push(i));var n=o.combine(this.options.node.urlBase(),"categories/"+i),s={"type":"DELETE","url":n};this.options.node.connector&&this.options.node.connector.extendAjaxOptions(s),this.blockActions(),t.ajax(s).done(e.bind(function(){this.unblockActions(),this._removeTab()},this)).fail(e.bind(function(t){this.unblockActions();var i=this._getRespError(t),n=this.tabToDelete.model.get("title"),o=T.removeCategoryFailMessageTitle,s=e.str.sformat(T.removeCategoryFailMessage,n,i);p.showError(s,o)},this))}},"_removeTab":function(){if(this.tabToDelete.$el.hasClass("binf-active")){var i=this.tabToDelete._index-1,n=this.tabLinks.children.findByIndex(i);this._autoScrollTabTo(i,{"animationOff":!0}).done(function(){n&&n.activate()})}this.options.collection.remove(this.tabToDelete.model),this.trigger("reset:switch"),setTimeout(e.bind(function(){this._computeTablinkWidth(),this._enableToolbarState();var e=t.Event("tab:content:render");this.$el.trigger(e)},this),300)},"_onRequiredSwitch":function(e){return i.trigger("closeToggleAction"),this._updateScrollbar(),this._hideNotRequiredFormFields(e.on,e),!1},"_hideNotRequiredFormFields":function(i,n){this.tabContent.children.each(function(e){if(e.content.hideNotRequired){var t=e.content.hideNotRequired(i),n=this.tabLinks.children.findByModel(e.model);if(t){var o=i?"addClass":"removeClass";e.$el[o]("binf-hidden hidden-by-switch"),i?this._hideTabLinkByRequiredSwitch(n.$el):this._showTabLinkByRequiredSwitch(n.$el,e.model.get("removeable"))}else this._showTabLinkByRequiredSwitch(n.$el,e.model.get("removeable"))}},this),this.tabLinks.$el.find(".tab-links-first-visible").removeClass("tab-links-first-visible"),this.tabContent.onReorder();for(var o,s=this.tabLinks.children._views,a=Object.keys(s).sort(function(e,t){return s[e]._index-s[t]._index}),r=0;r<a.length;r++)if(!this.tabLinks.children._views[a[r]].$el.hasClass("binf-hidden")){o=this.tabLinks.children._views[a[r]];break}o&&o.$el.addClass("tab-links-first-visible"),o&&!o.isActive()&&o.activate(),setTimeout(e.bind(function(){this._computeTablinkWidth(),this._enableToolbarState();var e=t.Event("tab:content:render");this.$el.trigger(e),n&&(this.currentTabPosition=1)},this),300)},"_getRespError":function(e){var i="";return e&&e.responseJSON&&e.responseJSON.error?i=e.responseJSON.error:s.MessageHelper.hasMessages()&&(i=t(s.MessageHelper.toHtml()).text(),s.MessageHelper.clear()),i}});return e.extend(E.prototype,l),E}),csui.define("csui/widgets/metadata/metadata.properties.view",["csui/widgets/metadata/impl/metadata.properties.view","css!csui/widgets/metadata/impl/metadata"],function(e){return e.extend({"constructor":function(t){e.prototype.constructor.apply(this,arguments)},"validateForms":function(){return e.prototype.validateForms.apply(this,arguments)},"getFormsValues":function(){return e.prototype.getFormsValues.apply(this,arguments)}})}),csui.define("csui/widgets/metadata/impl/metadata.properties.content.view",["csui/lib/underscore","csui/lib/marionette","csui/utils/nodesprites","csui/widgets/metadata/metadata.properties.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin"],function(e,t,i,n,o){var s=t.ItemView.extend({"className":"metadata-inner-wrapper","constructor":function(e){this.options=e,t.ItemView.prototype.constructor.call(this,e);var i={"context":this.options.context,"node":this.options.model,"containerCollection":this.options.containerCollection,"metadataView":this.options.metadataView,"blockingParentView":this.options.blockingParentView,"selectedProperty":this.options.selectedProperty,"notTabableRegion":!0};this.childTabPanelView=new n(i),this.propagateEventsToViews(this.childTabPanelView)},"render":function(){this._ensureViewIsIntact(),this.triggerMethod("before:render",this);var e=this.childTabPanelView.render();return t.triggerMethodOn(e,"before:show",e,this),this.$el.append(e.el),t.triggerMethodOn(e,"show",e,this),this.triggerMethod("render",this),this},"onBeforeDestroy":function(){this.childTabPanelView.destroy()},"onPanelActivated":function(){this.childTabPanelView&&this.childTabPanelView.triggerMethod("panel:activated")}});return e.extend(s.prototype,o),s}),csui.define("csui/utils/versions.default.action.items",["csui/lib/underscore","csui/models/actionitems","csui-ext!csui/utils/versions.default.action.items"],function(e,t,i){"use strict";var n=new t([{"type":144,"signature":"VersionOpen","sequence":10}]);return i&&n.add(e.flatten(i,!0)),n}),csui.define("csui/widgets/metadata/impl/versions/metadata.versions.columns",["csui/lib/backbone","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t){var i=e.Model.extend({"idAttribute":"key","defaults":{"key":null,"sequence":0}}),n=e.Collection.extend({"model":i,"comparator":"sequence","getColumnKeys":function(){return this.pluck("key")},"deepClone":function(){return new n(this.map(function(e){return e.attributes}))}});return new n([{"key":"version_number_name","align":"center","title":t.versionColumnVersionNumberTitle,"sequence":10},{"key":"name","sequence":20},{"key":"create_date","sequence":30},{"key":"owner_id","sequence":40},{"key":"file_size","align":"right","title":t.versionColumnSizeTitle,"sequence":50}])}),csui.define("csui/widgets/metadata/versions.toolbaritems.mask",["module","csui/lib/underscore","csui/controls/toolbar/toolitems.mask","csui/utils/toolitem.masks/global.toolitems.mask","csui-ext!csui/widgets/metadata/versions.toolbaritems.mask"],function(e,t,i,n,o){"use strict";return o||(o=[]),i.extend({"constructor":function(o){var s=e.config(),a=new n;i.prototype.constructor.call(this,a,{"normalize":!1}),t.each(s,function(e,t){this.extendMask(e)},this),this.storeMask(),this.context=o.context,this.node=o.node?o.node:o.model,this._updateMask(),this.listenTo(this.node,"change:id",this._updateMask)},"_updateMask":function(){var e=this.restoreMask({"silent":!0});o.forEach(function(t){(t=t({"context":this.context,"node":this.node
}))&&(e=this.extendMask(t,{"silent":!0})||e)},this),e&&this.trigger("update",this)}})}),csui.define("hbs!csui/widgets/metadata/impl/versions/metadata.versions",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="csui-metadata-versions">\r\n  <div class="csui-metadata-versions-rowselection-toolbar-view"></div>\r\n  <div class="csui-table-view"></div>\r\n  <div class="csui-pagination-view"></div>\r\n</div>'}});return i.registerPartial("csui_widgets_metadata_impl_versions_metadata.versions",n),n}),csui.define("css!csui/widgets/metadata/impl/versions/metadata.versions",[],function(){}),csui.define("csui/widgets/metadata/impl/versions/metadata.versions.view",["module","csui/lib/jquery","csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/globalmessage/globalmessage","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/controls/toolbar/toolitems.filtered.model","csui/controls/toolbar/toolbar.view","csui/controls/toolbar/delayed.toolbar.view","csui/controls/table/table.view","csui/controls/pagination/nodespagination.view","csui/utils/versions.default.action.items","csui/utils/commands/versions","csui/controls/table.rowselection.toolbar/table.rowselection.toolbar.view","csui/controls/toolbar/toolbar.command.controller","csui/models/nodes","csui/models/columns","csui/models/nodeversions","csui/models/version","csui/widgets/metadata/impl/versions/metadata.versions.columns","csui/widgets/metadata/versions.toolbaritems","csui/widgets/metadata/versions.toolbaritems.mask","hbs!csui/widgets/metadata/impl/versions/metadata.versions","css!csui/widgets/metadata/impl/versions/metadata.versions"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p,g,f,b,w,v,_,y,T,V,x){"use strict";var C=/\baccessibleTable\b(?:=([^&]*)?)?/i.exec(location.search);C=C&&"false"!==C[1];var I=e.config();i.defaults(I,{"defaultPageSize":30,"defaultPageSizes":[30,50,100],"enabled":!0});var k=o.LayoutView.extend({"className":function(){var e="metadata-inner-wrapper";return C&&(e+=" csui-no-animation"),e},"template":x,"ui":{"tableRowSelectionToolbarView":".csui-metadata-versions-rowselection-toolbar-view","tableView":".csui-table-view","childContainer":".csui-table-view","paginationView":".csui-pagination-view"},"regions":{"tableRowSelectionToolbarRegion":"@ui.tableRowSelectionToolbarView","tableRegion":"@ui.tableView","paginationRegion":"@ui.paginationView"},"constructor":function e(t){this.commands=t.commands||p,i.defaults(t,{"pageSize":I.defaultPageSize,"ddItemsList":I.defaultPageSizes,"toolbarItems":T,"originatingView":t.originatingView||t.metadataView}),e.__super__.constructor.call(this,t),this.selectedNodes=new b,this.collection=new v(void 0,{"node":this.options.model,"autoreset":!0,"expand":"user","commands":p.getAllSignatures(),"onlyClientSideDefinedColumns":!0}),this.options.model.versions=this.collection,this.commandController=new f({"commands":this.commands}),this.collection.delayedActions&&this.listenTo(this.collection.delayedActions,"error",function(e,t,i){var n=new s.Error(t);a.showMessage("error",n.message)}),this.defaultActionItems=m,this.options.toolbarItemsMasks||(this.options.toolbarItemsMasks=new V(this.options)),this._setTableView(),this._setTableRowSelectionToolbar({"toolItemFactory":this.options.toolbarItems.tableHeaderToolbar,"toolbarItemsMask":this.options.toolbarItemsMasks,"commands":this.options.commands||p}),this._setTableRowSelectionToolbarEventListeners(),this._setPagination(),this.collection.fetch(),this.propagateEventsToRegions(),this.listenTo(this.collection,"add",this._updateCollection).listenTo(this.collection,"remove",this._updateCollection)},"onRender":function(){this.tableRowSelectionToolbarRegion.show(this._tableRowSelectionToolbarView),this.tableRegion.show(this.tableView),this.paginationRegion.show(this.paginationView)},"_updateCollection":function(){this.collection.fetch()},"_setTableView":function(){this.options||(this.options={});var e=i.extend({"tableColumns":y,"connector":this.model.connector,"collection":this.collection,"columns":this.collection.columns,"columnsWithSearch":[],"orderBy":"version_number_name desc","actionItems":m,"commands":p,"originatingView":this.options.originatingView},this.options);delete e.blockingParentView,i.contains(this.options.ddItemsList,this.options.pageSize)||(this.options.ddItemsList.push(this.options.pageSize),this.options.ddItemsList.sort()),this.tableView=new u(e);var t={"context":this.options.context,"originatingView":this};this.listenTo(this.tableView,"execute:defaultAction",function(e){var i=this.defaultActionItems.find(function(t){if(t.get("type")===e.get("type"))return!0},this),n=p.get(i.get("signature")),o={"nodes":new v([e])};n.execute(o,t)})},"_setTableRowSelectionToolbar":function(e){this._tableRowSelectionToolbarView=new g({"toolItemFactory":e.toolItemFactory,"toolbarItemsMask":e.toolbarItemsMask,"toolbarCommandController":this.commandController,"commands":p,"selectedChildren":this.tableView.selectedChildren,"container":this.collection.node,"context":this.options.context,"originatingView":this.options.originatingView,"collection":this.collection})},"_setTableRowSelectionToolbarEventListeners":function(){this.listenTo(this.tableView.selectedChildren,"reset",function(){this.tableView.selectedChildren.length>0?this.tableRowSelectionToolbarRegion.$el.addClass("csui-metadata-versions-rowselection-toolbar-visible"):this.tableRowSelectionToolbarRegion.$el.removeClass("csui-metadata-versions-rowselection-toolbar-visible")})},"_setPagination":function(){this.paginationView=new h({"collection":this.collection,"pageSize":this.options.pageSize,"defaultDDList":this.options.ddItemsList,"skipPaginationUpdateRequest":!0})}},{"enabled":function(e){return!1!==I.enabled&&(!(e.node instanceof _)&&i.contains([144,736,5574],e.node.get("type")))}});return i.extend(k.prototype,r),k}),csui.define("csui/widgets/metadata/metadata.panels",["csui/lib/underscore","csui/lib/backbone","csui/widgets/metadata/impl/metadata.properties.content.view","csui/widgets/metadata/impl/versions/metadata.versions.view","i18n!csui/widgets/metadata/impl/nls/lang","csui-ext!csui/widgets/metadata/metadata.panels"],function(e,t,i,n,o,s){var a=t.Model.extend({"defaults":{"sequence":100,"title":null,"contentView":null,"contentViewOptions":null},"constructor":function(e,i){t.Model.prototype.constructor.apply(this,arguments)}}),r=t.Collection.extend({"model":a,"comparator":"sequence","constructor":function(e,i){t.Collection.prototype.constructor.apply(this,arguments)}}),l=new r([{"title":o.properties,"name":"properties","sequence":10,"contentView":i},{"title":o.versions,"name":"versions","sequence":20,"contentView":n}]);if(s){l.add(e.flatten(s,!0));var d=1;l.forEach(function(e){void 0===e.get("name")&&(e.set("name","unnamed_panel"+d,{"silent":!0}),d++)})}return l}),csui.define("hbs!csui/controls/tab.panel/impl/tab.link.dropdown",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o;return'<a href="#'+this.escapeExpression((o=null!=(o=t.uniqueTabId||(null!=e?e.uniqueTabId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"uniqueTabId","hash":{}}):o))+'" data-binf-toggle="tab">\r\n  <span class="cs-label">'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+"</span>\r\n</a>\r\n"}});return i.registerPartial("csui_controls_tab.panel_impl_tab.link.dropdown",n),n}),csui.define("csui/controls/tab.panel/impl/tab.link.dropdown.view",["csui/lib/underscore","csui/controls/tab.panel/impl/tab.link.view","hbs!csui/controls/tab.panel/impl/tab.link.dropdown","csui/lib/binf/js/binf"],function(e,t,i){"use strict";return t.extend({"template":i,"attributes":function(){var e=this.model.get("title");return{"id":"tablink-"+this.model.get("uniqueTabId"),"role":"menuitem","aria-label":e,"title":e}},"constructor":function(){t.prototype.constructor.apply(this,arguments),this.listenTo(this.model,"change",this.render),this.$el.bind("click",">a",e.bind(this._linkClicked,this))},"onBeforeDestroy":function(){this.$el.unbind("click",">a")},"activate":function(){this.$el.hasClass("binf-active")||(this.triggerMethod("clear:active:tab"),this.ui.link.binf_tab("show"));var e=this.model.collection.indexOf(this.model);this._parent.options.activeTab&&this._parent.options.activeTab.set("tabIndex",e),this.triggerMethod("activate:tab",this),this.triggerMethod("click:link")},"_linkClicked":function(e){e.preventDefault(),e.stopPropagation(),this.activate()}})}),csui.define("hbs!csui/controls/tab.panel/impl/tab.links.dropdown",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"1":function(e,t,i,n){var o;return'  <button id="'+this.escapeExpression((o=null!=(o=t.btnId||(null!=e?e.btnId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"btnId","hash":{}}):o))+'" type="button" class="binf-btn binf-btn-default"\r\n          aria-label="'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+'">\r\n    <span class="cs-label">'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+"</span>\r\n  </button>\r\n"},"3":function(e,t,i,n){var o;return'  <button id="'+this.escapeExpression((o=null!=(o=t.btnId||(null!=e?e.btnId:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"btnId","hash":{}}):o))+'" type="button" class="binf-btn binf-btn-default binf-dropdown-toggle"\r\n          data-binf-toggle="dropdown" aria-haspopup="true" aria-expanded="false"\r\n          aria-label="'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+'">\r\n    <span class="cs-label">'+this.escapeExpression((o=null!=(o=t.title||(null!=e?e.title:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"title","hash":{}}):o))+'</span>\r\n    <span class="cs-icon icon-caret-down" title="'+this.escapeExpression((o=null!=(o=t.addToolTipContent||(null!=e?e.addToolTipContent:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{"name":"addToolTipContent","hash":{}}):o))+'"></span>\r\n  </button>\r\n'},"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o,s;return'<span class="dropdown-label">'+this.escapeExpression((s=null!=(s=t.title||(null!=e?e.title:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"title","hash":{}}):s))+"</span>\r\n"+(null!=(o=t.if.call(e,null!=e?e.single_item:e,{"name":"if","hash":{},"fn":this.program(1,n,0),"inverse":this.program(3,n,0)}))?o:"")+'<ul class="binf-dropdown-menu" role="menu" aria-labelledby="'+this.escapeExpression((s=null!=(s=t.btnId||(null!=e?e.btnId:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"btnId","hash":{}}):s))+'">\r\n</ul>\r\n'}});return i.registerPartial("csui_controls_tab.panel_impl_tab.links.dropdown",n),n}),csui.define("csui/controls/tab.panel/behaviors/tab.links.dropdown.keyboard.behavior",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/log","csui/lib/marionette","csui/controls/tab.panel/behaviors/common.keyboard.behavior.mixin"],function(e,t,i,n,o,s){"use strict";return o.Behavior.extend({"constructor":function(e,i){o.Behavior.prototype.constructor.apply(this,arguments),i.keyboardBehavior=this,this.tabableElements=[];var n=this;this.listenTo(i,"refresh:tabable:elements",function(e){n.refreshTabableElements(i,e)}),s.mixin(i),t.extend(i,{"onKeyInView":function(e){var t;return 0===this.keyboardBehavior.tabableElements.length?t:(9===e.keyCode&&(t=this._accSetFocusToPreviousOrNextElement(e.shiftKey)),t)}})},"refreshTabableElements":function(e,t){this.tabableElements=e.$el.find("button:not([disabled])").filter(":visible"),this.view.currentTabPosition=-1,setTimeout(function(){e._setFirstAndLastFocusable&&e._setFirstAndLastFocusable()},50)}})}),csui.define("css!csui/controls/tab.panel/impl/tab.links.dropdown",[],function(){}),csui.define("csui/controls/tab.panel/tab.links.dropdown.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/controls/tab.panel/impl/tab.link.dropdown.view","hbs!csui/controls/tab.panel/impl/tab.links.dropdown","csui/controls/tab.panel/behaviors/tab.links.dropdown.keyboard.behavior","csui/behaviors/dropdown.menu/dropdown.menu.behavior","i18n!csui/controls/tab.panel/impl/nls/lang","css!csui/controls/tab.panel/impl/tab.links.dropdown","csui/lib/binf/js/binf"],function(e,t,i,n,o,s,a,r){"use strict";return i.CompositeView.extend({"className":"cs-tab-links binf-dropdown tile-nav","template":o,"templateHelpers":function(){return{"single_item":1===this.collection.length,"addToolTipContent":r.showMore,"btnId":e.uniqueId("cstabBtn")}},"childView":n,"childViewContainer":">ul","ui":{"toggle":">.binf-dropdown-toggle","menuButton":">.binf-btn","selectedLabel":">.binf-btn >.cs-label"},"behaviors":{"TabLinksDropdownKeyboardBehavior":{"behaviorClass":s},"DropdownMenuBehavior":{"behaviorClass":a}},"constructor":function(e){i.CompositeView.prototype.constructor.apply(this,arguments),this.selected=new t.Model;var n=e.activeTab&&e.activeTab.get("tabIndex");if(this.collection&&this.collection.length>0&&void 0!==n&&n<this.collection.length){var o=e.selectedTab&&e.selectedTab.get("title");if(void 0!==o&&o===this.collection.at(n).get("title"))this._setSelection(this.collection.at(n));else{var s=-1;if(void 0!==o)for(var a=0;a<this.collection.length;a++)o===this.collection.at(a).get("title")&&(s=a);-1!==s?(this._setSelection(this.collection.at(s)),e.activeTab.set("tabIndex",s)):(this._setSelection(this.collection.at(0)),e.activeTab.set("tabIndex",0))}}this.listenTo(this.collection,"change",this._refreshSelection),this.listenTo(this.selected,"change",this._updateSelection)},"onRender":function(){var e=this.selected.get("title");this.ui.selectedLabel.text(e),this.ui.menuButton.attr("aria-label",e),1!==this.collection.length&&this.ui.toggle.binf_dropdown();for(var t=this.selected.get("id"),i=0;i<this.collection.length;i++)if(t===this.collection.at(i).get("id")){var n=this.$el.find("ul li");n.removeClass("binf-active"),this.$(n.get(i)).addClass("binf-active");break}},"onChildviewClickLink":function(e){this._setSelection(e.model),this.ui.toggle.binf_dropdown("toggle")},"onChildviewClearActiveTab":function(e){this.children.each(function(e){e.$el.hasClass("binf-active")&&e.$el.removeClass("binf-active")})},"_setSelection":function(e){this.selected.set(e.pick("id","title"))},"_updateSelection":function(){var e=this.selected.get("title");this.ui.selectedLabel.text(e),this.ui.menuButton.attr("aria-label",e)},"_refreshSelection":function(e){e.get("id")===this.selected.get("id")&&this._setSelection(e)}})}),csui.define("csui/widgets/metadata/impl/metadata.dropdowntab.view",["require","csui/lib/underscore","csui/lib/backbone","csui/controls/tab.panel/tab.panel.view","csui/widgets/metadata/metadata.panels","csui/controls/tab.panel/tab.links.dropdown.view","csui/models/browsing.state/nodes/nodes.browsing.state","csui/utils/contexts/factories/browsing.states","csui/models/version","i18n!csui/widgets/metadata/impl/nls/lang","csui/lib/binf/js/binf"],function(e,t,i,n,o,s,a,r,l,d){"use strict";return n.extend({"className":"metadata-content-wrapper binf-panel binf-panel-default","ui":{"dropdownToggle":".binf-dropdown-toggle"},"contentView":function(){return this.options.contentView},"contentViewOptions":function(){return{"context":this.options.context,"model":this.options.node,"originatingView":this.options.originatingView,"metadataView":this.options.metadataView,"blockingParentView":this.options.blockingParentView,"selectedProperty":this.options.selectedProperty}},"constructor":function(e){this.options=e||(e={}),t.defaults(e,{"TabLinkCollectionViewClass":s,"implementTabContentsDefaultKeyboardHandling":!1,"delayTabContent":!1!==e.delayTabContent}),e.tabs=this._buildTabs(),n.prototype.constructor.call(this,e),this.browsingStates=this.options.context&&this.options.context.getCollection(r),this.listenTo(this.options.node,"change",this._nodeChanged).listenTo(i,"closeToggleAction",this._closeToggle),this.listenTo(this,"before:destroy",this._clearBrowsingState)},"_buildTabs":function(){return o.chain().filter(function(e){var t=e.get("contentView"),i=t.enabled;return this.options.node.attributes.customProperties?!!e.attributes.executeCommand&&(!i||i({"context":this.options.context,"node":this.options.node})):!i||i({"context":this.options.context,"node":this.options.node})},this).map(function(e){return e.attributes}).value()},"onRender":function(){this.$el.prepend("<div class='csui-metadata-tab-bar'></div>"),this._updateBrowsingState()},"onActivateTab":function(e,t,i){e&&e.triggerMethod("panel:activated"),this._updateBrowsingState()},"_updateBrowsingState":function(){if(this.browsingStates&&this.options.node){var e=!1,i=this.browsingStates.at(this.browsingStates.length-1),n=i&&i.get("id"),o="metadata",s=d.properties,r="",c=this.options.node.get("name"),u={"path":{},"query":{}};u.path.node_id=this.options.node.get("id");var h=this.options.container||this.options.containerCollection;u.query.perspective=h?"metadata.navigation":"metadata",h&&h.get("id")===this.options.node.get("id")&&(u.query.perspective="metadata"),this.options.node instanceof l&&(u.path.version_num=this.options.node.get("version_number"),o="version",r=t.str.sformat(d.versionNumInBrowserTitle,u.path.version_num));var m=this.options.activeTab&&this.options.activeTab.get("tabIndex");if(void 0!==m&&this.options.collection&&m>=0&&m<this.options.collection.length){var p=this.options.collection.at(m);u.query.panel=p&&p.get("name");var g=p&&p.get("title");g&&(s=g)}if(r.length>0&&(s=r+" "+s),u.path.node_name=c+" - "+s,n!==o)u.query.container_id=this.options.node.get("parent_id"),i=new a(u),i.set("id",o,{"silent":!0}),this.browsingStates.push(i,{"silent":!0}),this.browsingState=i,e=!0;else{var f=i.get("path")||{},b=i.get("query")||{};u.query=t.extend({},b,u.query),u.path.node_id===f.node_id&&u.path.version_num===f.version_num&&u.query.panel===b.panel||(e=!0),i.set(u,{"silent":!0})}e&&this.browsingStates.allowUrlUpdate?this.browsingStates.trigger("state:change"):!0===this.browsingStates.updateBrowserTitleAfterPageLoaded&&(this.browsingStates.updateBrowserTitleAfterPageLoaded=!1,this.browsingStates.trigger("update:title"))}},"_clearBrowsingState":function(){this.browsingStates&&this.browsingState&&this.options.node&&(this.browsingStates.remove(this.browsingState,{"silent":!0}),this.browsingState=void 0)},"_closeToggle":function(){var e=this.$el.find(".binf-dropdown-toggle");e.parent().hasClass("binf-open")&&e.binf_dropdown("toggle")},"_updateTabs":function(){var e=this._buildTabs();this.collection.reset(this._convertCollection({"tabs":e}).models)},"_nodeChanged":function(){(this.options.node.hasChanged("id")||this.options.node.hasChanged("type"))&&this._updateTabs()}})}),csui.define("csui/widgets/metadata/impl/metadata.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","csui/utils/base"],function(e,t,i,n,o){function s(e,t,i){this.status=e||{},this.options=t||{},this.attributes=i||{}}return e.extend(s.prototype,i.Events,{"save":function(e,t){return e.save(t,{"wait":!0,"patch":!0})},"createItem":function(e,t){return e.save(void 0,{"data":t,"wait":!0})}}),s.prototype.get=i.Model.prototype.get,e.extend(s,{"version":"1.0"}),s}),csui.define("csui/widgets/metadata/metadata.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/utils/base","csui/widgets/metadata/impl/header/metadata.header.view","csui/widgets/metadata/impl/metadata.dropdowntab.view","csui/models/node/node.model","csui/utils/contexts/factories/node","csui/utils/contexts/factories/browsing.states","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/widgets/metadata/impl/metadata.controller","csui/utils/nodesprites","csui/controls/progressblocker/blocker","csui/utils/commandhelper","csui/widgets/permissions/permissions.view","csui/models/nodechildren","csui/models/version","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p,g,f,b,w,v){var _=i.ItemView.extend({"className":"cs-metadata","template":!1,"constructor":function(n){var a=this;n||(n={}),n.data||(n.data={}),this.options=n,n.model||(n.model=n.context.getModel(r,{"attributes":n.data.id&&{"id":n.data.id},"temporary":!0})),n.model.unset("initialPanel",{"silent":!0}),n.data.initialPanel&&n.model.set("initialPanel",n.data.initialPanel,{"silent":!0}),this.browsingStates=n.context.getCollection(l);var d=this.browsingStates.at(this.browsingStates.length-1),c=d&&d.get("query"),u=c&&c.perspective;if("metadata"===u||"metadata.navigation"===u){var m=c&&c.panel;m&&n.model.set("initialPanel",m,{"silent":!0});var g=d&&d.get("path"),b=g&&g.version_num;!b||n.model instanceof f||(n.model=new f({"id":n.model.get("id"),"version_number":b,"initialPanel":n.model.get("initialPanel")},{"connector":n.model.connector}),this._ensureCompleteVersionNode())}if(this.options.showShortcutSwitch=!0,this.options.showRequiredFieldsSwitch=!0,1===this.options.model.get("type")||this.options.model.get("shortcutNode")){if(this.options.model.get("shortcutNode")&&1!==this.options.model.get("type"))this.options.shortcutNode=this.options.model.get("shortcutNode");else{this.options.model.connector.assignTo(this.options.model.original),this.options.shortcutNode=this.options.model;var w=this.options.shortcutNode.getResourceScope();this.options.model.original.setResourceScope(w),this.options.model=this.options.model.original,this.options.model.set("shortcutNode",this.options.shortcutNode,{"silent":!0})}this.options.actionsPromise=this._ensureCompleteNode()}else this.options.actionsPromise=t.Deferred().resolve().promise();this.options.originatingView&&this.options.originatingView.supportOriginatingView&&(this.options.baseOriginatingView=this.options.originatingView,this.options.originatingView=this),i.ItemView.prototype.constructor.call(this,n),h.imbue(this),this.options.showDropdownMenu=!0,this.options.originatingView=this.options.originatingView||this,this.metadataHeaderView=new o(e.extend({"metadataScenario":!0,"originatingView":this},this.options)),this.listenTo(this.metadataHeaderView,"metadata:item:name:save",this._saveItemName).listenTo(this.metadataHeaderView,"metadata:item:before:delete",function(e){a.trigger("metadata:item:before:delete",e)}).listenTo(this.metadataHeaderView,"metadata:item:before:move",function(e){a.trigger("metadata:item:before:move",e)}).listenTo(this.metadataHeaderView,"metadata:item:deleted",function(e){a.trigger("metadata:item:deleted",e)}).listenTo(this.metadataHeaderView,"shortcut:switch",function(e){a.options.model=e.node,a.options.model.set("shortcutNode",a.model.get("shortcutNode"),{"silent":!0}),this._ensureCompleteNode().always(function(){!!a.metadataTabView&&a.metadataTabView.destroy(),a.options.showPermissionView?a.metadataTabView=new p({"model":a.options.model,"originatingView":a.options.originatingView,"context":a.options.context,"showCloseIcon":!a.options.originatingView,"showBackIcon":!!a.options.originatingView,"selectedTab":status.selectedTab,"selectedProperty":a.options.selectedProperty}):a.metadataTabView=new s({"context":a.options.context,"node":a.options.model,"containerCollection":a.options.containerCollection,"originatingView":a.options.originatingView,"metadataView":a,"activeTab":a.options.activeTab,"delayTabContent":a.options.delayTabContent}),a.$el.append(a.metadataTabView.render().$el),a.propagateEventsToViews(a.metadataTabView)})}).listenTo(this.metadataHeaderView,"metadata:close",function(){a.trigger("metadata:close")}).listenTo(this.options.context,"request",function(){a._closeMetadata()}).listenTo(this.options.context,"request:perspective",function(){a._closeMetadata()});var v={"context":this.options.context,"node":this.options.model,"containerCollection":this.options.containerCollection,"originatingView":this.options.originatingView,"metadataView":this,"blockingParentView":this,"activeTab":this.options.activeTab,"selectedTab":this.options.selectedTab,"selectedProperty":this.options.selectedProperty,"delayTabContent":a.options.delayTabContent};this.options.showPermissionView?this.options.actionsPromise.always(function(){a.metadataTabView=new p({"model":a.options.model,"originatingView":a.options.originatingView,"context":a.options.context,"showCloseIcon":!a.options.originatingView,"showBackIcon":!!a.options.originatingView,"selectedTab":status.selectedTab,"selectedProperty":a.options.selectedProperty}),a.propagateEventsToViews(a.metadataTabView,a.metadataHeaderView)}):(this.metadataTabView=new s(v),this.propagateEventsToViews(this.metadataTabView,this.metadataHeaderView))},"onRender":function(){var t=this.options.model.fetching;if(t)return t.always(e.bind(this.render,this));var n=this.metadataHeaderView.render(),o=this.metadataTabView.render();i.triggerMethodOn(n,"before:show",n,this),i.triggerMethodOn(o,"before:show",o,this),this.$el.append(n.el),this.$el.append(o.el),i.triggerMethodOn(n,"show",n,this),i.triggerMethodOn(o,"show",o,this)},"onBeforeDestroy":function(){this.cancelEventsToViewsPropagation(this.metadataTabView,this.metadataHeaderView),this.metadataHeaderView.destroy(),this.metadataTabView.destroy()},"_saveItemName":function(t){var i,n=this,o=t.sender.getValue(),s={"name":o},a=new c,r=this.options.model;this.options.collection;if(this.options.shortcutNode&&this.options.shortcutNode.original===r){var l=this.options.collection.findWhere({"id":r.get("id")});l?(i=r,r=l):void 0}n._blockActions(),a.save(r,s).done(function(){return r.fetch().then(function(){i&&i.set(r.attributes),t.success&&t.success(),n._unblockActions(),n.options.originatingView&&e.isFunction(n.options.originatingView.unblockActions)&&n.options.originatingView.unblockActions()})}).fail(function(e){n._unblockActions();var i=m._getErrorMessageFromResponse(e);void 0===i&&(i=v.failedToSaveName),t.error&&t.error(i)})},"_ensureCompleteVersionNode":function(){return this._blockActions(),this.options.model.fetch().always(e.bind(this._unblockActions,this)).fail(function(e){var t=new n.Error(e);b.showError(t.message)})},"_ensureCompleteNode":function(){function i(t){var i=o.get(t+"_id");if(i&&!e.isObject(i)&&!e.isObject(o.get(t+"_id_expand")))return o.setExpand("properties",t),!0}var o=this.options.model,s=e.invoke(["original","parent","create_user","modify_user","owner_user","reserved_user"],i);s=e.contains(s,!0);var a=o.actions.length<=1;return s||a?(this._blockActions(),o.fetch().always(e.bind(this._unblockActions,this)).fail(e.bind(function(e){var t=new n.Error(e);b.showError(t.message)},this))):t.Deferred().resolve().promise()},"_closeMetadata":function(){var e=this.options.model;1===e.get("type")&&e.original&&0===e.original.get("type")?this.trigger("metadata:close"):this.trigger("metadata:close:without:animation")},"_blockActions":function(){var e=this.options.originatingView;e&&e.blockActions&&e.blockActions()},"_unblockActions":function(){var e=this.options.originatingView;e&&e.unblockActions&&e.unblockActions()}});return e.extend(_.prototype,d),_}),csui.define("csui/widgets/metadata/metadata.action.one.item.properties.view",["module","csui/lib/underscore","csui/lib/jquery","csui/lib/marionette","csui/widgets/metadata/impl/header/metadata.header.view","csui/widgets/metadata/metadata.properties.view","csui/utils/log","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,s,a,r){var l=n.ItemView.extend({"className":"cs-add-item-metadata-form","template":!1,"constructor":function(e){e||(e={}),this.options=e,n.ItemView.prototype.constructor.apply(this,arguments),e.showRequiredFieldsSwitch=!0,this.metadataHeaderView=new o(e),this.listenTo(this.metadataHeaderView,"metadata:item:name:save",this._saveItemName),this.listenTo(this.metadataHeaderView,"update:button",t.bind(function(e){this.trigger("update:button",e)},this)),this.metadataPropertiesView=new s({"node":e.model,"collection":e.collection,"container":e.container,"context":e.context,"formMode":"create","action":e.action,"inheritance":e.inheritance,"metadataView":this,"formCollection":e.formCollection,"suppressAddProperties":e.suppressAddProperties}),e.collection||this.listenTo(this.metadataPropertiesView.allForms,"sync",this._updateSchema),this.listenTo(this.metadataPropertiesView,"render:forms",this.setNameFieldFocus),this.propagateEventsToViews(this.metadataHeaderView,this.metadataPropertiesView)},"_updateSchema":function(){var e=this.metadataPropertiesView.allForms.first(),t=e&&e.get("schema"),i=t&&t.properties&&t.properties.name;i?this.metadataHeaderView.metadataItemNameView.updateNameSchema(i):a.warn("Form collection lacks name field in the first form.")&&console.warn(a.last)},"onRender":function(){var e=this.metadataHeaderView.render(),t=this.metadataPropertiesView.render();n.triggerMethodOn(e,"before:show",e,this),n.triggerMethodOn(t,"before:show",t,this),!0!==this.options.suppressHeaderView&&this.$el.append(e.el),this.$el.append(t.el),this.options.suppressHeaderView&&this.$el.addClass("without-header-bar"),this.options.extraViewClass&&this.$el.addClass(this.options.extraViewClass),n.triggerMethodOn(e,"show",e,this),n.triggerMethodOn(t,"show",t,this)},"onBeforeDestroy":function(){this.cancelEventsToViewsPropagation(this.metadataHeaderView,this.metadataPropertiesView),this.metadataHeaderView.destroy(),this.metadataPropertiesView.destroy()},"validate":function(){var e=this.metadataHeaderView.validateName(),t=this.metadataPropertiesView.validateForms();return e&&t},"getValues":function(){var e={};if(this.validate()){e={"name":this.metadataHeaderView.getNameValue(),"type":this.options.model.get("type"),"parent_id":this.options.model.get("parent_id")};var i=this.metadataPropertiesView.getFormsValues();t.extend(e,i)}return e},"setNameFieldFocus":function(){!0!==this.firstFocusCalled&&!0!==this.options.suppressHeaderView&&this.metadataHeaderView.setNameEditModeFocus(),this.firstFocusCalled=!0},"_saveItemName":function(e){var t=e.sender.getValue();this.model.set("name",t,{"silent":!0}),e.success&&e.success()}});return l.version="1.0",t.extend(l.prototype,r),l}),csui.define("csui/widgets/metadata/impl/common/base.metadata.action.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/controls/dialog/dialog.view","csui/controls/progressblocker/blocker","i18n!csui/widgets/metadata/impl/nls/lang","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,s){function a(){}return e.extend(a.prototype,i.Events,{"baseDisplayForm":function(i){if(i||(i={}),this.options=i,this.deferred=t.Deferred(),i.view&&o.imbue(i.view),i.originatingView);else{var a=i.dialogOptions||{},r=a.OkButtonClick||this._cancelAction,l=a.CancelButtonClick||this._cancelAction,d=[{"id":"okButton","default":!0,"label":a.OkButtonTitle?a.OkButtonTitle:s.defaultDialogOkButtonTitle,"click":e.bind(r,this,i)},{"id":"cancel","label":a.CancelButtonTitle?a.CancelButtonTitle:s.defaultDialogCancelButtonTitle,"click":e.bind(l,this),"actionToken":a.CancelButtonActionToken}];this.options.view.model&&(this.options.view.model.get("name")||(d[0].disabled=!0));var c=a.dialogTitle?a.dialogTitle:s.defaultDialogTitle,u=new n({"className":"cs-item-action-metadata","title":c,"buttons":d,"largeSize":!0,"view":i.view});this.dialog=u,this.listenTo(this.dialog,"hide",this._cancelAction).listenTo(this.dialog,"update:button",e.bind(function(e){if(void 0!==e.overlay){
var t=this.dialog.footerView.collection.get("okButton"),i=this.dialog.footerView.children.findByModel(t),n=i&&!i.$el.is(":disabled")&&e.overlay?"addClass":"removeClass";i.$el[n]("cs-button-overlay")}else this.dialog.footerView.updateButton("okButton",e)},this)),u.show()}return this.deferred.promise()},"_cancelAction":function(e){!!this.node&&!!this.node.collection&&!!this.node.collection.requireSwitched&&(!!this.node.get("action")||!!this.options.view&&this.options.view.options.action)&&(this.node.collection.requireSwitched=!1),this.options.view&&this.options.view.unblockActions(),this.dialog.destroy(),void 0===e&&(e={"buttonAttributes":{"actionToken":"closeMetadataActionView"}}),this.deferred.reject(e)}}),a.prototype.get=i.Model.prototype.get,e.extend(a,{"version":"1.0"}),a}),csui.define("csui/widgets/metadata/impl/add.properties/metadata.add.categories.view",["require","csui/lib/underscore","csui/lib/jquery","csui/utils/url","csui/utils/log","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/forms","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,s,a,r,l){"use strict";function d(){}return t.extend(d.prototype,s.prototype,{"displayForm":function(e){var t=i.Deferred(),n=this;e||(e={}),this.node=e.model,this.catId=e.catId,this.catName=e.catName;var s=new a([e.catModel]);return s.fetching=!1,s.fetched=!0,csui.require(["csui/widgets/metadata/metadata.action.one.item.properties.view"],function(i){n.metadataAddItemPropView=new i({"model":e.model,"collection":s,"context":e.context,"commands":e.commands,"suppressAddProperties":!0,"suppressHeaderView":!0,"extraViewClass":"add-category"});var o={};o.callerProcessData=e.callerProcessData,o.originatingView=e.originatingView,o.view=n.metadataAddItemPropView;var a={};a.dialogTitle=e.dialogTitle?e.dialogTitle:r.addNewCategoryDialogTitle,a.OkButtonTitle=e.okButtonTitle?e.okButtonTitle:r.addNewCategoryDialogAddButtonTitle,a.OkButtonClick=n._addCategory,o.dialogOptions=a,n.baseDisplayForm(o).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})},function(e){o.warn("Failed to load MetadataActionOneItemPropertiesView. {0}",e)&&console.log(o.last),t.reject(e)}),t.promise()},"_addCategory":function(e){if(this.metadataAddItemPropView.validate()){this.options.view.$el.find(".cs-formfield-invalid").removeClass("cs-formfield-invalid");var o=this.node.get("id"),s=this.metadataAddItemPropView.getValues(),a={"id":o,"category_id":this.catId};s.roles&&s.roles.categories&&t.each(s.roles.categories,function(e,i){a=t.extend(a,e)});var d=n.combine(this.node.urlBase(),"categories"),c=new FormData,u={"type":"POST","url":d};c.append("body",JSON.stringify(a)),t.extend(u,{"data":c,"contentType":!1,"processData":!1}),this.node.connector&&this.node.connector.extendAjaxOptions(u),this.metadataAddItemPropView.blockActions(),i.ajax(u).done(t.bind(function(e){this.metadataAddItemPropView.unblockActions(),this.dialog.destroy(),this.deferred.resolve(e)},this)).fail(t.bind(function(e){this.metadataAddItemPropView.unblockActions();var i="";e&&e.responseJSON&&e.responseJSON.error&&(i=e.responseJSON.error);var n=r.addNewCategoryFailTitle,s=t.str.sformat(r.addNewCategoryFailMessage,this.catName,this.node.get("name"),o,i);l.showError(s,n)},this))}else this.options.view.$el.find(".binf-has-error .cs-formfield").addClass("cs-formfield-invalid")}}),t.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/metadata.add.categories.controller",["require","csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/utils/url","csui/utils/base","csui/utils/log","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/widgets/metadata/impl/metadata.utils","csui/widgets/metadata/impl/add.properties/metadata.add.categories.view","csui/models/node/node.model","csui/models/appliedcategoryform","csui/dialogs/node.picker/node.picker","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p){"use strict";function g(){}return t.extend(g.prototype,n.Events,{"AddNewCategory":function(e){var n=i.Deferred();return new m({"startLocation":"category.volume","context":e.context,"selectableTypes":[131],"unselectableNodes":e.collection?e.collection.where({"role_name":"categories"}):[],"selectMultiple":!1,"dialogTitle":r.selectCategoryTitle,"globalSearch":!0,"selectButtonLabel":r.selectCategoryButtonLabel}).show().done(t.bind(function(o){t.reduce(o.nodes,function(i,n){return i.then(t.bind(function(){var t=n.get("id"),i=n.get("name");return void 0===e.node.get("id")||e.action?this._loadNewCategoryForm(e,t,i):this._displayAddCategoryForm(e,t,i)},this))},i.Deferred().resolve(),this).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})},this)).fail(function(e){n.reject(e)}),n.promise()},"_displayAddCategoryForm":function(e,t,n){var o=i.Deferred(),s=this;return this._getCategoryModel(e,t,n).done(function(i){var a={"model":e.node,"context":e.context,"commands":p,"catId":t,"catName":n,"catModel":i.catModel};(new c).displayForm(a).done(function(i){s._loadNewCategoryForm(e,t,n,"update").done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})}).fail(function(e){o.reject(e)})}).fail(function(e){o.reject(e)}),o.promise()},"_loadNewCategoryForm":function(e,n,o,s){if(n&&e.collection.get(n)){var a=r.addNewCategoryFailTitle,d=t.str.sformat(r.categoryExistsMessage,o);return l.showError(d,a),i.Deferred().reject({})}var c=i.Deferred();return this._getCategoryModel(e,n,o,s).done(t.bind(function(e){c.resolve(e)},this)).fail(function(e){c.reject(e)}),c.promise()},"_getCategoryModel":function(e,n,s,a){var c=!0;a||(a="create",void 0===e.action&&(c=!1));var u,m=i.Deferred(),p=e.node&&e.node.connector||e.container&&e.container.connector,g=e.node.get("id");if(e.container&&(e.node.pId=e.container.get("id")),void 0===e.node.get("id")&&"create"===e.action)u=o.combine(p.connection.url,"forms/nodes/create?parent_id="+e.container.get("id")+"&type="+e.node.get("type")+"&category_id="+n);else if("copy"===e.action||"move"===e.action){var f=0;"destination"===e.inheritance?f=1:"merged"===e.inheritance&&(f=2),u=o.combine(p.connection.url,"forms/nodes/"+e.action+"?id="+g+"&parent_id="+e.container.get("id")+"&inheritance="+f+"&category_id="+n)}else u=o.combine(p.connection.url,"forms/nodes/categories/"+a+"?id="+g+"&category_id="+n);var b={"type":"GET","url":u};return p.extendAjaxOptions(b),e.parentView&&(e.parentView.blockActions(),e.parentView.trigger("update:button",!0)),i.ajax(b).done(t.bind(function(i){e.parentView&&e.parentView.unblockActions();var o,a,r,l;if("create"===e.action||"copy"===e.action||"move"===e.action?i.forms.length>1&&(o=t.find(i.forms,function(e){return"categories"===e.role_name}))&&(a=o.data[n]||{},r=o.options.fields[n]||{},l=o.schema.properties[n]||{}):(o=i&&i.forms&&i.forms[0],a=o&&o.data||{},r=o.options||{},l=o.schema||{}),o){r.form&&(r=t.omit(r,"form")),void 0===l.title&&s&&(l.title=s);var u=new d,p=u.AlpacaFormOptionsSchemaHaveRequiredFields(r,l),g=new h({"id":n,"title":s||r&&r.fields&&r.fields.category_id&&r.fields.category_id.label,"allow_delete":c,"required":p},{"node":e.node,"categoryId":n,"action":"none"});g.set({"data":a,"options":r,"schema":t.omit(l,"description"),"role_name":"categories","removeable":!0}),m.resolve({"catModel":g})}else m.reject({})},this)).fail(t.bind(function(i){e.parentView&&(e.parentView.unblockActions(),e.parentView.trigger("update:button",!1));var n=this._getRespError(i),o=r.loadNewCategoryFailTitle,a=t.str.sformat(r.loadNewCategoryFailMessage,s,e.node.get("name"),g,n);l.showError(a,o),m.reject(i)},this)),m.promise()},"_getRespError":function(e){var t="";return e&&e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:s.MessageHelper.hasMessages()&&(t=i(s.MessageHelper.toHtml()).text(),s.MessageHelper.clear()),t}}),t.extend(g,{"version":"1.0"}),g}),csui.define("csui/widgets/metadata/metadata.add.item.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/widgets/metadata/impl/metadata.controller","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/utils/commandhelper","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/nodesprites","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,s,a,r,l){function d(){}return e.extend(d.prototype,t.prototype,{"displayForm":function(t,i){var a=o.getAtLeastOneNode(t),d=a.length>0?a.models[0]:null,c=d.get("type_name")?r.findTypeByNode(d):s.addItemMetadataDialogTitleGeneric;this.node=d,this.metadataController=i.metadataController;var u=this.metadataAddItemPropView=new n({"model":d,"container":t.container,"id":i.id,"context":t.context||i&&i.context,"commands":l,"action":"create","inheritance":i.inheritance,"collection":i.completeFormCollection,"formCollection":i.formCollection}),h={};h.callerProcessData=i.callerProcessData,h.originatingView=i.originatingView,h.view=u;var m={};m.dialogTitle=i.dialogTitle?i.dialogTitle:e.str.sformat(s.addItemMetadataDialogTitle1,c),m.OkButtonTitle=i.addButtonTitle?i.addButtonTitle:s.addItemMetadataDialogButtonAddTitle,m.OkButtonClick=this._addItem,m.CancelButtonActionToken=i.cancelButtonActionToken,h.dialogOptions=m;var p=this.baseDisplayForm(h);return this.listenTo(this.metadataAddItemPropView,"update:button",e.bind(function(e){this.dialog&&this.dialog.trigger("update:button",e)},this)),p},"_addItem":function(t){function n(e,t){e&&e.footerView&&e.footerView.getButtons().forEach(function(e){e.updateButton(t)})}if(t.view.metadataPropertiesView.allFormsRendered){var o=!1;!0!==t.callerProcessData&&(n(this.dialog,{"disabled":!0}),o=!0);if(this.metadataAddItemPropView.validate()){var r=this.metadataAddItemPropView.getValues();if(!0===t.callerProcessData)this.dialog.destroy(),this.deferred.resolve({"data":r});else{var l=this.metadataController||new i;this.metadataAddItemPropView.blockActions(),o=!1,l.createItem(this.node,r).done(e.bind(function(e){this.listenToOnce(this.dialog,"hide",function(){this.metadataAddItemPropView.unblockActions(),n(this.dialog,{"disabled":!1})}),this.dialog.destroy(),this.deferred.resolve({"name":r.name})},this)).fail(e.bind(function(e){this.metadataAddItemPropView.unblockActions();var t=s.failedToCreateItem;e&&(e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:e.responseText&&(t=e.responseText),a.showError(t)),n(this.dialog,{"disabled":!1})},this))}}o&&n(this.dialog,{"disabled":!1})}}}),e.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.keyboard.behavior",["module","csui/lib/underscore","csui/lib/jquery","csui/utils/log","csui/lib/marionette"],function(e,t,i,n,o){"use strict";var s={"none":-1,"header":0,"list":1};return o.Behavior.extend({"constructor":function(e,n){o.Behavior.prototype.constructor.apply(this,arguments),n.keyboardBehavior=this,this.tabableElements=[];var a=this;this.listenTo(n,"show",function(){a.refreshTabableElements(n)}),this.listenTo(n,"click:item",function(e){var t=n.selectedIndex,i=n.selectedIndexElem(t);i&&i.prop("tabindex","-1"),n.currentTabPosition=s.list,n.selectedIndex=n.collection.indexOf(e.model)}),t.extend(n,{"_focusHeader":function(){if(!0===this.headerFocusable&&this.headerElement)return this.currentTabPosition=s.header,i(this.ui.header)},"_focusList":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.currentTabPosition=s.list,this.getSelectedItem().$el},"_setFocus":function(){return!0===this.headerFocusable&&this.headerElement?this._focusHeader():this._focusList()},"_headerIsInFocus":function(){return this.$(this.ui.header).is(":focus")},"_listIsInFocus":function(){var e,t=!1;for(e=0;e<this.collection.length;e++){var i=this.selectedIndexElem(e);if(i&&i.is(":focus")){t=!0;break}}return t},"_checkFocusAndSetCurrentTabPosition":function(){this._headerIsInFocus()?this.currentTabPosition=s.header:this._listIsInFocus()?this.currentTabPosition=s.list:this.currentTabPosition=s.none},"_setFirstAndLastFocusable":function(){!0===this.headerFocusable&&i(this.ui.header).prop("tabindex","0"),this.getSelectedItem()&&this.getSelectedItem().$el.prop("tabindex","0")},"currentlyFocusedElement":function(e){return this._checkFocusAndSetCurrentTabPosition(),this._setFirstAndLastFocusable(),e&&e.shiftKey?this._focusList():this.currentTabPosition===s.header?this._focusHeader():this.currentTabPosition===s.list?this._focusList():this._setFocus()},"_resetFocusedListElem":function(){var e,t;e=this.selectedIndex,t=this.selectedIndexElem(e),t&&t.prop("tabindex","-1"),e=this.getSelectedIndex(),t=this.selectedIndexElem(e),t&&(t.prop("tabindex","0"),this.selectedIndex=e),i(this.ui.header).prop("tabindex","0")},"_moveTo":function(e,i,n){e.preventDefault(),e.stopPropagation(),setTimeout(t.bind(function(){n&&n.prop("tabindex","-1"),i.prop("tabindex","0"),i.focus()},this),50)},"onKeyInView":function(e){this._checkFocusAndSetCurrentTabPosition(),9===e.keyCode?e.shiftKey?this.currentTabPosition===s.list&&!0===this.headerFocusable&&this.headerElement&&i(this.ui.header).is(":visible")&&(this._moveTo(e,this._focusHeader()),this._resetFocusedListElem()):this.currentTabPosition===s.header?this.$el.find(">.cs-content").is(":visible")&&this._moveTo(e,this._focusList()):setTimeout(t.bind(function(){this._resetFocusedListElem()},this),50):32!==e.keyCode&&13!==e.keyCode||(this.currentTabPosition===s.header?(e.preventDefault(),e.stopPropagation(),this.clickBack()):this.currentTabPosition===s.list&&(e.preventDefault(),e.stopPropagation(),this.selectAt(this.selectedIndex)))},"onKeyDown":function(e){if(this._checkFocusAndSetCurrentTabPosition(),this.currentTabPosition!==s.list)return void this.onKeyInView(e);var t=this.selectedIndex;(t<0||void 0===t)&&(t=this.getSelectedIndex());var i=this.selectedIndexElem(t);switch(e.which){case 33:this._moveTo(e,this._selectFirst(),i);break;case 34:this._moveTo(e,this._selectLast(),i);break;case 38:this._moveTo(e,this._selectPrevious(),i);break;case 40:this._moveTo(e,this._selectNext(),i);break;default:return void this.onKeyInView(e)}},"_selectFirst":function(){return this.selectedIndex=0,this.selectedIndexElem(this.selectedIndex)},"_selectLast":function(){return this.selectedIndex=this.collection.length-1,this.selectedIndexElem(this.selectedIndex)},"_selectNext":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.selectedIndex<this.collection.length-1&&this.selectedIndex++,this.selectedIndexElem(this.selectedIndex)},"_selectPrevious":function(){return(this.selectedIndex<0||void 0===this.selectedIndex)&&(this.selectedIndex=this.getSelectedIndex()),this.selectedIndex>0&&this.selectedIndex--,this.selectedIndexElem(this.selectedIndex)},"selectAt":function(e){if(!(e>=this.collection.length||e<0)){var t=this.selectedIndexElem(e);t&&t.click()}}})},"refreshTabableElements":function(e){n.debug("MetadataNavigationListKeyboardBehavior::refreshTabableElements "+e.constructor.name)&&console.log(n.last),e.options.data.back_button&&(this.view.headerFocusable=!0,this.view.headerElement=e.ui.header),this.view.currentTabPosition=s.none,this.view.selectedIndex=-1}})}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.view",["csui/lib/underscore","csui/lib/jquery","csui/controls/list/simplelist.view","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/widgets/metadata/impl/metadata.navigation.list.keyboard.behavior","csui/controls/node-type.icon/node-type.icon.view","csui/models/version","i18n!csui/widgets/metadata/impl/nls/lang"],function(e,t,i,n,o,s,a,r){return i.extend({"childViewOptions":function(e){return{"templateHelpers":function(){var e=this.options.nameAttribute||"name";return{"enableIcon":!0,"name":this.model.get(e)}},"nameAttribute":this.options.data.nameAttribute}},"events":{"keydown":"onKeyDown"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":n,"initialActivationWeight":100},"MetadataNavigationListKeyboardBehavior":{"behaviorClass":o}},"constructor":function(t){this.events=e.extend({},i.prototype.events,this.events),i.apply(this,arguments),this.listenTo(this,"childview:render",this.onRenderItem),this.listenTo(this,"childview:before:destroy",this.onBeforeDestroyItem)},"onRenderItem":function(e){if(e.model instanceof a){var i=e.model.get("version_number_name");t(e.$(".csui-type-icon").get(0)).append("<span title='"+i+"' class='list-item-version'>"+i+"</span>")}else if(e._nodeIconView=new s({"el":e.$(".csui-type-icon").get(0),"node":e.model}),e._nodeIconView.render(),this.options.originatingView&&this.options.originatingView.thumbnailView){this.$el.addClass("csui-metadata-navigation-thumbnail");var n=e.model&&e.model.thumbnail&&e.model.thumbnail.url;n&&e._nodeIconView.$el.find(".csui-icon").css("background-image","url("+n+")")}else this.$el.find(".csui-metadata-navigation-thumbnail").removeClass("csui-metadata-navigation-thumbnail");var o=this.options.data&&!0===this.options.data.show_required,l=e.model&&e.model.options&&!0===e.model.options.enforcedRequiredAttrs;if(o&&l){var d=e.$(".list-item-title").get(0);if(d){var c,u;!0===e.model.validated?(c="cs-icon-required category_required_done",u=r.requiredPassedTooltip):(c="cs-icon-required category_required",u=r.requiredTooltip),t(d).before("<span class='"+c+"' alt='"+u+"' title='"+u+"'></span>")}}},"onBeforeDestroyItem":function(e){e._nodeIconView&&e._nodeIconView.destroy()}})}),csui.define("hbs!csui/widgets/metadata/impl/common/metadata.action.multiple.items",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="metadata-wrapper binf-col-md-12">\r\n  <div class="metadata-navigation">\r\n    <div class="metadata-sidebar"></div>\r\n    <div class="metadata-content"></div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_common_metadata.action.multiple.items",n),n}),csui.define("csui/widgets/metadata/impl/metadata.navigation.list.behavior",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette"],function(e,t,i,n){"use strict";return n.Behavior.extend({"constructor":function(t,o){n.Behavior.prototype.constructor.apply(this,arguments),e.extend(o,{"onBeforeShow":function(){this._showChildViews()},"onShow":function(){this._showScrollPosition()},"onBeforeDestroy":function(){this.mdv&&this.mdv.internal&&this.mdv.destroy(),this.mdn&&this.mdn.destroy()},"_showChildViews":function(){this.navigationRegion.show(this.mdn),this.contentRegion.show(this.mdv)},"_showScrollPosition":function(){if(this.initiallySelected instanceof i.Model){var e=this.mdn.collection.findIndex({"id":this.initiallySelected.get("id")});return(e<0||e>this.mdn.collection.length-1)&&(e=0),this.mdn.setSelectedIndex(e)}if(this.initiallySelected&&this.initiallySelected.length>0){var t=this.initiallySelected.models[0],n=this.mdn.collection.indexOf(t);this.mdn.setSelectedIndex(n)}else this.mdn.collection.models.length>0&&this.mdn.setSelectedIndex(0)}})}})}),csui.define("css!csui/widgets/metadata/impl/common/metadata.action.multiple.items",[],function(){}),csui.define("csui/widgets/metadata/impl/common/metadata.action.multiple.items.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/widgets/metadata/impl/metadata.navigation.list.view","csui/widgets/metadata/metadata.action.one.item.properties.view","hbs!csui/widgets/metadata/impl/common/metadata.action.multiple.items","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/widgets/metadata/impl/metadata.navigation.list.behavior","csui/lib/jsonpath","css!csui/widgets/metadata/impl/common/metadata.action.multiple.items"],function(e,t,i,n,o,s,a,r,l){var d=i.LayoutView.extend({"className":"cs-metadata-add-items","template":s,"regions":{"navigationRegion":".metadata-sidebar","contentRegion":".metadata-content"},"behaviors":{"MetadataNavigationListBehavior":{"behaviorClass":r}},"constructor":function(e){e||(e={}),this.options=e,i.LayoutView.prototype.constructor.apply(this,arguments),this.collection=e.collection,this.container=e.container,this.context=e.context,this.originatingView=e.originatingView,this.initiallySelected=this.options.selected,this.commonCategories=e.commonCategories,this.initialFormData=e.initialFormData,this.requiredFields=[];var t=this._getInitiallySelectedModel();e.applyFlag&&t.set("applyFlag",e.applyFlag),this.mdv=new o({"model":t,"container":this.container,"context":this.context,"commands":e.commands,"originatingView":this.originatingView,"action":e.action,"inheritance":e.inheritance}),this.mdv.internal=!0,this._subscribeToMetadataViewEvents(),this.mdn=new n({"collection":e.collection,"data":{"back_button":!1,"title":"","show_required":!0}}),e.applyFlag&&this.setInitialCategories(),this.listenTo(this.mdn,"click:item",this.onClickItem),this.listenTo(this.mdn,"click:back",this.onClickBack),this.listenTo(this.mdn,"show:node",function(e){this._showNode(e.model)}),this.propagateEventsToRegions()},"_getInitiallySelectedModel":function(){return this.initiallySelected&&this.initiallySelected.length>0?this.initiallySelected.models[0]:this.collection&&this.collection.length>0?this.collection.models[0]:null},"onClickItem":function(e){this.validateAndSetValuesToNode()?this._showNode(e.model):e.cancelClick=!0},"setInitialCategories":function(){var t=this;e.each(this.mdn.collection.models,function(i){var n={};void 0===i.get("data")&&(n.advanced_versioning=!1,n.name=i.get("newName")||i.get("name"),n.mime_type=i.get("mime_type"),n.type=i.get("type")||144,n.parent_id=this.mdv.options.container.get("id"),e.extend(n,JSON.parse(JSON.stringify(t.commonCategories)))),i.set("data",n)},this)},"getRequiredFields":function(){var t={},i=this;i.requiredFields=[],this.initialFormData&&this.initialFormData.models&&e.each(this.initialFormData.models,function(n,o){var s,a=n.get("data"),r=n.get("role_name"),d=n.get("options"),c=n.get("schema");if(a&&r&&(s=t.roles||(t.roles={}),s[r]||(s[r]={}),"categories"===r)){var u=l(c,"$..[?(@.required===true)]",{"resultType":"PATH"}),h=l(d,"$..[?(@.validate===false)]",{"resultType":"PATH"}),m=[];e.each(h,function(e){var t=e.toString().match(/(\'[\w]*\')/g);t&&m.push(t[t.length-1].replace(/'/g,""))});var p=[];e.each(u,function(e){var t=e.toString().match(/(\'[\w]*\')/g);t&&p.push(t[t.length-1].replace(/'/g,""))}),p=p.filter(function(e){return-1===m.indexOf(e)}),p.length>0&&i.requiredFields.push(p)}})},"validateAndSetValuesToAllNode":function(){var t=this,i=!0,n=!0;return this.getRequiredFields(),e.each(this.mdn.collection.models,e.bind(function(o){var s=o.get("data");e.each(s.roles.categories,function(e){i=i&&t._checkForAlpacaRequiredFields(o,e)}),o.validated=i,n=n&&i},this)),n},"_checkForAlpacaRequiredFields":function(t,i){var n=!0,o=[];if(this.requiredFields){var s=!1;e.each(this.requiredFields,function(t){if(o=l(i,"$.."+t.toString(),{"resultType":"PATH"}.toArray),e.each(o,function(t){var i=function(t){if(t instanceof Array&&(null!==t||""!==t))e.each(t,function(e){i(e)});else if(null===t||""===t)return void(s=!0)};if(s)return void(n=!1);i(t)}),s)return void(n=!1)})}return n},"validateAndSetValuesToNode":function(){var t=this.mdn.getSelectedItem();if(this.mdv.validate()){var i=this.mdv.getValues();return t.model.newCategories.models.length>0&&e.each(t.model.newCategories.models,function(t){var n=t.get("id"),o=t.get("role_name"),s={};i&&i.roles&&i.roles[o]&&(s=i.roles[o]),!1===e.isEmpty(s[n])&&e.each(t.attributes.data,function(i,o){e.has(s[n],o)&&(t.attributes.data[o]=s[n][o])})}),t.model.validated=!0,t.model.set("data",i),!0}return this.mdv.metadataPropertiesView.allFormsRendered&&(t.model.validated=!1,t.model.trigger("change",t.model)),!1},"onClickBack":function(){this.trigger("metadata:close",{"sender":this})},"onItemNameChanged":function(e){var t=this.mdn.getSelectedItem(),i=this.mdn.getSelectedIndex();t.render(),this.mdn.setSelectedIndex(i)},"_showNode":function(e){this.mdv&&this.mdv.internal&&this.mdv.destroy(),e.set("applyFlag",this.options.applyFlag),this.mdv=new o({"model":e,"container":this.container,"context":this.context,"originatingView":this.originatingView,"action":this.options.action,"inheritance":this.options.inheritance}),this.mdv.internal=!0,this._subscribeToMetadataViewEvents(),this.contentRegion.show(this.mdv)},"_subscribeToMetadataViewEvents":function(){this.listenTo(this.mdv,"metadata:close",e.bind(function(){this.trigger("metadata:close",{"sender":this})},this)),this.listenTo(this.mdv,"item:name:changed",e.bind(this.onItemNameChanged,this))}});return e.extend(d.prototype,a),d}),csui.define("csui/widgets/metadata/impl/add.items/metadata.add.multiple.docs.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/node/node.model","csui/controls/dialog/dialog.view","csui/widgets/metadata/impl/common/metadata.action.multiple.items.view","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","css!csui/widgets/metadata/impl/metadata","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,s,a,r){function l(){}return e.extend(l.prototype,t.prototype,{"displayForm":function(t,i){var n=!1,a=this._getCommonCategories(i);i.initialFormData&&i.initialFormData.models&&i.initialFormData.models.length>1&&(n=!0),this.metadataAddItems=new o({"container":i.container,"collection":t.nodes,"selected":t.nodes,"action":"create","originatingView":i.originatingView,"context":i.context,"commands":r,"commonCategories":a,"applyFlag":n,"initialFormData":i.initialFormData}),this.listenTo(this.metadataAddItems,"metadata:add",e.bind(function(){this.deferred.resolve()},this));var l={};l.originatingView=i.originatingView,l.view=this.metadataAddItems;var d={};return d.dialogTitle=i.dialogTitle?i.dialogTitle:s.addDocumentMetadataDialogTitle,d.OkButtonTitle=i.addButtonTitle?i.addButtonTitle:s.addDocumentMetadataDialogAddButtonTitle,d.OkButtonClick=this._addItems,l.dialogOptions=d,this.baseDisplayForm(l)},"_getCommonCategories":function(t){var i={};return t.initialFormData&&t.initialFormData.models&&e.each(t.initialFormData.models,function(t,n){var o,s,a,r=t.get("data"),l=t.get("role_name");t.get("options"),t.get("schema");if(r&&l&&(o=i.roles||(i.roles={}),s=o[l]||(o[l]={}),"categories"===l)){var d=t.get("id").toString();a=s[d]||(s[d]={}),e.isEmpty(r)?a=null:(r=JSON.parse(JSON.stringify(r).replace(/null/g,'""')),e.extend(a,r))}}),i},"_addItems":function(t){if(t.view.mdv&&t.view.mdv.metadataPropertiesView&&t.view.mdv.metadataPropertiesView.allFormsRendered){if(this.metadataAddItems.validateAndSetValuesToNode()){this.options.view.$el.find(".cs-formfield-invalid").removeClass("cs-formfield-invalid");var i=!0;if(this.metadataAddItems.validateAndSetValuesToAllNode(),this.metadataAddItems.collection.forEach(function(e){i=i&&!!e.validated}),i)this.metadataAddItems.collection.forEach(function(t){var i=t.get("data"),n=t.get("fileObject"),o=t.get("extended_data");if(i&&n){n.set("newName",i.name);var s={};void 0!==i.description&&(s.description=i.description),void 0!==i.advanced_versioning&&(s.advanced_versioning=i.advanced_versioning),i.roles&&(s.roles=e.deepClone(i.roles)),!1===e.isEmpty(s)&&e.extend(o,s)}}),this.dialog.destroy(),this.deferred.resolve();else{var n=s.addDocumentMetadataDialogTitle,o=s.missingRequiredMetadataForDocuments;a.showError(o,n)}}else this.options.view.$el.find(".binf-has-error .cs-formfield").addClass("cs-formfield-invalid")}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/metadata.add.document.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/metadata.add.item.controller","csui/widgets/metadata/impl/metadata.utils","csui/widgets/metadata/impl/add.items/metadata.add.multiple.docs.controller","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,s,a,r,l){"use strict";function d(){}return e.extend(d.prototype,i.Events,{"addItemsRequiredMetadata":function(i,n){var o=t.Deferred(),s=i.models,r=e.find(i.models,function(e){return void 0===e.get("newVersion")})||s[0],l=s.length>0?r.get("file").name:"temp_name",d={"action":"create","addableType":n.addableType,"name":l,"container":n.container,"docParentId":s.length>0?r.get("id"):null},c=new a,u=t.grep(i.models,function(e){return void 0===e.get("newVersion")});return c.ContainerHasEnforcedEmptyRequiredMetadata(d).done(e.bind(function(e){if(!0===e.hasRequiredMetadata){var i=t.Deferred();u&&1===u.length?i=this._addOneItemWithRequiredMetadata(u,n):u&&u.length>1?(e.initialFormData&&(n.initialFormData=e.initialFormData),i=this._addMultipleItemsWithRequiredMetadata(u,n)):o.reject(),i.done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})}else o.resolve({})},this)).fail(function(e){o.reject(e)}),o.promise()},"_makeNodeCollectionFromItems":function(t,i){var s=new n;return t&&t.length>0&&e.each(t,function(t){var n=t.get("file"),a=new o({"name":t.get("newName")||n.name,"type":t.get("type")||144,"size":n.size,"mime_type":n.type,"fileObject":t,"extended_data":t.get("extended_data")},{"connector":i.container.connector});e.extend(a.options,{"enforcedRequiredAttrs":!0}),s.add(a,{"silent":!0})},this),s},"_addOneItemWithRequiredMetadata":function(i,n){var o=t.Deferred(),a=this._makeNodeCollectionFromItems(i,n),r={"nodes":a,"container":n.container,"context":n.context},d={"callerProcessData":!0,"dialogTitle":l.addDocumentMetadataDialogTitle,"addButtonTitle":l.addDocumentMetadataDialogAddButtonTitle,"cancelButtonActionToken":"cancelAddOneItemWithRequiredMetadata"};return(new s).displayForm(r,d).done(function(t){var n=i[0];n.set("newName",t.data.name);var s={};void 0!==t.data.description&&(s.description=t.data.description),void 0!==t.data.advanced_versioning&&(s.advanced_versioning=t.data.advanced_versioning),t.data.roles&&(s.roles=e.deepClone(t.data.roles)),!1===e.isEmpty(s)&&n.set("extended_data",s),o.resolve()}).fail(function(e){var t,i=e&&e.error?e.error:void 0;e&&e.buttonAttributes&&("cancelAddOneItemWithRequiredMetadata"===e.buttonAttributes.actionToken?t="cancelAddOneItemWithRequiredMetadata":"closeMetadataActionView"===e.buttonAttributes.actionToken&&(t="closeMetadataActionView")),o.reject({"error":i,"userAction":t})}),o.promise()},"_addMultipleItemsWithRequiredMetadata":function(e,i){var n=t.Deferred(),o=this._makeNodeCollectionFromItems(e,i),s={"nodes":o};return(new r).displayForm(s,i).done(function(e){n.resolve()}).fail(function(){n.reject()}),n.promise()}}),d.prototype.get=i.Model.prototype.get,e.extend(d,{"version":"1.0"}),d}),csui.define("csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.one.item.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/widgets/metadata/impl/metadata.controller","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/utils/commandhelper","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","csui/utils/commands","css!csui/widgets/metadata/impl/metadata"],function(e,t,i,n,o,s,a,r){function l(){}return e.extend(l.prototype,t.prototype,{"displayForm":function(e,t){var i=o.getAtLeastOneNode(e),a=i.length>0?i.models[0]:null;this.node=a;var l=this.metadataAddItemPropView=new n({"model":a,"container":e.container,"originatingView":t.originatingView,"context":t.context,"commands":r,"action":t.action,"inheritance":t.inheritance}),d={};d.callerProcessData=t.callerProcessData,d.originatingView=t.originatingView,d.view=l;var c={};return c.dialogTitle=t.dialogTitle?t.dialogTitle:s.defaultDialogTitle,c.OkButtonTitle=t.okButtonTitle?t.okButtonTitle:s.defaultDialogOkButtonTitle,c.OkButtonClick=this._CopyMoveItem,d.dialogOptions=c,this.baseDisplayForm(d)},"_CopyMoveItem":function(t){
if(t.view.metadataPropertiesView&&t.view.metadataPropertiesView.allFormsRendered){if(this.metadataAddItemPropView.validate()){var n=this.metadataAddItemPropView.getValues();if(!0===t.callerProcessData)this.dialog.destroy(),this.deferred.resolve({"data":n});else{(new i).createItem(this.node,n).done(e.bind(function(e){this.dialog.destroy(),this.deferred.resolve({"name":n.name})},this)).fail(function(e){var t=s.failedToCreateItem;e&&(e.responseJSON&&e.responseJSON.error?t=e.responseJSON.error:e.responseText&&(t=e.responseText),a.showError(t))})}}}}}),e.extend(l,{"version":"1.0"}),l}),csui.define("csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.multiple.items.controller",["csui/lib/underscore","csui/widgets/metadata/impl/common/base.metadata.action.view","csui/models/node/node.model","csui/controls/dialog/dialog.view","csui/widgets/metadata/impl/common/metadata.action.multiple.items.view","i18n!csui/widgets/metadata/impl/nls/lang","csui/dialogs/modal.alert/modal.alert","css!csui/widgets/metadata/impl/metadata","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,s,a){function r(){}return e.extend(r.prototype,t.prototype,{"displayForm":function(t,i){this.metadataAddItems=new o({"container":i.container,"collection":t.nodes,"selected":t.nodes,"originatingView":i.originatingView,"context":i.context,"action":i.action,"inheritance":i.inheritance}),this.listenTo(this.metadataAddItems,"metadata:add",e.bind(function(){this.deferred.resolve()},this));var n={};n.originatingView=i.originatingView,n.view=this.metadataAddItems;var a={};return a.dialogTitle=i.dialogTitle?i.dialogTitle:s.defaultDialogTitle,a.OkButtonTitle=i.okButtonTitle?i.okButtonTitle:s.defaultDialogOkButtonTitle,a.OkButtonClick=this._CopyMoveItems,n.dialogOptions=a,this.baseDisplayForm(n)},"_CopyMoveItems":function(t){if(t.view.mdv&&t.view.mdv.metadataPropertiesView&&t.view.mdv.metadataPropertiesView.allFormsRendered){if(this.metadataAddItems.validateAndSetValuesToNode()){var i=!0;if(this.metadataAddItems.collection.forEach(function(e){var t=!0!==e.options.enforcedRequiredAttrs||!!e.validated;i=i&&t}),i)this.metadataAddItems.collection.forEach(function(t){var i=t.get("data"),n=t.get("itemObject");if(i&&n){n.newName=i.name;var o={};void 0!==i.description&&(o.description=i.description),void 0!==i.advanced_versioning&&(o.advanced_versioning=i.advanced_versioning),i.roles&&(o.roles=e.deepClone(i.roles)),!1===e.isEmpty(o)&&(n.extended_data=o)}}),this.dialog.destroy(),this.deferred.resolve();else{var n=s.defaultDialogTitle,o=s.missingRequiredMetadataForObjects;a.showError(o,n)}}}}}),e.extend(r,{"version":"1.0"}),r}),csui.define("csui/widgets/metadata/metadata.copy.move.items.controller",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/models/nodes","csui/models/node/node.model","csui/widgets/metadata/impl/metadata.utils","csui/models/actions","csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.one.item.controller","csui/widgets/metadata/impl/copy.move.items/metadata.copy.move.multiple.items.controller","i18n!csui/widgets/metadata/impl/nls/lang","csui/utils/deepClone/deepClone"],function(e,t,i,n,o,s,a,r,l,d){function c(){}return e.extend(c.prototype,i.Events,{"CopyMoveItemsWithMetadata":function(t,i){return this.CopyMoveItemsRequiredMetadata(t,e.extend(i,{"openMetadata":!0}))},"_copyMoveItemsWithMetadata":function(e,i){var n=t.Deferred(),o=t.Deferred();return e&&e.length>0&&(i.id||(i.id=e[0].id),i.container||(i.container=i.targetFolder)),e&&1===e.length?o=this._copyMoveOneItemWithRequiredMetadata(e,i):e&&e.length>1?o=this._copyMoveMultipleItemsWithRequiredMetadata(e,i):n.reject(),o.done(function(e){n.resolve()}).fail(function(e){n.reject(e)}),n.promise()},"CopyMoveItemsRequiredMetadata":function(i,n){if(!i||i.length<1)return t.Deferred().reject();if(!0!==n.openMetadata&&"original"===n.inheritance)return t.Deferred().resolve();if(!0!==n.openMetadata&&i.length>1&&"merged"===n.inheritance)return t.Deferred().resolve();var o=t.Deferred(),a={"action":n.action,"inheritance":n.inheritance,"items":i,"container":n.targetFolder,"context":n.context};return(new s).ContainerHasEnforcedEmptyRequiredMetadataOnNodes(a).done(e.bind(function(t){t.requiredMetadata&&t.enforcedItems&&t.enforcedItems.length>0||!0===n.openMetadata?(t.requiredMetadata&&(a=e.extend(a,{"enforcedItems":t.enforcedItems})),this._copyMoveItemsWithMetadata(i,a).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)})):o.resolve()},this)).fail(function(e){o.reject(e)}),o.promise()},"_makeNodeCollectionFromItems":function(t,i){var s=new n;return t&&t.length>0&&e.each(t,function(t){var n=void 0!==e.find(i.enforcedItems,function(e){return e.id===t.id}),r=new o({"id":t.id,"name":t.newName||t.name,"container":t.container,"mime_type":t.mime_type,"original_id":t.original_id,"type":t.type,"type_name":t.type_name,"action":i.action,"inheritance":i.inheritance,"itemObject":t,"size":t.size,"size_formatted":144===t.type||749===t.type||736===t.type||30309===t.type?t.size_formatted:void 0},{"connector":i.container.connector});140===t.type&&(r.attributes.url=t.url),e.extend(r.options,{"original":t.original,"enforcedRequiredAttrs":n}),r.original=t.original||r.original,r.actions=t.actions||new a,s.add(r,{"silent":!0})},this),s},"_copyMoveOneItemWithRequiredMetadata":function(i,n){var o,s,a=t.Deferred(),l=this._makeNodeCollectionFromItems(i,n),c={"nodes":l,"container":n.container};"copy"===n.action?(o=d.copyOneItemMetadataDialogTitle,s=d.copyItemsMetadataDialogButtonTitle):"move"===n.action&&(o=d.moveOneItemMetadataDialogTitle,s=d.moveItemsMetadataDialogButtonTitle),o=this._extendDialogTitle(o,n.inheritance);var u={"callerProcessData":!0,"action":n.action,"context":n.context,"inheritance":n.inheritance,"originatingView":n.originatingView,"dialogTitle":o,"okButtonTitle":s};return(new r).displayForm(c,u).done(function(t){i[0].newName=t.data.name;var n={};void 0!==t.data.description&&(n.description=t.data.description),void 0!==t.data.advanced_versioning&&(n.advanced_versioning=t.data.advanced_versioning),t.data.roles&&(n.roles=e.deepClone(t.data.roles)),!1===e.isEmpty(n)&&(i[0].extended_data=n),a.resolve()}).fail(function(e){a.reject(e)}),a.promise()},"_copyMoveMultipleItemsWithRequiredMetadata":function(i,n){var o,s,a=t.Deferred();"copy"===n.action?(o=e.str.sformat(d.copyMultipleItemsMetadataDialogTitle,i.length),s=d.copyItemsMetadataDialogButtonTitle):"move"===n.action&&(o=e.str.sformat(d.moveMultipleItemsMetadataDialogTitle,i.length),s=d.moveItemsMetadataDialogButtonTitle),o=this._extendDialogTitle(o,n.inheritance);var r=this._makeNodeCollectionFromItems(i,n),c={"nodes":r},u={"action":n.action,"inheritance":n.inheritance,"container":n.container,"context":n.context,"originatingView":n.originatingView,"dialogTitle":o,"okButtonTitle":s};return(new l).displayForm(c,u).done(function(e){a.resolve()}).fail(function(e){a.reject(e)}),a.promise()},"_extendDialogTitle":function(e,t){var i=e;return"original"===t?i=e+" "+d.inheritanceOriginalProperties:"destination"===t?i=e+" "+d.inheritanceDestinationProperties:"merged"===t&&(i=e+" "+d.inheritanceMergedProperties),i}}),c.prototype.get=i.Model.prototype.get,e.extend(c,{"version":"1.0"}),c}),csui.define("hbs!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){return'<div class="metadata-wrapper binf-col-md-12">\r\n  <div class="metadata-navigation">\r\n    <div class="metadata-sidebar"></div>\r\n    <div class="metadata-content"></div>\r\n  </div>\r\n</div>\r\n'}});return i.registerPartial("csui_widgets_metadata_impl_metadatanavigation_impl_metadatanavigation",n),n}),csui.define("csui/widgets/metadata/impl/metadatanavigation/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata/impl/metadatanavigation/impl/nls/root/lang",{"dialogTitle":"Favorites","searchPlaceholder":"Search Favorites","versionsTitle":"Versions"}),csui.define("css!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation",[],function(){}),csui.define("csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/behaviors/keyboard.navigation/tabable.region.behavior","csui/widgets/metadata/impl/metadata.navigation.list.behavior","csui/widgets/metadata/impl/metadata.navigation.list.view","csui/widgets/metadata/metadata.view","hbs!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation","csui/controls/mixins/layoutview.events.propagation/layoutview.events.propagation.mixin","csui/utils/contexts/factories/browsing.states","csui/utils/contexts/factories/next.node","i18n!csui/widgets/metadata/impl/metadatanavigation/impl/nls/lang","css!csui/widgets/metadata/impl/metadatanavigation/impl/metadatanavigation"],function(e,t,i,n,o,s,a,r,l,d,c,u){"use strict";var h=i.LayoutView.extend({"className":"cs-metadata","template":r,"regions":{"navigationRegion":".metadata-sidebar","contentRegion":".metadata-content"},"behaviors":{"TabableRegionBehavior":{"behaviorClass":n,"initialActivationWeight":100},"MetadataNavigationListBehavior":{"behaviorClass":o}},"constructor":function(e){e||(e={}),i.LayoutView.prototype.constructor.apply(this,arguments),this.collection=e.collection,this.container=e.container,this.containerCollection=e.containerCollection,this.context=e.context,this.originatingView=e.originatingView,this.showCloseIcon=e.showCloseIcon,this.initiallySelected=this.options.selected,this.selectedTab=e.selectedTab,this.selectedProperty=e.selectedProperty,this.showPermissionView=e.showPermissionView;var t=e.container?e.container.get("name"):"";!t&&e.collection.length>0&&e.collection.models[0].collection.title&&(t=e.collection.models[0].collection.title),"NodeVersionCollection"===Object.getPrototypeOf(e.collection).constructor.name&&(t=u.versionsTitle),!this.options.toolbarItems&&this.originatingView&&this.originatingView.options&&this.originatingView.options.toolbarItems&&(this.options.toolbarItems=this.originatingView.options.toolbarItems);var n=this._getInitiallySelectedModel();this.mdv=this.options.data&&this.options.data.contentView?this.options.data.contentView:new a({"model":n,"container":this.container,"containerCollection":this.containerCollection,"collection":this.collection,"context":this.context,"originatingView":this,"metadataNavigationView":this,"isExpandedView":!!this.options.isExpandedView,"showCloseIcon":void 0!==this.showCloseIcon&&this.showCloseIcon,"selectedTab":this.selectedTab,"selectedProperty":this.selectedProperty,"showPermissionView":this.showPermissionView}),this.options.data&&this.options.data.contentView||(this.mdv.internal=!0),this._subscribeToMetadataViewEvents(),this.mdn=new s({"collection":e.collection,"containerCollection":this.containerCollection,"data":{"back_button":!(!this.originatingView&&!this.containerCollection),"title":t,"nameAttribute":e.nameAttribute},"originatingView":e.originatingView}),this.listenTo(this.mdn,"click:item",this.onClickItem),this.listenTo(this.mdn,"click:back",this.onClickBack),this.listenTo(this.mdn,"show:node",function(e){this._showNode(e.model)}),this.listenTo(this.mdv,"disable:active:item",function(e){this.mdn.$el.find(".binf-active").addClass("active-item-disable")}).listenTo(this.mdv,"enable:active:item",function(){this.mdn.$el.find(".active-item-disable").removeClass("active-item-disable")}),this.options.originatingView&&this.listenTo(this.options.originatingView,"before:destroy",function(){this._closeMetadata()}),this.propagateEventsToRegions()},"_getInitiallySelectedModel":function(){if(this.initiallySelected instanceof t.Model){var e=this.collection.findIndex({"id":this.initiallySelected.get("id")});return e<0||e>this.collection.length-1?null:this.collection.at(e)}return this.initiallySelected&&this.initiallySelected.length>0?this.initiallySelected.models[0]:this.collection&&this.collection.length>0?this.collection.models[0]:null},"onClickItem":function(e){this._showNode(e.model)},"onClickBack":function(){this._closeMetadata()},"onItemNameChanged":function(e){var t=this.mdn.getSelectedItem(),i=this.mdn.getSelectedIndex();t.render(),this.mdn.setSelectedIndex(i)},"_moveToNextItemAfterDeleteOrMove":function(){if(0===this.mdn.collection.length)this._closeMetadata();else{var e=this.indexOfItemDeleteOrMove;e===this.mdn.collection.length&&e--,this.mdn.selectAt(e)}},"onItemBeforeDelete":function(e){this.indexOfItemDeleteOrMove=this.mdn.getSelectedIndex()},"onItemDeleted":function(e){this._moveToNextItemAfterDeleteOrMove()},"onItemBeforeMove":function(t){this.indexOfItemDeleteOrMove=this.mdn.getSelectedIndex(),this.listenToOnce(this.containerCollection,"remove",e.bind(this.onItemMoved,this))},"onItemMoved":function(e){this.mdn.collection.remove(e),this._moveToNextItemAfterDeleteOrMove()},"_showNode":function(t){var i=this.mdv.metadataTabView.tabLinks?this.mdv.metadataTabView.tabLinks.selected:this.mdv.options.selectedTab?this.mdv.options.selectedTab:"",n=this.mdv.metadataTabView.options.activeTab?this.mdv.metadataTabView.options.activeTab:this.mdv.options.activeTab?this.mdv.options.activeTab:"";this.mdv&&this.mdv.internal&&this.mdv.destroy();var o=this.context.getCollection(d),s=o&&o.at(o.length-1);s&&e.has(s.attributes.path,"version_num")&&delete s.attributes.path.version_num,this.mdv=new a({"model":t,"container":this.container,"containerCollection":this.containerCollection,"collection":this.collection,"context":this.context,"originatingView":this,"metadataNavigationView":this,"showCloseIcon":void 0!==this.showCloseIcon&&this.showCloseIcon,"activeTab":n,"selectedTab":i,"showPermissionView":this.showPermissionView}),this.mdv.internal=!0,this._subscribeToMetadataViewEvents(),this.contentRegion.show(this.mdv)},"onMetadataClose":function(){this._closeMetadata()},"_closeMetadata":function(){var e=this.context.getCollection(d);if(e&&(e.triggerStateChangeOnStateRemoval=!0),this.trigger("metadata:close",{"sender":this}),!this.originatingView&&this.containerCollection&&this.containerCollection.node){var t=this.containerCollection.node.get("id");if(this.context&&void 0!==t){var i=this.context.getModel(c);i&&(i.get("id")===t&&i.unset("id",{"silent":!0}),i.set("id",t))}}},"_subscribeToMetadataViewEvents":function(){this.listenTo(this.mdv,"metadata:close",e.bind(function(){this._closeMetadata()},this)),this.listenTo(this.mdv,"metadata:close:without:animation",e.bind(function(){this.trigger("metadata:close:without:animation",{"sender":this})},this)),this.listenTo(this.mdv,"item:name:changed",e.bind(this.onItemNameChanged,this)),this.listenTo(this.mdv,"metadata:item:before:delete",e.bind(function(e){this.onItemBeforeDelete(e)},this)),this.listenTo(this.mdv,"metadata:item:deleted",e.bind(function(e){this.onItemDeleted(e)},this)),this.listenTo(this.mdv,"metadata:item:before:move",e.bind(function(e){this.onItemBeforeMove(e)},this))}});return e.extend(h.prototype,l),h}),csui.define("csui/widgets/metadata.navigation/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata.navigation/impl/nls/root/lang",{"FetchNodeFailTitle":"Error","FetchNodeFailMessage":'Failed to fetch node "{0}". \n\n{1}'}),csui.define("css!csui/widgets/metadata.navigation/impl/metadata.navigation",[],function(){}),csui.define("csui/widgets/metadata.navigation/metadata.navigation.view",["csui/lib/underscore","csui/lib/jquery","csui/lib/backbone","csui/lib/marionette","csui/utils/base","csui/controls/progressblocker/blocker","csui/utils/contexts/factories/node","csui/utils/contexts/factories/children","csui/utils/contexts/factories/children2","csui/widgets/nodestable/nodestable.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view","csui/behaviors/default.action/impl/defaultaction","csui/dialogs/modal.alert/modal.alert","i18n!csui/widgets/metadata.navigation/impl/nls/lang","css!csui/widgets/metadata.navigation/impl/metadata.navigation"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p){"use strict";d.useV2RestApi&&(r=l);var g=n.ItemView.extend({"className":"cs-metadata-navigation-wrapper","template":!1,"constructor":function(e){e||(e={}),e.data||(e.data={}),e.showCloseIcon=!1,this.options=e,this.defaultActionController=new h,this.options.originatingView&&this.options.originatingView.supportOriginatingView&&(this.options.baseOriginatingView=this.options.originatingView,this.options.originatingView=this),n.ItemView.prototype.constructor.call(this,e),s.imbue(this)},"onRender":function(){var t=this._ensureCompleteData();if(t)return t.done(e.bind(this.render,this));this.metadataNavigationView&&this.metadataNavigationView.destroy();var i=this.metadataNavigationView=new u(this.options);this.propagateEventsToViews(this.metadataNavigationView),this.metadataNavigationView.render(),n.triggerMethodOn(i,"before:show",i,this),this.$el.append(i.el),n.triggerMethodOn(i,"show",i,this)},"onBeforeDestroy":function(){this.metadataNavigationView&&(this.cancelEventsToViewsPropagation(this.metadataNavigationView),this.metadataNavigationView.destroy())},"_ensureCompleteData":function(){function e(){n._ensureCollection().always(function(){n.unblockActions()}).done(function(e){i&&i.resolve(e)}).fail(function(e){i&&i.reject(e)})}var i,n=this,o=this.options;return o.model&&(o.collection||o.containerCollection)||(i=t.Deferred()),o.model?o.collection&&o.containerCollection||(o.selected=o.model,n.blockActions(),e()):(o.model=o.context.getModel(a,{"attributes":o.data.id&&{"id":o.data.id},"temporary":!0}),o.selected=o.model,n.blockActions(),o.model.ensureFetched().done(function(t){e()}).fail(function(e){n.unblockActions(),n._showFetchNodeFailMessage(e,o.model.get("id")),i&&i.reject(e)})),i&&i.promise()},"_ensureCollection":function(){var e=this,i=t.Deferred(),n=this.options,o=n.collection||n.containerCollection;return o?(this._ensureModelInCollection(o),i&&i.promise().resolve()):(n.container=n.context.getModel(a,{"attributes":{"id":n.model.get("parent_id")},"temporary":!0}),n.container.ensureFetched().done(function(t){o=n.context.getCollection(r,{"options":{"node":n.container,"commands":e.defaultActionController.commands,"defaultActionCommands":e.defaultActionController.actionItems.getAllCommandSignatures(e.defaultActionController.commands),"delayRestCommands":!1}}),o.ensureFetched().done(function(t){e._ensureModelInCollection(o),i&&i.resolve(t)}).fail(function(t){e.unblockActions(),e._showFetchNodeFailMessage(t,n.container.get("id")),i&&i.reject(t)})}).fail(function(t){e.unblockActions(),e._showFetchNodeFailMessage(t,n.container.get("id")),i&&i.reject(t)}),i&&i.promise())},"_ensureModelInCollection":function(e){e.findWhere({"id":this.options.model.get("id")})||e.add(this.options.model,{"at":0,"silent":!0}),this.options.collection||(this.options.collection=e),this.options.containerCollection||(this.options.containerCollection=e)},"_showFetchNodeFailMessage":function(t,i){var n=new o.Error(t),s=p.FetchNodeFailTitle,a=e.str.sformat(p.FetchNodeFailMessage,i,n.message);m.showError(a,s)}});return e.extend(g.prototype,c),g}),csui.define("csui/widgets/document.overview/impl/nls/lang",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/document.overview/impl/nls/root/lang",{"ToolbarItemOpen":"Open","ToolbarItemDownload":"Download","ToolbarItemEdit":"Edit","ToolbarItemProperties":"Properties","location":"Location","docPreviewImgAlt":"Document Preview","name":"Name","description":"Description","created":"Created","createdBy":"Created by","type":"Type","modified":"Modified","ownedBy":"Owned by","size":"Size"}),csui.define("hbs!csui/widgets/document.overview/impl/document.overview",["module","hbs","csui/lib/handlebars"],function(e,t,i){var n=i.template({"compiler":[6,">= 2.0.0-beta.1"],"main":function(e,t,i,n){var o,s;return'<div class="cs-content-wrapper">\r\n  <div class="cs-content-header">\r\n    <div class="title-container"></div>\r\n    <div class="actions-container">\r\n      <div class="commentRegion"></div>\r\n      <div class="favoriteRegion"></div>\r\n    </div>\r\n\r\n  </div>\r\n  <div class="cs-content-container">\r\n    <div class="description-container cs-content">\r\n      <div class="owner_section general-information"></div>\r\n      <div class="modified_section general-information"></div>\r\n      <div class="type_section general-information"></div>\r\n      <div class="size_section general-information"></div>\r\n      <div class="reserve_info general-information"></div>\r\n      <div class="location-container general-information">\r\n        <div class="alpaca-container-item">\r\n          <div class="binf-form-group alpaca-field alpaca-field-text alpaca-optional\r\n              alpaca-readonly">\r\n            <label class="binf-control-label alpaca-control-label binf-col-sm-3">\r\n              '+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.location:o,e))+'\r\n            </label>\r\n            <div id="location" class="binf-col-sm-9 location-view">\r\n\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="description_section general-information">\r\n\r\n      </div>\r\n    </div>\r\n    <div class="binf-col-md-4 thumbnail-container binf-text-left cs-content">\r\n      <div class="metadata-tab">\r\n        <div class="thumbnail_section metadata-preview preview-section" title="'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemOpen:o,e))+'">\r\n          <span class="thumbnail_not_loaded thumbnail_empty" data-cstabindex="0"></span>\r\n          <img src="'+this.escapeExpression((s=null!=(s=t.imgSrc||(null!=e?e.imgSrc:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"imgSrc","hash":{}}):s))+'" class="img-doc-preview binf-hidden" alt="'+this.escapeExpression((s=null!=(s=t.imgAlt||(null!=e?e.imgAlt:e))?s:t.helperMissing,"function"==typeof s?s.call(e,{"name":"imgAlt","hash":{}}):s))+'">\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class="cs-content-footer">\r\n    <button class="binf-btn primary-btn open-command">'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemOpen:o,e))+'</button>\r\n    <button class="binf-btn default-btn command-btn"\r\n            data-signature="Download">'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemDownload:o,e))+'</button>\r\n    <button class="binf-btn default-btn command-btn edit-btn"\r\n            data-signature="Edit">'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemEdit:o,e))+'</button>\r\n    <button class="binf-btn default-btn command-btn"\r\n            data-signature="Properties">'+this.escapeExpression(this.lambda(null!=(o=null!=e?e.lang:e)?o.ToolbarItemProperties:o,e))+"</button>\r\n  </div>\r\n</div>\r\n\r\n"}});return i.registerPartial("csui_widgets_document.overview_impl_document.overview",n),n}),csui.define("css!csui/widgets/document.overview/impl/document.overview",[],function(){}),csui.define("csui/widgets/document.overview/document.overview.view",["csui/lib/underscore","csui/lib/backbone","csui/lib/marionette","csui/lib/jquery","csui/widgets/metadata/impl/header/item.name/metadata.item.name.view","csui/controls/mixins/view.events.propagation/view.events.propagation.mixin","csui/controls/form/form.view","csui/models/nodeancestors","csui/utils/nodesprites","csui/models/node/node.model","csui/utils/contexts/factories/connector","csui/controls/form/fields/nodepickerfield.view","csui/controls/node-type.icon/node-type.icon.view","csui/utils/contexts/factories/node","csui/utils/commands/impl/thumbnail/thumbnail.object","csui/widgets/metadata/general.panels/document/document.general.form.model","csui/controls/tableheader/comment/comment.button.view","csui/widgets/favorites/favorite.star.view","csui/controls/toolbar/toolbar.command.controller","csui/models/nodes","csui/behaviors/default.action/default.action.behavior","csui/controls/tile/behaviors/perfect.scrolling.behavior","csui/utils/commands","i18n!csui/widgets/document.overview/impl/nls/lang","hbs!./impl/document.overview","css!./impl/document.overview"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,m,p,g,f,b,w,v,_,y,T,V,x){"use strict";var C=a.extend({"constructor":function(e){e||(e={}),e.data||(e.data={}),e.node||(e.node=e.context.getModel(m,{"attributes":e.data.id&&{"id":e.data.id},"temporary":!0})),t.trigger("show:breadcrumbsoverride"),this.options=e,this._createModel(),a.prototype.constructor.call(this,this.options),this.listenTo(this.options.node,"change",this.updateForm),this._createMetadataItemNameView(),this.commandController=new w({"commands":e.commands||T}),this.commands=this.commandController.commands,this.reloadWidget=!1,this.parentNode=void 0,this.supportOriginatingView=!0},"fieldToRefresh":"modify_date","_createMetadataItemNameView":function(){this.metadataItemNameView&&(this.cancelEventsToViewsPropagation(this.metadataItemNameView),this.metadataItemNameView.destroy());var t=this.metadataItemNameView=new o({"model":this.options.node,"container":this.options.node.parent,"containerCollection":this.options.containerCollection,"collection":this.options.collection,"context":this.options.context,"nameSchema":{},"commands":this.commands,"originatingView":this,"showDropdownMenu":!0});this.listenTo(t,"metadata:item:name:save",this._saveItemName),this.listenTo(t,"metadata:item:before:delete",e.bind(function(e){this.trigger("metadata:item:before:delete",e)},this)),this.listenTo(t,"metadata:item:before:move",e.bind(function(e){this.trigger("metadata:item:before:move",e)},this)),this.listenTo(t,"metadata:item:deleted",e.bind(function(e){this.trigger("metadata:item:deleted",e)},this)),this.propagateEventsToViews(this.metadataItemNameView)},"reloadWidget":!1,"formTemplate":x,"className":"cs-form csui-general-form cs-document-overview-wrapper","ui":{"command":".command-btn","open":".open-command","location":"#location"},"events":{"click @ui.command":"_triggerMenuItemAction","click @ui.open":"_executeDefaultAction"},"behaviors":{"DefaultAction":{"behaviorClass":_},"PerfectScrolling":{"behaviorClass":y,"contentParent":".cs-content-container","suppressScrollX":!0}},"_executeDefaultAction":function(e){e.stopImmediatePropagation(),e.preventDefault(),this.defaultActionController.executeAction(this.options.node,{"context":this.options.context,"originatingView":this})},"_saveItemName":function(t){var i=this,n=t.sender.getValue(),o={"name":n},s=this.options.model;s.setFields("versions.element(0)","owner_id"),s.set(o,{"silent":!0});var a=e.clone(s.attributes);return s.save(a,{"data":o,"wait":!0,"silent":!0}).then(function(){s.fetch({"silent":!0}).done(function(){i._updateFieldsToRefersh(),i.metadataItemNameView._toggleEditMode(!1,!1)})})},"_triggerMenuItemAction":function(e){e.stopImmediatePropagation(),e.preventDefault();var t=n(e.target).data("signature"),i=this.commands.findWhere({"signature":t}),o=this;o.collection=new v([this.options.node]);var s={"context":this.options.context,"nodes":new v([this.options.node]),"container":this.options.node,"originatingView":o};i&&i.enabled(s)&&i.execute(s)},"_createModel":function(){var e=this.options.node;this.options.model=new g({"data":{"name":e.get("name"),"description":e.get("description"),"create_date":e.get("create_date"),"create_user_id":e.get("create_user_id"),"type":e.get("type"),"type_name":e.get("type_name"),"mime_type":l.findTypeByNode(e),"modify_date":e.get("modify_date"),"owner_user_id":e.get("owner_user_id"),"size":e.get("size_formatted"),"reserved_user_id":e.get("reserved_user_id")},"schema":{"properties":{"name":{"maxLength":248,"minLength":1,"readonly":!0,"required":!0,"title":"Name","type":"string"},"description":{"readonly":!0,"required":!1,"title":"Description","type":"string"},"create_date":{"readonly":!0,"required":!1,"title":"Created","type":"string","format":"datetime"},"create_user_id":{"readonly":!0,"required":!1,"title":"Created By","type":"otcs_user_picker"},"type":{"readonly":!0,"required":!1,"title":"Type","type":"integer"},"type_name":{"readonly":!0,"required":!1,"title":"Type","type":"string"},"modify_date":{"readonly":!0,"required":!1,"title":"Modified","type":"string","format":"datetime"},"owner_user_id":{"readonly":!0,"required":!1,"title":"Owned By","type":"otcs_user_picker"},"size":{"hidden":!1,"readonly":!0,"title":"Size","type":"string","tooltip":"838,049 bytes"},"mime_type":{"hidden":!1,"readonly":!0,"title":"Type","type":"string"}},"type":"object","title":"General"},"options":{"fields":{"name":{"hidden":!1,"hideInitValidationError":!0,"label":V.name,"readonly":!0,"type":"text"},"description":{"hidden":!1,"rows":5,"hideInitValidationError":!0,"label":V.description,"readonly":!0,"type":"textarea","placeholder":"Add description"},"create_date":{"hidden":!1,"hideInitValidationError":!0,"label":V.created,"readonly":!0,"type":"datetime","placeholder":"n/a"},"create_user_id":{"hidden":!1,"hideInitValidationError":!0,"label":V.createdBy,"readonly":!0,"type":"otcs_user","type_control":{"name":"Admin"},"placeholder":"n/a"},"type":{"hidden":!0,"hideInitValidationError":!0,"label":V.type,"readonly":!0,"type":"integer"},"type_name":{"hidden":!1,"hideInitValidationError":!0,"label":V.type,"readonly":!0,"type":"text"},"modify_date":{"hidden":!1,"hideInitValidationError":!0,"label":V.modified,"readonly":!0,"type":"datetime","placeholder":"n/a"},"owner_user_id":{"hidden":!1,"hideInitValidationError":!0,"label":V.ownedBy,"readonly":!0,"type":"otcs_user","type_control":{"name":"Admin"},"placeholder":"n/a"},"size":{"hidden":!1,"readonly":!0,"label":V.size,"placeholder":"n/a","type":"text"},"mime_type":{"hidden":!1,"readonly":!0,"label":V.type,"placeholder":"n/a","type":"text"}}}},this.options),this.options.model._addReserveInfo(this.options.model.attributes)},"_updateModel":function(){var t=this.options.node;e.extend(this.model.attributes.data,{"name":t.get("name"),"description":t.get("description"),"create_date":t.get("create_date"),"create_user_id":t.get("create_user_id"),"type":t.get("type"),"type_name":t.get("type_name"),"mime_type":l.findTypeByNode(t),"modify_date":t.get("modify_date"),"owner_user_id":t.get("owner_user_id"),"size":t.get("size_formatted"),"reserved_user_id":t.get("reserved_user_id")}),this.model._addReserveInfo(this.model.attributes)},"_getLayout":function(){var e=this.alpaca.data;return e.name=this.model.get("data").name,{"parent":"bootstrap-csui","layout":{"template":this.getOption("formTemplate").call(this,{"data":e,"mode":this.mode,"lang":V,"imgSrc":"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=","imgAlt":V.docPreviewImgAlt}),"bindings":this._getBindings()}}},"_getBindings":function(){var t={"name":"name_section","owner_user_id":".owner_section","modify_date":".modified_section","mime_type":".type_section","description":".description_section","size":".size_section","status":"status_section"};return this.model&&this.model.node&&this.model.node.get("reserved")&&(t=e.extend(t,{"reserve_info":".reserve_info"})),t},"updateForm":function(e){this._updateModel(),this._createModel(),a.prototype.constructor.call(this,this.options),this.metadataItemNameView=new o({"model":this.options.node,"container":this.options.node.parent,"containerCollection":this.options.containerCollection,"collection":this.options.collection,"context":this.options.context,"nameSchema":{},"commands":this.commands,"originatingView":this,"showDropdownMenu":!0}),this.listenTo(this.metadataItemNameView,"metadata:item:name:save",this._saveItemName),this.propagateEventsToViews(this.metadataItemNameView),a.prototype.updateForm.apply(this,arguments)},"updateRenderedForm":function(e){a.prototype.updateRenderedForm.apply(this,arguments),this._showNodeIcon(),this._showMetadataItemName(),this._showThumbnail(),this._addLocationView(),this._addCommentView(),this._addFavoriteView(),this._checkDescriptionContent(),this._checkEditPermission()},
"_validateAndSave":function(){var t=this.metadataItemNameView.getValue().trim(),i=this.metadataItemNameView.getInputBoxValue();i=i.trim(),0!==i.length&&t===i||this.metadataItemNameView.ItemNameBehavior.validateInputName(i).done(e.bind(function(e){if(!e)return!1;this.metadataItemNameView.setInputBoxValue(i),this.metadataItemNameView.setValue(i),this.metadataItemNameView.modelHasEmptyName=!1,this.metadataItemNameView.trigger("metadata:item:name:save",{"sender":this.metadataItemNameView})},this))},"_showThumbnail":function(){if(this.thumbnail=this.options.thumbnail||new p({"node":this.options.node}),this.listenTo(this.thumbnail,"load",this._showImage).listenTo(this.thumbnail,"error",this._showDefaultImage).listenTo(this,"destroy",e.bind(this._destroyThumbnail,this)),"create"!==this.mode&&!this.thumbnailSet){var t=this;this.thumbnailSet=!0,this.thumbnail.url?this._showImage():this.thumbnail.load(),this.$el.find(".thumbnail_section").click(function(){t.triggerMethod("execute:DefaultAction",t.options.node)})}},"_showImage":function(){var e=this,t=this.$el.find(".img-doc-preview"),i=this.$el.find(".thumbnail_not_loaded");t.attr("src",this.thumbnail.url),t.prop("tabindex","0"),t.one("load",function(o){o.target.clientHeight>=o.target.clientWidth?t.addClass("cs-form-img-vertical"):t.addClass("cs-form-img-horizontal"),t.addClass("cs-form-img-border"),i.addClass("binf-hidden"),t.removeClass("binf-hidden");var s=n.Event("tab:content:render");e.$el.trigger(s)})},"_showDefaultImage":function(){var e=this.$el.find(".img-doc-preview"),t=this.$el.find(".thumbnail_not_loaded"),i=l.findClassByNode(this.options.node);t.addClass(i),t.removeClass("thumbnail_empty"),t.removeClass("csui-icon-notification-error"),t.removeClass("binf-hidden"),e.addClass("binf-hidden");var o=n.Event("tab:content:render");this.$el.trigger(o)},"_showNodeIcon":function(){this._nodeIconView||(this._nodeIconView=new h({"el":this.$el.find(".csui-type-icon").get(0),"node":this.options.node}),this._nodeIconView.render(),t.trigger("show:breadcrumbsoverride"))},"_showMetadataItemName":function(){var e=this.metadataItemNameView.render();i.triggerMethodOn(e,"before:show",e,this),this.$el.find(".title-container").append(e.el)},"_addLocationView":function(){var e=this,t=new i.Region({"el":this.$el.find(this.ui.location)}),n=new u({"model":this._getParentNode(),"context":this.options.context,"formView":this});t.show(n);var o=new r(void 0,{"node":this._getParentNode()});this.listenTo(o,"error",function(t){e.$(".location-container").hide()}),o.fetch()},"_getParentNode":function(){return void 0===this.parentNode&&(this.parentNode=this.options.node.parent,this.parentNode.attributes.schema=this.options.model.attributes.schema,this.parentNode.attributes.schema.readonly=!0,this.parentNode.attributes.options=this.options.model.attributes.options,this.parentNode.attributes.data=this.parentNode.attributes.id),this.parentNode},"_addCommentView":function(){var e=this.options;e.model=this.options.node;var t=new f(e);new i.Region({"el":this.$el.find(".commentRegion")}).show(t)},"_checkDescriptionContent":function(){var e=this.$el.find(".description_section .cs-field-textarea-data");e&&0!==e.length?this.$el.find(".description_section").show():this.$el.find(".description_section").hide()},"_addFavoriteView":function(){var e=this.options;e.model=this.options.node,e.popoverAtBodyElement=!0;var t=new b(e);new i.Region({"el":this.$el.find(".favoriteRegion")}).show(t)},"_checkEditPermission":function(){var e=this.commands.findWhere({"signature":"Edit"}),t={"context":this.options.context,"nodes":new v([this.options.node]),"container":this.options.node.parent};e&&e.enabled(t)||this.$el.find(".edit-btn").addClass("binf-hidden")},"_destroyForm":function(){a.prototype._destroyForm.apply(this,arguments),this._destroyThumbnail()},"_destroyThumbnail":function(){this.thumbnail&&(this.thumbnail.destroy(),this.thumbnail=void 0),this.thumbnailSet=!1},"_updateFieldsToRefersh":function(){var e=this.$el.alpaca("get");if(e){var t=this.options.model.attributes,i=e.childrenByPropertyId[this.fieldToRefresh],n=t[this.fieldToRefresh];i&&i.getValue()!==n&&(i.setValue(n),i.refresh())}}});return e.extend(C.prototype,s),C}),csui.define("json!csui/widgets/document.overview/document.overview.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{widgetTitle}}","description":"{{widgetDescription}}","kind":"fullpage","schema":{"type":"object","properties":{"id":{"title":"{{idTitle}}","description":"{{idDescription}}","type":"integer"}},"required":["id"]},"options":{"fields":{"id":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[144]}}}}}}),csui.define("json!csui/widgets/metadata/metadata.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{widgetTitle}}","description":"{{widgetDescription}}","kind":"fullpage","schema":{"type":"object","properties":{"id":{"title":"{{idTitle}}","description":"{{idDescription}}","type":"integer"},"initialPanel":{"title":"{{initialPanelTitle}}","description":"{{initialPanelDescription}}","type":"string"}},"required":["id"]},"options":{"fields":{"id":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[]}}}}},"actions":[{"toolItems":"csui/widgets/metadata/header.dropdown.menu.items","toolItemMasks":"csui/widgets/metadata/header.dropdown.menu.items.mask","toolbars":[{"id":"dropdownMenuList","title":"{{dropdownMenuTitle}}","description":"{{dropdownMenuDescription}}"}]},{"toolItems":"csui/widgets/metadata/add.properties.menuitems","toolItemMasks":"csui/widgets/metadata/add.properties.menuitems.mask","toolbars":[{"id":"addPropertiesToolbar","title":"{{addPropertiesTitle}}","description":"{{addPropertiesDescription}}"}]}]}),csui.define("json!csui/widgets/metadata.navigation/metadata.navigation.manifest.json",{"$schema":"http://opentext.com/cs/json-schema/draft-04/schema#","title":"{{widgetTitle}}","description":"{{widgetDescription}}","kind":"fullpage","schema":{"type":"object","properties":{"id":{"title":"{{idTitle}}","description":"{{idDescription}}","type":"integer"},"initialPanel":{"title":"{{initialPanelTitle}}","description":"{{initialPanelDescription}}","type":"string"}},"required":["id"]},"options":{"fields":{"id":{"type":"otcs_node_picker","type_control":{"parameters":{"select_types":[]}}}}}}),csui.define("csui/widgets/document.overview/impl/nls/document.overview.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/document.overview/impl/nls/root/document.overview.manifest",{"widgetTitle":"Document Overview","widgetDescription":"Shows basic information about a document and offers the most often actions for it.","idTitle":"Document","idDescription":"A document to show the overview for"}),csui.define("csui/widgets/metadata/impl/nls/metadata.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata/impl/nls/root/metadata.manifest",{"widgetTitle":"Object Information","widgetDescription":"Shows information about an object and offers the most important actions for it.","idTitle":"Object","idDescription":"An object to show the information for","initialPanelTitle":"Object information","initialPanelDescription":"An object to show the information for","dropdownMenuTitle":"Object Context Menu","dropdownMenuDescription":"Context menu, which is displayed when clicking on the arrow on the right side of the name of the opened object.","addPropertiesTitle":"Add Feature Menu","addPropertiesDescription":"Drop-down menu, which is displayed when clicking on the plus on the right side of the property tabs."}),csui.define("csui/widgets/metadata.navigation/impl/nls/metadata.navigation.manifest",{"root":!0,"en-us":!1,"en":!1}),csui.define("csui/widgets/metadata.navigation/impl/nls/root/metadata.navigation.manifest",{"widgetTitle":"Object Information","widgetDescription":"Shows information about an object and offers the most important actions for it.","idTitle":"Object","idDescription":"An object to show the information for","initialPanelTitle":"Object information","initialPanelDescription":"An object to show the information for"}),csui.define("bundles/csui-metadata",["csui/controls/tableheader/comment/comment.button.view","csui/widgets/metadata/versions.toolbaritems","csui/widgets/metadata/impl/metadata.tabcontentcollection.view","csui/widgets/metadata/metadata.view","csui/widgets/metadata/metadata.properties.view","csui/widgets/metadata/metadata.action.one.item.properties.view","csui/widgets/metadata/metadata.add.categories.controller","csui/widgets/metadata/metadata.add.document.controller","csui/widgets/metadata/metadata.add.item.controller","csui/widgets/metadata/metadata.copy.move.items.controller","csui/widgets/metadata/impl/metadatanavigation/metadatanavigation.view","csui/widgets/metadata.navigation/metadata.navigation.view","csui/widgets/document.overview/document.overview.view","json!csui/widgets/document.overview/document.overview.manifest.json","json!csui/widgets/metadata/metadata.manifest.json","json!csui/widgets/metadata.navigation/metadata.navigation.manifest.json","i18n!csui/widgets/document.overview/impl/nls/document.overview.manifest","i18n!csui/widgets/metadata/impl/nls/metadata.manifest","i18n!csui/widgets/metadata.navigation/impl/nls/metadata.navigation.manifest","csui/widgets/metadata/add.properties.menuitems","csui/widgets/metadata/add.properties.menuitems.mask","csui/widgets/metadata/header.dropdown.menu.items","csui/widgets/metadata/header.dropdown.menu.items.mask","csui/widgets/metadata/versions.toolbaritems.mask","csui/widgets/metadata/metadata.general.action.fields"],{}),csui.require(["require","css"],function(e,t){t.styleLoad(e,"csui/bundles/csui-metadata",!0)});
//# sourceMappingURL=csui-metadata.js.map